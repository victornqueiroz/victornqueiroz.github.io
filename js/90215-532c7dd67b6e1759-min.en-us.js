(globalThis.webpackChunkextract_css=globalThis.webpackChunkextract_css||[]).push([["90215"],{660426:function(nt,kt,oe){"use strict";oe.d(kt,{DM:()=>xe,Iv:()=>j,b$:()=>ge,Y7:()=>xn,hJ:()=>yt,AC:()=>xt,pZ:()=>ce,Vo:()=>pe,oI:()=>ne,ZJ:()=>rt,zj:()=>ve,Tj:()=>ct});var H=oe(392338),Ie=oe(221107),Ge=oe(927215),De=oe(410633),Ye=function(e,t){return e.replace("{variant}",t)},rt=function(e,t){return t||Ye(e,"thumbnail")},ct=function(e){return Ye(e.alexandriaUrl,"playlist.m3u8")},mt={Production:"PRODUCTION",Staging:"STAGING",QA:"QA",Dev:"DEV"},ve=function(){var e,t,i,s=(e=(t=(i=window.Static)===null||i===void 0||(i=i.SQUARESPACE_CONTEXT)===null||i===void 0?void 0:i.appDomain)!==null&&t!==void 0?t:window.location.host)!==null&&e!==void 0?e:"",n=function(){return/localhost(:[0-9]+)?$/.test(s)},r=function(){return/dev\.(sqsp|squarespace)\.net$/.test(s)},o=function(){return/qa[0-9]+\.(sqsp|squarespace)\.net$/.test(s)},l=function(){return/stage\.(sqsp|squarespace)\.net$/.test(s)};return r()||n()?mt.Dev:o()?mt.QA:l()?mt.Staging:mt.Production},ge="2.6.1",pe={None:"none",Minimal:"minimal",Full:"full"},j={VideoAbortedByUser:"VIDEO_ABORTED_BY_USER",VideoCouldNotBeAccessed:"VIDEO_COULD_NOT_BE_ACCESSED",VideoCouldNotBeDecoded:"VIDEO_COULD_NOT_BE_DECODED",VideoCouldNotBePlayed:"VIDEO_COULD_NOT_BE_PLAYED",VideoPlaybackDriverUnsupported:"VIDEO_PLAYBACK_DRIVER_UNSUPPORTED",InvalidConfiguration:"VIDEO_PLAYER_INVALID_CONFIGURATION",UnknownMediaError:"VIDEO_PLAYER_UNKNOWN_MEDIA_ERROR",UnexpectedError:"VIDEO_PLAYER_UNEXPECTED_ERROR",UnauthorizedError:"VIDEO_PLAYER_UNAUTHORIZED"},Te=oe(675523),z=oe.n(Te),Ze=oe(668595),te=oe.n(Ze),ut=oe(20104),at=oe.n(ut),ht=oe(848664),Tt=oe.n(ht),Rt=oe(590670),Xt=oe.n(Rt),Bt=oe(778978),li=oe.n(Bt);function Qt(a,e,t){return e=Tt()(e),at()(a,x()?Reflect.construct(e,t||[],Tt()(a).constructor):e.apply(a,t))}function x(){try{var a=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(x=function(){return!!a})()}var yt=function(a){function e(t,i){var s;return z()(this,e),s=Qt(this,e,[i]),s.code=t,s.name="VideoPlayerError",s}return Xt()(e,a),te()(e,null,[{key:"fromError",value:function(i){var s;return i instanceof e?i:i instanceof MediaError?this.fromMediaError(i):new e(j.UnexpectedError,(s=i==null?void 0:i.message)!==null&&s!==void 0?s:void 0)}},{key:"fromMediaError",value:function(i){var s,n=e.mapMediaErrorCode(i);return new e(n,(s=i==null?void 0:i.message)!==null&&s!==void 0?s:void 0)}},{key:"fromPlayerMedia",value:function(i){var s=i instanceof HTMLVideoElement?i.error:void 0;return s===null?new e(j.UnknownMediaError):s?e.fromMediaError(s):new e(j.UnexpectedError)}},{key:"mapMediaErrorCode",value:function(i){switch(i.code){case MediaError.MEDIA_ERR_ABORTED:return j.VideoAbortedByUser;case MediaError.MEDIA_ERR_NETWORK:return j.VideoCouldNotBeAccessed;case MediaError.MEDIA_ERR_DECODE:return j.VideoCouldNotBeDecoded;case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:return j.VideoCouldNotBePlayed;default:return j.UnknownMediaError}}}])}(li()(Error)),yi=oe(642979),F=oe.n(yi),xt={Watching:"watching",Paused:"paused",Seeked:"seeked",Ended:"ended",Abandoned:"abandoned"};function Oe(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(a,s).enumerable})),t.push.apply(t,i)}return t}function Zt(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Oe(Object(t),!0).forEach(function(i){F()(a,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):Oe(Object(t)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(t,i))})}return a}var K=function(){function a(){z()(this,a)}return te()(a,null,[{key:"makeSegmentForNewSession",value:function(t,i){return{viewSessionId:t,startPosition:i,progressStartPosition:i,progressEndPosition:i}}},{key:"startPositionUpdated",value:function(t,i){return Zt(Zt({},t),{},{progressStartPosition:i,progressEndPosition:i})}},{key:"endPositionUpdated",value:function(t,i){return Zt(Zt({},t),{},{progressEndPosition:i})}}])}();function D(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(a,s).enumerable})),t.push.apply(t,i)}return t}function W(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?D(Object(t),!0).forEach(function(i){F()(a,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):D(Object(t)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(t,i))})}return a}var ce=function(){function a(e){var t=this;z()(this,a),F()(this,"hasPlayed",!1),F()(this,"onPlay",function(){t.hasPlayed=!0}),F()(this,"onTimeUpdate",function(i,s){if(a.isSeeking(i,t.segmentData)){t.onSeeked(i,s);return}t.segmentData=K.endPositionUpdated(t.segmentData,i),a.shouldReportSegment(t.segmentData)&&(t.options.onSendProgressEvent(W(W({},t.segmentData),{},{progressTriggerReason:xt.Watching,currentPosition:i})),t.segmentData=K.startPositionUpdated(t.segmentData,i))}),F()(this,"onPause",function(i,s){i>=s||(t.segmentData=K.endPositionUpdated(t.segmentData,i),t.options.onSendProgressEvent(W(W({},t.segmentData),{},{progressTriggerReason:xt.Paused,currentPosition:i})),t.segmentData=K.startPositionUpdated(t.segmentData,i))}),F()(this,"onEnd",function(i){t.segmentData=K.endPositionUpdated(t.segmentData,i),t.options.onSendProgressEvent(W(W({},t.segmentData),{},{progressTriggerReason:xt.Ended,currentPosition:i}))}),F()(this,"onPlayerAbandoned",function(){var i=t.segmentData.progressEndPosition-t.segmentData.progressStartPosition>0;i&&(t.options.onSendProgressEvent(W(W({},t.segmentData),{},{progressTriggerReason:xt.Abandoned,currentPosition:t.segmentData.progressEndPosition})),t.segmentData=K.startPositionUpdated(t.segmentData,t.segmentData.progressEndPosition))}),F()(this,"onNewViewSessionId",function(i){t.viewSessionId=i}),this.options=e,this.viewSessionId=e.initialViewSessionId,this.segmentData=K.makeSegmentForNewSession(this.viewSessionId,0)}return te()(a,[{key:"onSeeked",value:function(t,i){if(!this.hasPlayed){this.segmentData=K.makeSegmentForNewSession(this.viewSessionId,t);return}var s=this.segmentData.progressEndPosition/i,n=t/i,r=s>=1,o=r&&n===0;o||this.options.onSendProgressEvent(W(W({},this.segmentData),{},{progressTriggerReason:xt.Seeked,currentPosition:t})),this.segmentData=K.startPositionUpdated(this.segmentData,t),r&&n<1&&(this.viewSessionId=this.options.requestNewSession(),this.segmentData=K.makeSegmentForNewSession(this.viewSessionId,t))}}],[{key:"shouldReportSegment",value:function(t){var i=t.progressEndPosition-t.progressStartPosition;return i>=a.ReportAfterSecondsViewed}},{key:"isSeeking",value:function(t,i){var s=Math.abs(t-i.progressEndPosition);return s>=a.SeekTimeBufferInSeconds}}])}();F()(ce,"SeekTimeBufferInSeconds",1.5),F()(ce,"ReportAfterSecondsViewed",10);var ne=te()(function a(e){var t=this;z()(this,a),F()(this,"isPlayerReady",!1),F()(this,"hasViewedPlayer",!1),F()(this,"onReady",function(){t.isPlayerReady=!0}),F()(this,"onPlayerViewed",function(){t.hasViewedPlayer||!t.isPlayerReady||(t.options.onSendViewEvent({viewSessionId:t.viewSessionId}),t.hasViewedPlayer=!0)}),F()(this,"onNewViewSessionId",function(i){t.viewSessionId=i}),this.options=e,this.viewSessionId=e.initialViewSessionId}),xe=function(){function a(){z()(this,a)}return te()(a,[{key:"makeEventHooks",value:function(){var t=this;return{onReady:function(){return t.onReady()},onPlay:function(s,n){return t.onPlay(s,n)},onTimeUpdate:function(s,n){return t.onTimeUpdate(s,n)},onPause:function(s,n){return t.onPause(s,n)},onEnd:function(s,n){return t.onEnd(s,n)},onSeek:function(s,n){return t.onSeek(s,n)},onPaywallCtaClick:function(){return t.onPaywallCtaClick()}}}},{key:"onReady",value:function(){this.trackers.forEach(function(t){var i;return(i=t.onReady)===null||i===void 0?void 0:i.call(t)})}},{key:"onPlay",value:function(t,i){this.trackers.forEach(function(s){var n;return(n=s.onPlay)===null||n===void 0?void 0:n.call(s,t,i)})}},{key:"onTimeUpdate",value:function(t,i){this.trackers.forEach(function(s){var n;return(n=s.onTimeUpdate)===null||n===void 0?void 0:n.call(s,t,i)})}},{key:"onPause",value:function(t,i){this.trackers.forEach(function(s){var n;return(n=s.onPause)===null||n===void 0?void 0:n.call(s,t,i)})}},{key:"onEnd",value:function(t,i){this.trackers.forEach(function(s){var n;return(n=s.onEnd)===null||n===void 0?void 0:n.call(s,t,i)})}},{key:"onSeek",value:function(t,i){this.trackers.forEach(function(s){var n;return(n=s.onSeek)===null||n===void 0?void 0:n.call(s,t,i)})}},{key:"onPaywallCtaClick",value:function(){this.trackers.forEach(function(t){var i;return(i=t.onPaywallCtaClick)===null||i===void 0?void 0:i.call(t)})}},{key:"onNewSessionId",value:function(t){this.trackers.forEach(function(i){var s;return(s=i.onNewViewSessionId)===null||s===void 0?void 0:s.call(i,t)})}}])}(),Me=oe(279794),Be=oe.n(Me),be=oe(375377),Ne=oe.n(be),Lt=oe(457728),Fe=oe.n(Lt),Pe=oe(91913),Ni=oe.n(Pe),Qi="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAOEbW9vdgAAAGxtdmhkAAAAANOs4tLTrOLSAAAD6AAAA+gAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAABhpb2RzAAAAABCAgIAHAE/////+/wAAAoh0cmFrAAAAXHRraGQAAAAD06zi0tOs4tIAAAABAAAAAAAAA+gAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAACAAAAAUAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPoAACMoAABAAAAAAIAbWRpYQAAACBtZGhkAAAAANOs4tLTrOLSAAFfkAABX5BVxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAABq21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAWtzdGJsAAAAl3N0c2QAAAAAAAAAAQAAAIdhdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAACAAFABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAAMWF2Y0MBTUAo/+EAGWdNQCjspL881AQEBQAAAwABAAK/IA8YMZYBAAVo74GfIAAAABhzdHRzAAAAAAAAAAEAAAAFAABGUAAAABRzdHNzAAAAAAAAAAEAAAABAAAAOGN0dHMAAAAAAAAABQAAAAEAAIygAAAAAQABX5AAAAABAACMoAAAAAEAAAAAAAAAAQAARlAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAKHN0c3oAAAAAAAAAAAAAAAUAAAMQAAAADAAAAAsAAAALAAAACwAAACRzdGNvAAAAAAAAAAUAAAO0AAAGxAAABtAAAAbbAAAG5gAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC41IDIwMTYwMjExMDAAAAAIZnJlZQAAA0VtZGF0AAAC8AYF///s3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9NTAga2V5aW50X21pbj01IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9MTAgcmM9Y3JmIG1idHJlZT0xIGNyZj0xLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAGGWIhAH/+n/CVf/Y9kSiv//ffLnuYgWj/wAAAAhBmiQYv/7a4AAAAAdBnkJC/xXRAAAABwGeYUX/FdAAAAAHAZ5jRf8V0Q==",He={PlayLarge:"play-large",Restart:"restart",Rewind:"rewind",Play:"play",FastForward:"fast-forward",Progress:"progress",CurrentTime:"current-time",Duration:"duration",Mute:"mute",Volume:"volume",Captions:"captions",Settings:"settings",PiP:"pip",AirPlay:"airplay",Download:"download",Fullscreen:"fullscreen"},Ut={Play:"play",Time:"time",Mute:"mute",Volume:"volume",Settings:"settings",Fullscreen:"fullscreen",Progress:"progress",LoadingIndicator:"loading-indicator",NavigationIndicators:"navigation-indicators"},si=F()(F()(F()({},pe.None,[]),pe.Minimal,[Ut.Play,Ut.Progress,Ut.LoadingIndicator]),pe.Full,Object.values(Ut)),Le={Quality:"quality",Speed:"speed",Captions:"captions",Loop:"loop"},vi=[.5,.75,1,1.25,1.5,1.75,2],Fi=function(){function a(e,t,i){var s=this;z()(this,a),F()(this,"embedVideoAspectRatio",16/9),F()(this,"embedWrapperClassName","video-player__embed--fixed-width"),this.videoPlayerElement=e,this.player=t,this.isExternalProvider=i,i&&t.once("ready",function(){s.embedWrapper=t.elements.wrapper,s.forceEmbedAspectRatio(),s.resizeObserver=new ResizeObserver(function(){return s.forceEmbedAspectRatio()}),s.resizeObserver.observe(e)})}return te()(a,[{key:"destroy",value:function(){var t;(t=this.resizeObserver)===null||t===void 0||t.disconnect(),this.clearEmbedWrapperStyles()}},{key:"forceEmbedAspectRatio",value:function(){var t=this.videoPlayerElement.clientWidth,i=this.videoPlayerElement.clientHeight,s=Math.round(i*this.embedVideoAspectRatio);t>s?this.setEmbedWrapperStyles(s):this.clearEmbedWrapperStyles()}},{key:"setEmbedWrapperStyles",value:function(t){this.embedWrapper&&(this.embedWrapper.classList.add(this.embedWrapperClassName),this.embedWrapper.style.width="".concat(t,"px"))}},{key:"clearEmbedWrapperStyles",value:function(){this.embedWrapper&&(this.embedWrapper.classList.remove(this.embedWrapperClassName),this.embedWrapper.style.width="")}}])}();function he(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(a,s).enumerable})),t.push.apply(t,i)}return t}function Zi(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?he(Object(t),!0).forEach(function(i){F()(a,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):he(Object(t)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(t,i))})}return a}var bi={YouTube:"youtube",Vimeo:"vimeo"},Ct={HlsJs:"hls-js",NativeHls:"native-hls"},Dt=Zi(Zi({},bi),Ct);function Ji(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Mi={exports:{}};(function(a,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,r=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,c,h){if(h=h||{},l=l.trim(),c=c.trim(),!c){if(!h.alwaysNormalize)return l;var f=o.parseURL(l);if(!f)throw new Error("Error trying to parse base URL.");return f.path=o.normalizePath(f.path),o.buildURLFromParts(f)}var g=o.parseURL(c);if(!g)throw new Error("Error trying to parse relative URL.");if(g.scheme)return h.alwaysNormalize?(g.path=o.normalizePath(g.path),o.buildURLFromParts(g)):c;var y=o.parseURL(l);if(!y)throw new Error("Error trying to parse base URL.");if(!y.netLoc&&y.path&&y.path[0]!=="/"){var v=s.exec(y.path);y.netLoc=v[1],y.path=v[2]}y.netLoc&&!y.path&&(y.path="/");var A={scheme:y.scheme,netLoc:g.netLoc,path:null,params:g.params,query:g.query,fragment:g.fragment};if(!g.netLoc&&(A.netLoc=y.netLoc,g.path[0]!=="/"))if(!g.path)A.path=y.path,g.params||(A.params=y.params,g.query||(A.query=y.query));else{var S=y.path,L=S.substring(0,S.lastIndexOf("/")+1)+g.path;A.path=o.normalizePath(L)}return A.path===null&&(A.path=h.alwaysNormalize?o.normalizePath(g.path):g.path),o.buildURLFromParts(A)},parseURL:function(l){var c=i.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(n,"");l.length!==(l=l.replace(r,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};a.exports=o})()})(Mi);var Ti=Mi.exports;function Bi(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(a,s).enumerable})),t.push.apply(t,i)}return t}function ot(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Bi(Object(t),!0).forEach(function(i){Ui(a,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):Bi(Object(t)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(t,i))})}return a}function Ui(a,e,t){return e=Wt(e),e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function Ke(){return Ke=Object.assign?Object.assign.bind():function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(a[i]=t[i])}return a},Ke.apply(this,arguments)}function es(a,e){if(typeof a!="object"||a===null)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var i=t.call(a,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(a)}function Wt(a){var e=es(a,"string");return typeof e=="symbol"?e:String(e)}const se=Number.isFinite||function(a){return typeof a=="number"&&isFinite(a)},ci=Number.isSafeInteger||function(a){return typeof a=="number"&&Math.abs(a)<=ts},ts=Number.MAX_SAFE_INTEGER||9007199254740991;let b=function(a){return a.MEDIA_ATTACHING="hlsMediaAttaching",a.MEDIA_ATTACHED="hlsMediaAttached",a.MEDIA_DETACHING="hlsMediaDetaching",a.MEDIA_DETACHED="hlsMediaDetached",a.BUFFER_RESET="hlsBufferReset",a.BUFFER_CODECS="hlsBufferCodecs",a.BUFFER_CREATED="hlsBufferCreated",a.BUFFER_APPENDING="hlsBufferAppending",a.BUFFER_APPENDED="hlsBufferAppended",a.BUFFER_EOS="hlsBufferEos",a.BUFFER_FLUSHING="hlsBufferFlushing",a.BUFFER_FLUSHED="hlsBufferFlushed",a.MANIFEST_LOADING="hlsManifestLoading",a.MANIFEST_LOADED="hlsManifestLoaded",a.MANIFEST_PARSED="hlsManifestParsed",a.LEVEL_SWITCHING="hlsLevelSwitching",a.LEVEL_SWITCHED="hlsLevelSwitched",a.LEVEL_LOADING="hlsLevelLoading",a.LEVEL_LOADED="hlsLevelLoaded",a.LEVEL_UPDATED="hlsLevelUpdated",a.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",a.LEVELS_UPDATED="hlsLevelsUpdated",a.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",a.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",a.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",a.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",a.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",a.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",a.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",a.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",a.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",a.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",a.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",a.CUES_PARSED="hlsCuesParsed",a.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",a.INIT_PTS_FOUND="hlsInitPtsFound",a.FRAG_LOADING="hlsFragLoading",a.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",a.FRAG_LOADED="hlsFragLoaded",a.FRAG_DECRYPTED="hlsFragDecrypted",a.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",a.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",a.FRAG_PARSING_METADATA="hlsFragParsingMetadata",a.FRAG_PARSED="hlsFragParsed",a.FRAG_BUFFERED="hlsFragBuffered",a.FRAG_CHANGED="hlsFragChanged",a.FPS_DROP="hlsFpsDrop",a.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",a.ERROR="hlsError",a.DESTROYING="hlsDestroying",a.KEY_LOADING="hlsKeyLoading",a.KEY_LOADED="hlsKeyLoaded",a.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",a.BACK_BUFFER_REACHED="hlsBackBufferReached",a}({}),ue=function(a){return a.NETWORK_ERROR="networkError",a.MEDIA_ERROR="mediaError",a.KEY_SYSTEM_ERROR="keySystemError",a.MUX_ERROR="muxError",a.OTHER_ERROR="otherError",a}({}),N=function(a){return a.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",a.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",a.KEY_SYSTEM_NO_SESSION="keySystemNoSession",a.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",a.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",a.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",a.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",a.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",a.MANIFEST_LOAD_ERROR="manifestLoadError",a.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",a.MANIFEST_PARSING_ERROR="manifestParsingError",a.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",a.LEVEL_EMPTY_ERROR="levelEmptyError",a.LEVEL_LOAD_ERROR="levelLoadError",a.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",a.LEVEL_PARSING_ERROR="levelParsingError",a.LEVEL_SWITCH_ERROR="levelSwitchError",a.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",a.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",a.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",a.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",a.FRAG_LOAD_ERROR="fragLoadError",a.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",a.FRAG_DECRYPT_ERROR="fragDecryptError",a.FRAG_PARSING_ERROR="fragParsingError",a.FRAG_GAP="fragGap",a.REMUX_ALLOC_ERROR="remuxAllocError",a.KEY_LOAD_ERROR="keyLoadError",a.KEY_LOAD_TIMEOUT="keyLoadTimeOut",a.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",a.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",a.BUFFER_APPEND_ERROR="bufferAppendError",a.BUFFER_APPENDING_ERROR="bufferAppendingError",a.BUFFER_STALLED_ERROR="bufferStalledError",a.BUFFER_FULL_ERROR="bufferFullError",a.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",a.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",a.INTERNAL_EXCEPTION="internalException",a.INTERNAL_ABORTED="aborted",a.UNKNOWN="unknown",a}({});const je=function(){},Jt={trace:je,debug:je,log:je,warn:je,info:je,error:je};let $t=Jt;function is(a){const e=self.console[a];return e?e.bind(self.console,`[${a}] >`):je}function ss(a,...e){e.forEach(function(t){$t[t]=a[t]?a[t].bind(a):is(t)})}function Is(a,e){if(self.console&&a===!0||typeof a=="object"){ss(a,"debug","log","info","warn","error");try{$t.log(`Debug logs enabled for "${e}" in hls.js version 1.4.13`)}catch{$t=Jt}}else $t=Jt}const k=$t,Ei=/^(\d+)x(\d+)$/,X=/(.+?)=(".*?"|.*?)(?:,|$)/g;class We{constructor(e){typeof e=="string"&&(e=We.parseAttrList(e));for(const t in e)e.hasOwnProperty(t)&&(t.substring(0,2)==="X-"&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(t)),this[t]=e[t])}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const i=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)i[s]=parseInt(t.slice(s*2,s*2+2),16);return i}else return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}bool(e){return this[e]==="YES"}decimalResolution(e){const t=Ei.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const i={},s='"';for(X.lastIndex=0;(t=X.exec(e))!==null;){let n=t[2];n.indexOf(s)===0&&n.lastIndexOf(s)===n.length-1&&(n=n.slice(1,-1));const r=t[1].trim();i[r]=n}return i}}function ns(a){return a!=="ID"&&a!=="CLASS"&&a!=="START-DATE"&&a!=="DURATION"&&a!=="END-DATE"&&a!=="END-ON-NEXT"}function we(a){return a==="SCTE35-OUT"||a==="SCTE35-IN"}class $i{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const i=t.attr;for(const s in i)if(Object.prototype.hasOwnProperty.call(e,s)&&e[s]!==i[s]){k.warn(`DATERANGE tag attribute: "${s}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=s;break}e=Ke(new We({}),i,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const i=new Date(this.attr["END-DATE"]);se(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return e!==null?new Date(this._startDate.getTime()+e*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(se(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&se(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class ui{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Re={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Vt{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[Re.AUDIO]:null,[Re.VIDEO]:null,[Re.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,t){const i=e.split("@",2),s=[];i.length===1?s[0]=t?t.byteRangeEndOffset:0:s[0]=parseInt(i[1]),s[1]=parseInt(i[0])+s[0],this._byteRange=s}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Ti.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class Vi extends Vt{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new ui,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const i=Object.keys(this.levelkeys);if(i.length===1)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!se(this.programDateTime))return null;const e=se(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),i=t.length;if(i>1||i===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,s,n,r=!1){const{elementaryStreams:o}=this,l=o[e];if(!l){o[e]={startPTS:t,endPTS:i,startDTS:s,endDTS:n,partial:r};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,i),l.startDTS=Math.min(l.startDTS,s),l.endDTS=Math.max(l.endDTS,n)}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Re.AUDIO]=null,e[Re.VIDEO]=null,e[Re.AUDIOVIDEO]=null}}class rs extends Vt{constructor(e,t,i,s,n){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new ui,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const r=e.enumeratedString("BYTERANGE");r&&this.setByteRange(r,n),n&&(this.fragOffset=n.fragOffset+n.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}const Gi=10;class ks{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?se(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Gi}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function vt(a){return Uint8Array.from(atob(a),e=>e.charCodeAt(0))}function Ai(a){const e=as(a).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Ce(a){const e=function(i,s,n){const r=i[s];i[s]=i[n],i[n]=r};e(a,0,3),e(a,1,2),e(a,4,5),e(a,6,7)}function Rs(a){const e=a.split(":");let t=null;if(e[0]==="data"&&e.length===2){const i=e[1].split(";"),s=i[i.length-1].split(",");if(s.length===2){const n=s[0]==="base64",r=s[1];n?(i.splice(-1,1),t=vt(r)):t=Ai(r)}}return t}function as(a){return Uint8Array.from(unescape(encodeURIComponent(a)),e=>e.charCodeAt(0))}var Ue={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},lt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Si(a){switch(a){case lt.FAIRPLAY:return Ue.FAIRPLAY;case lt.PLAYREADY:return Ue.PLAYREADY;case lt.WIDEVINE:return Ue.WIDEVINE;case lt.CLEARKEY:return Ue.CLEARKEY}}var ni={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function Cs(a){if(a===ni.WIDEVINE)return Ue.WIDEVINE}function di(a){switch(a){case Ue.FAIRPLAY:return lt.FAIRPLAY;case Ue.PLAYREADY:return lt.PLAYREADY;case Ue.WIDEVINE:return lt.WIDEVINE;case Ue.CLEARKEY:return lt.CLEARKEY}}function xi(a){const{drmSystems:e,widevineLicenseUrl:t}=a,i=e?[Ue.FAIRPLAY,Ue.WIDEVINE,Ue.PLAYREADY,Ue.CLEARKEY].filter(s=>!!e[s]):[];return!i[Ue.WIDEVINE]&&t&&i.push(Ue.WIDEVINE),i}const os=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function ls(a,e,t,i){let s;switch(a){case Ue.FAIRPLAY:s=["cenc","sinf"];break;case Ue.WIDEVINE:case Ue.PLAYREADY:s=["cenc"];break;case Ue.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${a}`)}return Ds(s,e,t,i)}function Ds(a,e,t,i){return[{initDataTypes:a,persistentState:i.persistentState||"not-allowed",distinctiveIdentifier:i.distinctiveIdentifier||"not-allowed",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(n=>({contentType:`audio/mp4; codecs="${n}"`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(n=>({contentType:`video/mp4; codecs="${n}"`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function Yt(a,e,t){return Uint8Array.prototype.slice?a.slice(e,t):new Uint8Array(Array.prototype.slice.call(a,e,t))}const hi=(a,e)=>e+10<=a.length&&a[e]===73&&a[e+1]===68&&a[e+2]===51&&a[e+3]<255&&a[e+4]<255&&a[e+6]<128&&a[e+7]<128&&a[e+8]<128&&a[e+9]<128,Li=(a,e)=>e+10<=a.length&&a[e]===51&&a[e+1]===68&&a[e+2]===73&&a[e+3]<255&&a[e+4]<255&&a[e+6]<128&&a[e+7]<128&&a[e+8]<128&&a[e+9]<128,qt=(a,e)=>{const t=e;let i=0;for(;hi(a,e);){i+=10;const s=fi(a,e+6);i+=s,Li(a,e+10)&&(i+=10),e+=i}if(i>0)return a.subarray(t,t+i)},fi=(a,e)=>{let t=0;return t=(a[e]&127)<<21,t|=(a[e+1]&127)<<14,t|=(a[e+2]&127)<<7,t|=a[e+3]&127,t},u=(a,e)=>hi(a,e)&&fi(a,e+6)+10<=a.length-e,m=a=>{const e=T(a);for(let t=0;t<e.length;t++){const i=e[t];if(d(i))return $(i)}},d=a=>a&&a.key==="PRIV"&&a.info==="com.apple.streaming.transportStreamTimestamp",p=a=>{const e=String.fromCharCode(a[0],a[1],a[2],a[3]),t=fi(a,4),i=10;return{type:e,size:t,data:a.subarray(i,i+t)}},T=a=>{let e=0;const t=[];for(;hi(a,e);){const i=fi(a,e+6);e+=10;const s=e+i;for(;e+8<s;){const n=p(a.subarray(e)),r=E(n);r&&t.push(r),e+=n.size+10}Li(a,e)&&(e+=10)}return t},E=a=>a.type==="PRIV"?w(a):a.type[0]==="W"?_(a):I(a),w=a=>{if(a.size<2)return;const e=Q(a.data,!0),t=new Uint8Array(a.data.subarray(e.length+1));return{key:a.type,info:e,data:t.buffer}},I=a=>{if(a.size<2)return;if(a.type==="TXXX"){let t=1;const i=Q(a.data.subarray(t),!0);t+=i.length+1;const s=Q(a.data.subarray(t));return{key:a.type,info:i,data:s}}const e=Q(a.data.subarray(1));return{key:a.type,data:e}},_=a=>{if(a.type==="WXXX"){if(a.size<2)return;let t=1;const i=Q(a.data.subarray(t),!0);t+=i.length+1;const s=Q(a.data.subarray(t));return{key:a.type,info:i,data:s}}const e=Q(a.data);return{key:a.type,data:e}},$=a=>{if(a.data.byteLength===8){const e=new Uint8Array(a.data),t=e[3]&1;let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}},Q=(a,e=!1)=>{const t=q();if(t){const c=t.decode(a);if(e){const h=c.indexOf("\0");return h!==-1?c.substring(0,h):c}return c.replace(/\0/g,"")}const i=a.length;let s,n,r,o="",l=0;for(;l<i;){if(s=a[l++],s===0&&e)return o;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(s);break;case 12:case 13:n=a[l++],o+=String.fromCharCode((s&31)<<6|n&63);break;case 14:n=a[l++],r=a[l++],o+=String.fromCharCode((s&15)<<12|(n&63)<<6|(r&63)<<0);break}}return o};let le;function q(){return!le&&typeof self.TextDecoder<"u"&&(le=new self.TextDecoder("utf-8")),le}const re={hexDump:function(a){let e="";for(let t=0;t<a.length;t++){let i=a[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}},Ee=Math.pow(2,32)-1,Se=[].push,qe={video:1,audio:2,id3:3,text:4};function ae(a){return String.fromCharCode.apply(null,a)}function ze(a,e){const t=a[e]<<8|a[e+1];return t<0?65536+t:t}function U(a,e){const t=Ae(a,e);return t<0?4294967296+t:t}function Ae(a,e){return a[e]<<24|a[e+1]<<16|a[e+2]<<8|a[e+3]}function it(a,e,t){a[e]=t>>24,a[e+1]=t>>16&255,a[e+2]=t>>8&255,a[e+3]=t&255}function ye(a,e){const t=[];if(!e.length)return t;const i=a.byteLength;for(let s=0;s<i;){const n=U(a,s),r=ae(a.subarray(s+4,s+8)),o=n>1?s+n:i;if(r===e[0])if(e.length===1)t.push(a.subarray(s+8,o));else{const l=ye(a.subarray(s+8,o),e.slice(1));l.length&&Se.apply(t,l)}s=o}return t}function wt(a){const e=[],t=a[0];let i=8;const s=U(a,i);i+=4;const n=0,r=0;t===0?i+=8:i+=16,i+=2;let o=a.length+r;const l=ze(a,i);i+=2;for(let c=0;c<l;c++){let h=i;const f=U(a,h);h+=4;const g=f&2147483647;if((f&2147483648)>>>31===1)return k.warn("SIDX has hierarchical references (not supported)"),null;const v=U(a,h);h+=4,e.push({referenceSize:g,subsegmentDuration:v,info:{duration:v/s,start:o,end:o+g-1}}),o+=g,h+=4,i=h}return{earliestPresentationTime:n,timescale:s,version:t,referencesCount:l,references:e}}function Pt(a){const e=[],t=ye(a,["moov","trak"]);for(let s=0;s<t.length;s++){const n=t[s],r=ye(n,["tkhd"])[0];if(r){let o=r[0],l=o===0?12:20;const c=U(r,l),h=ye(n,["mdia","mdhd"])[0];if(h){o=h[0],l=o===0?12:20;const f=U(h,l),g=ye(n,["mdia","hdlr"])[0];if(g){const y=ae(g.subarray(8,12)),v={soun:Re.AUDIO,vide:Re.VIDEO}[y];if(v){const A=ye(n,["mdia","minf","stbl","stsd"])[0];let S;A&&(S=ae(A.subarray(12,16))),e[c]={timescale:f,type:v},e[v]={timescale:f,id:c,codec:S}}}}}}return ye(a,["moov","mvex","trex"]).forEach(s=>{const n=U(s,4),r=e[n];r&&(r.default={duration:U(s,12),flags:U(s,20)})}),e}function wi(a,e){if(!a||!e)return a;const t=e.keyId;return t&&e.isCommonEncryption&&ye(a,["moov","trak"]).forEach(s=>{const r=ye(s,["mdia","minf","stbl","stsd"])[0].subarray(8);let o=ye(r,["enca"]);const l=o.length>0;l||(o=ye(r,["encv"])),o.forEach(c=>{const h=l?c.subarray(28):c.subarray(78);ye(h,["sinf"]).forEach(g=>{const y=cs(g);if(y){const v=y.subarray(8,24);v.some(A=>A!==0)||(k.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${re.hexDump(v)} -> ${re.hexDump(t)}`),y.set(t,8))}})})}),a}function cs(a){const e=ye(a,["schm"])[0];if(e){const t=ae(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return ye(a,["schi","tenc"])[0]}return k.error("[eme] missing 'schm' box"),null}function Sa(a,e){return ye(e,["moof","traf"]).reduce((t,i)=>{const s=ye(i,["tfdt"])[0],n=s[0],r=ye(i,["tfhd"]).reduce((o,l)=>{const c=U(l,4),h=a[c];if(h){let f=U(s,4);if(n===1){if(f===Ee)return k.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),o;f*=Ee+1,f+=U(s,8)}const g=h.timescale||9e4,y=f/g;if(se(y)&&(o===null||y<o))return y}return o},null);return r!==null&&se(r)&&(t===null||r<t)?r:t},null)}function xa(a,e){let t=0,i=0,s=0;const n=ye(a,["moof","traf"]);for(let r=0;r<n.length;r++){const o=n[r],l=ye(o,["tfhd"])[0],c=U(l,4),h=e[c];if(!h)continue;const f=h.default,g=U(l,0)|(f==null?void 0:f.flags);let y=f==null?void 0:f.duration;g&8&&(g&2?y=U(l,12):y=U(l,8));const v=h.timescale||9e4,A=ye(o,["trun"]);for(let S=0;S<A.length;S++){if(t=La(A[S]),!t&&y){const L=U(A[S],4);t=y*L}h.type===Re.VIDEO?i+=t/v:h.type===Re.AUDIO&&(s+=t/v)}}if(i===0&&s===0){let r=0;const o=ye(a,["sidx"]);for(let l=0;l<o.length;l++){const c=wt(o[l]);c!=null&&c.references&&(r+=c.references.reduce((h,f)=>h+f.info.duration||0,0))}return r}return i||s}function La(a){const e=U(a,0);let t=8;e&1&&(t+=4),e&4&&(t+=4);let i=0;const s=U(a,4);for(let n=0;n<s;n++){if(e&256){const r=U(a,t);i+=r,t+=4}e&512&&(t+=4),e&1024&&(t+=4),e&2048&&(t+=4)}return i}function wa(a,e,t){ye(e,["moof","traf"]).forEach(i=>{ye(i,["tfhd"]).forEach(s=>{const n=U(s,4),r=a[n];if(!r)return;const o=r.timescale||9e4;ye(i,["tfdt"]).forEach(l=>{const c=l[0];let h=U(l,4);if(c===0)h-=t*o,h=Math.max(h,0),it(l,4,h);else{h*=Math.pow(2,32),h+=U(l,8),h-=t*o,h=Math.max(h,0);const f=Math.floor(h/(Ee+1)),g=Math.floor(h%(Ee+1));it(l,4,f),it(l,8,g)}})})})}function Ia(a){const e={valid:null,remainder:null},t=ye(a,["moof"]);if(t){if(t.length<2)return e.remainder=a,e}else return e;const i=t[t.length-1];return e.valid=Yt(a,0,i.byteOffset-8),e.remainder=Yt(a,i.byteOffset-8),e}function mi(a,e){const t=new Uint8Array(a.length+e.length);return t.set(a),t.set(e,a.length),t}function wn(a,e){const t=[],i=e.samples,s=e.timescale,n=e.id;let r=!1;return ye(i,["moof"]).map(l=>{const c=l.byteOffset-8;ye(l,["traf"]).map(f=>{const g=ye(f,["tfdt"]).map(y=>{const v=y[0];let A=U(y,4);return v===1&&(A*=Math.pow(2,32),A+=U(y,8)),A/s})[0];return g!==void 0&&(a=g),ye(f,["tfhd"]).map(y=>{const v=U(y,4),A=U(y,0)&16777215,S=(A&1)!==0,L=(A&2)!==0,C=(A&8)!==0;let R=0;const M=(A&16)!==0;let O=0;const J=(A&32)!==0;let G=8;v===n&&(S&&(G+=8),L&&(G+=4),C&&(R=U(y,G),G+=4),M&&(O=U(y,G),G+=4),J&&(G+=4),e.type==="video"&&(r=ka(e.codec)),ye(f,["trun"]).map(Y=>{const Z=Y[0],B=U(Y,0)&16777215,de=(B&1)!==0;let ee=0;const $e=(B&4)!==0,bt=(B&256)!==0;let et=0;const st=(B&512)!==0;let tt=0;const ie=(B&1024)!==0,fe=(B&2048)!==0;let Ve=0;const Qe=U(Y,4);let _e=8;de&&(ee=U(Y,_e),_e+=4),$e&&(_e+=4);let dt=ee+c;for(let Ft=0;Ft<Qe;Ft++){if(bt?(et=U(Y,_e),_e+=4):et=R,st?(tt=U(Y,_e),_e+=4):tt=O,ie&&(_e+=4),fe&&(Z===0?Ve=U(Y,_e):Ve=Ae(Y,_e),_e+=4),e.type===Re.VIDEO){let jt=0;for(;jt<tt;){const Mt=U(i,dt);if(dt+=4,Ra(r,i[dt])){const pi=i.subarray(dt,dt+Mt);In(pi,r?2:1,a+Ve/s,t)}dt+=Mt,jt+=Mt+4}}a+=et/s}}))})})}),t}function ka(a){if(!a)return!1;const e=a.indexOf("."),t=e<0?a:a.substring(0,e);return t==="hvc1"||t==="hev1"||t==="dvh1"||t==="dvhe"}function Ra(a,e){if(a){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function In(a,e,t,i){const s=kn(a);let n=0;n+=e;let r=0,o=0,l=!1,c=0;for(;n<s.length;){r=0;do{if(n>=s.length)break;c=s[n++],r+=c}while(c===255);o=0;do{if(n>=s.length)break;c=s[n++],o+=c}while(c===255);const h=s.length-n;if(!l&&r===4&&n<s.length){if(l=!0,s[n++]===181){const g=ze(s,n);if(n+=2,g===49){const y=U(s,n);if(n+=4,y===1195456820){const v=s[n++];if(v===3){const A=s[n++],S=31&A,L=64&A,C=L?2+S*3:0,R=new Uint8Array(C);if(L){R[0]=A;for(let M=1;M<C;M++)R[M]=s[n++]}i.push({type:v,payloadType:r,pts:t,bytes:R})}}}}}else if(r===5&&o<h){if(l=!0,o>16){const f=[];for(let v=0;v<16;v++){const A=s[n++].toString(16);f.push(A.length==1?"0"+A:A),(v===3||v===5||v===7||v===9)&&f.push("-")}const g=o-16,y=new Uint8Array(g);for(let v=0;v<g;v++)y[v]=s[n++];i.push({payloadType:r,pts:t,uuid:f.join(""),userData:Q(y),userDataBytes:y})}}else if(o<h)n+=o;else if(o>h)break}}function kn(a){const e=a.byteLength,t=[];let i=1;for(;i<e-2;)a[i]===0&&a[i+1]===0&&a[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return a;const s=e-t.length,n=new Uint8Array(s);let r=0;for(i=0;i<s;r++,i++)r===t[0]&&(r++,t.shift()),n[i]=a[r];return n}function Ca(a){const e=a[0];let t="",i="",s=0,n=0,r=0,o=0,l=0,c=0;if(e===0){for(;ae(a.subarray(c,c+1))!=="\0";)t+=ae(a.subarray(c,c+1)),c+=1;for(t+=ae(a.subarray(c,c+1)),c+=1;ae(a.subarray(c,c+1))!=="\0";)i+=ae(a.subarray(c,c+1)),c+=1;i+=ae(a.subarray(c,c+1)),c+=1,s=U(a,12),n=U(a,16),o=U(a,20),l=U(a,24),c=28}else if(e===1){c+=4,s=U(a,c),c+=4;const f=U(a,c);c+=4;const g=U(a,c);for(c+=4,r=2**32*f+g,ci(r)||(r=Number.MAX_SAFE_INTEGER,k.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=U(a,c),c+=4,l=U(a,c),c+=4;ae(a.subarray(c,c+1))!=="\0";)t+=ae(a.subarray(c,c+1)),c+=1;for(t+=ae(a.subarray(c,c+1)),c+=1;ae(a.subarray(c,c+1))!=="\0";)i+=ae(a.subarray(c,c+1)),c+=1;i+=ae(a.subarray(c,c+1)),c+=1}const h=a.subarray(c,a.byteLength);return{schemeIdUri:t,value:i,timeScale:s,presentationTime:r,presentationTimeDelta:n,eventDuration:o,id:l,payload:h}}function Da(a,...e){const t=e.length;let i=8,s=t;for(;s--;)i+=e[s].byteLength;const n=new Uint8Array(i);for(n[0]=i>>24&255,n[1]=i>>16&255,n[2]=i>>8&255,n[3]=i&255,n.set(a,4),s=0,i=8;s<t;s++)n.set(e[s],i),i+=e[s].byteLength;return n}function Pa(a,e,t){if(a.byteLength!==16)throw new RangeError("Invalid system id");let i,s;if(e){i=1,s=new Uint8Array(e.length*16);for(let o=0;o<e.length;o++){const l=e[o];if(l.byteLength!==16)throw new RangeError("Invalid key");s.set(l,o*16)}}else i=0,s=new Uint8Array;let n;i>0?(n=new Uint8Array(4),e.length>0&&new DataView(n.buffer).setUint32(0,e.length,!1)):n=new Uint8Array;const r=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(r.buffer).setUint32(0,t.byteLength,!1),Da([112,115,115,104],new Uint8Array([i,0,0,0]),a,n,s,r,t||new Uint8Array)}function _a(a){if(!(a instanceof ArrayBuffer)||a.byteLength<32)return null;const e={version:0,systemId:"",kids:null,data:null},t=new DataView(a),i=t.getUint32(0);if(a.byteLength!==i&&i>44||t.getUint32(4)!==1886614376||(e.version=t.getUint32(8)>>>24,e.version>1))return null;e.systemId=re.hexDump(new Uint8Array(a,12,16));const n=t.getUint32(28);if(e.version===0){if(i-32<n)return null;e.data=new Uint8Array(a,32,n)}else if(e.version===1){e.kids=[];for(let r=0;r<n;r++)e.kids.push(new Uint8Array(a,32+r*16,16))}return e}let us={};class Hi{static clearKeyUriToKeyIdMap(){us={}}constructor(e,t,i,s=[1],n=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=s,this.iv=n,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&e!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case lt.FAIRPLAY:case lt.WIDEVINE:case lt.PLAYREADY:case lt.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method==="AES-128"&&!this.iv&&k.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const i=Oa(e);return new Hi(this.method,this.uri,"identity",this.keyFormatVersions,i)}const t=Rs(this.uri);if(t)switch(this.keyFormat){case lt.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case lt.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Pa(i,null,t);const s=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),n=String.fromCharCode.apply(null,Array.from(s)),r=n.substring(n.indexOf("<"),n.length),c=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(c){const h=c.childNodes[0]?c.childNodes[0].nodeValue:c.getAttribute("VALUE");if(h){const f=vt(h).subarray(0,16);Ce(f),this.keyId=f}}break}default:{let i=t.subarray(0,16);if(i.length!==16){const s=new Uint8Array(16);s.set(i,16-i.length),i=s}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i=us[this.uri];if(!i){const s=Object.keys(us).length%Number.MAX_SAFE_INTEGER;i=new Uint8Array(16),new DataView(i.buffer,12,4).setUint32(0,s),us[this.uri]=i}this.keyId=i}return this}}function Oa(a){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=a>>8*(15-t)&255;return e}const Rn=/\{\$([a-zA-Z0-9-_]+)\}/g;function Cn(a){return Rn.test(a)}function Et(a,e,t){if(a.variableList!==null||a.hasVariableRefs)for(let i=t.length;i--;){const s=t[i],n=e[s];n&&(e[s]=Ps(a,n))}}function Ps(a,e){if(a.variableList!==null||a.hasVariableRefs){const t=a.variableList;return e.replace(Rn,i=>{const s=i.substring(2,i.length-1),n=t==null?void 0:t[s];return n===void 0?(a.playlistParsingError||(a.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),i):n})}return e}function Dn(a,e,t){let i=a.variableList;i||(a.variableList=i={});let s,n;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const r=new self.URL(t).searchParams;if(r.has(s))n=r.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(r){a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${r.message}`))}}else s=e.NAME,n=e.VALUE;s in i?a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):i[s]=n||""}function Na(a,e,t){const i=e.IMPORT;if(t&&i in t){let s=a.variableList;s||(a.variableList=s={}),s[i]=t[i]}else a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}function ds(){if(!(typeof self>"u"))return self.MediaSource||self.WebKitMediaSource}const Fa={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},Pn=ds();function Ma(a,e){const t=Fa[e];return!!t&&t[a.slice(0,4)]===!0}function _s(a,e){var t;return(t=Pn==null?void 0:Pn.isTypeSupported(`${e||"video"}/mp4;codecs="${a}"`))!=null?t:!1}const _n=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,On=/#EXT-X-MEDIA:(.*)/g,Ba=/^#EXT(?:INF|-X-TARGETDURATION):/m,Nn=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Ua=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Gt{static findGroup(e,t){for(let i=0;i<e.length;i++){const s=e[i];if(s.id===t)return s}}static convertAVC1ToAVCOTI(e){const t=e.split(".");if(t.length>2){let i=t.shift()+".";return i+=parseInt(t.shift()).toString(16),i+=("000"+parseInt(t.shift()).toString(16)).slice(-4),i}return e}static resolve(e,t){return Ti.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Ba.test(e)}static parseMasterPlaylist(e,t){const i=Cn(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},n=[];_n.lastIndex=0;let r;for(;(r=_n.exec(e))!=null;)if(r[1]){var o;const c=new We(r[1]);Et(s,c,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const h=Ps(s,r[2]),f={attrs:c,bitrate:c.decimalInteger("AVERAGE-BANDWIDTH")||c.decimalInteger("BANDWIDTH"),name:c.NAME,url:Gt.resolve(h,t)},g=c.decimalResolution("RESOLUTION");g&&(f.width=g.width,f.height=g.height),$a((c.CODECS||"").split(/[ ,]+/).filter(y=>y),f),f.videoCodec&&f.videoCodec.indexOf("avc1")!==-1&&(f.videoCodec=Gt.convertAVC1ToAVCOTI(f.videoCodec)),(o=f.unknownCodecs)!=null&&o.length||n.push(f),s.levels.push(f)}else if(r[3]){const c=r[3],h=r[4];switch(c){case"SESSION-DATA":{const f=new We(h);Et(s,f,["DATA-ID","LANGUAGE","VALUE","URI"]);const g=f["DATA-ID"];g&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[g]=f);break}case"SESSION-KEY":{const f=Fn(h,t,s);f.encrypted&&f.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(f)):k.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${h}"`);break}case"DEFINE":{{const f=new We(h);Et(s,f,["NAME","VALUE","QUERYPARAM"]),Dn(s,f,t)}break}case"CONTENT-STEERING":{const f=new We(h);Et(s,f,["SERVER-URI","PATHWAY-ID"]),s.contentSteering={uri:Gt.resolve(f["SERVER-URI"],t),pathwayId:f["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=Mn(h);break}}}const l=n.length>0&&n.length<s.levels.length;return s.levels=l?n:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,i){let s;const n={},r=i.levels,o={AUDIO:r.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:r.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(On.lastIndex=0;(s=On.exec(e))!==null;){const c=new We(s[1]),h=c.TYPE;if(h){const f=o[h],g=n[h]||[];n[h]=g,Et(i,c,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const y={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",instreamId:c["INSTREAM-ID"],name:c.NAME||c.LANGUAGE||"",type:h,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:c.LANGUAGE,url:c.URI?Gt.resolve(c.URI,t):""};if(f!=null&&f.length){const v=Gt.findGroup(f,y.groupId)||f[0];Bn(y,v,"audioCodec"),Bn(y,v,"textCodec")}g.push(y)}}return n}static parseLevelPlaylist(e,t,i,s,n,r){const o=new ks(t),l=o.fragments;let c=null,h=0,f=0,g=0,y=0,v=null,A=new Vi(s,t),S,L,C,R=-1,M=!1;for(Nn.lastIndex=0,o.m3u8=e,o.hasVariableRefs=Cn(e);(S=Nn.exec(e))!==null;){M&&(M=!1,A=new Vi(s,t),A.start=g,A.sn=h,A.cc=y,A.level=i,c&&(A.initSegment=c,A.rawProgramDateTime=c.rawProgramDateTime,c.rawProgramDateTime=null));const Y=S[1];if(Y){A.duration=parseFloat(Y);const Z=(" "+S[2]).slice(1);A.title=Z||null,A.tagList.push(Z?["INF",Y,Z]:["INF",Y])}else if(S[3]){if(se(A.duration)){A.start=g,C&&Vn(A,C,o),A.sn=h,A.level=i,A.cc=y,A.urlId=n,l.push(A);const Z=(" "+S[3]).slice(1);A.relurl=Ps(o,Z),Un(A,v),v=A,g+=A.duration,h++,f=0,M=!0}}else if(S[4]){const Z=(" "+S[4]).slice(1);v?A.setByteRange(Z,v):A.setByteRange(Z)}else if(S[5])A.rawProgramDateTime=(" "+S[5]).slice(1),A.tagList.push(["PROGRAM-DATE-TIME",A.rawProgramDateTime]),R===-1&&(R=l.length);else{if(S=S[0].match(Ua),!S){k.warn("No matches on slow regex match for level playlist!");continue}for(L=1;L<S.length&&!(typeof S[L]<"u");L++);const Z=(" "+S[L]).slice(1),B=(" "+S[L+1]).slice(1),de=S[L+2]?(" "+S[L+2]).slice(1):"";switch(Z){case"PLAYLIST-TYPE":o.type=B.toUpperCase();break;case"MEDIA-SEQUENCE":h=o.startSN=parseInt(B);break;case"SKIP":{const ee=new We(B);Et(o,ee,["RECENTLY-REMOVED-DATERANGES"]);const $e=ee.decimalInteger("SKIPPED-SEGMENTS");if(se($e)){o.skippedSegments=$e;for(let et=$e;et--;)l.unshift(null);h+=$e}const bt=ee.enumeratedString("RECENTLY-REMOVED-DATERANGES");bt&&(o.recentlyRemovedDateranges=bt.split("	"));break}case"TARGETDURATION":o.targetduration=Math.max(parseInt(B),1);break;case"VERSION":o.version=parseInt(B);break;case"EXTM3U":break;case"ENDLIST":o.live=!1;break;case"#":(B||de)&&A.tagList.push(de?[B,de]:[B]);break;case"DISCONTINUITY":y++,A.tagList.push(["DIS"]);break;case"GAP":A.gap=!0,A.tagList.push([Z]);break;case"BITRATE":A.tagList.push([Z,B]);break;case"DATERANGE":{const ee=new We(B);Et(o,ee,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),Et(o,ee,ee.clientAttrs);const $e=new $i(ee,o.dateRanges[ee.ID]);$e.isValid||o.skippedSegments?o.dateRanges[$e.id]=$e:k.warn(`Ignoring invalid DATERANGE tag: "${B}"`),A.tagList.push(["EXT-X-DATERANGE",B]);break}case"DEFINE":{{const ee=new We(B);Et(o,ee,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in ee?Na(o,ee,r):Dn(o,ee,t)}break}case"DISCONTINUITY-SEQUENCE":y=parseInt(B);break;case"KEY":{const ee=Fn(B,t,o);if(ee.isSupported()){if(ee.method==="NONE"){C=void 0;break}C||(C={}),C[ee.keyFormat]&&(C=Ke({},C)),C[ee.keyFormat]=ee}else k.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${B}"`);break}case"START":o.startTimeOffset=Mn(B);break;case"MAP":{const ee=new We(B);if(Et(o,ee,["BYTERANGE","URI"]),A.duration){const $e=new Vi(s,t);$n($e,ee,i,C),c=$e,A.initSegment=c,c.rawProgramDateTime&&!A.rawProgramDateTime&&(A.rawProgramDateTime=c.rawProgramDateTime)}else $n(A,ee,i,C),c=A,M=!0;break}case"SERVER-CONTROL":{const ee=new We(B);o.canBlockReload=ee.bool("CAN-BLOCK-RELOAD"),o.canSkipUntil=ee.optionalFloat("CAN-SKIP-UNTIL",0),o.canSkipDateRanges=o.canSkipUntil>0&&ee.bool("CAN-SKIP-DATERANGES"),o.partHoldBack=ee.optionalFloat("PART-HOLD-BACK",0),o.holdBack=ee.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const ee=new We(B);o.partTarget=ee.decimalFloatingPoint("PART-TARGET");break}case"PART":{let ee=o.partList;ee||(ee=o.partList=[]);const $e=f>0?ee[ee.length-1]:void 0,bt=f++,et=new We(B);Et(o,et,["BYTERANGE","URI"]);const st=new rs(et,A,t,bt,$e);ee.push(st),A.duration+=st.duration;break}case"PRELOAD-HINT":{const ee=new We(B);Et(o,ee,["URI"]),o.preloadHint=ee;break}case"RENDITION-REPORT":{const ee=new We(B);Et(o,ee,["URI"]),o.renditionReports=o.renditionReports||[],o.renditionReports.push(ee);break}default:k.warn(`line parsed but not handled: ${S}`);break}}}v&&!v.relurl?(l.pop(),g-=v.duration,o.partList&&(o.fragmentHint=v)):o.partList&&(Un(A,v),A.cc=y,o.fragmentHint=A,C&&Vn(A,C,o));const O=l.length,J=l[0],G=l[O-1];if(g+=o.skippedSegments*o.targetduration,g>0&&O&&G){o.averagetargetduration=g/O;const Y=G.sn;o.endSN=Y!=="initSegment"?Y:0,o.live||(G.endList=!0),J&&(o.startCC=J.cc)}else o.endSN=0,o.startCC=0;return o.fragmentHint&&(g+=o.fragmentHint.duration),o.totalduration=g,o.endCC=y,R>0&&Va(l,R),o}}function Fn(a,e,t){var i,s;const n=new We(a);Et(t,n,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const r=(i=n.METHOD)!=null?i:"",o=n.URI,l=n.hexadecimalInteger("IV"),c=n.KEYFORMATVERSIONS,h=(s=n.KEYFORMAT)!=null?s:"identity";o&&n.IV&&!l&&k.error(`Invalid IV: ${n.IV}`);const f=o?Gt.resolve(o,e):"",g=(c||"1").split("/").map(Number).filter(Number.isFinite);return new Hi(r,f,h,g,l)}function Mn(a){const t=new We(a).decimalFloatingPoint("TIME-OFFSET");return se(t)?t:null}function $a(a,e){["video","audio","text"].forEach(t=>{const i=a.filter(s=>Ma(s,t));if(i.length){const s=i.filter(n=>n.lastIndexOf("avc1",0)===0||n.lastIndexOf("mp4a",0)===0);e[`${t}Codec`]=s.length>0?s[0]:i[0],a=a.filter(n=>i.indexOf(n)===-1)}}),e.unknownCodecs=a}function Bn(a,e,t){const i=e[t];i&&(a[t]=i)}function Va(a,e){let t=a[e];for(let i=e;i--;){const s=a[i];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function Un(a,e){a.rawProgramDateTime?a.programDateTime=Date.parse(a.rawProgramDateTime):e!=null&&e.programDateTime&&(a.programDateTime=e.endProgramDateTime),se(a.programDateTime)||(a.programDateTime=null,a.rawProgramDateTime=null)}function $n(a,e,t,i){a.relurl=e.URI,e.BYTERANGE&&a.setByteRange(e.BYTERANGE),a.level=t,a.sn="initSegment",i&&(a.levelkeys=i),a.initSegment=null}function Vn(a,e,t){a.levelkeys=e;const{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&i.push(a)}var ke={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},me={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function Gn(a){const{type:e}=a;switch(e){case ke.AUDIO_TRACK:return me.AUDIO;case ke.SUBTITLE_TRACK:return me.SUBTITLE;default:return me.MAIN}}function Os(a,e){let t=a.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class Ga{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(b.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(b.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,s=t.loader,n=i||s,r=new n(t);return this.loaders[e.type]=r,r}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ke.MANIFEST,url:i,deliveryDirectives:null})}onLevelLoading(e,t){const{id:i,level:s,url:n,deliveryDirectives:r}=t;this.load({id:i,level:s,responseType:"text",type:ke.LEVEL,url:n,deliveryDirectives:r})}onAudioTrackLoading(e,t){const{id:i,groupId:s,url:n,deliveryDirectives:r}=t;this.load({id:i,groupId:s,level:null,responseType:"text",type:ke.AUDIO_TRACK,url:n,deliveryDirectives:r})}onSubtitleTrackLoading(e,t){const{id:i,groupId:s,url:n,deliveryDirectives:r}=t;this.load({id:i,groupId:s,level:null,responseType:"text",type:ke.SUBTITLE_TRACK,url:n,deliveryDirectives:r})}load(e){var t;const i=this.hls.config;let s=this.getInternalLoader(e);if(s){const c=s.context;if(c&&c.url===e.url){k.trace("[playlist-loader]: playlist request ongoing");return}k.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let n;if(e.type===ke.MANIFEST?n=i.manifestLoadPolicy.default:n=Ke({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),(t=e.deliveryDirectives)!=null&&t.part){let c;if(e.type===ke.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===ke.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===ke.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const h=c.partTarget,f=c.targetduration;if(h&&f){const g=Math.max(h*3,f*.8)*1e3;n=Ke({},n,{maxTimeToFirstByteMs:Math.min(g,n.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(g,n.maxTimeToFirstByteMs)})}}}const r=n.errorRetry||n.timeoutRetry||{},o={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:r.maxNumRetry||0,retryDelay:r.retryDelayMs||0,maxRetryDelay:r.maxRetryDelayMs||0},l={onSuccess:(c,h,f,g)=>{const y=this.getInternalLoader(f);this.resetInternalLoader(f.type);const v=c.data;if(v.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(c,f,new Error("no EXTM3U delimiter"),g||null,h);return}h.parsing.start=performance.now(),Gt.isMediaPlaylist(v)?this.handleTrackOrLevelPlaylist(c,h,f,g||null,y):this.handleMasterPlaylist(c,h,f,g)},onError:(c,h,f,g)=>{this.handleNetworkError(h,f,!1,c,g)},onTimeout:(c,h,f)=>{this.handleNetworkError(h,f,!0,void 0,c)}};s.load(e,o,l)}handleMasterPlaylist(e,t,i,s){const n=this.hls,r=e.data,o=Os(e,i),l=Gt.parseMasterPlaylist(r,o);if(l.playlistParsingError){this.handleManifestParsingError(e,i,l.playlistParsingError,s,t);return}const{contentSteering:c,levels:h,sessionData:f,sessionKeys:g,startTimeOffset:y,variableList:v}=l;this.variableList=v;const{AUDIO:A=[],SUBTITLES:S,"CLOSED-CAPTIONS":L}=Gt.parseMasterPlaylistMedia(r,o,l);A.length&&!A.some(R=>!R.url)&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(k.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),A.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new We({}),bitrate:0,url:""})),n.trigger(b.MANIFEST_LOADED,{levels:h,audioTracks:A,subtitles:S,captions:L,contentSteering:c,url:o,stats:t,networkDetails:s,sessionData:f,sessionKeys:g,startTimeOffset:y,variableList:v})}handleTrackOrLevelPlaylist(e,t,i,s,n){const r=this.hls,{id:o,level:l,type:c}=i,h=Os(e,i),f=se(o)?o:0,g=se(l)?l:f,y=Gn(i),v=Gt.parseLevelPlaylist(e.data,h,g,y,f,this.variableList);if(c===ke.MANIFEST){const A={attrs:new We({}),bitrate:0,details:v,name:"",url:h};r.trigger(b.MANIFEST_LOADED,{levels:[A],audioTracks:[],url:h,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=v,this.handlePlaylistLoaded(v,e,t,i,s,n)}handleManifestParsingError(e,t,i,s,n){this.hls.trigger(b.ERROR,{type:ue.NETWORK_ERROR,details:N.MANIFEST_PARSING_ERROR,fatal:t.type===ke.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:s,stats:n})}handleNetworkError(e,t,i=!1,s,n){let r=`A network ${i?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===ke.LEVEL?r+=`: ${e.level} id: ${e.id}`:(e.type===ke.AUDIO_TRACK||e.type===ke.SUBTITLE_TRACK)&&(r+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(r);k.warn(`[playlist-loader]: ${r}`);let l=N.UNKNOWN,c=!1;const h=this.getInternalLoader(e);switch(e.type){case ke.MANIFEST:l=i?N.MANIFEST_LOAD_TIMEOUT:N.MANIFEST_LOAD_ERROR,c=!0;break;case ke.LEVEL:l=i?N.LEVEL_LOAD_TIMEOUT:N.LEVEL_LOAD_ERROR,c=!1;break;case ke.AUDIO_TRACK:l=i?N.AUDIO_TRACK_LOAD_TIMEOUT:N.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case ke.SUBTITLE_TRACK:l=i?N.SUBTITLE_TRACK_LOAD_TIMEOUT:N.SUBTITLE_LOAD_ERROR,c=!1;break}h&&this.resetInternalLoader(e.type);const f={type:ue.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:h,context:e,error:o,networkDetails:t,stats:n};if(s){const g=(t==null?void 0:t.url)||e.url;f.response=ot({url:g,data:void 0},s)}this.hls.trigger(b.ERROR,f)}handlePlaylistLoaded(e,t,i,s,n,r){const o=this.hls,{type:l,level:c,id:h,groupId:f,deliveryDirectives:g}=s,y=Os(t,s),v=Gn(s),A=typeof s.level=="number"&&v===me.MAIN?c:void 0;if(!e.fragments.length){const L=new Error("No Segments found in Playlist");o.trigger(b.ERROR,{type:ue.NETWORK_ERROR,details:N.LEVEL_EMPTY_ERROR,fatal:!1,url:y,error:L,reason:L.message,response:t,context:s,level:A,parent:v,networkDetails:n,stats:i});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const S=e.playlistParsingError;if(S){o.trigger(b.ERROR,{type:ue.NETWORK_ERROR,details:N.LEVEL_PARSING_ERROR,fatal:!1,url:y,error:S,reason:S.message,response:t,context:s,level:A,parent:v,networkDetails:n,stats:i});return}switch(e.live&&r&&(r.getCacheAge&&(e.ageHeader=r.getCacheAge()||0),(!r.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case ke.MANIFEST:case ke.LEVEL:o.trigger(b.LEVEL_LOADED,{details:e,level:A||0,id:h||0,stats:i,networkDetails:n,deliveryDirectives:g});break;case ke.AUDIO_TRACK:o.trigger(b.AUDIO_TRACK_LOADED,{details:e,id:h||0,groupId:f||"",stats:i,networkDetails:n,deliveryDirectives:g});break;case ke.SUBTITLE_TRACK:o.trigger(b.SUBTITLE_TRACK_LOADED,{details:e,id:h||0,groupId:f||"",stats:i,networkDetails:n,deliveryDirectives:g});break}}}function Hn(a,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=a,e.dispatchEvent(t)}function Kn(a,e){const t=a.mode;if(t==="disabled"&&(a.mode="hidden"),a.cues&&!a.cues.getCueById(e.id))try{if(a.addCue(e),!a.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){k.debug(`[texttrack-utils]: ${i}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,a.addCue(s)}catch(s){k.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(a.mode=t)}function Ii(a){const e=a.mode;if(e==="disabled"&&(a.mode="hidden"),a.cues)for(let t=a.cues.length;t--;)a.removeCue(a.cues[t]);e==="disabled"&&(a.mode=e)}function Ns(a,e,t,i){const s=a.mode;if(s==="disabled"&&(a.mode="hidden"),a.cues&&a.cues.length>0){const n=Ka(a.cues,e,t);for(let r=0;r<n.length;r++)(!i||i(n[r]))&&a.removeCue(n[r])}s==="disabled"&&(a.mode=s)}function Ha(a,e){if(e<a[0].startTime)return 0;const t=a.length-1;if(e>a[t].endTime)return-1;let i=0,s=t;for(;i<=s;){const n=Math.floor((s+i)/2);if(e<a[n].startTime)s=n-1;else if(e>a[n].startTime&&i<t)i=n+1;else return n}return a[i].startTime-e<e-a[s].startTime?i:s}function Ka(a,e,t){const i=[],s=Ha(a,e);if(s>-1)for(let n=s,r=a.length;n<r;n++){const o=a[n];if(o.startTime>=e&&o.endTime<=t)i.push(o);else if(o.startTime>t)return i}return i}var Ht={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const ja=.25;function Fs(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function jn(a,e,t,i,s){let n=new a(e,t,"");try{n.value=i,s&&(n.type=s)}catch{n=new a(e,t,JSON.stringify(s?ot({type:s},i):i))}return n}const hs=(()=>{const a=Fs();try{a&&new a(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function Ms(a,e){return a.getTime()/1e3-e}function Wa(a){return Uint8Array.from(a.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class Ya{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(Ii(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const i=e[t];if(i.kind==="metadata"&&i.label==="id3")return Hn(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:s}}}=this;if(!i&&!s)return;const{samples:n}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const r=Fs();if(r)for(let o=0;o<n.length;o++){const l=n[o].type;if(l===Ht.emsg&&!i||!s)continue;const c=T(n[o].data);if(c){const h=n[o].pts;let f=h+n[o].duration;f>hs&&(f=hs),f-h<=0&&(f=h+ja);for(let y=0;y<c.length;y++){const v=c[y];if(!d(v)){this.updateId3CueEnds(h,l);const A=jn(r,h,f,v,l);A&&this.id3Track.addCue(A)}}}}}updateId3CueEnds(e,t){var i;const s=(i=this.id3Track)==null?void 0:i.cues;if(s)for(let n=s.length;n--;){const r=s[n];r.type===t&&r.startTime<e&&r.endTime===hs&&(r.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:s}){const{id3Track:n,hls:r}=this;if(!r)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=r;if(n&&(o||l)){let c;s==="audio"?c=h=>h.type===Ht.audioId3&&l:s==="video"?c=h=>h.type===Ht.emsg&&o:c=h=>h.type===Ht.audioId3&&l||h.type===Ht.emsg&&o,Ns(n,t,i,c)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:i,id3Track:s}=this,{dateRanges:n}=t,r=Object.keys(n);if(s){const h=Object.keys(i).filter(f=>!r.includes(f));for(let f=h.length;f--;){const g=h[f];Object.keys(i[g].cues).forEach(y=>{s.removeCue(i[g].cues[y])}),delete i[g]}}const o=t.fragments[t.fragments.length-1];if(r.length===0||!se(o==null?void 0:o.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=o.programDateTime/1e3-o.start,c=Fs();for(let h=0;h<r.length;h++){const f=r[h],g=n[f],y=i[f],v=(y==null?void 0:y.cues)||{};let A=(y==null?void 0:y.durationKnown)||!1;const S=Ms(g.startDate,l);let L=hs;const C=g.endDate;if(C)L=Ms(C,l),A=!0;else if(g.endOnNext&&!A){const M=r.reduce((O,J)=>{const G=n[J];return G.class===g.class&&G.id!==J&&G.startDate>g.startDate&&O.push(G),O},[]).sort((O,J)=>O.startDate.getTime()-J.startDate.getTime())[0];M&&(L=Ms(M.startDate,l),A=!0)}const R=Object.keys(g.attr);for(let M=0;M<R.length;M++){const O=R[M];if(!ns(O))continue;const J=v[O];if(J)A&&!y.durationKnown&&(J.endTime=L);else if(c){let G=g.attr[O];we(O)&&(G=Wa(G));const Y=jn(c,S,L,{key:O,data:G},Ht.dateRange);Y&&(Y.id=f,this.id3Track.addCue(Y),v[O]=Y)}}i[f]={cues:v,dateRange:g,durationKnown:A}}}}class qa{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(e===null)return null;const{holdBack:t,partHoldBack:i,targetduration:s}=e,{liveSyncDuration:n,liveSyncDurationCount:r,lowLatencyMode:o}=this.config,l=this.hls.userConfig;let c=o&&i||t;(l.liveSyncDuration||l.liveSyncDurationCount||c===0)&&(c=n!==void 0?n:r*s);const h=s,f=1;return c+Math.min(this.stallCount*f,h)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,i=this.levelDetails;if(e===null||t===null||i===null)return null;const s=i.edge,n=e-t-this.edgeStalled,r=s-i.totalduration,o=s-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(r,n),o)}get drift(){const{levelDetails:e}=this;return e===null?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(b.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(b.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var i;t.details===N.BUFFER_STALLED_ERROR&&(this.stallCount++,(i=this.levelDetails)!=null&&i.live&&k.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:n}=this.config;if(!s||n===1)return;const r=this.targetLatency;if(r===null)return;const o=i-r,l=Math.min(this.maxLatency,r+t.targetduration),c=o<l;if(t.live&&c&&o>.05&&this.forwardBufferLength>1){const h=Math.min(2,Math.max(1,n)),f=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;e.playbackRate=Math.min(h,Math.max(1,f))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}const Bs=["NONE","TYPE-0","TYPE-1",null];var Ki={No:"",Yes:"YES",v2:"v2"};function za(a,e){const{canSkipUntil:t,canSkipDateRanges:i,endSN:s}=a,n=e!==void 0?e-s:0;return t&&n<t?i?Ki.v2:Ki.Yes:Ki.No}class Wn{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class ji{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter(t=>t).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(e){const t=e%this.url.length;this._urlId!==t&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=t)}get audioGroupId(){var e;return(e=this.audioGroupIds)==null?void 0:e[this.urlId]}get textGroupId(){var e;return(e=this.textGroupIds)==null?void 0:e[this.urlId]}addFallback(e){this.url.push(e.url),this._attrs.push(e.attrs)}}function Us(a,e){const t=e.startPTS;if(se(t)){let i=0,s;e.sn>a.sn?(i=t-a.start,s=a):(i=a.start-t,s=e),s.duration!==i&&(s.duration=i)}else e.sn>a.sn?a.cc===e.cc&&a.minEndPTS?e.start=a.start+(a.minEndPTS-a.start):e.start=a.start+a.duration:e.start=Math.max(a.start-e.duration,0)}function Yn(a,e,t,i,s,n){i-t<=0&&(k.warn("Fragment should have a positive duration",e),i=t+e.duration,n=s+e.duration);let o=t,l=i;const c=e.startPTS,h=e.endPTS;if(se(c)){const S=Math.abs(c-t);se(e.deltaPTS)?e.deltaPTS=Math.max(S,e.deltaPTS):e.deltaPTS=S,o=Math.max(t,c),t=Math.min(t,c),s=Math.min(s,e.startDTS),l=Math.min(i,h),i=Math.max(i,h),n=Math.max(n,e.endDTS)}const f=t-e.start;e.start!==0&&(e.start=t),e.duration=i-e.start,e.startPTS=t,e.maxStartPTS=o,e.startDTS=s,e.endPTS=i,e.minEndPTS=l,e.endDTS=n;const g=e.sn;if(!a||g<a.startSN||g>a.endSN)return 0;let y;const v=g-a.startSN,A=a.fragments;for(A[v]=e,y=v;y>0;y--)Us(A[y],A[y-1]);for(y=v;y<A.length-1;y++)Us(A[y],A[y+1]);return a.fragmentHint&&Us(A[A.length-1],a.fragmentHint),a.PTSKnown=a.alignedSliding=!0,f}function Xa(a,e){let t=null;const i=a.fragments;for(let l=i.length-1;l>=0;l--){const c=i[l].initSegment;if(c){t=c;break}}a.fragmentHint&&delete a.fragmentHint.endPTS;let s=0,n;if(Ja(a,e,(l,c)=>{l.relurl&&(s=l.cc-c.cc),se(l.startPTS)&&se(l.endPTS)&&(c.start=c.startPTS=l.startPTS,c.startDTS=l.startDTS,c.maxStartPTS=l.maxStartPTS,c.endPTS=l.endPTS,c.endDTS=l.endDTS,c.minEndPTS=l.minEndPTS,c.duration=l.endPTS-l.startPTS,c.duration&&(n=c),e.PTSKnown=e.alignedSliding=!0),c.elementaryStreams=l.elementaryStreams,c.loader=l.loader,c.stats=l.stats,c.urlId=l.urlId,l.initSegment&&(c.initSegment=l.initSegment,t=l.initSegment)}),t&&(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach(c=>{var h;(!c.initSegment||c.initSegment.relurl===((h=t)==null?void 0:h.relurl))&&(c.initSegment=t)}),e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some(l=>!l),e.deltaUpdateFailed){k.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let l=e.skippedSegments;l--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=Qa(a.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));const r=e.fragments;if(s){k.warn("discontinuity sliding from playlist, take drift into account");for(let l=0;l<r.length;l++)r[l].cc+=s}e.skippedSegments&&(e.startCC=e.fragments[0].cc),Za(a.partList,e.partList,(l,c)=>{c.elementaryStreams=l.elementaryStreams,c.stats=l.stats}),n?Yn(e,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):qn(a,e),r.length&&(e.totalduration=e.edge-r[0].start),e.driftStartTime=a.driftStartTime,e.driftStart=a.driftStart;const o=e.advancedDateTime;if(e.advanced&&o){const l=e.edge;e.driftStart||(e.driftStartTime=o,e.driftStart=l),e.driftEndTime=o,e.driftEnd=l}else e.driftEndTime=a.driftEndTime,e.driftEnd=a.driftEnd,e.advancedDateTime=a.advancedDateTime}function Qa(a,e,t){const i=Ke({},a);return t&&t.forEach(s=>{delete i[s]}),Object.keys(e).forEach(s=>{const n=new $i(e[s].attr,i[s]);n.isValid?i[s]=n:k.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(e[s].attr)}"`)}),i}function Za(a,e,t){if(a&&e){let i=0;for(let s=0,n=a.length;s<=n;s++){const r=a[s],o=e[s+i];r&&o&&r.index===o.index&&r.fragment.sn===o.fragment.sn?t(r,o):i--}}}function Ja(a,e,t){const i=e.skippedSegments,s=Math.max(a.startSN,e.startSN)-e.startSN,n=(a.fragmentHint?1:0)+(i?e.endSN:Math.min(a.endSN,e.endSN))-e.startSN,r=e.startSN-a.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments;for(let c=s;c<=n;c++){const h=l[r+c];let f=o[c];i&&!f&&c<i&&(f=e.fragments[c]=h),h&&f&&t(h,f)}}function qn(a,e){const t=e.startSN+e.skippedSegments-a.startSN,i=a.fragments;t<0||t>=i.length||$s(e,i[t].start)}function $s(a,e){if(e){const t=a.fragments;for(let i=a.skippedSegments;i<t.length;i++)t[i].start+=e;a.fragmentHint&&(a.fragmentHint.start+=e)}}function eo(a,e=1/0){let t=1e3*a.targetduration;if(a.updated){const i=a.fragments,s=4;if(i.length&&t*s>e){const n=i[i.length-1].duration*1e3;n<t&&(t=n)}}else t/=2;return Math.round(t)}function to(a,e,t){if(!(a!=null&&a.details))return null;const i=a.details;let s=i.fragments[e-i.startSN];return s||(s=i.fragmentHint,s&&s.sn===e)?s:e<i.startSN&&t&&t.sn===e?t:null}function zn(a,e,t){var i;return a!=null&&a.details?Xn((i=a.details)==null?void 0:i.partList,e,t):null}function Xn(a,e,t){if(a)for(let i=a.length;i--;){const s=a[i];if(s.index===t&&s.fragment.sn===e)return s}return null}function fs(a){switch(a.details){case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_TIMEOUT:case N.LEVEL_LOAD_TIMEOUT:case N.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Qn(a,e){const t=fs(e);return a.default[`${t?"timeout":"error"}Retry`]}function Vs(a,e){const t=a.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*a.retryDelayMs,a.maxRetryDelayMs)}function Zn(a){return ot(ot({},a),{errorRetry:null,timeoutRetry:null})}function ms(a,e,t,i){return!!a&&e<a.maxNumRetry&&(io(i)||!!t)}function io(a){return a===0&&navigator.onLine===!1||!!a&&(a<400||a>499)}const Jn={search:function(a,e){let t=0,i=a.length-1,s=null,n=null;for(;t<=i;){s=(t+i)/2|0,n=a[s];const r=e(n);if(r>0)t=s+1;else if(r<0)i=s-1;else return n}return null}};function so(a,e,t){if(e===null||!Array.isArray(a)||!a.length||!se(e))return null;const i=a[0].programDateTime;if(e<(i||0))return null;const s=a[a.length-1].endProgramDateTime;if(e>=(s||0))return null;t=t||0;for(let n=0;n<a.length;++n){const r=a[n];if(no(e,t,r))return r}return null}function Wi(a,e,t=0,i=0){let s=null;if(a?s=e[a.sn-e[0].sn+1]||null:t===0&&e[0].start===0&&(s=e[0]),s&&Gs(t,i,s)===0)return s;const n=Jn.search(e,Gs.bind(null,t,i));return n&&(n!==a||!s)?n:s}function Gs(a=0,e=0,t){if(t.start<=a&&t.start+t.duration>a)return 0;const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=a?1:t.start-i>a&&t.start?-1:0}function no(a,e,t){const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>a}function ro(a,e){return Jn.search(a,t=>t.cc<e?1:t.cc>e?-1:0)}const ao=3e5;var gt={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},_t={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class oo{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=k.log.bind(k,"[info]:"),this.warn=k.warn.bind(k,"[warning]:"),this.error=k.error.bind(k,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(b.ERROR,this.onError,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(b.ERROR,this.onError,this),e.off(b.ERROR,this.onErrorOut,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){this.playlistError=0}stopLoad(){}getVariantLevelIndex(e){return(e==null?void 0:e.type)===me.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var i,s;if(t.fatal)return;const n=this.hls,r=t.context;switch(t.details){case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case N.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction={action:gt.DoNothing,flags:_t.None};return}case N.FRAG_GAP:case N.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=gt.SendAlternateToPenaltyBox;return}case N.LEVEL_EMPTY_ERROR:case N.LEVEL_PARSING_ERROR:{var o,l;const c=t.parent===me.MAIN?t.level:n.loadLevel;t.details===N.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(l=o.levelDetails)!=null&&l.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,c):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,c))}return;case N.LEVEL_LOAD_ERROR:case N.LEVEL_LOAD_TIMEOUT:typeof(r==null?void 0:r.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level));return;case N.AUDIO_TRACK_LOAD_ERROR:case N.AUDIO_TRACK_LOAD_TIMEOUT:case N.SUBTITLE_LOAD_ERROR:case N.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const c=n.levels[n.loadLevel];if(c&&(r.type===ke.AUDIO_TRACK&&r.groupId===c.audioGroupId||r.type===ke.SUBTITLE_TRACK&&r.groupId===c.textGroupId)){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=gt.SendAlternateToPenaltyBox,t.errorAction.flags=_t.MoveAllAlternatesMatchingHost;return}}return;case N.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const c=n.levels[n.loadLevel],h=c==null?void 0:c.attrs["HDCP-LEVEL"];h&&(t.errorAction={action:gt.SendAlternateToPenaltyBox,flags:_t.MoveAllAlternatesMatchingHDCP,hdcpLevel:h})}return;case N.BUFFER_ADD_CODEC_ERROR:case N.REMUX_ALLOC_ERROR:t.errorAction=this.getLevelSwitchAction(t,(s=t.level)!=null?s:n.loadLevel);return;case N.INTERNAL_EXCEPTION:case N.BUFFER_APPENDING_ERROR:case N.BUFFER_APPEND_ERROR:case N.BUFFER_FULL_ERROR:case N.LEVEL_SWITCH_ERROR:case N.BUFFER_STALLED_ERROR:case N.BUFFER_SEEK_OVER_HOLE:case N.BUFFER_NUDGE_ON_STALL:t.errorAction={action:gt.DoNothing,flags:_t.None};return}if(t.type===ue.KEY_SYSTEM_ERROR){const c=this.getVariantLevelIndex(t.frag);t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,c);return}}getPlaylistRetryOrSwitchAction(e,t){var i;const s=this.hls,n=Qn(s.config.playlistLoadPolicy,e),r=this.playlistError++,o=(i=e.response)==null?void 0:i.code;if(ms(n,r,fs(e),o))return{action:gt.RetryRequest,flags:_t.None,retryConfig:n,retryCount:r};const c=this.getLevelSwitchAction(e,t);return n&&(c.retryConfig=n,c.retryCount=r),c}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),s=t.levels[i],{fragLoadPolicy:n,keyLoadPolicy:r}=t.config,o=Qn(e.details.startsWith("key")?r:n,e),l=t.levels.reduce((f,g)=>f+g.fragmentError,0);if(s){var c;e.details!==N.FRAG_GAP&&s.fragmentError++;const f=(c=e.response)==null?void 0:c.code;if(ms(o,l,fs(e),f))return{action:gt.RetryRequest,flags:_t.None,retryConfig:o,retryCount:l}}const h=this.getLevelSwitchAction(e,i);return o&&(h.retryConfig=o,h.retryCount=l),h}getLevelSwitchAction(e,t){const i=this.hls;t==null&&(t=i.loadLevel);const s=this.hls.levels[t];if(s&&(s.loadError++,i.autoLevelEnabled)){var n,r;let o=-1;const{levels:l,loadLevel:c,minAutoLevel:h,maxAutoLevel:f}=i,g=(n=e.frag)==null?void 0:n.type,{type:y,groupId:v}=(r=e.context)!=null?r:{};for(let A=l.length;A--;){const S=(A+c)%l.length;if(S!==c&&S>=h&&S<=f&&l[S].loadError===0){const L=l[S];if(e.details===N.FRAG_GAP&&e.frag){const C=l[S].details;if(C){const R=Wi(e.frag,C.fragments,e.frag.start);if(R!=null&&R.gap)continue}}else{if(y===ke.AUDIO_TRACK&&v===L.audioGroupId||y===ke.SUBTITLE_TRACK&&v===L.textGroupId)continue;if(g===me.AUDIO&&s.audioGroupId===L.audioGroupId||g===me.SUBTITLE&&s.textGroupId===L.textGroupId)continue}o=S;break}}if(o>-1&&i.loadLevel!==o)return e.levelRetry=!0,this.playlistError=0,{action:gt.SendAlternateToPenaltyBox,flags:_t.None,nextAutoLevel:o}}return{action:gt.SendAlternateToPenaltyBox,flags:_t.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case gt.DoNothing:break;case gt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==N.FRAG_GAP&&(t.fatal=!0);break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:s,hdcpLevel:n,nextAutoLevel:r}=i;switch(s){case _t.None:this.switchLevel(e,r);break;case _t.MoveAllAlternatesMatchingHost:i.resolved||(i.resolved=this.redundantFailover(e));break;case _t.MoveAllAlternatesMatchingHDCP:n&&(t.maxHdcpLevel=Bs[Bs.indexOf(n)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}i.resolved||this.switchLevel(e,r)}switchLevel(e,t){t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(e){const{hls:t,penalizedRenditions:i}=this,s=e.parent===me.MAIN?e.level:t.loadLevel,n=t.levels[s],r=n.url.length,o=e.frag?e.frag.urlId:n.urlId;n.urlId===o&&(!e.frag||n.details)&&this.penalizeRendition(n,e);for(let l=1;l<r;l++){const c=(o+l)%r,h=i[c];if(!h||lo(h,e,i[o]))return this.warn(`Switching to Redundant Stream ${c+1}/${r}: "${n.url[c]}" after ${e.details}`),this.playlistError=0,t.levels.forEach(f=>{f.urlId=c}),t.nextLoadLevel=s,!0}return!1}penalizeRendition(e,t){const{penalizedRenditions:i}=this,s=i[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};s.lastErrorPerfMs=performance.now(),s.errors.push(t),s.details=e.details,i[e.urlId]=s}}function lo(a,e,t){if(performance.now()-a.lastErrorPerfMs>ao)return!0;const i=a.details;if(e.details===N.FRAG_GAP&&i&&e.frag){const s=e.frag.start,n=Wi(null,i.fragments,s);if(n&&!n.gap)return!0}if(t&&a.errors.length<t.errors.length){const s=a.errors[a.errors.length-1];if(i&&s.frag&&e.frag&&Math.abs(s.frag.start-e.frag.start)>i.targetduration*3)return!0}return!1}class Hs{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=k.log.bind(k,`${t}:`),this.warn=k.warn.bind(k,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t){const i=t==null?void 0:t.renditionReports;if(i){let s=-1;for(let n=0;n<i.length;n++){const r=i[n];let o;try{o=new self.URL(r.URI,t.url).href}catch(l){k.warn(`Could not construct new URL for Rendition Report: ${l}`),o=r.URI||""}if(o===e){s=n;break}else o===e.substring(0,o.length)&&(s=n)}if(s!==-1){const n=i[s],r=parseInt(n["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let o=parseInt(n["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const l=Math.min(t.age-t.partTarget,t.targetduration);o>=0&&l>t.partTarget&&(o+=1)}return new Wn(r,o>=0?o:void 0,Ki.No)}}}loadPlaylist(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,i){const{details:s,stats:n}=t,r=self.performance.now(),o=n.loading.first?Math.max(0,r-n.loading.first):0;if(s.advancedDateTime=Date.now()-o,s.live||i!=null&&i.live){if(s.reloaded(i),i&&this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),i&&s.fragments.length>0&&Xa(i,s),!this.canLoad||!s.live)return;let l,c,h;if(s.canBlockReload&&s.endSN&&s.advanced){const S=this.hls.config.lowLatencyMode,L=s.lastPartSn,C=s.endSN,R=s.lastPartIndex,M=R!==-1,O=L===C,J=S?0:R;M?(c=O?C+1:L,h=O?J:R+1):c=C+1;const G=s.age,Y=G+s.ageHeader;let Z=Math.min(Y-s.partTarget,s.targetduration*1.5);if(Z>0){if(i&&Z>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${Z} with playlist age: ${s.age}`),Z=0;else{const B=Math.floor(Z/s.targetduration);if(c+=B,h!==void 0){const de=Math.round(Z%s.targetduration/s.partTarget);h+=de}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${G.toFixed(2)}s goal: ${Z} skip sn ${B} to part ${h}`)}s.tuneInGoal=Z}if(l=this.getDeliveryDirectives(s,t.deliveryDirectives,c,h),S||!O){this.loadPlaylist(l);return}}else(s.canBlockReload||s.canSkipUntil)&&(l=this.getDeliveryDirectives(s,t.deliveryDirectives,c,h));const f=this.hls.mainForwardBufferInfo,g=f?f.end-f.len:0,y=(s.edge-g)*1e3,v=eo(s,y);s.updated&&r>this.requestScheduled+v&&(this.requestScheduled=n.loading.start),c!==void 0&&s.canBlockReload?this.requestScheduled=n.loading.first+v-(s.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+v<r?this.requestScheduled=r:this.requestScheduled-r<=0&&(this.requestScheduled+=v);let A=this.requestScheduled-r;A=Math.max(0,A),this.log(`reload live playlist ${e} in ${Math.round(A)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(l),A)}else this.clearTimer()}getDeliveryDirectives(e,t,i,s){let n=za(e,i);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,s=t.part,n=Ki.No),new Wn(i,s,n)}checkRetry(e){const t=e.details,i=fs(e),s=e.errorAction,{action:n,retryCount:r=0,retryConfig:o}=s||{},l=!!s&&!!o&&(n===gt.RetryRequest||!s.resolved&&n===gt.SendAlternateToPenaltyBox);if(l){var c;if(this.requestScheduled=-1,r>=o.maxNumRetry)return!1;if(i&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${r+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const h=Vs(o,r);this.timer=self.setTimeout(()=>this.loadPlaylist(),h),this.warn(`Retrying playlist loading ${r+1}/${o.maxNumRetry} after "${t}" in ${h}ms`)}e.levelRetry=!0,s.resolved=!0}return l}}let Ks;class co extends Hs{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this),e.on(b.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this),e.off(b.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=[],s={};let n;t.levels.forEach(r=>{var o;const l=r.attrs;((o=r.audioCodec)==null?void 0:o.indexOf("mp4a.40.34"))!==-1&&(Ks||(Ks=/chrome|firefox/i.test(navigator.userAgent)),Ks&&(r.audioCodec=void 0));const{AUDIO:c,CODECS:h,"FRAME-RATE":f,"PATHWAY-ID":g,RESOLUTION:y,SUBTITLES:v}=l,S=`${`${g||"."}-`}${r.bitrate}-${y}-${f}-${h}`;n=s[S],n?n.addFallback(r):(n=new ji(r),s[S]=n,i.push(n)),gs(n,"audio",c),gs(n,"text",v)}),this.filterAndSortMediaOptions(i,t)}filterAndSortMediaOptions(e,t){let i=[],s=[],n=!1,r=!1,o=!1,l=e.filter(({audioCodec:y,videoCodec:v,width:A,height:S,unknownCodecs:L})=>(n||(n=!!(A&&S)),r||(r=!!v),o||(o=!!y),!(L!=null&&L.length)&&(!y||_s(y,"audio"))&&(!v||_s(v,"video"))));if((n||r)&&o&&(l=l.filter(({videoCodec:y,width:v,height:A})=>!!y||!!(v&&A))),l.length===0){Promise.resolve().then(()=>{if(this.hls){const y=new Error("no level with compatible codecs found in manifest");this.hls.trigger(b.ERROR,{type:ue.MEDIA_ERROR,details:N.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:y,reason:y.message})}});return}t.audioTracks&&(i=t.audioTracks.filter(y=>!y.audioCodec||_s(y.audioCodec,"audio")),er(i)),t.subtitles&&(s=t.subtitles,er(s));const c=l.slice(0);l.sort((y,v)=>y.attrs["HDCP-LEVEL"]!==v.attrs["HDCP-LEVEL"]?(y.attrs["HDCP-LEVEL"]||"")>(v.attrs["HDCP-LEVEL"]||"")?1:-1:y.bitrate!==v.bitrate?y.bitrate-v.bitrate:y.attrs["FRAME-RATE"]!==v.attrs["FRAME-RATE"]?y.attrs.decimalFloatingPoint("FRAME-RATE")-v.attrs.decimalFloatingPoint("FRAME-RATE"):y.attrs.SCORE!==v.attrs.SCORE?y.attrs.decimalFloatingPoint("SCORE")-v.attrs.decimalFloatingPoint("SCORE"):n&&y.height!==v.height?y.height-v.height:0);let h=c[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==c.length)){for(let y=0;y<c.length;y++)if(c[y].pathwayId===l[0].pathwayId){h=c[y];break}}this._levels=l;for(let y=0;y<l.length;y++)if(l[y]===h){this._firstLevel=y,this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${h.bitrate}`);break}const f=o&&!r,g={levels:l,audioTracks:i,subtitleTracks:s,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:o,video:r,altAudio:!f&&i.some(y=>!!y.url)};this.hls.trigger(b.MANIFEST_PARSED,g),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const h=new Error("invalid level idx"),f=e<0;if(this.hls.trigger(b.ERROR,{type:ue.OTHER_ERROR,details:N.LEVEL_SWITCH_ERROR,level:e,fatal:f,error:h,reason:h.message}),f)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,s=this.currentLevel,n=s?s.attrs["PATHWAY-ID"]:void 0,r=t[e],o=r.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=r,i===e&&r.details&&s&&n===o)return;this.log(`Switching to level ${e}${o?" with Pathway "+o:""} from level ${i}${n?" with Pathway "+n:""}`);const l=Ke({},r,{level:e,maxBitrate:r.maxBitrate,attrs:r.attrs,uri:r.uri,urlId:r.urlId});delete l._attrs,delete l._urlId,this.hls.trigger(b.LEVEL_SWITCHING,l);const c=r.details;if(!c||c.live){const h=this.switchParams(r.uri,s==null?void 0:s.details);this.loadPlaylist(h)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this._firstLevel}else return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){t.fatal||!t.context||t.context.type===ke.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragLoaded(e,{frag:t}){if(t!==void 0&&t.type===me.MAIN){const i=this._levels[t.level];i!==void 0&&(i.loadError=0)}}onLevelLoaded(e,t){var i;const{level:s,details:n}=t,r=this._levels[s];if(!r){var o;this.warn(`Invalid level index ${s}`),(o=t.deliveryDirectives)!=null&&o.skip&&(n.deltaUpdateFailed=!0);return}s===this.currentLevelIndex?(r.fragmentError===0&&(r.loadError=0),this.playlistLoaded(s,t,r.details)):(i=t.deliveryDirectives)!=null&&i.skip&&(n.deltaUpdateFailed=!0)}onAudioTrackSwitched(e,t){const i=this.currentLevel;if(!i)return;const s=this.hls.audioTracks[t.id].groupId;if(i.audioGroupIds&&i.audioGroupId!==s){let n=-1;for(let r=0;r<i.audioGroupIds.length;r++)if(i.audioGroupIds[r]===s){n=r;break}n!==-1&&n!==i.urlId&&(i.urlId=n,this.canLoad&&this.startLoad())}}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){const s=i.urlId;let n=i.uri;if(e)try{n=e.addDirectives(n)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}const r=i.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${(e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""} with${r?" Pathway "+r:""} URI ${s+1}/${i.url.length} ${n}`),this.clearTimer(),this.hls.trigger(b.LEVEL_LOADING,{url:n,level:t,id:s,deliveryDirectives:e||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e,t){const i=(n,r)=>r!==t,s=this._levels.filter((n,r)=>r!==e?!0:n.url.length>1&&t!==void 0?(n.url=n.url.filter(i),n.audioGroupIds&&(n.audioGroupIds=n.audioGroupIds.filter(i)),n.textGroupIds&&(n.textGroupIds=n.textGroupIds.filter(i)),n.urlId=0,!0):(this.steering&&this.steering.removeLevel(n),!1));this.hls.trigger(b.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){t.forEach((i,s)=>{const{details:n}=i;n!=null&&n.fragments&&n.fragments.forEach(r=>{r.level=s})}),this._levels=t}}function gs(a,e,t){t&&(e==="audio"?(a.audioGroupIds||(a.audioGroupIds=[]),a.audioGroupIds[a.url.length-1]=t):e==="text"&&(a.textGroupIds||(a.textGroupIds=[]),a.textGroupIds[a.url.length-1]=t))}function er(a){const e={};a.forEach(t=>{const i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}var ft={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class uo{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(b.BUFFER_APPENDED,this.onBufferAppended,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(b.BUFFER_APPENDED,this.onBufferAppended,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let s=i.length;s--;){const n=i[s];if(!n)break;const r=n.end;if(n.start<=e&&r!==null&&e<=r)return n}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:i}=this,s=Object.keys(i);for(let n=s.length;n--;){const r=i[s[n]];if((r==null?void 0:r.body.type)===t&&r.buffered){const o=r.body;if(o.start<=e&&e<=o.end)return o}}return null}detectEvictedFragments(e,t,i,s){this.timeRanges&&(this.timeRanges[e]=t);const n=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(r=>{const o=this.fragments[r];if(!o||n>=o.body.sn)return;if(!o.buffered&&!o.loaded){o.body.type===i&&this.removeFragment(o.body);return}const l=o.range[e];l&&l.time.some(c=>{const h=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return h&&this.removeFragment(o.body),h})})}detectPartialFragments(e){const t=this.timeRanges,{frag:i,part:s}=e;if(!t||i.sn==="initSegment")return;const n=ki(i),r=this.fragments[n];if(!r||r.buffered&&i.gap)return;const o=!i.relurl;Object.keys(t).forEach(l=>{const c=i.elementaryStreams[l];if(!c)return;const h=t[l],f=o||c.partial===!0;r.range[l]=this.getBufferedTimes(i,s,f,h)}),r.loaded=null,Object.keys(r.range).length?(r.buffered=!0,(r.body.endList=i.endList||r.body.endList)&&(this.endListFragments[r.body.type]=r),ps(r)||this.removeParts(i.sn-1,i.type)):this.removeFragment(r.body)}removeParts(e,t){const i=this.activePartLists[t];i&&(this.activePartLists[t]=i.filter(s=>s.fragment.sn>=e))}fragBuffered(e,t){const i=ki(e);let s=this.fragments[i];!s&&t&&(s=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)}getBufferedTimes(e,t,i,s){const n={time:[],partial:i},r=e.start,o=e.end,l=e.minEndPTS||o,c=e.maxStartPTS||r;for(let h=0;h<s.length;h++){const f=s.start(h)-this.bufferPadding,g=s.end(h)+this.bufferPadding;if(c>=f&&l<=g){n.time.push({startPTS:Math.max(r,s.start(h)),endPTS:Math.min(o,s.end(h))});break}else if(r<g&&o>f)n.partial=!0,n.time.push({startPTS:Math.max(r,s.start(h)),endPTS:Math.min(o,s.end(h))});else if(o<=f)break}return n}getPartialFragment(e){let t=null,i,s,n,r=0;const{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(c=>{const h=l[c];h&&ps(h)&&(s=h.body.start-o,n=h.body.end+o,e>=s&&e<=n&&(i=Math.min(e-s,n-e),r<=i&&(t=h.body,r=i)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||ps(t))}getState(e){const t=ki(e),i=this.fragments[t];return i?i.buffered?ps(i)?ft.PARTIAL:ft.OK:ft.APPENDING:ft.NOT_LOADED}isTimeBuffered(e,t,i){let s,n;for(let r=0;r<i.length;r++){if(s=i.start(r)-this.bufferPadding,n=i.end(r)+this.bufferPadding,e>=s&&t<=n)return!0;if(t<=s)return!1}return!1}onFragLoaded(e,t){const{frag:i,part:s}=t;if(i.sn==="initSegment"||i.bitrateTest)return;const n=s?null:t,r=ki(i);this.fragments[r]={body:i,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:s,timeRanges:n}=t;if(i.sn==="initSegment")return;const r=i.type;if(s){let o=this.activePartLists[r];o||(this.activePartLists[r]=o=[]),o.push(s)}this.timeRanges=n,Object.keys(n).forEach(o=>{const l=n[o];this.detectEvictedFragments(o,l,r,s)})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=ki(e);return!!this.fragments[t]}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,s,n){s&&!this.hasGaps||Object.keys(this.fragments).forEach(r=>{const o=this.fragments[r];if(!o)return;const l=o.body;l.type!==i||s&&!l.gap||l.start<t&&l.end>e&&(o.buffered||n)&&this.removeFragment(l)})}removeFragment(e){const t=ki(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const s=e.sn;this.activePartLists[e.type]=i.filter(n=>n.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function ps(a){var e,t,i;return a.buffered&&(a.body.gap||((e=a.range.video)==null?void 0:e.partial)||((t=a.range.audio)==null?void 0:t.partial)||((i=a.range.audiovideo)==null?void 0:i.partial))}function ki(a){return`${a.type}_${a.level}_${a.urlId}_${a.sn}`}const tr=Math.pow(2,17);class ho{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new ei({type:ue.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,n=s.fLoader,r=s.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(y=>y[0]==="GAP")){l(sr(e));return}else e.gap=!1;const c=this.loader=e.loader=n?new n(s):new r(s),h=ir(e),f=Zn(s.fragLoadPolicy.default),g={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:tr};e.stats=c.stats,c.load(h,g,{onSuccess:(y,v,A,S)=>{this.resetLoader(e,c);let L=y.data;A.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(L.slice(0,16)),L=L.slice(16)),o({frag:e,part:null,payload:L,networkDetails:S})},onError:(y,v,A,S)=>{this.resetLoader(e,c),l(new ei({type:ue.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:ot({url:i,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:A,stats:S}))},onAbort:(y,v,A)=>{this.resetLoader(e,c),l(new ei({type:ue.NETWORK_ERROR,details:N.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:A,stats:y}))},onTimeout:(y,v,A)=>{this.resetLoader(e,c),l(new ei({type:ue.NETWORK_ERROR,details:N.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${g.timeout}ms`),networkDetails:A,stats:y}))},onProgress:(y,v,A,S)=>{t&&t({frag:e,part:null,payload:A,networkDetails:S})}})})}loadPart(e,t,i){this.abort();const s=this.config,n=s.fLoader,r=s.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(sr(e,t));return}const c=this.loader=e.loader=n?new n(s):new r(s),h=ir(e,t),f=Zn(s.fragLoadPolicy.default),g={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:tr};t.stats=c.stats,c.load(h,g,{onSuccess:(y,v,A,S)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const L={frag:e,part:t,payload:y.data,networkDetails:S};i(L),o(L)},onError:(y,v,A,S)=>{this.resetLoader(e,c),l(new ei({type:ue.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:ot({url:h.url,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:A,stats:S}))},onAbort:(y,v,A)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),l(new ei({type:ue.NETWORK_ERROR,details:N.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:A,stats:y}))},onTimeout:(y,v,A)=>{this.resetLoader(e,c),l(new ei({type:ue.NETWORK_ERROR,details:N.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${g.timeout}ms`),networkDetails:A,stats:y}))}})})}updateStatsFromPart(e,t){const i=e.stats,s=t.stats,n=s.total;if(i.loaded+=s.loaded,n){const l=Math.round(e.duration/t.duration),c=Math.min(Math.round(i.loaded/n),l),f=(l-c)*Math.round(i.loaded/c);i.total=i.loaded+f}else i.total=Math.max(i.loaded,i.total);const r=i.loading,o=s.loading;r.start?r.first+=o.first-o.start:(r.start=o.start,r.first=o.first),r.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function ir(a,e=null){const t=e||a,i={frag:a,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,n=t.byteRangeEndOffset;if(se(s)&&se(n)){var r;let o=s,l=n;if(a.sn==="initSegment"&&((r=a.decryptdata)==null?void 0:r.method)==="AES-128"){const c=n-s;c%16&&(l=n+(16-c%16)),s!==0&&(i.resetIV=!0,o=s-16)}i.rangeStart=o,i.rangeEnd=l}return i}function sr(a,e){const t=new Error(`GAP ${a.gap?"tag":"attribute"} found`),i={type:ue.MEDIA_ERROR,details:N.FRAG_GAP,fatal:!1,frag:a,error:t,networkDetails:null};return e&&(i.part=e),(e||a).stats.aborted=!0,new ei(i)}class ei extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class fo{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const t in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[t].loader;if(i){if(e&&e!==i.context.frag.type)return;i.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=N.KEY_LOAD_ERROR,i,s,n){return new ei({type:ue.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:n,error:i,networkDetails:s})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:i,cc:s}=e;for(let n=0;n<t.length;n++){const r=t[n];if(s<=r.cc&&(i==="initSegment"||r.sn==="initSegment"||i<r.sn)){this.emeController.selectKeySystemFormat(r).then(o=>{r.setKeyFormat(o)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,s;t&&e.setKeyFormat(t);const n=e.decryptdata;if(!n){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,c))}const r=n.uri;if(!r)return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${r}"`)));let o=this.keyUriToKeyInfo[r];if((i=o)!=null&&i.decryptdata.key)return n.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if((s=o)!=null&&s.keyLoadPromise){var l;switch((l=o.mediaKeySessionContext)==null?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return o.keyLoadPromise.then(c=>(n.key=c.keyInfo.decryptdata.key,{frag:e,keyInfo:o}))}}switch(o=this.keyUriToKeyInfo[r]={decryptdata:n,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},n.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return n.keyFormat==="identity"?this.loadKeyHTTP(o,e):this.loadKeyEME(o,e);case"AES-128":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${n.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const s=this.emeController.loadKey(i);if(s)return(e.keyLoadPromise=s.then(n=>(e.mediaKeySessionContext=n,i))).catch(n=>{throw e.keyLoadPromise=null,n})}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,s=i.loader,n=new s(i);return t.keyLoader=e.loader=n,e.keyLoadPromise=new Promise((r,o)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=i.keyLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:(g,y,v,A)=>{const{frag:S,keyInfo:L,url:C}=v;if(!S.decryptdata||L!==this.keyUriToKeyInfo[C])return o(this.createKeyLoadError(S,N.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),A));L.decryptdata.key=S.decryptdata.key=new Uint8Array(g.data),S.keyLoader=null,L.loader=null,r({frag:S,keyInfo:L})},onError:(g,y,v,A)=>{this.resetLoader(y),o(this.createKeyLoadError(t,N.KEY_LOAD_ERROR,new Error(`HTTP Error ${g.code} loading key ${g.text}`),v,ot({url:l.url,data:void 0},g)))},onTimeout:(g,y,v)=>{this.resetLoader(y),o(this.createKeyLoadError(t,N.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),v))},onAbort:(g,y,v)=>{this.resetLoader(y),o(this.createKeyLoadError(t,N.INTERNAL_ABORTED,new Error("key loading aborted"),v))}};n.load(l,h,f)})}resetLoader(e){const{frag:t,keyInfo:i,url:s}=e,n=i.loader;t.keyLoader===n&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[s],n&&n.destroy()}}class mo{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}const go={length:0,start:()=>0,end:()=>0};class Xe{static isBuffered(e,t){try{if(e){const i=Xe.getBuffered(e);for(let s=0;s<i.length;s++)if(t>=i.start(s)&&t<=i.end(s))return!0}}catch{}return!1}static bufferInfo(e,t,i){try{if(e){const s=Xe.getBuffered(e),n=[];let r;for(r=0;r<s.length;r++)n.push({start:s.start(r),end:s.end(r)});return this.bufferedInfo(n,t,i)}}catch{}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.sort(function(c,h){const f=c.start-h.start;return f||h.end-c.end});let s=[];if(i)for(let c=0;c<e.length;c++){const h=s.length;if(h){const f=s[h-1].end;e[c].start-f<i?e[c].end>f&&(s[h-1].end=e[c].end):s.push(e[c])}else s.push(e[c])}else s=e;let n=0,r,o=t,l=t;for(let c=0;c<s.length;c++){const h=s[c].start,f=s[c].end;if(t+i>=h&&t<f)o=h,l=f,n=l-t;else if(t+i<h){r=h;break}}return{len:n,start:o||0,end:l||0,nextStart:r}}static getBuffered(e){try{return e.buffered}catch(t){return k.log("failed to get media.buffered",t),go}}}class js{constructor(e,t,i,s=0,n=-1,r=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=ys(),this.buffering={audio:ys(),video:ys(),audiovideo:ys()},this.level=e,this.sn=t,this.id=i,this.size=s,this.part=n,this.partial=r}}function ys(){return{start:0,executeStart:0,executeEnd:0,end:0}}function nr(a,e){let t=null;for(let i=0,s=a.length;i<s;i++){const n=a[i];if(n&&n.cc===e){t=n;break}}return t}function po(a,e,t){return!!(e.details&&(t.endCC>t.startCC||a&&a.cc<t.startCC))}function yo(a,e,t=0){const i=a.fragments,s=e.fragments;if(!s.length||!i.length){k.log("No fragments to align");return}const n=nr(i,s[0].cc);if(!n||n&&!n.startPTS){k.log("No frag in previous level to align on");return}return n}function rr(a,e){if(a){const t=a.start+e;a.start=a.startPTS=t,a.endPTS=t+a.duration}}function Ws(a,e){const t=e.fragments;for(let i=0,s=t.length;i<s;i++)rr(t[i],a);e.fragmentHint&&rr(e.fragmentHint,a),e.alignedSliding=!0}function vo(a,e,t){e&&(bo(a,t,e),!t.alignedSliding&&e.details&&To(t,e.details),!t.alignedSliding&&e.details&&!t.skippedSegments&&qn(e.details,t))}function bo(a,e,t){if(po(a,t,e)){const i=yo(t.details,e);i&&se(i.start)&&(k.log(`Adjusting PTS using last level due to CC increase within current level ${e.url}`),Ws(i.start,e))}}function To(a,e){if(!e.fragments.length||!a.hasProgramDateTime||!e.hasProgramDateTime)return;const t=e.fragments[0].programDateTime,i=a.fragments[0].programDateTime,s=(i-t)/1e3+e.fragments[0].start;s&&se(s)&&(k.log(`Adjusting PTS using programDateTime delta ${i-t}ms, sliding:${s.toFixed(3)} ${a.url} `),Ws(s,a))}function ar(a,e){if(!a.hasProgramDateTime||!e.hasProgramDateTime)return;const t=a.fragments,i=e.fragments;if(!t.length||!i.length)return;const s=Math.round(i.length/2)-1,n=i[s],r=nr(t,n.cc)||t[Math.round(t.length/2)-1],o=n.programDateTime,l=r.programDateTime;if(o===null||l===null)return;const c=(l-o)/1e3-(r.start-n.start);Ws(c,a)}class Eo{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class Ao{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function So(a){const e=a.byteLength,t=e&&new DataView(a.buffer).getUint8(e-1);return t?Yt(a,0,e-t):a}class xo{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let s=0;s<4;s++)i[s]=t.getUint32(s*4);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,s=i[0],n=i[1],r=i[2],o=i[3],l=this.invSubMix,c=l[0],h=l[1],f=l[2],g=l[3],y=new Uint32Array(256);let v=0,A=0,S=0;for(S=0;S<256;S++)S<128?y[S]=S<<1:y[S]=S<<1^283;for(S=0;S<256;S++){let L=A^A<<1^A<<2^A<<3^A<<4;L=L>>>8^L&255^99,e[v]=L,t[L]=v;const C=y[v],R=y[C],M=y[R];let O=y[L]*257^L*16843008;s[v]=O<<24|O>>>8,n[v]=O<<16|O>>>16,r[v]=O<<8|O>>>24,o[v]=O,O=M*16843009^R*65537^C*257^v*16843008,c[L]=O<<24|O>>>8,h[L]=O<<16|O>>>16,f[L]=O<<8|O>>>24,g[L]=O,v?(v=C^y[y[y[M^C]]],A^=y[y[A]]):v=A=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,s=0;for(;s<t.length&&i;)i=t[s]===this.key[s],s++;if(i)return;this.key=t;const n=this.keySize=t.length;if(n!==4&&n!==6&&n!==8)throw new Error("Invalid aes key size="+n);const r=this.ksRows=(n+6+1)*4;let o,l;const c=this.keySchedule=new Uint32Array(r),h=this.invKeySchedule=new Uint32Array(r),f=this.sBox,g=this.rcon,y=this.invSubMix,v=y[0],A=y[1],S=y[2],L=y[3];let C,R;for(o=0;o<r;o++){if(o<n){C=c[o]=t[o];continue}R=C,o%n===0?(R=R<<8|R>>>24,R=f[R>>>24]<<24|f[R>>>16&255]<<16|f[R>>>8&255]<<8|f[R&255],R^=g[o/n|0]<<24):n>6&&o%n===4&&(R=f[R>>>24]<<24|f[R>>>16&255]<<16|f[R>>>8&255]<<8|f[R&255]),c[o]=C=(c[o-n]^R)>>>0}for(l=0;l<r;l++)o=r-l,l&3?R=c[o]:R=c[o-4],l<4||o<=4?h[l]=R:h[l]=v[f[R>>>24]]^A[f[R>>>16&255]]^S[f[R>>>8&255]]^L[f[R&255]],h[l]=h[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){const s=this.keySize+6,n=this.invKeySchedule,r=this.invSBox,o=this.invSubMix,l=o[0],c=o[1],h=o[2],f=o[3],g=this.uint8ArrayToUint32Array_(i);let y=g[0],v=g[1],A=g[2],S=g[3];const L=new Int32Array(e),C=new Int32Array(L.length);let R,M,O,J,G,Y,Z,B,de,ee,$e,bt,et,st;const tt=this.networkToHostOrderSwap;for(;t<L.length;){for(de=tt(L[t]),ee=tt(L[t+1]),$e=tt(L[t+2]),bt=tt(L[t+3]),G=de^n[0],Y=bt^n[1],Z=$e^n[2],B=ee^n[3],et=4,st=1;st<s;st++)R=l[G>>>24]^c[Y>>16&255]^h[Z>>8&255]^f[B&255]^n[et],M=l[Y>>>24]^c[Z>>16&255]^h[B>>8&255]^f[G&255]^n[et+1],O=l[Z>>>24]^c[B>>16&255]^h[G>>8&255]^f[Y&255]^n[et+2],J=l[B>>>24]^c[G>>16&255]^h[Y>>8&255]^f[Z&255]^n[et+3],G=R,Y=M,Z=O,B=J,et=et+4;R=r[G>>>24]<<24^r[Y>>16&255]<<16^r[Z>>8&255]<<8^r[B&255]^n[et],M=r[Y>>>24]<<24^r[Z>>16&255]<<16^r[B>>8&255]<<8^r[G&255]^n[et+1],O=r[Z>>>24]<<24^r[B>>16&255]<<16^r[G>>8&255]<<8^r[Y&255]^n[et+2],J=r[B>>>24]<<24^r[G>>16&255]<<16^r[Y>>8&255]<<8^r[Z&255]^n[et+3],C[t]=tt(R^y),C[t+1]=tt(J^v),C[t+2]=tt(O^A),C[t+3]=tt(M^S),y=de,v=ee,A=$e,S=bt,t=t+4}return C.buffer}}const Lo=16;class Ys{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?So(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i){return this.useSoftware?new Promise((s,n)=>{this.softwareDecrypt(new Uint8Array(e),t,i);const r=this.flush();r?s(r.buffer):n(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i)}softwareDecrypt(e,t,i){const{currentIV:s,currentResult:n,remainderData:r}=this;this.logOnce("JS AES decrypt"),r&&(e=mi(r,e),this.remainderData=null);const o=this.getValidChunk(e);if(!o.length)return null;s&&(i=s);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new xo),l.expandKey(t);const c=n;return this.currentResult=l.decrypt(o.buffer,0,i),this.currentIV=Yt(o,-16).buffer,c||null}webCryptoDecrypt(e,t,i){const s=this.subtle;return(this.key!==t||!this.fastAesKey)&&(this.key=t,this.fastAesKey=new Ao(s,t)),this.fastAesKey.expandKey().then(n=>s?(this.logOnce("WebCrypto AES decrypt"),new Eo(s,new Uint8Array(i)).decrypt(e.buffer,n)):Promise.reject(new Error("web crypto not initialized"))).catch(n=>(k.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${n.name}: ${n.message}`),this.onWebCryptoError(e,t,i)))}onWebCryptoError(e,t,i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i);const s=this.flush();if(s)return s.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%Lo;return i!==e.length&&(t=Yt(e,0,i),this.remainderData=Yt(e,i)),t}logOnce(e){this.logEnabled&&(k.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const wo={toString:function(a){let e="";const t=a.length;for(let i=0;i<t;i++)e+=`[${a.start(i).toFixed(3)}-${a.end(i).toFixed(3)}]`;return e}},V={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class qs extends mo{constructor(e,t,i,s,n){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=V.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=n,this.logPrefix=s,this.log=k.log.bind(k,`${s}:`),this.warn=k.warn.bind(k,`${s}:`),this.hls=e,this.fragmentLoader=new ho(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Ys(e.config),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=V.STOPPED}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const i=t.partList;if(i!=null&&i.length){const n=i[i.length-1];return Xe.isBuffered(this.media,n.start+n.duration/2)}const s=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(s)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levels[this.levelLastLoaded])==null?void 0:e.details}}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);const s=this.config;this.levels&&s.autoStartLoad&&this.state===V.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(){const e=this.media;e!=null&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:i,mediaBuffer:s,state:n}=this,r=i?i.currentTime:0,o=Xe.bufferInfo(s||i,r,e.maxBufferHole);if(this.log(`media seeking to ${se(r)?r.toFixed(3):r}, state: ${n}`),this.state===V.ENDED)this.resetLoadingState();else if(t){const l=e.maxFragLookUpTolerance,c=t.start-l,h=t.start+t.duration+l;if(!o.len||h<o.start||c>o.end){const f=r>h;(r<c||f)&&(f&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}i&&(this.fragmentTracker.removeFragmentsInRange(r,1/0,this.playlistType,!0),this.lastCurrentTime=r),!this.loadedmetadata&&!o.len&&(this.nextLoadPosition=this.startPosition=r),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state=V.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){const s=n=>{if(this.fragContextChanged(e)){this.warn(`Fragment ${e.sn}${n.part?" p: "+n.part.index:""} of level ${e.level} was dropped during download.`),this.fragmentTracker.removeFragment(e);return}e.stats.chunkCount++,this._handleFragmentLoadProgress(n)};this._doFragLoad(e,t,i,s).then(n=>{if(!n)return;const r=this.state;if(this.fragContextChanged(e)){(r===V.FRAG_LOADING||!this.fragCurrent&&r===V.PARSING)&&(this.fragmentTracker.removeFragment(e),this.state=V.IDLE);return}"payload"in n&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(b.FRAG_LOADED,n)),this._handleFragmentLoadComplete(n)}).catch(n=>{this.state===V.STOPPED||this.state===V.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===ft.APPENDING){const n=e.type,r=this.getFwdBufferInfo(this.mediaBuffer,n),o=Math.max(e.duration,r?r.len:this.config.maxBufferLength);this.reduceMaxBufferLength(o)&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===ft.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,i=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:i};this.hls.trigger(b.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{if(!i||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:s}=this,{payload:n}=i,r=e.decryptdata;if(n&&n.byteLength>0&&r&&r.key&&r.iv&&r.method==="AES-128"){const o=self.performance.now();return this.decrypter.decrypt(new Uint8Array(n),r.key.buffer,r.iv.buffer).catch(l=>{throw s.trigger(b.ERROR,{type:ue.MEDIA_ERROR,details:N.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:e}),l}).then(l=>{const c=self.performance.now();return s.trigger(b.FRAG_DECRYPTED,{frag:e,payload:l,stats:{tstart:o,tdecrypt:c}}),i.payload=l,i})}return i}).then(i=>{const{fragCurrent:s,hls:n,levels:r}=this;if(!r)throw new Error("init load aborted, missing levels");const o=e.stats;this.state=V.IDLE,t.fragmentError=0,e.data=new Uint8Array(i.payload),o.parsing.start=o.buffering.start=self.performance.now(),o.parsing.end=o.buffering.end=self.performance.now(),i.frag===s&&n.trigger(b.FRAG_BUFFERED,{stats:o,frag:s,part:null,id:e.type}),this.tick()}).catch(i=>{this.state===V.STOPPED||this.state===V.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId}fragBufferedComplete(e,t){var i,s,n,r;const o=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===me.MAIN?"level":"track"} ${e.level} (frag:[${((i=e.startPTS)!=null?i:NaN).toFixed(3)}-${((s=e.endPTS)!=null?s:NaN).toFixed(3)}] > buffer:${o?wo.toString(Xe.getBuffered(o)):"(detached)"})`),this.state=V.IDLE,o&&(!this.loadedmetadata&&e.type==me.MAIN&&o.buffered.length&&((n=this.fragCurrent)==null?void 0:n.sn)===((r=this.fragPrevious)==null?void 0:r.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:s,partsLoaded:n}=e,r=!n||n.length===0||n.some(l=>!l),o=new js(i.level,i.sn,i.stats.chunkCount+1,0,s?s.index:-1,!r);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,s){var n;const r=t==null?void 0:t.details;if(!this.levels||!r)throw new Error(`frag load aborted, missing level${r?"":" detail"}s`);let o=null;if(e.encrypted&&!((n=e.decryptdata)!=null&&n.key)?(this.log(`Loading key for ${e.sn} of [${r.startSN}-${r.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${e.level}`),this.state=V.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(h=>{if(!this.fragContextChanged(h.frag))return this.hls.trigger(b.KEY_LOADED,h),this.state===V.KEY_LOADING&&(this.state=V.IDLE),h}),this.hls.trigger(b.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(o=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&r.encryptedFragments.length&&this.keyLoader.loadClear(e,r.encryptedFragments),i=Math.max(e.start,i||0),this.config.lowLatencyMode&&e.sn!=="initSegment"){const h=r.partList;if(h&&s){i>e.end&&r.fragmentHint&&(e=r.fragmentHint);const f=this.getNextPart(h,e,i);if(f>-1){const g=h[f];this.log(`Loading part sn: ${e.sn} p: ${g.index} cc: ${e.cc} of playlist [${r.startSN}-${r.endSN}] parts [0-${f}-${h.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=g.start+g.duration,this.state=V.FRAG_LOADING;let y;return o?y=o.then(v=>!v||this.fragContextChanged(v.frag)?null:this.doFragPartsLoad(e,g,t,s)).catch(v=>this.handleFragLoadError(v)):y=this.doFragPartsLoad(e,g,t,s).catch(v=>this.handleFragLoadError(v)),this.hls.trigger(b.FRAG_LOADING,{frag:e,part:g,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):y}else if(!e.url||this.loadedEndOfParts(h,i))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${r?"of ["+r.startSN+"-"+r.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(i.toFixed(3))}`),se(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=V.FRAG_LOADING;const l=this.config.progressive;let c;return l&&o?c=o.then(h=>!h||this.fragContextChanged(h==null?void 0:h.frag)?null:this.fragmentLoader.load(e,s)).catch(h=>this.handleFragLoadError(h)):c=Promise.all([this.fragmentLoader.load(e,l?s:void 0),o]).then(([h])=>(!l&&h&&s&&s(h),h)).catch(h=>this.handleFragLoadError(h)),this.hls.trigger(b.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):c}doFragPartsLoad(e,t,i,s){return new Promise((n,r)=>{var o;const l=[],c=(o=i.details)==null?void 0:o.partList,h=f=>{this.fragmentLoader.loadPart(e,f,s).then(g=>{l[f.index]=g;const y=g.part;this.hls.trigger(b.FRAG_LOADED,g);const v=zn(i,e.sn,f.index+1)||Xn(c,e.sn,f.index+1);if(v)h(v);else return n({frag:e,part:y,partsLoaded:l})}).catch(r)};h(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===N.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(b.ERROR,t)}else this.hls.trigger(b.ERROR,{type:ue.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==V.PARSING){!this.fragCurrent&&this.state!==V.STOPPED&&this.state!==V.ERROR&&(this.state=V.IDLE);return}const{frag:i,part:s,level:n}=t,r=self.performance.now();i.stats.parsing.end=r,s&&(s.stats.parsing.end=r),this.updateLevelTiming(i,s,n,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:s,sn:n,part:r}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${n} of level ${s}. The current chunk will not be buffered.`),null;const o=t[s],l=r>-1?zn(o,n,r):null,c=l?l.fragment:to(o,n,i);return c?(i&&i!==c&&(c.stats=i.stats),{frag:c,part:l,level:o}):null}bufferFragmentData(e,t,i,s,n){var r;if(!e||this.state!==V.PARSING)return;const{data1:o,data2:l}=e;let c=o;if(o&&l&&(c=mi(o,l)),!((r=c)!=null&&r.length))return;const h={type:e.type,frag:t,part:i,chunkMeta:s,parent:t.type,data:c};if(this.hls.trigger(b.BUFFER_APPENDING,h),e.dropped&&e.independent&&!i){if(n)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Xe.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const i=t.currentTime,s=Xe.bufferInfo(t,i,0),n=e.duration,r=Math.min(this.config.maxFragLookUpTolerance*2,n*.25),o=Math.max(Math.min(e.start-r,s.end-r),i+r);e.start-o>r&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){const i=this.getLoadPosition();return se(i)?this.getFwdBufferInfoAtPos(e,i,t):null}getFwdBufferInfoAtPos(e,t,i){const{config:{maxBufferHole:s}}=this,n=Xe.bufferInfo(e,t,s);if(n.len===0&&n.nextStart!==void 0){const r=this.fragmentTracker.getBufferedFrag(t,i);if(r&&n.nextStart<r.end)return Xe.bufferInfo(e,t,Math.max(n.nextStart,s))}return n}getMaxBufferLength(e){const{config:t}=this;let i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e){const t=this.config,i=e||t.maxBufferLength;return t.maxMaxBufferLength>=i?(t.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${t.maxMaxBufferLength}s`),!0):!1}getAppendedFrag(e,t=me.MAIN){const i=this.fragmentTracker.getAppendedFrag(e,me.MAIN);return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const i=t.fragments,s=i.length;if(!s)return null;const{config:n}=this,r=i[0].start;let o;if(t.live){const l=n.initialLiveManifestSize;if(s<l)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${l})`),null;!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(o=this.getInitialLiveFragment(t,i),this.startPosition=o?this.hls.liveSyncPosition||o.start:e)}else e<=r&&(o=i[0]);if(!o){const l=n.lowLatencyMode?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,l,t)}return this.mapToInitFragWhenRequired(o)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===ft.OK||i===ft.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,s,n){const r=e.gap,o=this.getNextFragment(this.nextLoadPosition,t);if(o===null)return o;if(e=o,r&&e&&!e.gap&&i.nextStart){const l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,s);if(l!==null&&i.len+l.len>=n)return this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let s=-1,n=!1,r=!0;for(let o=0,l=e.length;o<l;o++){const c=e[o];if(r=r&&!c.independent,s>-1&&i<c.start)break;const h=c.loaded;h?s=-1:(n||c.independent||r)&&c.fragment===t&&(s=o),n=h}return s}loadedEndOfParts(e,t){const i=e[e.length-1];return i&&t>i.start&&i.loaded}getInitialLiveFragment(e,t){const i=this.fragPrevious;let s=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),s=so(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const n=i.sn+1;if(n>=e.startSN&&n<=e.endSN){const r=t[n-e.startSN];i.cc===r.cc&&(s=r,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=ro(t,i.cc),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const n=this.hls.liveSyncPosition;n!==null&&(s=this.getFragmentAtPosition(n,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,i){const{config:s}=this;let{fragPrevious:n}=this,{fragments:r,endSN:o}=i;const{fragmentHint:l}=i,c=s.maxFragLookUpTolerance,h=i.partList,f=!!(s.lowLatencyMode&&h!=null&&h.length&&l);f&&l&&!this.bitrateTest&&(r=r.concat(l),o=l.sn);let g;if(e<t){const y=e>t-c?0:c;g=Wi(n,r,e,y)}else g=r[r.length-1];if(g){const y=g.sn-i.startSN,v=this.fragmentTracker.getState(g);if((v===ft.OK||v===ft.PARTIAL&&g.gap)&&(n=g),n&&g.sn===n.sn&&(!f||h[0].fragment.sn>g.sn)&&n&&g.level===n.level){const S=r[y+1];g.sn<o&&this.fragmentTracker.getState(S)!==ft.OK?g=S:g=null}}return g}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const s=this.hls.liveSyncPosition,n=i.currentTime,r=e.fragments[0].start,o=e.edge,l=n>=r-t.maxFragLookUpTolerance&&n<=o;if(s!==null&&i.duration>s&&(n<s||!l)){const c=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!l&&i.readyState<4||n<o-c)&&(this.loadedmetadata||(this.nextLoadPosition=s),i.readyState&&(this.warn(`Playback: ${n.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${s.toFixed(3)}`),i.currentTime=s))}}alignPlaylists(e,t){const{levels:i,levelLastLoaded:s,fragPrevious:n}=this,r=s!==null?i[s]:null,o=e.fragments.length;if(!o)return this.warn("No fragments in live playlist"),0;const l=e.fragments[0].start,c=!t,h=e.alignedSliding&&se(l);if(c||!h&&!l){vo(n,r,e);const f=e.fragments[0].start;return this.log(`Live playlist sliding: ${f.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${n?n.sn:"na"} fragments: ${o}`),f}return l}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;if(i<t&&(i=-1),i===-1||this.lastCurrentTime===-1){const s=this.startTimeOffset!==null,n=s?this.startTimeOffset:e.startTimeOffset;n!==null&&se(n)?(i=t+n,n<0&&(i+=e.totalduration),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Start time offset ${n} found in ${s?"multivariant":"media"} playlist, adjust startPosition to ${i}`),this.startPosition=i):e.live?i=this.hls.liveSyncPosition||t:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&e.sn!=="initSegment"&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==V.FRAG_LOADING_WAITING_RETRY)&&(this.state=V.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const f=this.getCurrentContext(t.chunkMeta);f&&(t.frag=f.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var s;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const n=t.details===N.FRAG_GAP;n&&this.fragmentTracker.fragBuffered(i,!0);const r=t.errorAction,{action:o,retryCount:l=0,retryConfig:c}=r||{};if(r&&o===gt.RetryRequest&&c){var h;this.resetStartWhenNotLoaded((h=this.levelLastLoaded)!=null?h:i.level);const f=Vs(c,l);this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${l+1}/${c.maxNumRetry} in ${f}ms`),r.resolved=!0,this.retryDate=self.performance.now()+f,this.state=V.FRAG_LOADING_WAITING_RETRY}else c&&r?(this.resetFragmentErrors(e),l<c.maxNumRetry?n||(r.resolved=!0):k.warn(`${t.details} reached or exceeded max retry (${l})`)):(r==null?void 0:r.action)===gt.SendAlternateToPenaltyBox?this.state=V.WAITING_LEVEL:this.state=V.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===V.PARSING||this.state===V.PARSED){const t=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,t),s=i&&i.len>.5;s&&this.reduceMaxBufferLength(i.len);const n=!s;return n&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),n}return!1}resetFragmentErrors(e){e===me.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==V.STOPPED&&(this.state=V.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;const s=Xe.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,i),this.state===V.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=V.IDLE}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=this.levels?this.levels[e].details:null;t!=null&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){var t;this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded((t=this.levelLastLoaded)!=null?t:e.level),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,s){var n;const r=i.details;if(!r){this.warn("level.details undefined");return}if(Object.keys(e.elementaryStreams).reduce((l,c)=>{const h=e.elementaryStreams[c];if(h){const f=h.endPTS-h.startPTS;if(f<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${f})`),l||!1;const g=s?0:Yn(r,e,h.startPTS,h.endPTS,h.startDTS,h.endDTS);return this.hls.trigger(b.LEVEL_PTS_UPDATED,{details:r,level:i,drift:g,type:c,frag:e,start:h.startPTS,end:h.endPTS}),!0}return l},!1))i.fragmentError=0;else if(((n=this.transmuxer)==null?void 0:n.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(i.fragmentError===0&&(i.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(l.message),this.hls.trigger(b.ERROR,{type:ue.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of level "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=V.PARSED,this.hls.trigger(b.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){if(e.event==="demuxerWorker"){var t,i,s;this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded((t=(i=this.levelLastLoaded)!=null?i:(s=this.fragCurrent)==null?void 0:s.level)!=null?t:0),this.resetLoadingState()}}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function or(){return self.SourceBuffer||self.WebKitSourceBuffer}function Io(){const a=ds();if(!a)return!1;const e=or(),t=a&&typeof a.isTypeSupported=="function"&&a.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function";return!!t&&!!i}function ko(){var a;const e=or();return typeof(e==null||(a=e.prototype)==null?void 0:a.changeType)=="function"}function Ro(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Co(){const a=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(a);return{worker:new self.Worker(e),objectURL:e}}function Do(a){const e=new self.URL(a,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}function zt(a="",e=9e4){return{type:a,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class lr{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=mi(this.cachedData,e),this.cachedData=null);let i=qt(e,0),s=i?i.length:0,n;const r=this._audioTrack,o=this._id3Track,l=i?m(i):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&se(l))&&(this.basePTS=Po(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Ht.audioId3,duration:Number.POSITIVE_INFINITY});s<c;){if(this.canParse(e,s)){const h=this.appendFrame(r,e,s);h?(this.frameIndex++,this.lastPTS=h.sample.pts,s+=h.length,n=s):s=c}else u(e,s)?(i=qt(e,s),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Ht.audioId3,duration:Number.POSITIVE_INFINITY}),s+=i.length,n=s):s++;if(s===c&&n!==c){const h=Yt(e,n);this.cachedData?this.cachedData=mi(this.cachedData,h):this.cachedData=h}}return{audioTrack:r,videoTrack:zt(),id3Track:o,textTrack:zt()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:zt(),id3Track:this._id3Track,textTrack:zt()}}destroy(){}}const Po=(a,e,t)=>{if(se(a))return a*90;const i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i};function _o(a,e,t,i){let s,n,r,o;const l=navigator.userAgent.toLowerCase(),c=i,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];s=((e[t+2]&192)>>>6)+1;const f=(e[t+2]&60)>>>2;if(f>h.length-1){a.trigger(b.ERROR,{type:ue.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${f}`});return}return r=(e[t+2]&1)<<2,r|=(e[t+3]&192)>>>6,k.log(`manifest codec:${i}, ADTS type:${s}, samplingIndex:${f}`),/firefox/i.test(l)?f>=6?(s=5,o=new Array(4),n=f-3):(s=2,o=new Array(2),n=f):l.indexOf("android")!==-1?(s=2,o=new Array(2),n=f):(s=5,o=new Array(4),i&&(i.indexOf("mp4a.40.29")!==-1||i.indexOf("mp4a.40.5")!==-1)||!i&&f>=6?n=f-3:((i&&i.indexOf("mp4a.40.2")!==-1&&(f>=6&&r===1||/vivaldi/i.test(l))||!i&&r===1)&&(s=2,o=new Array(2)),n=f)),o[0]=s<<3,o[0]|=(f&14)>>1,o[1]|=(f&1)<<7,o[1]|=r<<3,s===5&&(o[1]|=(n&14)>>1,o[2]=(n&1)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:h[f],channelCount:r,codec:"mp4a.40."+s,manifestCodec:c}}function cr(a,e){return a[e]===255&&(a[e+1]&246)===240}function ur(a,e){return a[e+1]&1?7:9}function zs(a,e){return(a[e+3]&3)<<11|a[e+4]<<3|(a[e+5]&224)>>>5}function Oo(a,e){return e+5<a.length}function vs(a,e){return e+1<a.length&&cr(a,e)}function No(a,e){return Oo(a,e)&&cr(a,e)&&zs(a,e)<=a.length-e}function Fo(a,e){if(vs(a,e)){const t=ur(a,e);if(e+t>=a.length)return!1;const i=zs(a,e);if(i<=t)return!1;const s=e+i;return s===a.length||vs(a,s)}return!1}function dr(a,e,t,i,s){if(!a.samplerate){const n=_o(e,t,i,s);if(!n)return;a.config=n.config,a.samplerate=n.samplerate,a.channelCount=n.channelCount,a.codec=n.codec,a.manifestCodec=n.manifestCodec,k.log(`parsed codec:${a.codec}, rate:${n.samplerate}, channels:${n.channelCount}`)}}function hr(a){return 1024*9e4/a}function Mo(a,e){const t=ur(a,e);if(e+t<=a.length){const i=zs(a,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function fr(a,e,t,i,s){const n=hr(a.samplerate),r=i+s*n,o=Mo(e,t);let l;if(o){const{frameLength:f,headerLength:g}=o,y=g+f,v=Math.max(0,t+y-e.length);v?(l=new Uint8Array(y-g),l.set(e.subarray(t+g,e.length),0)):l=e.subarray(t+g,t+y);const A={unit:l,pts:r};return v||a.samples.push(A),{sample:A,length:y,missing:v}}const c=e.length-t;return l=new Uint8Array(c),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:r},length:c,missing:-1}}class Bo extends lr{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let i=(qt(e,0)||[]).length;for(let s=e.length;i<s;i++)if(Fo(e,i))return k.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return No(e,t)}appendFrame(e,t,i){dr(e,this.observer,t,i,e.manifestCodec);const s=fr(e,t,i,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const Uo=/\/emsg[-/]ID3/i;class $o{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,s){const n=this.videoTrack=zt("video",1),r=this.audioTrack=zt("audio",1),o=this.txtTrack=zt("text",1);if(this.id3Track=zt("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=Pt(e);if(l.video){const{id:c,timescale:h,codec:f}=l.video;n.id=c,n.timescale=o.timescale=h,n.codec=f}if(l.audio){const{id:c,timescale:h,codec:f}=l.audio;r.id=c,r.timescale=h,r.codec=f}o.id=qe.text,n.sampleDuration=0,n.duration=r.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return e=e.length>16384?e.subarray(0,16384):e,ye(e,["moof"]).length>0}demux(e,t){this.timeOffset=t;let i=e;const s=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=mi(this.remainderData,e));const o=Ia(i);this.remainderData=o.remainder,s.samples=o.valid||new Uint8Array}else s.samples=i;const r=this.extractID3Track(s,t);return n.samples=wn(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:r,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return i.samples=wn(e,t),{videoTrack:t,audioTrack:zt(),id3Track:s,textTrack:zt()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const s=ye(e.samples,["emsg"]);s&&s.forEach(n=>{const r=Ca(n);if(Uo.test(r.schemeIdUri)){const o=se(r.presentationTime)?r.presentationTime/r.timeScale:t+r.presentationTimeDelta/r.timeScale;let l=r.eventDuration===4294967295?Number.POSITIVE_INFINITY:r.eventDuration/r.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=r.payload;i.samples.push({data:c,len:c.byteLength,dts:o,pts:o,type:Ht.emsg,duration:l})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}let bs=null;const Vo=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Go=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Ho=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Ko=[0,1,1,4];function mr(a,e,t,i,s){if(t+24>e.length)return;const n=gr(e,t);if(n&&t+n.frameLength<=e.length){const r=n.samplesPerFrame*9e4/n.sampleRate,o=i+s*r,l={unit:e.subarray(t,t+n.frameLength),pts:o,dts:o};return a.config=[],a.channelCount=n.channelCount,a.samplerate=n.sampleRate,a.samples.push(l),{sample:l,length:n.frameLength,missing:0}}}function gr(a,e){const t=a[e+1]>>3&3,i=a[e+1]>>1&3,s=a[e+2]>>4&15,n=a[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&n!==3){const r=a[e+2]>>1&1,o=a[e+3]>>6,l=t===3?3-i:i===3?3:4,c=Vo[l*14+s-1]*1e3,f=Go[(t===3?0:t===2?1:2)*3+n],g=o===3?1:2,y=Ho[t][i],v=Ko[i],A=y*8*v,S=Math.floor(y*c/f+r)*v;if(bs===null){const R=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);bs=R?parseInt(R[1]):0}return!!bs&&bs<=87&&i===2&&c>=224e3&&o===0&&(a[e+3]=a[e+3]|128),{sampleRate:f,channelCount:g,frameLength:S,samplesPerFrame:A}}}function Xs(a,e){return a[e]===255&&(a[e+1]&224)===224&&(a[e+1]&6)!==0}function pr(a,e){return e+1<a.length&&Xs(a,e)}function jo(a,e){return Xs(a,e)&&4<=a.length-e}function Wo(a,e){if(e+1<a.length&&Xs(a,e)){const i=gr(a,e);let s=4;i!=null&&i.frameLength&&(s=i.frameLength);const n=e+s;return n===a.length||pr(a,n)}return!1}class yr{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,s=new Uint8Array(4),n=Math.min(4,t);if(n===0)throw new Error("no bytes available");s.set(e.subarray(i,i+n)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=n*8,this.bytesAvailable-=n}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&k.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t=8,i=8,s;for(let n=0;n<e;n++)i!==0&&(s=this.readEG(),i=(t+s+256)%256),t=i===0?t:i}readSPS(){let e=0,t=0,i=0,s=0,n,r,o;const l=this.readUByte.bind(this),c=this.readBits.bind(this),h=this.readUEG.bind(this),f=this.readBoolean.bind(this),g=this.skipBits.bind(this),y=this.skipEG.bind(this),v=this.skipUEG.bind(this),A=this.skipScalingList.bind(this);l();const S=l();if(c(5),g(3),l(),v(),S===100||S===110||S===122||S===244||S===44||S===83||S===86||S===118||S===128){const J=h();if(J===3&&g(1),v(),v(),g(1),f())for(r=J!==3?8:12,o=0;o<r;o++)f()&&(o<6?A(16):A(64))}v();const L=h();if(L===0)h();else if(L===1)for(g(1),y(),y(),n=h(),o=0;o<n;o++)y();v(),g(1);const C=h(),R=h(),M=c(1);M===0&&g(1),g(1),f()&&(e=h(),t=h(),i=h(),s=h());let O=[1,1];if(f()&&f())switch(l()){case 1:O=[1,1];break;case 2:O=[12,11];break;case 3:O=[10,11];break;case 4:O=[16,11];break;case 5:O=[40,33];break;case 6:O=[24,11];break;case 7:O=[20,11];break;case 8:O=[32,11];break;case 9:O=[80,33];break;case 10:O=[18,11];break;case 11:O=[15,11];break;case 12:O=[64,33];break;case 13:O=[160,99];break;case 14:O=[4,3];break;case 15:O=[3,2];break;case 16:O=[2,1];break;case 255:{O=[l()<<8|l(),l()<<8|l()];break}}return{width:Math.ceil((C+1)*16-e*2-t*2),height:(2-M)*(R+1)*16-(M?2:4)*(i+s),pixelRatio:O}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class Yo{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new Ys(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,i){const s=e[t].unit;if(s.length<=16)return;const n=s.subarray(16,s.length-s.length%16),r=n.buffer.slice(n.byteOffset,n.byteOffset+n.length);this.decryptBuffer(r).then(o=>{const l=new Uint8Array(o);s.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)})}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t);let s=0;for(let n=32;n<e.length-16;n+=160,s+=16)i.set(e.subarray(n,n+16),s);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let s=0;for(let n=32;n<e.length-16;n+=160,s+=16)e.set(i.subarray(s,s+16),n);return e}decryptAvcSample(e,t,i,s,n){const r=kn(n.data),o=this.getAvcEncryptedData(r);this.decryptBuffer(o.buffer).then(l=>{n.data=this.getAvcDecryptedUnit(r,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,s)})}decryptAvcSamples(e,t,i,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){s();return}const n=e[t].units;for(;!(i>=n.length);i++){const r=n[i];if(!(r.data.length<=48||r.type!==1&&r.type!==5)&&(this.decryptAvcSample(e,t,i,s,r),!this.decrypter.isSync()))return}}}}const pt=188;class ri{constructor(e,t,i){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=i}static probe(e){const t=ri.syncOffset(e);return t>0&&k.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),t!==-1}static syncOffset(e){const t=e.length;let i=Math.min(pt*5,e.length-pt)+1,s=0;for(;s<i;){let n=!1,r=-1,o=0;for(let l=s;l<t;l+=pt)if(e[l]===71){if(o++,r===-1&&(r=l,r!==0&&(i=Math.min(r+pt*99,e.length-pt)+1)),n||(n=Qs(e,l)===0),n&&o>1&&(r===0&&o>2||l+pt>i))return r}else{if(o)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:qe[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=ri.createTrack("video"),this._audioTrack=ri.createTrack("audio",s),this._id3Track=ri.createTrack("id3"),this._txtTrack=ri.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i,this._duration=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_avcTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(e,t,i=!1,s=!1){i||(this.sampleAes=null);let n;const r=this._avcTrack,o=this._audioTrack,l=this._id3Track,c=this._txtTrack;let h=r.pid,f=r.pesData,g=o.pid,y=l.pid,v=o.pesData,A=l.pesData,S=null,L=this.pmtParsed,C=this._pmtId,R=e.length;if(this.remainderData&&(e=mi(this.remainderData,e),R=e.length,this.remainderData=null),R<pt&&!s)return this.remainderData=e,{audioTrack:o,videoTrack:r,id3Track:l,textTrack:c};const M=Math.max(0,ri.syncOffset(e));R-=(R-M)%pt,R<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,R,e.buffer.byteLength-R));let O=0;for(let G=M;G<R;G+=pt)if(e[G]===71){const Y=!!(e[G+1]&64),Z=Qs(e,G),B=(e[G+3]&48)>>4;let de;if(B>1){if(de=G+5+e[G+4],de===G+pt)continue}else de=G+4;switch(Z){case h:Y&&(f&&(n=Ri(f))&&this.parseAVCPES(r,c,n,!1),f={data:[],size:0}),f&&(f.data.push(e.subarray(de,G+pt)),f.size+=G+pt-de);break;case g:if(Y){if(v&&(n=Ri(v)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,n);break;case"mp3":this.parseMPEGPES(o,n);break}v={data:[],size:0}}v&&(v.data.push(e.subarray(de,G+pt)),v.size+=G+pt-de);break;case y:Y&&(A&&(n=Ri(A))&&this.parseID3PES(l,n),A={data:[],size:0}),A&&(A.data.push(e.subarray(de,G+pt)),A.size+=G+pt-de);break;case 0:Y&&(de+=e[de]+1),C=this._pmtId=qo(e,de);break;case C:{Y&&(de+=e[de]+1);const ee=zo(e,de,this.typeSupported,i);h=ee.avc,h>0&&(r.pid=h),g=ee.audio,g>0&&(o.pid=g,o.segmentCodec=ee.segmentCodec),y=ee.id3,y>0&&(l.pid=y),S!==null&&!L&&(k.warn(`MPEG-TS PMT found at ${G} after unknown PID '${S}'. Backtracking to sync byte @${M} to parse all TS packets.`),S=null,G=M-188),L=this.pmtParsed=!0;break}case 17:case 8191:break;default:S=Z;break}}else O++;if(O>0){const G=new Error(`Found ${O} TS packet/s that do not start with 0x47`);this.observer.emit(b.ERROR,b.ERROR,{type:ue.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,error:G,reason:G.message})}r.pesData=f,o.pesData=v,l.pesData=A;const J={audioTrack:o,videoTrack:r,id3Track:l,textTrack:c};return s&&this.extractRemainingSamples(J),J}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:s,textTrack:n}=e,r=i.pesData,o=t.pesData,l=s.pesData;let c;if(r&&(c=Ri(r))?(this.parseAVCPES(i,n,c,!0),i.pesData=null):i.pesData=r,o&&(c=Ri(o))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break}t.pesData=null}else o!=null&&o.size&&k.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;l&&(c=Ri(l))?(this.parseID3PES(s,c),s.pesData=null):s.pesData=l}demuxSampleAes(e,t,i){const s=this.demux(e,i,!0,!this.config.progressive),n=this.sampleAes=new Yo(this.observer,this.config,t);return this.decrypt(s,n)}decrypt(e,t){return new Promise(i=>{const{audioTrack:s,videoTrack:n}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{n.samples?t.decryptAvcSamples(n.samples,0,0,()=>{i(e)}):i(e)}):n.samples&&t.decryptAvcSamples(n.samples,0,0,()=>{i(e)})})}destroy(){this._duration=0}parseAVCPES(e,t,i,s){const n=this.parseAVCNALu(e,i.data);let r=this.avcSample,o,l=!1;i.data=null,r&&n.length&&!e.audFound&&(Yi(r,e),r=this.avcSample=Ts(!1,i.pts,i.dts,"")),n.forEach(c=>{var h;switch(c.type){case 1:{let g=!1;o=!0;const y=c.data;if(l&&y.length>4){const v=new yr(y).readSliceType();(v===2||v===4||v===7||v===9)&&(g=!0)}if(g){var f;(f=r)!=null&&f.frame&&!r.key&&(Yi(r,e),r=this.avcSample=null)}r||(r=this.avcSample=Ts(!0,i.pts,i.dts,"")),r.frame=!0,r.key=g;break}case 5:o=!0,(h=r)!=null&&h.frame&&!r.key&&(Yi(r,e),r=this.avcSample=null),r||(r=this.avcSample=Ts(!0,i.pts,i.dts,"")),r.key=!0,r.frame=!0;break;case 6:{o=!0,In(c.data,1,i.pts,t.samples);break}case 7:if(o=!0,l=!0,!e.sps){const g=c.data,v=new yr(g).readSPS();e.width=v.width,e.height=v.height,e.pixelRatio=v.pixelRatio,e.sps=[g],e.duration=this._duration;const A=g.subarray(1,4);let S="avc1.";for(let L=0;L<3;L++){let C=A[L].toString(16);C.length<2&&(C="0"+C),S+=C}e.codec=S}break;case 8:o=!0,e.pps||(e.pps=[c.data]);break;case 9:o=!1,e.audFound=!0,r&&Yi(r,e),r=this.avcSample=Ts(!1,i.pts,i.dts,"");break;case 12:o=!0;break;default:o=!1,r&&(r.debug+="unknown NAL "+c.type+" ");break}r&&o&&r.units.push(c)}),s&&r&&(Yi(r,e),this.avcSample=null)}getLastNalUnit(e){var t;let i=this.avcSample,s;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){const n=i.units;s=n[n.length-1]}return s}parseAVCNALu(e,t){const i=t.byteLength;let s=e.naluState||0;const n=s,r=[];let o=0,l,c,h,f=-1,g=0;for(s===-1&&(f=0,g=t[0]&31,s=0,o=1);o<i;){if(l=t[o++],!s){s=l?0:1;continue}if(s===1){s=l?0:2;continue}if(!l)s=3;else if(l===1){if(f>=0){const y={data:t.subarray(f,o-s-1),type:g};r.push(y)}else{const y=this.getLastNalUnit(e.samples);if(y&&(n&&o<=4-n&&y.state&&(y.data=y.data.subarray(0,y.data.byteLength-n)),c=o-s-1,c>0)){const v=new Uint8Array(y.data.byteLength+c);v.set(y.data,0),v.set(t.subarray(0,c),y.data.byteLength),y.data=v,y.state=0}}o<i?(h=t[o]&31,f=o,g=h,s=0):s=-1}else s=0}if(f>=0&&s>=0){const y={data:t.subarray(f,i),type:g,state:s};r.push(y)}if(r.length===0){const y=this.getLastNalUnit(e.samples);if(y){const v=new Uint8Array(y.data.byteLength+t.byteLength);v.set(y.data,0),v.set(t,y.data.byteLength),y.data=v}}return e.naluState=s,r}parseAACPES(e,t){let i=0;const s=this.aacOverFlow;let n=t.data;if(s){this.aacOverFlow=null;const f=s.missing,g=s.sample.unit.byteLength;if(f===-1){const y=new Uint8Array(g+n.byteLength);y.set(s.sample.unit,0),y.set(n,g),n=y}else{const y=g-f;s.sample.unit.set(n.subarray(0,f),y),e.samples.push(s.sample),i=s.missing}}let r,o;for(r=i,o=n.length;r<o-1&&!vs(n,r);r++);if(r!==i){let f;const g=r<o-1;g?f=`AAC PES did not start with ADTS header,offset:${r}`:f="No ADTS header found in AAC PES";const y=new Error(f);if(k.warn(`parsing error: ${f}`),this.observer.emit(b.ERROR,b.ERROR,{type:ue.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,levelRetry:g,error:y,reason:f}),!g)return}dr(e,this.observer,n,r,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(s){const f=hr(e.samplerate);l=s.sample.pts+f}else{k.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,h;for(;r<o;)if(h=fr(e,n,r,l,c),r+=h.length,h.missing){this.aacOverFlow=h;break}else for(c++;r<o-1&&!vs(n,r);r++);}parseMPEGPES(e,t){const i=t.data,s=i.length;let n=0,r=0;const o=t.pts;if(o===void 0){k.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;r<s;)if(pr(i,r)){const l=mr(e,i,r,o,n);if(l)r+=l.length,n++;else break}else r++}parseID3PES(e,t){if(t.pts===void 0){k.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=Ke({},t,{type:this._avcTrack?Ht.emsg:Ht.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function Ts(a,e,t,i){return{key:a,frame:!1,pts:e,dts:t,units:[],debug:i,length:0}}function Qs(a,e){return((a[e+1]&31)<<8)+a[e+2]}function qo(a,e){return(a[e+10]&31)<<8|a[e+11]}function zo(a,e,t,i){const s={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},n=(a[e+1]&15)<<8|a[e+2],r=e+3+n-4,o=(a[e+10]&15)<<8|a[e+11];for(e+=12+o;e<r;){const l=Qs(a,e);switch(a[e]){case 207:if(!i){k.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:s.audio===-1&&(s.audio=l);break;case 21:s.id3===-1&&(s.id3=l);break;case 219:if(!i){k.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:s.avc===-1&&(s.avc=l);break;case 3:case 4:t.mpeg!==!0&&t.mp3!==!0?k.log("MPEG audio found, not supported in this browser"):s.audio===-1&&(s.audio=l,s.segmentCodec="mp3");break;case 36:k.warn("Unsupported HEVC stream type found");break}e+=((a[e+3]&15)<<8|a[e+4])+5}return s}function Ri(a){let e=0,t,i,s,n,r;const o=a.data;if(!a||a.size===0)return null;for(;o[0].length<19&&o.length>1;){const c=new Uint8Array(o[0].length+o[1].length);c.set(o[0]),c.set(o[1],o[0].length),o[0]=c,o.splice(1,1)}if(t=o[0],(t[0]<<16)+(t[1]<<8)+t[2]===1){if(i=(t[4]<<8)+t[5],i&&i>a.size-6)return null;const c=t[7];c&192&&(n=(t[9]&14)*536870912+(t[10]&255)*4194304+(t[11]&254)*16384+(t[12]&255)*128+(t[13]&254)/2,c&64?(r=(t[14]&14)*536870912+(t[15]&255)*4194304+(t[16]&254)*16384+(t[17]&255)*128+(t[18]&254)/2,n-r>60*9e4&&(k.warn(`${Math.round((n-r)/9e4)}s delta between PTS and DTS, align them`),n=r)):r=n),s=t[8];let h=s+9;if(a.size<=h)return null;a.size-=h;const f=new Uint8Array(a.size);for(let g=0,y=o.length;g<y;g++){t=o[g];let v=t.byteLength;if(h)if(h>v){h-=v;continue}else t=t.subarray(h),v-=h,h=0;f.set(t,e),e+=v}return i&&(i-=s+3),{data:f,pts:n,dts:r,len:i}}return null}function Yi(a,e){if(a.units.length&&a.frame){if(a.pts===void 0){const t=e.samples,i=t.length;if(i){const s=t[i-1];a.pts=s.pts,a.dts=s.dts}else{e.dropped++;return}}e.samples.push(a)}a.debug.length&&k.log(a.pts+"/"+a.dts+":"+a.debug)}class Xo extends lr{resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let i=(qt(e,0)||[]).length;for(let s=e.length;i<s;i++)if(Wo(e,i))return k.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return jo(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return mr(e,t,i,this.basePTS,this.frameIndex)}}class vr{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const ai=Math.pow(2,32)-1;class P{static init(){P.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in P.types)P.types.hasOwnProperty(e)&&(P.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);P.HDLR_TYPES={video:t,audio:i};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);P.STTS=P.STSC=P.STCO=n,P.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),P.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),P.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),P.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const r=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);P.FTYP=P.box(P.types.ftyp,r,l,r,o),P.DINF=P.box(P.types.dinf,P.box(P.types.dref,s))}static box(e,...t){let i=8,s=t.length;const n=s;for(;s--;)i+=t[s].byteLength;const r=new Uint8Array(i);for(r[0]=i>>24&255,r[1]=i>>16&255,r[2]=i>>8&255,r[3]=i&255,r.set(e,4),s=0,i=8;s<n;s++)r.set(t[s],i),i+=t[s].byteLength;return r}static hdlr(e){return P.box(P.types.hdlr,P.HDLR_TYPES[e])}static mdat(e){return P.box(P.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(ai+1)),s=Math.floor(t%(ai+1));return P.box(P.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return P.box(P.types.mdia,P.mdhd(e.timescale,e.duration),P.hdlr(e.type),P.minf(e))}static mfhd(e){return P.box(P.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?P.box(P.types.minf,P.box(P.types.smhd,P.SMHD),P.DINF,P.stbl(e)):P.box(P.types.minf,P.box(P.types.vmhd,P.VMHD),P.DINF,P.stbl(e))}static moof(e,t,i){return P.box(P.types.moof,P.mfhd(e),P.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=P.trak(e[t]);return P.box.apply(null,[P.types.moov,P.mvhd(e[0].timescale,e[0].duration)].concat(i).concat(P.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=P.trex(e[t]);return P.box.apply(null,[P.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(ai+1)),s=Math.floor(t%(ai+1)),n=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return P.box(P.types.mvhd,n)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let s,n;for(s=0;s<t.length;s++)n=t[s].flags,i[s+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return P.box(P.types.sdtp,i)}static stbl(e){return P.box(P.types.stbl,P.stsd(e),P.box(P.types.stts,P.STTS),P.box(P.types.stsc,P.STSC),P.box(P.types.stsz,P.STSZ),P.box(P.types.stco,P.STCO))}static avc1(e){let t=[],i=[],s,n,r;for(s=0;s<e.sps.length;s++)n=e.sps[s],r=n.byteLength,t.push(r>>>8&255),t.push(r&255),t=t.concat(Array.prototype.slice.call(n));for(s=0;s<e.pps.length;s++)n=e.pps[s],r=n.byteLength,i.push(r>>>8&255),i.push(r&255),i=i.concat(Array.prototype.slice.call(n));const o=P.box(P.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(i))),l=e.width,c=e.height,h=e.pixelRatio[0],f=e.pixelRatio[1];return P.box(P.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,P.box(P.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),P.box(P.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,f>>24,f>>16&255,f>>8&255,f&255])))}static esds(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static mp4a(e){const t=e.samplerate;return P.box(P.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,t&255,0,0]),P.box(P.types.esds,P.esds(e)))}static mp3(e){const t=e.samplerate;return P.box(P.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,t&255,0,0]))}static stsd(e){return e.type==="audio"?e.segmentCodec==="mp3"&&e.codec==="mp3"?P.box(P.types.stsd,P.STSD,P.mp3(e)):P.box(P.types.stsd,P.STSD,P.mp4a(e)):P.box(P.types.stsd,P.STSD,P.avc1(e))}static tkhd(e){const t=e.id,i=e.duration*e.timescale,s=e.width,n=e.height,r=Math.floor(i/(ai+1)),o=Math.floor(i%(ai+1));return P.box(P.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,n>>8&255,n&255,0,0]))}static traf(e,t){const i=P.sdtp(e),s=e.id,n=Math.floor(t/(ai+1)),r=Math.floor(t%(ai+1));return P.box(P.types.traf,P.box(P.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),P.box(P.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255])),P.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,P.box(P.types.trak,P.tkhd(e),P.mdia(e))}static trex(e){const t=e.id;return P.box(P.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],s=i.length,n=12+16*s,r=new Uint8Array(n);let o,l,c,h,f,g;for(t+=8+n,r.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<s;o++)l=i[o],c=l.duration,h=l.size,f=l.flags,g=l.cts,r.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,h>>>24&255,h>>>16&255,h>>>8&255,h&255,f.isLeading<<2|f.dependsOn,f.isDependedOn<<6|f.hasRedundancy<<4|f.paddingValue<<1|f.isNonSync,f.degradPrio&61440,f.degradPrio&15,g>>>24&255,g>>>16&255,g>>>8&255,g&255],12+16*o);return P.box(P.types.trun,r)}static initSegment(e){P.types||P.init();const t=P.moov(e),i=new Uint8Array(P.FTYP.byteLength+t.byteLength);return i.set(P.FTYP),i.set(t,P.FTYP.byteLength),i}}P.types=void 0,P.HDLR_TYPES=void 0,P.STTS=void 0,P.STSC=void 0,P.STCO=void 0,P.STSZ=void 0,P.VMHD=void 0,P.SMHD=void 0,P.STSD=void 0,P.FTYP=void 0,P.DINF=void 0;const br=9e4;function Zs(a,e,t=1,i=!1){const s=a*e*t;return i?Math.round(s):s}function Qo(a,e,t=1,i=!1){return Zs(a,e,1/t,i)}function qi(a,e=!1){return Zs(a,1e3,1/br,e)}function Zo(a,e=1){return Zs(a,br,1/e)}const Jo=10*1e3,Tr=1024,el=1152;let Es=null,Js=null;class en{constructor(e,t,i,s=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,Es===null){const r=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Es=r?parseInt(r[1]):0}if(Js===null){const n=navigator.userAgent.match(/Safari\/(\d+)/i);Js=n?parseInt(n[1]):0}}destroy(){}resetTimeStamp(e){k.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){k.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){k.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(e){let t=!1;const i=e.reduce((s,n)=>{const r=n.pts-s;return r<-4294967296?(t=!0,Ot(s,n.pts)):r>0?s:n.pts},e[0].pts);return t&&k.debug("PTS rollover detected"),i}remux(e,t,i,s,n,r,o,l){let c,h,f,g,y,v,A=n,S=n;const L=e.pid>-1,C=t.pid>-1,R=t.samples.length,M=e.samples.length>0,O=o&&R>0||R>1;if((!L||M)&&(!C||O)||this.ISGenerated||o){this.ISGenerated||(f=this.generateIS(e,t,n,r));const G=this.isVideoContiguous;let Y=-1,Z;if(O&&(Y=tl(t.samples),!G&&this.config.forceKeyFrameOnDiscontinuity))if(v=!0,Y>0){k.warn(`[mp4-remuxer]: Dropped ${Y} out of ${R} video samples due to a missing keyframe`);const B=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(Y),t.dropped+=Y,S+=(t.samples[0].pts-B)/t.inputTimeScale,Z=S}else Y===-1&&(k.warn(`[mp4-remuxer]: No keyframe found out of ${R} video samples`),v=!1);if(this.ISGenerated){if(M&&O){const B=this.getVideoStartPts(t.samples),ee=(Ot(e.samples[0].pts,B)-B)/t.inputTimeScale;A+=Math.max(0,ee),S+=Math.max(0,-ee)}if(M){if(e.samplerate||(k.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),f=this.generateIS(e,t,n,r)),h=this.remuxAudio(e,A,this.isAudioContiguous,r,C||O||l===me.AUDIO?S:void 0),O){const B=h?h.endPTS-h.startPTS:0;t.inputTimeScale||(k.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),f=this.generateIS(e,t,n,r)),c=this.remuxVideo(t,S,G,B)}}else O&&(c=this.remuxVideo(t,S,G,0));c&&(c.firstKeyFrame=Y,c.independent=Y!==-1,c.firstKeyFramePTS=Z)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(y=Er(i,n,this._initPTS,this._initDTS)),s.samples.length&&(g=Ar(s,n,this._initPTS))),{audio:h,video:c,initSegment:f,independent:v,text:g,id3:y}}generateIS(e,t,i,s){const n=e.samples,r=t.samples,o=this.typeSupported,l={},c=this._initPTS;let h=!c||s,f="audio/mp4",g,y,v;if(h&&(g=y=1/0),e.config&&n.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(f="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break}l.audio={id:"audio",container:f,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):P.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(v=e.inputTimeScale,!c||v!==c.timescale?g=y=n[0].pts-Math.round(v*i):h=!1)}if(t.sps&&t.pps&&r.length&&(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:P.initSegment([t]),metadata:{width:t.width,height:t.height}},h))if(v=t.inputTimeScale,!c||v!==c.timescale){const A=this.getVideoStartPts(r),S=Math.round(v*i);y=Math.min(y,Ot(r[0].dts,A)-S),g=Math.min(g,A-S)}else h=!1;if(Object.keys(l).length)return this.ISGenerated=!0,h?(this._initPTS={baseTime:g,timescale:v},this._initDTS={baseTime:y,timescale:v}):g=v=void 0,{tracks:l,initPTS:g,timescale:v}}remuxVideo(e,t,i,s){const n=e.inputTimeScale,r=e.samples,o=[],l=r.length,c=this._initPTS;let h=this.nextAvcDts,f=8,g=this.videoSampleDuration,y,v,A=Number.POSITIVE_INFINITY,S=Number.NEGATIVE_INFINITY,L=!1;if(!i||h===null){const ie=t*n,fe=r[0].pts-Ot(r[0].dts,r[0].pts);h=ie-fe}const C=c.baseTime*n/c.timescale;for(let ie=0;ie<l;ie++){const fe=r[ie];fe.pts=Ot(fe.pts-C,h),fe.dts=Ot(fe.dts-C,h),fe.dts<r[ie>0?ie-1:ie].dts&&(L=!0)}L&&r.sort(function(ie,fe){const Ve=ie.dts-fe.dts,Qe=ie.pts-fe.pts;return Ve||Qe}),y=r[0].dts,v=r[r.length-1].dts;const R=v-y,M=R?Math.round(R/(l-1)):g||e.inputTimeScale/30;if(i){const ie=y-h,fe=ie>M,Ve=ie<-1;if((fe||Ve)&&(fe?k.warn(`AVC: ${qi(ie,!0)} ms (${ie}dts) hole between fragments detected, filling it`):k.warn(`AVC: ${qi(-ie,!0)} ms (${ie}dts) overlapping between fragments detected`),!Ve||h>=r[0].pts)){y=h;const Qe=r[0].pts-ie;r[0].dts=y,r[0].pts=Qe,k.log(`Video: First PTS/DTS adjusted: ${qi(Qe,!0)}/${qi(y,!0)}, delta: ${qi(ie,!0)} ms`)}}y=Math.max(0,y);let O=0,J=0;for(let ie=0;ie<l;ie++){const fe=r[ie],Ve=fe.units,Qe=Ve.length;let _e=0;for(let dt=0;dt<Qe;dt++)_e+=Ve[dt].data.length;J+=_e,O+=Qe,fe.length=_e,fe.dts=Math.max(fe.dts,y),A=Math.min(fe.pts,A),S=Math.max(fe.pts,S)}v=r[l-1].dts;const G=J+4*O+8;let Y;try{Y=new Uint8Array(G)}catch(ie){this.observer.emit(b.ERROR,b.ERROR,{type:ue.MUX_ERROR,details:N.REMUX_ALLOC_ERROR,fatal:!1,error:ie,bytes:G,reason:`fail allocating video mdat ${G}`});return}const Z=new DataView(Y.buffer);Z.setUint32(0,G),Y.set(P.types.mdat,4);let B=!1,de=Number.POSITIVE_INFINITY,ee=Number.POSITIVE_INFINITY,$e=Number.NEGATIVE_INFINITY,bt=Number.NEGATIVE_INFINITY;for(let ie=0;ie<l;ie++){const fe=r[ie],Ve=fe.units;let Qe=0;for(let Ft=0,jt=Ve.length;Ft<jt;Ft++){const Mt=Ve[Ft],pi=Mt.data,Ln=Mt.data.byteLength;Z.setUint32(f,Ln),f+=4,Y.set(pi,f),f+=Ln,Qe+=4+Ln}let _e;if(ie<l-1)g=r[ie+1].dts-fe.dts,_e=r[ie+1].pts-fe.pts;else{const Ft=this.config,jt=ie>0?fe.dts-r[ie-1].dts:M;if(_e=ie>0?fe.pts-r[ie-1].pts:M,Ft.stretchShortVideoTrack&&this.nextAudioPts!==null){const Mt=Math.floor(Ft.maxBufferHole*n),pi=(s?A+s*n:this.nextAudioPts)-fe.pts;pi>Mt?(g=pi-jt,g<0?g=jt:B=!0,k.log(`[mp4-remuxer]: It is approximately ${pi/90} ms to the next segment; using duration ${g/90} ms for the last video frame.`)):g=jt}else g=jt}const dt=Math.round(fe.pts-fe.dts);de=Math.min(de,g),$e=Math.max($e,g),ee=Math.min(ee,_e),bt=Math.max(bt,_e),o.push(new Sr(fe.key,g,Qe,dt))}if(o.length){if(Es){if(Es<70){const ie=o[0].flags;ie.dependsOn=2,ie.isNonSync=0}}else if(Js&&bt-ee<$e-de&&M/$e<.025&&o[0].cts===0){k.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let ie=y;for(let fe=0,Ve=o.length;fe<Ve;fe++){const Qe=ie+o[fe].duration,_e=ie+o[fe].cts;if(fe<Ve-1){const dt=Qe+o[fe+1].cts;o[fe].duration=dt-_e}else o[fe].duration=fe?o[fe-1].duration:M;o[fe].cts=0,ie=Qe}}}g=B||!g?M:g,this.nextAvcDts=h=v+g,this.videoSampleDuration=g,this.isVideoContiguous=!0;const et=P.moof(e.sequenceNumber++,y,Ke({},e,{samples:o})),st="video",tt={data1:et,data2:Y,startPTS:A/n,endPTS:(S+g)/n,startDTS:y/n,endDTS:h/n,type:st,hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,tt}remuxAudio(e,t,i,s,n){const r=e.inputTimeScale,o=e.samplerate?e.samplerate:r,l=r/o,c=e.segmentCodec==="aac"?Tr:el,h=c*l,f=this._initPTS,g=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,y=[],v=n!==void 0;let A=e.samples,S=g?0:8,L=this.nextAudioPts||-1;const C=t*r,R=f.baseTime*r/f.timescale;if(this.isAudioContiguous=i=i||A.length&&L>0&&(s&&Math.abs(C-L)<9e3||Math.abs(Ot(A[0].pts-R,C)-L)<20*h),A.forEach(function(st){st.pts=Ot(st.pts-R,C)}),!i||L<0){if(A=A.filter(st=>st.pts>=0),!A.length)return;n===0?L=0:s&&!v?L=Math.max(0,C):L=A[0].pts}if(e.segmentCodec==="aac"){const st=this.config.maxAudioFramesDrift;for(let tt=0,ie=L;tt<A.length;tt++){const fe=A[tt],Ve=fe.pts,Qe=Ve-ie,_e=Math.abs(1e3*Qe/r);if(Qe<=-st*h&&v)tt===0&&(k.warn(`Audio frame @ ${(Ve/r).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*Qe/r)} ms.`),this.nextAudioPts=L=ie=Ve);else if(Qe>=st*h&&_e<Jo&&v){let dt=Math.round(Qe/h);ie=Ve-dt*h,ie<0&&(dt--,ie+=h),tt===0&&(this.nextAudioPts=L=ie),k.warn(`[mp4-remuxer]: Injecting ${dt} audio frame @ ${(ie/r).toFixed(3)}s due to ${Math.round(1e3*Qe/r)} ms gap.`);for(let Ft=0;Ft<dt;Ft++){const jt=Math.max(ie,0);let Mt=vr.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);Mt||(k.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Mt=fe.unit.subarray()),A.splice(tt,0,{unit:Mt,pts:jt}),ie+=h,tt++}}fe.pts=ie,ie+=h}}let M=null,O=null,J,G=0,Y=A.length;for(;Y--;)G+=A[Y].unit.byteLength;for(let st=0,tt=A.length;st<tt;st++){const ie=A[st],fe=ie.unit;let Ve=ie.pts;if(O!==null){const _e=y[st-1];_e.duration=Math.round((Ve-O)/l)}else if(i&&e.segmentCodec==="aac"&&(Ve=L),M=Ve,G>0){G+=S;try{J=new Uint8Array(G)}catch(_e){this.observer.emit(b.ERROR,b.ERROR,{type:ue.MUX_ERROR,details:N.REMUX_ALLOC_ERROR,fatal:!1,error:_e,bytes:G,reason:`fail allocating audio mdat ${G}`});return}g||(new DataView(J.buffer).setUint32(0,G),J.set(P.types.mdat,4))}else return;J.set(fe,S);const Qe=fe.byteLength;S+=Qe,y.push(new Sr(!0,c,Qe,0)),O=Ve}const Z=y.length;if(!Z)return;const B=y[y.length-1];this.nextAudioPts=L=O+l*B.duration;const de=g?new Uint8Array(0):P.moof(e.sequenceNumber++,M/l,Ke({},e,{samples:y}));e.samples=[];const ee=M/r,$e=L/r,et={data1:de,data2:J,startPTS:ee,endPTS:$e,startDTS:ee,endDTS:$e,type:"audio",hasAudio:!0,hasVideo:!1,nb:Z};return this.isAudioContiguous=!0,et}remuxEmptyAudio(e,t,i,s){const n=e.inputTimeScale,r=e.samplerate?e.samplerate:n,o=n/r,l=this.nextAudioPts,c=this._initDTS,h=c.baseTime*9e4/c.timescale,f=(l!==null?l:s.startDTS*n)+h,g=s.endDTS*n+h,y=o*Tr,v=Math.ceil((g-f)/y),A=vr.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(k.warn("[mp4-remuxer]: remux empty Audio"),!A){k.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const S=[];for(let L=0;L<v;L++){const C=f+L*y;S.push({unit:A,pts:C,dts:C})}return e.samples=S,this.remuxAudio(e,t,i,!1)}}function Ot(a,e){let t;if(e===null)return a;for(e<a?t=-8589934592:t=8589934592;Math.abs(a-e)>4294967296;)a+=t;return a}function tl(a){for(let e=0;e<a.length;e++)if(a[e].key)return e;return-1}function Er(a,e,t,i){const s=a.samples.length;if(!s)return;const n=a.inputTimeScale;for(let o=0;o<s;o++){const l=a.samples[o];l.pts=Ot(l.pts-t.baseTime*n/t.timescale,e*n)/n,l.dts=Ot(l.dts-i.baseTime*n/i.timescale,e*n)/n}const r=a.samples;return a.samples=[],{samples:r}}function Ar(a,e,t){const i=a.samples.length;if(!i)return;const s=a.inputTimeScale;for(let r=0;r<i;r++){const o=a.samples[r];o.pts=Ot(o.pts-t.baseTime*s/t.timescale,e*s)/s}a.samples.sort((r,o)=>r.pts-o.pts);const n=a.samples;return a.samples=[],{samples:n}}class Sr{constructor(e,t,i,s){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=i,this.cts=s,this.flags=new il(e)}}class il{constructor(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}}class sl{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,i,s){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(wi(e,s)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const s=this.initData=Pt(e);t||(t=xr(s.audio,Re.AUDIO)),i||(i=xr(s.video,Re.VIDEO));const n={};s.audio&&s.video?n.audiovideo={container:"video/mp4",codec:t+","+i,initSegment:e,id:"main"}:s.audio?n.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:s.video?n.video={container:"video/mp4",codec:i,initSegment:e,id:"main"}:k.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=n}remux(e,t,i,s,n,r){var o,l;let{initPTS:c,lastEndTime:h}=this;const f={audio:void 0,video:void 0,text:s,id3:i,initSegment:void 0};se(h)||(h=this.lastEndTime=n||0);const g=t.samples;if(!(g!=null&&g.length))return f;const y={initPTS:void 0,timescale:1};let v=this.initData;if((o=v)!=null&&o.length||(this.generateInitSegment(g),v=this.initData),!((l=v)!=null&&l.length))return k.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),f;this.emitInitSegment&&(y.tracks=this.initTracks,this.emitInitSegment=!1);const A=xa(g,v),S=Sa(v,g),L=S===null?n:S;(nl(c,L,n,A)||y.timescale!==c.timescale&&r)&&(y.initPTS=L-n,c&&c.timescale===1&&k.warn(`Adjusting initPTS by ${y.initPTS-c.baseTime}`),this.initPTS=c={baseTime:y.initPTS,timescale:1});const C=e?L-c.baseTime/c.timescale:h,R=C+A;wa(v,g,c.baseTime/c.timescale),A>0?this.lastEndTime=R:(k.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const M=!!v.audio,O=!!v.video;let J="";M&&(J+="audio"),O&&(J+="video");const G={data1:g,startPTS:C,startDTS:C,endPTS:R,endDTS:R,type:J,hasAudio:M,hasVideo:O,nb:1,dropped:0};return f.audio=G.type==="audio"?G:void 0,f.video=G.type!=="audio"?G:void 0,f.initSegment=y,f.id3=Er(i,n,c,c),s.samples.length&&(f.text=Ar(s,n,c)),f}}function nl(a,e,t,i){if(a===null)return!0;const s=Math.max(i,1),n=e-a.baseTime/a.timescale;return Math.abs(n-t)>s}function xr(a,e){const t=a==null?void 0:a.codec;return t&&t.length>4?t:t==="hvc1"||t==="hev1"?"hvc1.1.6.L120.90":t==="av01"?"av01.0.04M.08":t==="avc1"||e===Re.VIDEO?"avc1.42e01e":"mp4a.40.5"}let ti;try{ti=self.performance.now.bind(self.performance)}catch{k.debug("Unable to use Performance API on this environment"),ti=typeof self<"u"&&self.Date.now}const tn=[{demux:$o,remux:sl},{demux:ri,remux:en},{demux:Bo,remux:en},{demux:Xo,remux:en}];class Lr{constructor(e,t,i,s,n){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.vendor=s,this.id=n}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,s){const n=i.transmuxing;n.executeStart=ti();let r=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:l}=this;s&&(this.currentTransmuxState=s);const{contiguous:c,discontinuity:h,trackSwitch:f,accurateTimeOffset:g,timeOffset:y,initSegmentChange:v}=s||o,{audioCodec:A,videoCodec:S,defaultInitPts:L,duration:C,initSegmentData:R}=l,M=rl(r,t);if(M&&M.method==="AES-128"){const Y=this.getDecrypter();if(Y.isSync()){let Z=Y.softwareDecrypt(r,M.key.buffer,M.iv.buffer);if(i.part>-1&&(Z=Y.flush()),!Z)return n.executeEnd=ti(),sn(i);r=new Uint8Array(Z)}else return this.decryptionPromise=Y.webCryptoDecrypt(r,M.key.buffer,M.iv.buffer).then(Z=>{const B=this.push(Z,null,i);return this.decryptionPromise=null,B}),this.decryptionPromise}const O=this.needsProbing(h,f);if(O){const Y=this.configureTransmuxer(r);if(Y)return k.warn(`[transmuxer] ${Y.message}`),this.observer.emit(b.ERROR,b.ERROR,{type:ue.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,error:Y,reason:Y.message}),n.executeEnd=ti(),sn(i)}(h||f||v||O)&&this.resetInitSegment(R,A,S,C,t),(h||v||O)&&this.resetInitialTimestamp(L),c||this.resetContiguity();const J=this.transmux(r,M,y,g,i),G=this.currentTransmuxState;return G.contiguous=!0,G.discontinuity=!1,G.trackSwitch=!1,n.executeEnd=ti(),J}flush(e){const t=e.transmuxing;t.executeStart=ti();const{decrypter:i,currentTransmuxState:s,decryptionPromise:n}=this;if(n)return n.then(()=>this.flush(e));const r=[],{timeOffset:o}=s;if(i){const f=i.flush();f&&r.push(this.push(f,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c)return t.executeEnd=ti(),[sn(e)];const h=l.flush(o);return As(h)?h.then(f=>(this.flushRemux(r,f,e),r)):(this.flushRemux(r,h,e),r)}flushRemux(e,t,i){const{audioTrack:s,videoTrack:n,id3Track:r,textTrack:o}=t,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;k.log(`[transmuxer.ts]: Flushed fragment ${i.sn}${i.part>-1?" p: "+i.part:""} of level ${i.level}`);const h=this.remuxer.remux(s,n,r,o,c,l,!0,this.id);e.push({remuxResult:h,chunkMeta:i}),i.transmuxing.executeEnd=ti()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,s,n){const{demuxer:r,remuxer:o}=this;!r||!o||(r.resetInitSegment(e,t,i,s),o.resetInitSegment(e,t,i,n))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,s,n){let r;return t&&t.method==="SAMPLE-AES"?r=this.transmuxSampleAes(e,t,i,s,n):r=this.transmuxUnencrypted(e,i,s,n),r}transmuxUnencrypted(e,t,i,s){const{audioTrack:n,videoTrack:r,id3Track:o,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(n,r,o,l,t,i,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,i,s,n){return this.demuxer.demuxSampleAes(e,t,i).then(r=>({remuxResult:this.remuxer.remux(r.audioTrack,r.videoTrack,r.id3Track,r.textTrack,i,s,!1,this.id),chunkMeta:n}))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:s,vendor:n}=this;let r;for(let f=0,g=tn.length;f<g;f++)if(tn[f].demux.probe(e)){r=tn[f];break}if(!r)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,c=r.remux,h=r.demux;(!l||!(l instanceof c))&&(this.remuxer=new c(i,t,s,n)),(!o||!(o instanceof h))&&(this.demuxer=new h(i,t,s),this.probe=h.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Ys(this.config)),e}}function rl(a,e){let t=null;return a.byteLength>0&&e!=null&&e.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const sn=a=>({remuxResult:{},chunkMeta:a});function As(a){return"then"in a&&a.then instanceof Function}class al{constructor(e,t,i,s,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=s,this.defaultInitPts=n||null}}class ol{constructor(e,t,i,s,n,r){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=s,this.timeOffset=n,this.initSegmentChange=r}}var wr={exports:{}};(function(a){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function s(l,c,h){this.fn=l,this.context=c,this.once=h||!1}function n(l,c,h,f,g){if(typeof h!="function")throw new TypeError("The listener must be a function");var y=new s(h,f||l,g),v=t?t+c:c;return l._events[v]?l._events[v].fn?l._events[v]=[l._events[v],y]:l._events[v].push(y):(l._events[v]=y,l._eventsCount++),l}function r(l,c){--l._eventsCount===0?l._events=new i:delete l._events[c]}function o(){this._events=new i,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],h,f;if(this._eventsCount===0)return c;for(f in h=this._events)e.call(h,f)&&c.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(h)):c},o.prototype.listeners=function(c){var h=t?t+c:c,f=this._events[h];if(!f)return[];if(f.fn)return[f.fn];for(var g=0,y=f.length,v=new Array(y);g<y;g++)v[g]=f[g].fn;return v},o.prototype.listenerCount=function(c){var h=t?t+c:c,f=this._events[h];return f?f.fn?1:f.length:0},o.prototype.emit=function(c,h,f,g,y,v){var A=t?t+c:c;if(!this._events[A])return!1;var S=this._events[A],L=arguments.length,C,R;if(S.fn){switch(S.once&&this.removeListener(c,S.fn,void 0,!0),L){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,h),!0;case 3:return S.fn.call(S.context,h,f),!0;case 4:return S.fn.call(S.context,h,f,g),!0;case 5:return S.fn.call(S.context,h,f,g,y),!0;case 6:return S.fn.call(S.context,h,f,g,y,v),!0}for(R=1,C=new Array(L-1);R<L;R++)C[R-1]=arguments[R];S.fn.apply(S.context,C)}else{var M=S.length,O;for(R=0;R<M;R++)switch(S[R].once&&this.removeListener(c,S[R].fn,void 0,!0),L){case 1:S[R].fn.call(S[R].context);break;case 2:S[R].fn.call(S[R].context,h);break;case 3:S[R].fn.call(S[R].context,h,f);break;case 4:S[R].fn.call(S[R].context,h,f,g);break;default:if(!C)for(O=1,C=new Array(L-1);O<L;O++)C[O-1]=arguments[O];S[R].fn.apply(S[R].context,C)}}return!0},o.prototype.on=function(c,h,f){return n(this,c,h,f,!1)},o.prototype.once=function(c,h,f){return n(this,c,h,f,!0)},o.prototype.removeListener=function(c,h,f,g){var y=t?t+c:c;if(!this._events[y])return this;if(!h)return r(this,y),this;var v=this._events[y];if(v.fn)v.fn===h&&(!g||v.once)&&(!f||v.context===f)&&r(this,y);else{for(var A=0,S=[],L=v.length;A<L;A++)(v[A].fn!==h||g&&!v[A].once||f&&v[A].context!==f)&&S.push(v[A]);S.length?this._events[y]=S.length===1?S[0]:S:r(this,y)}return this},o.prototype.removeAllListeners=function(c){var h;return c?(h=t?t+c:c,this._events[h]&&r(this,h)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,a.exports=o})(wr);var ll=wr.exports,nn=Ji(ll);const rn=ds()||{isTypeSupported:()=>!1};class Ir{constructor(e,t,i,s){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const n=e.config;this.hls=e,this.id=t,this.useWorker=!!n.enableWorker,this.onTransmuxComplete=i,this.onFlush=s;const r=(c,h)=>{h=h||{},h.frag=this.frag,h.id=this.id,c===b.ERROR&&(this.error=h.error),this.hls.trigger(c,h)};this.observer=new nn,this.observer.on(b.FRAG_DECRYPTED,r),this.observer.on(b.ERROR,r);const o={mp4:rn.isTypeSupported("video/mp4"),mpeg:rn.isTypeSupported("audio/mpeg"),mp3:rn.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(this.useWorker&&typeof Worker<"u"&&(n.workerPath||Ro())){try{n.workerPath?(k.log(`loading Web Worker ${n.workerPath} for "${t}"`),this.workerContext=Do(n.workerPath)):(k.log(`injecting Web Worker for "${t}"`),this.workerContext=Co()),this.onwmsg=f=>this.onWorkerMessage(f);const{worker:h}=this.workerContext;h.addEventListener("message",this.onwmsg),h.onerror=f=>{const g=new Error(`${f.message}  (${f.filename}:${f.lineno})`);n.enableWorker=!1,k.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(b.ERROR,{type:ue.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:g})},h.postMessage({cmd:"init",typeSupported:o,vendor:l,id:t,config:JSON.stringify(n)})}catch(h){k.warn(`Error setting up "${t}" Web Worker, fallback to inline`,h),this.resetWorker(),this.error=null,this.transmuxer=new Lr(this.observer,o,n,l,t)}return}this.transmuxer=new Lr(this.observer,o,n,l,t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,i,s,n,r,o,l,c,h){var f,g;c.transmuxing.start=self.performance.now();const{transmuxer:y}=this,v=r?r.start:n.start,A=n.decryptdata,S=this.frag,L=!(S&&n.cc===S.cc),C=!(S&&c.level===S.level),R=S?c.sn-S.sn:-1,M=this.part?c.part-this.part.index:-1,O=R===0&&c.id>1&&c.id===(S==null?void 0:S.stats.chunkCount),J=!C&&(R===1||R===0&&(M===1||O&&M<=0)),G=self.performance.now();(C||R||n.stats.parsing.start===0)&&(n.stats.parsing.start=G),r&&(M||!J)&&(r.stats.parsing.start=G);const Y=!(S&&((f=n.initSegment)==null?void 0:f.url)===((g=S.initSegment)==null?void 0:g.url)),Z=new ol(L,J,l,C,v,Y);if(!J||L||Y){k.log(`[transmuxer-interface, ${n.type}]: Starting new transmux session for sn: ${c.sn} p: ${c.part} level: ${c.level} id: ${c.id}
        discontinuity: ${L}
        trackSwitch: ${C}
        contiguous: ${J}
        accurateTimeOffset: ${l}
        timeOffset: ${v}
        initSegmentChange: ${Y}`);const B=new al(i,s,t,o,h);this.configureTransmuxer(B)}if(this.frag=n,this.part=r,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:A,chunkMeta:c,state:Z},e instanceof ArrayBuffer?[e]:[]);else if(y){const B=y.push(e,A,c,Z);As(B)?(y.async=!0,B.then(de=>{this.handleTransmuxComplete(de)}).catch(de=>{this.transmuxerError(de,c,"transmuxer-interface push error")})):(y.async=!1,this.handleTransmuxComplete(B))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let i=t.flush(e);As(i)||t.async?(As(i)||(i=Promise.resolve(i)),i.then(n=>{this.handleFlushResult(n,e)}).catch(n=>{this.transmuxerError(n,e,"transmuxer-interface flush error")})):this.handleFlushResult(i,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(b.ERROR,{type:ue.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}onWorkerMessage(e){const t=e.data,i=this.hls;switch(t.event){case"init":{var s;const n=(s=this.workerContext)==null?void 0:s.objectURL;n&&self.URL.revokeObjectURL(n);break}case"transmuxComplete":{this.handleTransmuxComplete(t.data);break}case"flush":{this.onFlush(t.data);break}case"workerLog":k[t.data.logType]&&k[t.data.logType](t.data.message);break;default:{t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data);break}}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const cl=250,an=2,ul=.1,dl=.05;class hl{constructor(e,t,i,s){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=i,this.hls=s}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:i,media:s,stalled:n}=this;if(s===null)return;const{currentTime:r,seeking:o}=s,l=this.seeking&&!o,c=!this.seeking&&o;if(this.seeking=o,r!==e){if(this.moved=!0,n!==null){if(this.stallReported){const L=self.performance.now()-n;k.warn(`playback not stuck anymore @${r}, after ${Math.round(L)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(c||l){this.stalled=null;return}if(s.paused&&!o||s.ended||s.playbackRate===0||!Xe.getBuffered(s).length)return;const h=Xe.bufferInfo(s,r,0),f=h.len>0,g=h.nextStart||0;if(!f&&!g)return;if(o){const L=h.len>an,C=!g||t&&t.start<=r||g-r>an&&!this.fragmentTracker.getPartialFragment(r);if(L||C)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var y;const L=Math.max(g,h.start||0)-r,C=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,M=(C==null||(y=C.details)==null?void 0:y.live)?C.details.targetduration*2:an,O=this.fragmentTracker.getPartialFragment(r);if(L>0&&(L<=M||O)){this._trySkipBufferHole(O);return}}const v=self.performance.now();if(n===null){this.stalled=v;return}const A=v-n;if(!o&&A>=cl&&(this._reportStall(h),!this.media))return;const S=Xe.bufferInfo(s,r,i.maxBufferHole);this._tryFixBufferStall(S,A)}_tryFixBufferStall(e,t){const{config:i,fragmentTracker:s,media:n}=this;if(n===null)return;const r=n.currentTime,o=s.getPartialFragment(r);o&&(this._trySkipBufferHole(o)||!this.media)||(e.len>i.maxBufferHole||e.nextStart&&e.nextStart-r<i.maxBufferHole)&&t>i.highBufferWatchdogPeriod*1e3&&(k.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:i,stallReported:s}=this;if(!s&&i){this.stallReported=!0;const n=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${JSON.stringify(e)})`);k.warn(n.message),t.trigger(b.ERROR,{type:ue.MEDIA_ERROR,details:N.BUFFER_STALLED_ERROR,fatal:!1,error:n,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:i,media:s}=this;if(s===null)return 0;const n=s.currentTime,r=Xe.bufferInfo(s,n,0),o=n<r.start?r.start:r.nextStart;if(o){const l=r.len<=t.maxBufferHole,c=r.len>0&&r.len<1&&s.readyState<3,h=o-n;if(h>0&&(l||c)){if(h>t.maxBufferHole){const{fragmentTracker:g}=this;let y=!1;if(n===0){const v=g.getAppendedFrag(0,me.MAIN);v&&o<v.end&&(y=!0)}if(!y){const v=e||g.getAppendedFrag(n,me.MAIN);if(v){let A=!1,S=v.end;for(;S<o;){const L=g.getPartialFragment(S);if(L)S+=L.duration;else{A=!0;break}}if(A)return 0}}}const f=Math.max(o+dl,n+ul);if(k.warn(`skipping hole, adjusting currentTime from ${n} to ${f}`),this.moved=!0,this.stalled=null,s.currentTime=f,e&&!e.gap){const g=new Error(`fragment loaded with buffer holes, seeking from ${n} to ${f}`);i.trigger(b.ERROR,{type:ue.MEDIA_ERROR,details:N.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,frag:e})}return f}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:i,nudgeRetry:s}=this;if(i===null)return;const n=i.currentTime;if(this.nudgeRetry++,s<e.nudgeMaxRetry){const r=n+(s+1)*e.nudgeOffset,o=new Error(`Nudging 'currentTime' from ${n} to ${r}`);k.warn(o.message),i.currentTime=r,t.trigger(b.ERROR,{type:ue.MEDIA_ERROR,details:N.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1})}else{const r=new Error(`Playhead still not moving while enough data buffered @${n} after ${e.nudgeMaxRetry} nudges`);k.error(r.message),t.trigger(b.ERROR,{type:ue.MEDIA_ERROR,details:N.BUFFER_STALLED_ERROR,error:r,fatal:!0})}}}const fl=100;class ml extends qs{constructor(e,t,i){super(e,t,i,"[stream-controller]",me.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(b.ERROR,this.onError,this),e.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this),e.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(b.ERROR,this.onError,this),e.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this),e.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:i}=this;if(this.stopLoad(),this.setInterval(fl),this.level=-1,!this.startFragRequested){let s=i.startLevel;s===-1&&(i.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=i.nextAutoLevel),this.level=i.nextLoadLevel=s,this.loadedmetadata=!1}t>0&&e===-1&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=V.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=V.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case V.WAITING_LEVEL:{var e;const{levels:i,level:s}=this,n=i==null||(e=i[s])==null?void 0:e.details;if(n&&(!n.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(n))break;this.state=V.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=V.IDLE;break}break}case V.FRAG_LOADING_WAITING_RETRY:{var t;const i=self.performance.now(),s=this.retryDate;(!s||i>=s||(t=this.media)!=null&&t.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=V.IDLE)}break}this.state===V.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:s}=this,{config:n,nextLoadLevel:r}=e;if(t===null||!s&&(this.startFragRequested||!n.startFragPrefetch)||this.altAudio&&this.audioOnly||!(i!=null&&i[r]))return;const o=i[r],l=this.getMainFwdBufferInfo();if(l===null)return;const c=this.getLevelDetails();if(c&&this._streamEnded(l,c)){const S={};this.altAudio&&(S.type="video"),this.hls.trigger(b.BUFFER_EOS,S),this.state=V.ENDED;return}e.loadLevel!==r&&e.manualLevel===-1&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const h=o.details;if(!h||this.state===V.WAITING_LEVEL||h.live&&this.levelLastLoaded!==r){this.level=r,this.state=V.WAITING_LEVEL;return}const f=l.len,g=this.getMaxBufferLength(o.maxBitrate);if(f>=g)return;this.backtrackFragment&&this.backtrackFragment.start>l.end&&(this.backtrackFragment=null);const y=this.backtrackFragment?this.backtrackFragment.start:l.end;let v=this.getNextFragment(y,h);if(this.couldBacktrack&&!this.fragPrevious&&v&&v.sn!=="initSegment"&&this.fragmentTracker.getState(v)!==ft.OK){var A;const L=((A=this.backtrackFragment)!=null?A:v).sn-h.startSN,C=h.fragments[L-1];C&&v.cc===C.cc&&(v=C,this.fragmentTracker.removeFragment(C))}else this.backtrackFragment&&l.len&&(this.backtrackFragment=null);if(v&&this.isLoopLoading(v,y)){if(!v.gap){const L=this.audioOnly&&!this.altAudio?Re.AUDIO:Re.VIDEO,C=(L===Re.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;C&&this.afterBufferFlushed(C,L,me.MAIN)}v=this.getNextFragmentLoopLoading(v,h,l,me.MAIN,g)}v&&(v.initSegment&&!v.initSegment.data&&!this.bitrateTest&&(v=v.initSegment),this.loadFragment(v,o,y))}loadFragment(e,t,i){const s=this.fragmentTracker.getState(e);this.fragCurrent=e,s===ft.NOT_LOADED||s===ft.PARTIAL?e.sn==="initSegment"?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,i)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,me.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let i;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const n=this.getLevelDetails();if(n!=null&&n.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<n.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,l=e[o],c=this.fragLastKbps;c&&this.fragCurrent?i=this.fragCurrent.duration*l.maxBitrate/(1e3*c)+1:i=0}else i=0;const r=this.getBufferedFrag(t.currentTime+i);if(r){const o=this.followingBufferedFrag(r);if(o){this.abortCurrentFrag();const l=o.maxStartPTS?o.maxStartPTS:o.start,c=o.duration,h=Math.max(r.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*.5),c*.75));this.flushMainBuffer(h,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case V.KEY_LOADING:case V.FRAG_LOADING:case V.FRAG_LOADING_WAITING_RETRY:case V.PARSING:case V.PARSED:this.state=V.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new hl(this.config,i,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;se(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const i=this.getMainFwdBufferInfo();if(i===null||i.len===0){this.warn(`Main forward buffer length on "seeked" event ${i?i.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(b.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}onManifestParsed(e,t){let i=!1,s=!1,n;t.levels.forEach(r=>{n=r.audioCodec,n&&(n.indexOf("mp4a.40.2")!==-1&&(i=!0),n.indexOf("mp4a.40.5")!==-1&&(s=!0))}),this.audioCodecSwitch=i&&s&&!ko(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==V.IDLE)return;const s=i[t.level];(!s.details||s.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(s.details))&&(this.state=V.WAITING_LEVEL)}onLevelLoaded(e,t){var i;const{levels:s}=this,n=t.level,r=t.details,o=r.totalduration;if(!s){this.warn(`Levels were reset while loading level ${n}`);return}this.log(`Level ${n} loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""}, cc [${r.startCC}, ${r.endCC}] duration:${o}`);const l=s[n],c=this.fragCurrent;c&&(this.state===V.FRAG_LOADING||this.state===V.FRAG_LOADING_WAITING_RETRY)&&(c.level!==t.level||c.urlId!==l.urlId)&&c.loader&&this.abortCurrentFrag();let h=0;if(r.live||(i=l.details)!=null&&i.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;h=this.alignPlaylists(r,l.details)}if(l.details=r,this.levelLastLoaded=n,this.hls.trigger(b.LEVEL_UPDATED,{details:r,level:n}),this.state===V.WAITING_LEVEL){if(this.waitForCdnTuneIn(r))return;this.state=V.IDLE}this.startFragRequested?r.live&&this.synchronizeToLiveEdge(r):this.setStartPosition(r,h),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:i,part:s,payload:n}=e,{levels:r}=this;if(!r){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const o=r[i.level],l=o.details;if(!l){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const c=o.videoCodec,h=l.PTSKnown||!l.live,f=(t=i.initSegment)==null?void 0:t.data,g=this._getAudioCodec(o),y=this.transmuxer=this.transmuxer||new Ir(this.hls,me.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),v=s?s.index:-1,A=v!==-1,S=new js(i.level,i.sn,i.stats.chunkCount,n.byteLength,v,A),L=this.initPTS[i.cc];y.push(n,f,g,c,i,s,l.totalduration,h,S,L)}onAudioTrackSwitching(e,t){const i=this.altAudio;if(!!!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const r=this.fragCurrent;r&&(this.log("Switching to main audio track, cancel main fragment load"),r.abortRequests(),this.fragmentTracker.removeFragment(r)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const n=this.hls;i&&(n.trigger(b.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),n.trigger(b.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=t.id,s=!!this.hls.audioTracks[i].url;if(s){const n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=s,this.tick()}onBufferCreated(e,t){const i=t.tracks;let s,n,r=!1;for(const o in i){const l=i[o];if(l.id==="main"){if(n=o,s=l,o==="video"){const c=i[o];c&&(this.videoBuffer=c.buffer)}}else r=!0}r&&s?(this.log(`Alternate track found, use ${n}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:s}=t;if(i&&i.type!==me.MAIN)return;if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===V.PARSED&&(this.state=V.IDLE);return}const n=s?s.stats:i.stats;this.fragLastKbps=Math.round(8*n.total/(n.buffering.end-n.loading.first)),i.sn!=="initSegment"&&(this.fragPrevious=i),this.fragBufferedComplete(i,s)}onError(e,t){var i;if(t.fatal){this.state=V.ERROR;return}switch(t.details){case N.FRAG_GAP:case N.FRAG_PARSING_ERROR:case N.FRAG_DECRYPT_ERROR:case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(me.MAIN,t);break;case N.LEVEL_LOAD_ERROR:case N.LEVEL_LOAD_TIMEOUT:case N.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===V.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===ke.LEVEL&&(this.state=V.IDLE);break;case N.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case N.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}checkBuffer(){const{media:e,gapController:t}=this;if(!(!e||!t||!e.readyState)){if(this.loadedmetadata||!Xe.getBuffered(e).length){const i=this.state!==V.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,i)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=V.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Re.AUDIO||this.audioOnly&&!this.altAudio){const i=(t===Re.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(i,t,me.MAIN)}}onLevelsUpdated(e,t){this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}const s=Xe.getBuffered(e),r=(s.length?s.start(0):0)-i;r>0&&(r<this.config.maxBufferHole||r<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${r} to match buffer start`),i+=r,this.startPosition=i),this.log(`seek to target start position ${i} from current time ${t}`),e.currentTime=i}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{const{hls:s}=this;if(!i||this.fragContextChanged(e))return;t.fragmentError=0,this.state=V.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const n=e.stats;n.parsing.start=n.parsing.end=n.buffering.start=n.buffering.end=self.performance.now(),s.trigger(b.FRAG_LOADED,i),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const i="main",{hls:s}=this,{remuxResult:n,chunkMeta:r}=e,o=this.getCurrentContext(r);if(!o){this.resetWhenMissingContext(r);return}const{frag:l,part:c,level:h}=o,{video:f,text:g,id3:y,initSegment:v}=n,{details:A}=h,S=this.altAudio?void 0:n.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=V.PARSING,v){if(v!=null&&v.tracks){const R=l.initSegment||l;this._bufferInitSegment(h,v.tracks,R,r),s.trigger(b.FRAG_PARSING_INIT_SEGMENT,{frag:R,id:i,tracks:v.tracks})}const L=v.initPTS,C=v.timescale;se(L)&&(this.initPTS[l.cc]={baseTime:L,timescale:C},s.trigger(b.INIT_PTS_FOUND,{frag:l,id:i,initPTS:L,timescale:C}))}if(f&&A&&l.sn!=="initSegment"){const L=A.fragments[l.sn-1-A.startSN],C=l.sn===A.startSN,R=!L||l.cc>L.cc;if(n.independent!==!1){const{startPTS:M,endPTS:O,startDTS:J,endDTS:G}=f;if(c)c.elementaryStreams[f.type]={startPTS:M,endPTS:O,startDTS:J,endDTS:G};else if(f.firstKeyFrame&&f.independent&&r.id===1&&!R&&(this.couldBacktrack=!0),f.dropped&&f.independent){const Y=this.getMainFwdBufferInfo(),Z=(Y?Y.end:this.getLoadPosition())+this.config.maxBufferHole,B=f.firstKeyFramePTS?f.firstKeyFramePTS:M;if(!C&&Z<B-this.config.maxBufferHole&&!R){this.backtrack(l);return}else R&&(l.gap=!0);l.setElementaryStreamInfo(f.type,l.start,O,l.start,G,!0)}l.setElementaryStreamInfo(f.type,M,O,J,G),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(f,l,c,r,C||R)}else if(C||R)l.gap=!0;else{this.backtrack(l);return}}if(S){const{startPTS:L,endPTS:C,startDTS:R,endDTS:M}=S;c&&(c.elementaryStreams[Re.AUDIO]={startPTS:L,endPTS:C,startDTS:R,endDTS:M}),l.setElementaryStreamInfo(Re.AUDIO,L,C,R,M),this.bufferFragmentData(S,l,c,r)}if(A&&y!=null&&(t=y.samples)!=null&&t.length){const L={id:i,frag:l,details:A,samples:y.samples};s.trigger(b.FRAG_PARSING_METADATA,L)}if(A&&g){const L={id:i,frag:l,details:A,samples:g.samples};s.trigger(b.FRAG_PARSING_USERDATA,L)}}_bufferInitSegment(e,t,i,s){if(this.state!==V.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:n,video:r,audiovideo:o}=t;if(n){let l=e.audioCodec;const c=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(l&&(l.indexOf("mp4a.40.5")!==-1?l="mp4a.40.2":l="mp4a.40.5"),n.metadata.channelCount!==1&&c.indexOf("firefox")===-1&&(l="mp4a.40.5")),c.indexOf("android")!==-1&&n.container!=="audio/mpeg"&&(l="mp4a.40.2",this.log(`Android: force audio codec to ${l}`)),e.audioCodec&&e.audioCodec!==l&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${l}"`),n.levelCodec=l,n.id="main",this.log(`Init audio buffer, container:${n.container}, codecs[selected/level/parsed]=[${l||""}/${e.audioCodec||""}/${n.codec}]`)}r&&(r.levelCodec=e.videoCodec,r.id="main",this.log(`Init video buffer, container:${r.container}, codecs[level/parsed]=[${e.videoCodec||""}/${r.codec}]`)),o&&this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.attrs.CODECS||""}/${o.codec}]`),this.hls.trigger(b.BUFFER_CODECS,t),Object.keys(t).forEach(l=>{const h=t[l].initSegment;h!=null&&h.byteLength&&this.hls.trigger(b.BUFFER_APPENDING,{type:l,data:h,frag:i,part:null,chunkMeta:s,parent:i.type})}),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,me.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=V.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const i=e.currentTime;if(Xe.isBuffered(e,i)?t=this.getAppendedFrag(i):Xe.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,n=t.level;(!s||t.sn!==s.sn||s.level!==n||t.urlId!==s.urlId)&&(this.fragPlaying=t,this.hls.trigger(b.FRAG_CHANGED,{frag:t}),(!s||s.level!==n)&&this.hls.trigger(b.LEVEL_SWITCHED,{level:n}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,i=this.currentFrag;if(i&&se(t)&&se(i.programDateTime)){const s=i.programDateTime+(t-i.start)*1e3;return new Date(s)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Ci{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class gl{constructor(e,t,i,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ci(e),this.fast_=new Ci(t),this.defaultTTFB_=s,this.ttfb_=new Ci(e)}update(e,t){const{slow_:i,fast_:s,ttfb_:n}=this;i.halfLife!==e&&(this.slow_=new Ci(e,i.getEstimate(),i.getTotalWeight())),s.halfLife!==t&&(this.fast_=new Ci(t,s.getEstimate(),s.getTotalWeight())),n.halfLife!==e&&(this.ttfb_=new Ci(e,n.getEstimate(),n.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const i=8*t,s=e/1e3,n=i/s;this.fast_.sample(s,n),this.slow_.sample(s,n)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class pl{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;const t=e.config;this.bwEstimator=new gl(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(b.FRAG_LOADING,this.onFragLoading,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){const{hls:e}=this;e.off(b.FRAG_LOADING,this.onFragLoading,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(e,t){var i;const s=t.frag;this.ignoreFragment(s)||(this.fragCurrent=s,this.partCurrent=(i=t.part)!=null?i:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(e,t){this.clearTimer()}getTimeToLoadFrag(e,t,i,s){const n=e+i/t,r=s?this.lastLevelLoadSec:0;return n+r}onLevelLoaded(e,t){const i=this.hls.config,{total:s,bwEstimate:n}=t.stats;se(s)&&se(n)&&(this.lastLevelLoadSec=8*s/n),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)}_abandonRulesCheck(){const{fragCurrent:e,partCurrent:t,hls:i}=this,{autoLevelEnabled:s,media:n}=i;if(!e||!n)return;const r=performance.now(),o=t?t.stats:e.stats,l=t?t.duration:e.duration,c=r-o.loading.start;if(o.aborted||o.loaded&&o.loaded===o.total||e.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!s||n.paused||!n.playbackRate||!n.readyState)return;const h=i.mainForwardBufferInfo;if(h===null)return;const f=this.bwEstimator.getEstimateTTFB(),g=Math.abs(n.playbackRate);if(c<=Math.max(f,1e3*(l/(g*2))))return;const y=h.len/g;if(y>=2*l/g)return;const v=o.loading.first?o.loading.first-o.loading.start:-1,A=o.loaded&&v>-1,S=this.bwEstimator.getEstimate(),{levels:L,minAutoLevel:C}=i,R=L[e.level],M=o.total||Math.max(o.loaded,Math.round(l*R.maxBitrate/8));let O=c-v;O<1&&A&&(O=Math.min(c,o.loaded*8/S));const J=A?o.loaded*1e3/O:0,G=J?(M-o.loaded)/J:M*8/S+f/1e3;if(G<=y)return;const Y=J?J*8:S;let Z=Number.POSITIVE_INFINITY,B;for(B=e.level-1;B>C;B--){const de=L[B].maxBitrate;if(Z=this.getTimeToLoadFrag(f/1e3,Y,l*de,!L[B].details),Z<y)break}Z>=G||Z>l*10||(i.nextLoadLevel=B,A?this.bwEstimator.sample(c-Math.min(f,v),o.loaded):this.bwEstimator.sampleTTFB(c),this.clearTimer(),k.warn(`[abr] Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} is loading too slowly;
      Time to underbuffer: ${y.toFixed(3)} s
      Estimated load time for current fragment: ${G.toFixed(3)} s
      Estimated load time for down switch fragment: ${Z.toFixed(3)} s
      TTFB estimate: ${v}
      Current BW estimate: ${se(S)?(S/1024).toFixed(3):"Unknown"} Kb/s
      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s
      Aborting and switching to level ${B}`),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),i.trigger(b.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:o}))}onFragLoaded(e,{frag:t,part:i}){const s=i?i.stats:t.stats;if(t.type===me.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){const n=i?i.duration:t.duration,r=this.hls.levels[t.level],o=(r.loaded?r.loaded.bytes:0)+s.loaded,l=(r.loaded?r.loaded.duration:0)+n;r.loaded={bytes:o,duration:l},r.realBitrate=Math.round(8*o/l)}if(t.bitrateTest){const n={stats:s,frag:t,part:i,id:t.type};this.onFragBuffered(b.FRAG_BUFFERED,n),t.bitrateTest=!1}}}onFragBuffered(e,t){const{frag:i,part:s}=t,n=s!=null&&s.stats.loaded?s.stats:i.stats;if(n.aborted||this.ignoreFragment(i))return;const r=n.parsing.end-n.loading.start-Math.min(n.loading.first-n.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(r,n.loaded),n.bwEstimate=this.bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=r/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==me.MAIN||e.sn==="initSegment"}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){const e=this._nextAutoLevel,t=this.bwEstimator;if(e!==-1&&!t.canEstimate())return e;let i=this.getNextABRAutoLevel();if(e!==-1){const s=this.hls.levels;if(s.length>Math.max(e,i)&&s[e].loadError<=s[i].loadError)return e}return e!==-1&&(i=Math.min(e,i)),i}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this,{maxAutoLevel:s,config:n,minAutoLevel:r,media:o}=i,l=t?t.duration:e?e.duration:0,c=o&&o.playbackRate!==0?Math.abs(o.playbackRate):1,h=this.bwEstimator?this.bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,f=i.mainForwardBufferInfo,g=(f?f.len:0)/c;let y=this.findBestLevel(h,r,s,g,n.abrBandWidthFactor,n.abrBandWidthUpFactor);if(y>=0)return y;k.trace(`[abr] ${g?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let v=l?Math.min(l,n.maxStarvationDelay):n.maxStarvationDelay,A=n.abrBandWidthFactor,S=n.abrBandWidthUpFactor;if(!g){const L=this.bitrateTestDelay;L&&(v=(l?Math.min(l,n.maxLoadingDelay):n.maxLoadingDelay)-L,k.trace(`[abr] bitrate test took ${Math.round(1e3*L)}ms, set first fragment max fetchDuration to ${Math.round(1e3*v)} ms`),A=S=1)}return y=this.findBestLevel(h,r,s,g+v,A,S),Math.max(y,0)}findBestLevel(e,t,i,s,n,r){var o;const{fragCurrent:l,partCurrent:c,lastLoadedFragLevel:h}=this,{levels:f}=this.hls,g=f[h],y=!!(g!=null&&(o=g.details)!=null&&o.live),v=g==null?void 0:g.codecSet,A=c?c.duration:l?l.duration:0,S=this.bwEstimator.getEstimateTTFB()/1e3;let L=t,C=-1;for(let R=i;R>=t;R--){const M=f[R];if(!M||v&&M.codecSet!==v){M&&(L=Math.min(R,L),C=Math.max(R,C));continue}C!==-1&&k.trace(`[abr] Skipped level(s) ${L}-${C} with CODECS:"${f[C].attrs.CODECS}"; not compatible with "${g.attrs.CODECS}"`);const O=M.details,J=(c?O==null?void 0:O.partTarget:O==null?void 0:O.averagetargetduration)||A;let G;R<=h?G=n*e:G=r*e;const Y=f[R].maxBitrate,Z=this.getTimeToLoadFrag(S,G,Y*J,O===void 0);if(k.trace(`[abr] level:${R} adjustedbw-bitrate:${Math.round(G-Y)} avgDuration:${J.toFixed(1)} maxFetchDuration:${s.toFixed(1)} fetchDuration:${Z.toFixed(1)}`),G>Y&&(Z===0||!se(Z)||y&&!this.bitrateTestDelay||Z<s))return R}return-1}set nextAutoLevel(e){this._nextAutoLevel=e}}class kr{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;if(e.length)e.length===1?i=e[0]:i=yl(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function yl(a,e){const t=new Uint8Array(e);let i=0;for(let s=0;s<a.length;s++){const n=a[s];t.set(n,i),i+=n.length}return t}const Rr=100;class vl extends qs{constructor(e,t,i){super(e,t,i,"[audio-stream-controller]",me.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(b.ERROR,this.onError,this),e.on(b.BUFFER_RESET,this.onBufferReset,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this),e.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(b.ERROR,this.onError,this),e.off(b.BUFFER_RESET,this.onBufferReset,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this),e.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:i,initPTS:s,timescale:n}){if(i==="main"){const r=t.cc;this.initPTS[t.cc]={baseTime:s,timescale:n},this.log(`InitPTS for cc: ${r} found from main: ${s}`),this.videoTrackCC=r,this.state===V.WAITING_INIT_PTS&&this.tick()}}startLoad(e){if(!this.levels){this.startPosition=e,this.state=V.STOPPED;return}const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(Rr),t>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=V.IDLE):(this.loadedmetadata=!1,this.state=V.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case V.IDLE:this.doTickIdle();break;case V.WAITING_TRACK:{var e;const{levels:i,trackId:s}=this,n=i==null||(e=i[s])==null?void 0:e.details;if(n){if(this.waitForCdnTuneIn(n))break;this.state=V.WAITING_INIT_PTS}break}case V.FRAG_LOADING_WAITING_RETRY:{var t;const i=performance.now(),s=this.retryDate;(!s||i>=s||(t=this.media)!=null&&t.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=V.IDLE);break}case V.WAITING_INIT_PTS:{const i=this.waitingData;if(i){const{frag:s,part:n,cache:r,complete:o}=i;if(this.initPTS[s.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=V.FRAG_LOADING;const l=r.flush(),c={frag:s,part:n,payload:l,networkDetails:null};this._handleFragmentLoadProgress(c),o&&super._handleFragmentLoadComplete(c)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${s.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const l=this.getLoadPosition(),c=Xe.bufferInfo(this.mediaBuffer,l,this.config.maxBufferHole);Gs(c.end,this.config.maxFragLookUpTolerance,s)<0&&(this.log(`Waiting fragment cc (${s.cc}) @ ${s.start} cancelled because another fragment at ${c.end} is needed`),this.clearWaitingFragment())}}else this.state=V.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=V.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:i,trackId:s}=this,n=e.config;if(!(t!=null&&t[s])||!i&&(this.startFragRequested||!n.startFragPrefetch))return;const r=t[s],o=r.details;if(!o||o.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(o)){this.state=V.WAITING_TRACK;return}const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,Re.AUDIO,me.AUDIO));const c=this.getFwdBufferInfo(l,me.AUDIO);if(c===null)return;const{bufferedTrack:h,switchingTrack:f}=this;if(!f&&this._streamEnded(c,o)){e.trigger(b.BUFFER_EOS,{type:"audio"}),this.state=V.ENDED;return}const g=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,me.MAIN),y=c.len,v=this.getMaxBufferLength(g==null?void 0:g.len);if(y>=v&&!f)return;const S=o.fragments[0].start;let L=c.end;if(f&&i){const O=this.getLoadPosition();h&&f.attrs!==h.attrs&&(L=O),o.PTSKnown&&O<S&&(c.end>S||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=S+.05)}let C=this.getNextFragment(L,o),R=!1;if(C&&this.isLoopLoading(C,L)&&(R=!!C.gap,C=this.getNextFragmentLoopLoading(C,o,c,me.MAIN,v)),!C){this.bufferFlushed=!0;return}const M=g&&C.start>g.end+o.targetduration;if(M||!(g!=null&&g.len)&&c.len){const O=this.getAppendedFrag(C.start,me.MAIN);if(O===null||(R||(R=!!O.gap||!!M&&g.len===0),M&&!R||R&&c.nextStart&&c.nextStart<O.end))return}this.loadFragment(C,r,L)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new ji(i))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),i?this.setInterval(Rr):this.resetTransmuxer(),i?(this.switchingTrack=t,this.state=V.IDLE):(this.switchingTrack=null,this.bufferedTrack=t,this.state=V.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(b.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var i;if(this.mainDetails==null){this.cachedTrackLoadedData=t;return}const{levels:s}=this,{details:n,id:r}=t;if(!s){this.warn(`Audio tracks were reset while loading level ${r}`);return}this.log(`Track ${r} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""},duration:${n.totalduration}`);const o=s[r];let l=0;if(n.live||(i=o.details)!=null&&i.live){this.checkLiveUpdate(n);const c=this.mainDetails;if(n.deltaUpdateFailed||!c)return;!o.details&&n.hasProgramDateTime&&c.hasProgramDateTime?(ar(n,c),l=n.fragments[0].start):l=this.alignPlaylists(n,o.details)}o.details=n,this.levelLastLoaded=r,!this.startFragRequested&&(this.mainDetails||!n.live)&&this.setStartPosition(o.details,l),this.state===V.WAITING_TRACK&&!this.waitForCdnTuneIn(n)&&(this.state=V.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:i,part:s,payload:n}=e,{config:r,trackId:o,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const c=l[o];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const h=c.details;if(!h){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const f=r.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let g=this.transmuxer;g||(g=this.transmuxer=new Ir(this.hls,me.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const y=this.initPTS[i.cc],v=(t=i.initSegment)==null?void 0:t.data;if(y!==void 0){const S=s?s.index:-1,L=S!==-1,C=new js(i.level,i.sn,i.stats.chunkCount,n.byteLength,S,L);g.push(n,v,f,"",i,s,h.totalduration,!1,C,y)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${h.startSN} ,${h.endSN}],track ${o}`);const{cache:A}=this.waitingData=this.waitingData||{frag:i,part:s,cache:new kr,complete:!1};A.push(new Uint8Array(n)),this.waitingVideoCC=this.videoTrackCC,this.state=V.WAITING_INIT_PTS}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:i,part:s}=t;if(i.type!==me.AUDIO){if(!this.loadedmetadata&&i.type===me.MAIN){const n=this.videoBuffer||this.media;n&&Xe.getBuffered(n).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(i.sn!=="initSegment"){this.fragPrevious=i;const n=this.switchingTrack;n&&(this.bufferedTrack=n,this.switchingTrack=null,this.hls.trigger(b.AUDIO_TRACK_SWITCHED,ot({},n)))}this.fragBufferedComplete(i,s)}onError(e,t){var i;if(t.fatal){this.state=V.ERROR;return}switch(t.details){case N.FRAG_GAP:case N.FRAG_PARSING_ERROR:case N.FRAG_DECRYPT_ERROR:case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(me.AUDIO,t);break;case N.AUDIO_TRACK_LOAD_ERROR:case N.AUDIO_TRACK_LOAD_TIMEOUT:case N.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===V.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===ke.AUDIO_TRACK&&(this.state=V.IDLE);break;case N.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case N.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushed(e,{type:t}){t===Re.AUDIO&&(this.bufferFlushed=!0,this.state===V.ENDED&&(this.state=V.IDLE))}_handleTransmuxComplete(e){var t;const i="audio",{hls:s}=this,{remuxResult:n,chunkMeta:r}=e,o=this.getCurrentContext(r);if(!o){this.resetWhenMissingContext(r);return}const{frag:l,part:c,level:h}=o,{details:f}=h,{audio:g,text:y,id3:v,initSegment:A}=n;if(this.fragContextChanged(l)||!f){this.fragmentTracker.removeFragment(l);return}if(this.state=V.PARSING,this.switchingTrack&&g&&this.completeAudioSwitch(this.switchingTrack),A!=null&&A.tracks){const S=l.initSegment||l;this._bufferInitSegment(A.tracks,S,r),s.trigger(b.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:i,tracks:A.tracks})}if(g){const{startPTS:S,endPTS:L,startDTS:C,endDTS:R}=g;c&&(c.elementaryStreams[Re.AUDIO]={startPTS:S,endPTS:L,startDTS:C,endDTS:R}),l.setElementaryStreamInfo(Re.AUDIO,S,L,C,R),this.bufferFragmentData(g,l,c,r)}if(v!=null&&(t=v.samples)!=null&&t.length){const S=Ke({id:i,frag:l,details:f},v);s.trigger(b.FRAG_PARSING_METADATA,S)}if(y){const S=Ke({id:i,frag:l,details:f},y);s.trigger(b.FRAG_PARSING_USERDATA,S)}}_bufferInitSegment(e,t,i){if(this.state!==V.PARSING)return;e.video&&delete e.video;const s=e.audio;if(!s)return;s.levelCodec=s.codec,s.id="audio",this.log(`Init audio buffer, container:${s.container}, codecs[parsed]=[${s.codec}]`),this.hls.trigger(b.BUFFER_CODECS,e);const n=s.initSegment;if(n!=null&&n.byteLength){const r={type:"audio",frag:t,part:null,chunkMeta:i,parent:t.type,data:n};this.hls.trigger(b.BUFFER_APPENDING,r)}this.tick()}loadFragment(e,t,i){const s=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||s===ft.NOT_LOADED||s===ft.PARTIAL){var n;e.sn==="initSegment"?this._loadInitSegment(e,t):(n=t.details)!=null&&n.live&&!this.initPTS[e.cc]?(this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=V.WAITING_INIT_PTS):(this.startFragRequested=!0,super.loadFragment(e,t,i))}else this.clearTrackerIfNeeded(e)}completeAudioSwitch(e){const{hls:t,media:i,bufferedTrack:s}=this,n=s==null?void 0:s.attrs,r=e.attrs;i&&n&&(n.CHANNELS!==r.CHANNELS||n.NAME!==r.NAME||n.LANGUAGE!==r.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(b.AUDIO_TRACK_SWITCHED,ot({},e))}}class bl extends Hs{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(b.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:s,details:n}=t,r=this.tracksInGroup[i];if(!r||r.groupId!==s){this.warn(`Track with id:${i} and group:${s} not found in active group ${r.groupId}`);return}const o=r.details;r.details=t.details,this.log(`audio-track ${i} "${r.name}" lang:${r.lang} group:${s} loaded [${n.startSN}-${n.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!(t!=null&&t.audioGroupIds))return;const i=t.audioGroupIds[t.urlId];if(this.groupId!==i){this.groupId=i||null;const s=this.tracks.filter(r=>!i||r.groupId===i);this.selectDefaultTrack&&!s.some(r=>r.default)&&(this.selectDefaultTrack=!1),this.tracksInGroup=s;const n={audioTracks:s};this.log(`Updating audio tracks, ${s.length} track(s) found in group:${i}`),this.hls.trigger(b.AUDIO_TRACKS_UPDATED,n),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(e,t){t.fatal||!t.context||t.context.type===ke.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(t))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();const i=this.currentTrack;t[this.trackId];const s=t[e],{groupId:n,name:r}=s;if(this.log(`Switching to audio-track ${e} "${r}" lang:${s.lang} group:${n}`),this.trackId=e,this.currentTrack=s,this.selectDefaultTrack=!1,this.hls.trigger(b.AUDIO_TRACK_SWITCHING,ot({},s)),s.details&&!s.details.live)return;const o=this.switchParams(s.url,i==null?void 0:i.details);this.loadPlaylist(o)}selectInitialTrack(){const e=this.tracksInGroup,t=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(t!==-1)this.setAudioTrack(t);else{const i=new Error(`No track found for running audio group-ID: ${this.groupId} track count: ${e.length}`);this.warn(i.message),this.hls.trigger(b.ERROR,{type:ue.MEDIA_ERROR,details:N.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:i})}}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const s=t[i];if((!this.selectDefaultTrack||s.default)&&(!e||e.attrs["STABLE-RENDITION-ID"]!==void 0&&e.attrs["STABLE-RENDITION-ID"]===s.attrs["STABLE-RENDITION-ID"]||e.name===s.name&&e.lang===s.lang))return s.id}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const i=t.id,s=t.groupId;let n=t.url;if(e)try{n=e.addDirectives(n)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}this.log(`loading audio-track playlist ${i} "${t.name}" lang:${t.lang} group:${s}`),this.clearTimer(),this.hls.trigger(b.AUDIO_TRACK_LOADING,{url:n,id:i,groupId:s,deliveryDirectives:e||null})}}}function Cr(a,e){if(a.length!==e.length)return!1;for(let t=0;t<a.length;t++)if(!Tl(a[t].attrs,e[t].attrs))return!1;return!0}function Tl(a,e){const t=a["STABLE-RENDITION-ID"];return t?t===e["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(i=>a[i]!==e[i])}const Dr=500;class El extends qs{constructor(e,t,i){super(e,t,i,"[subtitle-stream-controller]",me.SUBTITLE),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.ERROR,this.onError,this),e.on(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(b.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.ERROR,this.onError,this),e.off(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(b.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=V.IDLE,this.setInterval(Dr),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:s}=t;if(this.fragPrevious=i,this.state=V.IDLE,!s)return;const n=this.tracksBuffered[this.currentTrackId];if(!n)return;let r;const o=i.start;for(let c=0;c<n.length;c++)if(o>=n[c].start&&o<=n[c].end){r=n[c];break}const l=i.start+i.duration;r?r.end=l:(r={start:o,end:l},n.push(r)),this.fragmentTracker.fragBuffered(i)}onBufferFlushing(e,t){const{startOffset:i,endOffset:s}=t;if(i===0&&s!==Number.POSITIVE_INFINITY){const n=s-1;if(n<=0)return;t.endOffsetSubtitles=Math.max(0,n),this.tracksBuffered.forEach(r=>{for(let o=0;o<r.length;){if(r[o].end<=n){r.shift();continue}else if(r[o].start<n)r[o].start=n;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(i,n,me.SUBTITLE)}}onFragBuffered(e,t){if(!this.loadedmetadata&&t.frag.type===me.MAIN){var i;(i=this.media)!=null&&i.buffered.length&&(this.loadedmetadata=!0)}}onError(e,t){const i=t.frag;(i==null?void 0:i.type)===me.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==V.STOPPED&&(this.state=V.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(Cr(this.levels,t)){this.levels=t.map(i=>new ji(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{const s=new ji(i);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,me.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){if(this.currentTrackId=t.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(Dr)}onSubtitleTrackLoaded(e,t){var i;const{details:s,id:n}=t,{currentTrackId:r,levels:o}=this;if(!o.length)return;const l=o[r];if(n>=o.length||n!==r||!l)return;this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(s.live||(i=l.details)!=null&&i.live){const h=this.mainDetails;if(s.deltaUpdateFailed||!h)return;const f=h.fragments[0];l.details?(c=this.alignPlaylists(s,l.details),c===0&&f&&(c=f.start,$s(s,c))):s.hasProgramDateTime&&h.hasProgramDateTime?(ar(s,h),c=s.fragments[0].start):f&&(c=f.start,$s(s,c))}l.details=s,this.levelLastLoaded=n,!this.startFragRequested&&(this.mainDetails||!s.live)&&this.setStartPosition(l.details,c),this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===V.IDLE&&(Wi(null,s.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0))}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,s=t.decryptdata,n=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&s&&s.key&&s.iv&&s.method==="AES-128"){const r=performance.now();this.decrypter.decrypt(new Uint8Array(i),s.key.buffer,s.iv.buffer).catch(o=>{throw n.trigger(b.ERROR,{type:ue.MEDIA_ERROR,details:N.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const l=performance.now();n.trigger(b.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:r,tdecrypt:l}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=V.IDLE})}}doTick(){if(!this.media){this.state=V.IDLE;return}if(this.state===V.IDLE){const{currentTrackId:e,levels:t}=this,i=t[e];if(!t.length||!i||!i.details)return;const{config:s}=this,n=this.getLoadPosition(),r=Xe.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],n,s.maxBufferHole),{end:o,len:l}=r,c=this.getFwdBufferInfo(this.media,me.MAIN),h=i.details,f=this.getMaxBufferLength(c==null?void 0:c.len)+h.levelTargetDuration;if(l>f)return;const g=h.fragments,y=g.length,v=h.edge;let A=null;const S=this.fragPrevious;if(o<v){const L=s.maxFragLookUpTolerance,C=o>v-L?0:L;A=Wi(S,g,Math.max(g[0].start,o),C),!A&&S&&S.start<g[0].start&&(A=g[0])}else A=g[y-1];if(!A)return;if(A=this.mapToInitFragWhenRequired(A),A.sn!=="initSegment"){const L=A.sn-h.startSN,C=g[L-1];C&&C.cc===A.cc&&this.fragmentTracker.getState(C)===ft.NOT_LOADED&&(A=C)}this.fragmentTracker.getState(A)===ft.NOT_LOADED&&this.loadFragment(A,i,o)}}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,i){this.fragCurrent=e,e.sn==="initSegment"?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,i))}get mediaBufferTimeRanges(){return new Al(this.tracksBuffered[this.currentTrackId]||[])}}class Al{constructor(e){this.buffered=void 0;const t=(i,s,n)=>{if(s=s>>>0,s>n-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${n})`);return e[s][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}}class Sl extends Hs{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){const{hls:e}=this;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(b.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),on(this.media.textTracks).forEach(t=>{Ii(t)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,details:s}=t,{trackId:n}=this,r=this.tracksInGroup[n];if(!r){this.warn(`Invalid subtitle track id ${i}`);return}const o=r.details;r.details=t.details,this.log(`subtitle track ${i} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!(t!=null&&t.textGroupIds))return;const i=t.textGroupIds[t.urlId],s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==i){const n=this.tracks.filter(l=>!i||l.groupId===i);this.tracksInGroup=n;const r=this.findTrackId(s==null?void 0:s.name)||this.findTrackId();this.groupId=i||null;const o={subtitleTracks:n};this.log(`Updating subtitle tracks, ${n.length} track(s) found in "${i}" group-id`),this.hls.trigger(b.SUBTITLE_TRACKS_UPDATED,o),r!==-1&&this.setSubtitleTrack(r,s)}else this.shouldReloadPlaylist(s)&&this.setSubtitleTrack(this.trackId,s)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const s=t[i];if((!this.selectDefaultTrack||s.default)&&(!e||e===s.name))return s.id}return-1}onError(e,t){t.fatal||!t.context||t.context.type===ke.SUBTITLE_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.checkRetry(t)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1;const t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const i=t.id,s=t.groupId;let n=t.url;if(e)try{n=e.addDirectives(n)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}this.log(`Loading subtitle playlist for id ${i}`),this.hls.trigger(b.SUBTITLE_TRACK_LOADING,{url:n,id:i,groupId:s,deliveryDirectives:e||null})}}toggleTrackModes(e){const{media:t,trackId:i}=this;if(!t)return;const s=on(t.textTracks),n=s.filter(o=>o.groupId===this.groupId);if(e===-1)[].slice.call(s).forEach(o=>{o.mode="disabled"});else{const o=n[i];o&&(o.mode="disabled")}const r=n[e];r&&(r.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(e,t){var i;const s=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),this.trackId===e&&(e===-1||(i=s[e])!=null&&i.details)||e<-1||e>=s.length)return;this.clearTimer();const n=s[e];if(this.log(`Switching to subtitle-track ${e}`+(n?` "${n.name}" lang:${n.lang} group:${n.groupId}`:"")),this.trackId=e,n){const{id:r,groupId:o="",name:l,type:c,url:h}=n;this.hls.trigger(b.SUBTITLE_TRACK_SWITCH,{id:r,groupId:o,name:l,type:c,url:h});const f=this.switchParams(n.url,t==null?void 0:t.details);this.loadPlaylist(f)}else this.hls.trigger(b.SUBTITLE_TRACK_SWITCH,{id:e})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=-1;const t=on(this.media.textTracks);for(let i=0;i<t.length;i++)if(t[i].mode==="hidden")e=i;else if(t[i].mode==="showing"){e=i;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}}function on(a){const e=[];for(let t=0;t<a.length;t++){const i=a[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(a[t])}return e}class xl{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t){const i=this.queues[t];i.push(e),i.length===1&&this.buffers[t]&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const i=new Promise(n=>{t=n}),s={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(s,e),i}executeNext(e){const{buffers:t,queues:i}=this,s=t[e],n=i[e];if(n.length){const r=n[0];try{r.execute()}catch(o){k.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),r.onError(o),s!=null&&s.updating||(n.shift(),this.executeNext(e))}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const Pr=ds(),_r=/([ha]vc.)(?:\.[^.,]+)+/;class Ll{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{const{media:t,mediaSource:i}=this;k.log("[buffer-controller]: Media source opened"),t&&(t.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(b.MEDIA_ATTACHED,{media:t})),i&&i.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{k.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{k.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{const{media:t,_objectUrl:i}=this;t&&t.src!==i&&k.error(`Media element src was set while attaching MediaSource (${i} > ${t.src})`)},this.hls=e,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){const{hls:e}=this;e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.BUFFER_RESET,this.onBufferReset,this),e.on(b.BUFFER_APPENDING,this.onBufferAppending,this),e.on(b.BUFFER_CODECS,this.onBufferCodecs,this),e.on(b.BUFFER_EOS,this.onBufferEos,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(b.FRAG_PARSED,this.onFragParsed,this),e.on(b.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.BUFFER_RESET,this.onBufferReset,this),e.off(b.BUFFER_APPENDING,this.onBufferAppending,this),e.off(b.BUFFER_CODECS,this.onBufferCodecs,this),e.off(b.BUFFER_EOS,this.onBufferEos,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(b.FRAG_PARSED,this.onFragParsed,this),e.off(b.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new xl(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,k.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const i=this.media=t.media;if(i&&Pr){const s=this.mediaSource=new Pr;s.addEventListener("sourceopen",this._onMediaSourceOpen),s.addEventListener("sourceended",this._onMediaSourceEnded),s.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(s),this._objectUrl=i.src,i.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:i}=this;if(t){if(k.log("[buffer-controller]: media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(s){k.warn(`[buffer-controller]: onMediaDetaching: ${s.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),i&&self.URL.revokeObjectURL(i),e.src===i?(e.removeAttribute("src"),e.load()):k.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(b.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{const t=this.sourceBuffer[e];try{t&&(this.removeBufferListeners(e),this.mediaSource&&this.mediaSource.removeSourceBuffer(t),this.sourceBuffer[e]=void 0)}catch(i){k.warn(`[buffer-controller]: Failed to reset the ${e} buffer`,i)}}),this._initSourceBuffer()}onBufferCodecs(e,t){const i=this.getSourceBufferTypes().length;Object.keys(t).forEach(s=>{if(i){const n=this.tracks[s];if(n&&typeof n.buffer.changeType=="function"){const{id:r,codec:o,levelCodec:l,container:c,metadata:h}=t[s],f=(n.levelCodec||n.codec).replace(_r,"$1"),g=(l||o).replace(_r,"$1");if(f!==g){const y=`${c};codecs=${l||o}`;this.appendChangeType(s,y),k.log(`[buffer-controller]: switching codec ${f} to ${g}`),this.tracks[s]={buffer:n.buffer,codec:o,container:c,levelCodec:l,metadata:h,id:r}}}}else this.pendingTracks[s]=t[s]}),!i&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())}appendChangeType(e,t){const{operationQueue:i}=this,s={execute:()=>{const n=this.sourceBuffer[e];n&&(k.log(`[buffer-controller]: changing ${e} sourceBuffer type to ${t}`),n.changeType(t)),i.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:n=>{k.warn(`[buffer-controller]: Failed to change ${e} SourceBuffer type`,n)}};i.append(s,e)}onBufferAppending(e,t){const{hls:i,operationQueue:s,tracks:n}=this,{data:r,type:o,frag:l,part:c,chunkMeta:h}=t,f=h.buffering[o],g=self.performance.now();f.start=g;const y=l.stats.buffering,v=c?c.stats.buffering:null;y.start===0&&(y.start=g),v&&v.start===0&&(v.start=g);const A=n.audio;let S=!1;o==="audio"&&(A==null?void 0:A.container)==="audio/mpeg"&&(S=!this.lastMpegAudioChunk||h.id===1||this.lastMpegAudioChunk.sn!==h.sn,this.lastMpegAudioChunk=h);const L=l.start,C={execute:()=>{if(f.executeStart=self.performance.now(),S){const R=this.sourceBuffer[o];if(R){const M=L-R.timestampOffset;Math.abs(M)>=.1&&(k.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${L} (delta: ${M}) sn: ${l.sn})`),R.timestampOffset=L)}}this.appendExecutor(r,o)},onStart:()=>{},onComplete:()=>{const R=self.performance.now();f.executeEnd=f.end=R,y.first===0&&(y.first=R),v&&v.first===0&&(v.first=R);const{sourceBuffer:M}=this,O={};for(const J in M)O[J]=Xe.getBuffered(M[J]);this.appendError=0,this.hls.trigger(b.BUFFER_APPENDED,{type:o,frag:l,part:c,chunkMeta:h,parent:l.type,timeRanges:O})},onError:R=>{k.error(`[buffer-controller]: Error encountered while trying to append to the ${o} SourceBuffer`,R);const M={type:ue.MEDIA_ERROR,parent:l.type,details:N.BUFFER_APPEND_ERROR,frag:l,part:c,chunkMeta:h,error:R,err:R,fatal:!1};R.code===DOMException.QUOTA_EXCEEDED_ERR?M.details=N.BUFFER_FULL_ERROR:(this.appendError++,M.details=N.BUFFER_APPEND_ERROR,this.appendError>i.config.appendErrorMaxRetry&&(k.error(`[buffer-controller]: Failed ${i.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),M.fatal=!0)),i.trigger(b.ERROR,M)}};s.append(C,o)}onBufferFlushing(e,t){const{operationQueue:i}=this,s=n=>({execute:this.removeExecutor.bind(this,n,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(b.BUFFER_FLUSHED,{type:n})},onError:r=>{k.warn(`[buffer-controller]: Failed to remove from ${n} SourceBuffer`,r)}});t.type?i.append(s(t.type),t.type):this.getSourceBufferTypes().forEach(n=>{i.append(s(n),n)})}onFragParsed(e,t){const{frag:i,part:s}=t,n=[],r=s?s.elementaryStreams:i.elementaryStreams;r[Re.AUDIOVIDEO]?n.push("audiovideo"):(r[Re.AUDIO]&&n.push("audio"),r[Re.VIDEO]&&n.push("video"));const o=()=>{const l=self.performance.now();i.stats.buffering.end=l,s&&(s.stats.buffering.end=l);const c=s?s.stats:i.stats;this.hls.trigger(b.FRAG_BUFFERED,{frag:i,part:s,stats:c,id:i.type})};n.length===0&&k.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(o,n)}onFragChanged(e,t){this.flushBackBuffer()}onBufferEos(e,t){this.getSourceBufferTypes().reduce((s,n)=>{const r=this.sourceBuffer[n];return r&&(!t.type||t.type===n)&&(r.ending=!0,r.ended||(r.ended=!0,k.log(`[buffer-controller]: ${n} sourceBuffer now EOS`))),s&&!!(!r||r.ended)},!0)&&(k.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(n=>{const r=this.sourceBuffer[n];r&&(r.ending=!1)});const{mediaSource:s}=this;if(!s||s.readyState!=="open"){s&&k.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${s.readyState}`);return}k.log("[buffer-controller]: Calling mediaSource.endOfStream()"),s.endOfStream()}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){const{hls:e,details:t,media:i,sourceBuffer:s}=this;if(!i||t===null)return;const n=this.getSourceBufferTypes();if(!n.length)return;const r=t.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(!se(r)||r<0)return;const o=i.currentTime,l=t.levelTargetDuration,c=Math.max(r,l),h=Math.floor(o/l)*l-c;n.forEach(f=>{const g=s[f];if(g){const y=Xe.getBuffered(g);if(y.length>0&&h>y.start(0)){if(e.trigger(b.BACK_BUFFER_REACHED,{bufferEnd:h}),t.live)e.trigger(b.LIVE_BACK_BUFFER_REACHED,{bufferEnd:h});else if(g.ended&&y.end(y.length-1)-o<l*2){k.info(`[buffer-controller]: Cannot flush ${f} back buffer while SourceBuffer is in ended state`);return}e.trigger(b.BUFFER_FLUSHING,{startOffset:0,endOffset:h,type:f})}}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:e,hls:t,media:i,mediaSource:s}=this,n=e.fragments[0].start+e.totalduration,r=i.duration,o=se(s.duration)?s.duration:0;e.live&&t.config.liveDurationInfinity?(k.log("[buffer-controller]: Media Source duration is set to Infinity"),s.duration=1/0,this.updateSeekableRange(e)):(n>o&&n>r||!se(r))&&(k.log(`[buffer-controller]: Updating Media Source duration to ${n.toFixed(3)}`),s.duration=n)}updateSeekableRange(e){const t=this.mediaSource,i=e.fragments;if(i.length&&e.live&&t!=null&&t.setLiveSeekableRange){const n=Math.max(0,i[0].start),r=Math.max(n,n+e.totalduration);t.setLiveSeekableRange(n,r)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:i}=this,s=Object.keys(i).length;if(s&&!e||s===2){this.createSourceBuffers(i),this.pendingTracks={};const n=this.getSourceBufferTypes();if(n.length)this.hls.trigger(b.BUFFER_CREATED,{tracks:this.tracks}),n.forEach(r=>{t.executeNext(r)});else{const r=new Error("could not create source buffer for media codec(s)");this.hls.trigger(b.ERROR,{type:ue.MEDIA_ERROR,details:N.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:r,reason:r.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:i}=this;if(!i)throw Error("createSourceBuffers called when mediaSource was null");for(const s in e)if(!t[s]){const n=e[s];if(!n)throw Error(`source buffer exists for track ${s}, however track does not`);const r=n.levelCodec||n.codec,o=`${n.container};codecs=${r}`;k.log(`[buffer-controller]: creating sourceBuffer(${o})`);try{const l=t[s]=i.addSourceBuffer(o),c=s;this.addBufferListener(c,"updatestart",this._onSBUpdateStart),this.addBufferListener(c,"updateend",this._onSBUpdateEnd),this.addBufferListener(c,"error",this._onSBUpdateError),this.tracks[s]={buffer:l,codec:r,container:n.container,levelCodec:n.levelCodec,metadata:n.metadata,id:n.id}}catch(l){k.error(`[buffer-controller]: error while trying to add sourceBuffer: ${l.message}`),this.hls.trigger(b.ERROR,{type:ue.MEDIA_ERROR,details:N.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:l,mimeType:o})}}}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){const{operationQueue:t}=this;t.current(e).onComplete(),t.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){const i=new Error(`${e} SourceBuffer error`);k.error(`[buffer-controller]: ${i}`,t),this.hls.trigger(b.ERROR,{type:ue.MEDIA_ERROR,details:N.BUFFER_APPENDING_ERROR,error:i,fatal:!1});const s=this.operationQueue.current(e);s&&s.onError(t)}removeExecutor(e,t,i){const{media:s,mediaSource:n,operationQueue:r,sourceBuffer:o}=this,l=o[e];if(!s||!n||!l){k.warn(`[buffer-controller]: Attempting to remove from the ${e} SourceBuffer, but it does not exist`),r.shiftAndExecuteNext(e);return}const c=se(s.duration)?s.duration:1/0,h=se(n.duration)?n.duration:1/0,f=Math.max(0,t),g=Math.min(i,c,h);g>f&&!l.ending?(l.ended=!1,k.log(`[buffer-controller]: Removing [${f},${g}] from the ${e} SourceBuffer`),l.remove(f,g)):r.shiftAndExecuteNext(e)}appendExecutor(e,t){const{operationQueue:i,sourceBuffer:s}=this,n=s[t];if(!n){k.warn(`[buffer-controller]: Attempting to append to the ${t} SourceBuffer, but it does not exist`),i.shiftAndExecuteNext(t);return}n.ended=!1,n.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length){k.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}const{operationQueue:i}=this,s=t.map(n=>i.appendBlocker(n));Promise.all(s).then(()=>{e(),t.forEach(n=>{const r=this.sourceBuffer[n];r!=null&&r.updating||i.shiftAndExecuteNext(n)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,i){const s=this.sourceBuffer[e];if(!s)return;const n=i.bind(this,e);this.listeners[e].push({event:t,listener:n}),s.addEventListener(t,n)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach(i=>{t.removeEventListener(i.event,i.listener)})}}const Or={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Nr=function(e){let t=e;return Or.hasOwnProperty(e)&&(t=Or[e]),String.fromCharCode(t)},Kt=15,ii=100,wl={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Il={17:2,18:4,21:6,22:8,23:10,19:13,20:15},kl={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Rl={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Cl=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Dl{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i=typeof t=="function"?t():t;k.log(`${this.time} [${e}] ${i}`)}}}const gi=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class Fr{constructor(e,t,i,s,n){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=i||!1,this.background=s||"black",this.flash=n||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const s=t[i];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Pl{constructor(e,t,i,s,n,r){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new Fr(t,i,s,n,r)}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class _l{constructor(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let t=0;t<ii;t++)this.chars.push(new Pl);this.logger=e,this.pos=0,this.currPenState=new Fr}equals(e){let t=!0;for(let i=0;i<ii;i++)if(!this.chars[i].equals(e.chars[i])){t=!1;break}return t}copy(e){for(let t=0;t<ii;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<ii;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>ii&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=ii)}moveCursor(e){const t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Nr(e);if(this.pos>=ii){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<ii;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<ii;i++){const s=this.chars[i].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class ln{constructor(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let t=0;t<Kt;t++)this.rows.push(new _l(e));this.logger=e,this.currRow=Kt-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let e=0;e<Kt;e++)this.rows[e].clear();this.currRow=Kt-1}equals(e){let t=!0;for(let i=0;i<Kt;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<Kt;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Kt;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<Kt;o++)this.rows[o].clear();const n=this.currRow+1-this.nrRollUpRows,r=this.lastOutputScreen;if(r){const o=r.rows[n].cueStartTime,l=this.logger.time;if(o&&l!==null&&o<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(r.rows[n+c])}}this.currRow=t;const i=this.rows[this.currRow];if(e.indent!==null){const n=e.indent,r=Math.max(n-1,0);i.setCursor(e.indent),e.color=i.chars[r].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",s=-1;for(let n=0;n<Kt;n++){const r=this.rows[n].getTextString();r&&(s=n+1,e?t.push("Row "+s+": '"+r+"'"):t.push(r.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}}class Mr{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new ln(i),this.nonDisplayedMemory=new ln(i),this.lastOutputScreen=new ln(i),this.currRollUpRow=this.displayedMemory.rows[Kt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Kt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[i]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Br{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;const s=new Dl;this.channels=[null,new Mr(e,t,s),new Mr(e+1,i,s)],this.cmdHistory=$r(),this.logger=s}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){let i,s,n,r=!1;this.logger.time=e;for(let o=0;o<t.length;o+=2)if(s=t[o]&127,n=t[o+1]&127,!(s===0&&n===0)){if(this.logger.log(3,"["+gi([t[o],t[o+1]])+"] -> ("+gi([s,n])+")"),i=this.parseCmd(s,n),i||(i=this.parseMidrow(s,n)),i||(i=this.parsePAC(s,n)),i||(i=this.parseBackgroundAttributes(s,n)),!i&&(r=this.parseChars(s,n),r)){const l=this.currentChannel;l&&l>0?this.channels[l].insertChars(r):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!i&&!r&&this.logger.log(2,"Couldn't parse cleaned data "+gi([s,n])+" orig: "+gi([t[o],t[o+1]]))}}parseCmd(e,t){const{cmdHistory:i}=this,s=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=33&&t<=35;if(!(s||n))return!1;if(Ur(e,t,i))return Di(null,null,i),this.logger.log(3,"Repeated command ("+gi([e,t])+") is dropped"),!0;const r=e===20||e===21||e===23?1:2,o=this.channels[r];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),Di(e,t,i),this.currentChannel=r,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[i];return s?(s.ccMIDROW(t),this.logger.log(3,"MIDROW ("+gi([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i;const s=this.cmdHistory,n=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,r=(e===16||e===24)&&t>=64&&t<=95;if(!(n||r))return!1;if(Ur(e,t,s))return Di(null,null,s),!0;const o=e<=23?1:2;t>=64&&t<=95?i=o===1?wl[e]:kl[e]:i=o===1?Il[e]:Rl[e];const l=this.channels[o];return l?(l.setPAC(this.interpretPAC(i,t)),Di(e,t,s),this.currentChannel=o,!0):!1}interpretPAC(e,t){let i;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,s.underline=(i&1)===1,i<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((i-16)/2)*4,s}parseChars(e,t){let i,s=null,n=null;if(e>=25?(i=2,n=e-8):(i=1,n=e),n>=17&&n<=19){let r;n===17?r=t+80:n===18?r=t+112:r=t+144,this.logger.log(2,"Special char '"+Nr(r)+"' in channel "+i),s=[r]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);if(s){const r=gi(s);this.logger.log(3,"Char codes =  "+r.join(",")),Di(e,t,this.cmdHistory)}return s}parseBackgroundAttributes(e,t){const i=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(i||s))return!1;let n;const r={};e===16||e===24?(n=Math.floor((t-32)/2),r.background=Cl[n],t%2===1&&(r.background=r.background+"_semi")):t===45?r.background="transparent":(r.foreground="black",t===47&&(r.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(r),Di(e,t,this.cmdHistory),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}this.cmdHistory=$r()}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function Di(a,e,t){t.a=a,t.b=e}function Ur(a,e,t){return t.a===a&&t.b===e}function $r(){return{a:null,b:null}}class Ss{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var cn=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;const a=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,l){if(typeof l!="string"||!Array.isArray(o))return!1;const c=l.toLowerCase();return~o.indexOf(c)?c:!1}function i(o){return t(a,o)}function s(o){return t(e,o)}function n(o,...l){let c=1;for(;c<arguments.length;c++){const h=arguments[c];for(const f in h)o[f]=h[f]}return o}function r(o,l,c){const h=this,f={enumerable:!0};h.hasBeenReset=!1;let g="",y=!1,v=o,A=l,S=c,L=null,C="",R=!0,M="auto",O="start",J=50,G="middle",Y=50,Z="middle";Object.defineProperty(h,"id",n({},f,{get:function(){return g},set:function(B){g=""+B}})),Object.defineProperty(h,"pauseOnExit",n({},f,{get:function(){return y},set:function(B){y=!!B}})),Object.defineProperty(h,"startTime",n({},f,{get:function(){return v},set:function(B){if(typeof B!="number")throw new TypeError("Start time must be set to a number.");v=B,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",n({},f,{get:function(){return A},set:function(B){if(typeof B!="number")throw new TypeError("End time must be set to a number.");A=B,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",n({},f,{get:function(){return S},set:function(B){S=""+B,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",n({},f,{get:function(){return L},set:function(B){L=B,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",n({},f,{get:function(){return C},set:function(B){const de=i(B);if(de===!1)throw new SyntaxError("An invalid or illegal string was specified.");C=de,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",n({},f,{get:function(){return R},set:function(B){R=!!B,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",n({},f,{get:function(){return M},set:function(B){if(typeof B!="number"&&B!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");M=B,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",n({},f,{get:function(){return O},set:function(B){const de=s(B);if(!de)throw new SyntaxError("An invalid or illegal string was specified.");O=de,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",n({},f,{get:function(){return J},set:function(B){if(B<0||B>100)throw new Error("Position must be between 0 and 100.");J=B,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",n({},f,{get:function(){return G},set:function(B){const de=s(B);if(!de)throw new SyntaxError("An invalid or illegal string was specified.");G=de,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",n({},f,{get:function(){return Y},set:function(B){if(B<0||B>100)throw new Error("Size must be between 0 and 100.");Y=B,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",n({},f,{get:function(){return Z},set:function(B){const de=s(B);if(!de)throw new SyntaxError("An invalid or illegal string was specified.");Z=de,this.hasBeenReset=!0}})),h.displayState=void 0}return r.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},r}();class Ol{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Vr(a){function e(i,s,n,r){return(i|0)*3600+(s|0)*60+(n|0)+parseFloat(r||0)}const t=a.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class Nl{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let s=0;s<i.length;++s)if(t===i[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function Gr(a,e,t,i){const s=i?a.split(i):[a];for(const n in s){if(typeof s[n]!="string")continue;const r=s[n].split(t);if(r.length!==2)continue;const o=r[0],l=r[1];e(o,l)}}const un=new cn(0,0,""),xs=un.align==="middle"?"middle":"center";function Fl(a,e,t){const i=a;function s(){const o=Vr(a);if(o===null)throw new Error("Malformed timestamp: "+i);return a=a.replace(/^[^\sa-zA-Z-]+/,""),o}function n(o,l){const c=new Nl;Gr(o,function(g,y){let v;switch(g){case"region":for(let A=t.length-1;A>=0;A--)if(t[A].id===y){c.set(g,t[A].region);break}break;case"vertical":c.alt(g,y,["rl","lr"]);break;case"line":v=y.split(","),c.integer(g,v[0]),c.percent(g,v[0])&&c.set("snapToLines",!1),c.alt(g,v[0],["auto"]),v.length===2&&c.alt("lineAlign",v[1],["start",xs,"end"]);break;case"position":v=y.split(","),c.percent(g,v[0]),v.length===2&&c.alt("positionAlign",v[1],["start",xs,"end","line-left","line-right","auto"]);break;case"size":c.percent(g,y);break;case"align":c.alt(g,y,["start",xs,"end","left","right"]);break}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let h=c.get("line","auto");h==="auto"&&un.line===-1&&(h=-1),l.line=h,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",xs);let f=c.get("position","auto");f==="auto"&&un.position===50&&(f=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=f}function r(){a=a.replace(/^\s+/,"")}if(r(),e.startTime=s(),r(),a.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);a=a.slice(3),r(),e.endTime=s(),r(),n(a,e)}function Hr(a){return a.replace(/<br(?: \/)?>/gi,`
`)}class Ml{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Ol,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let n=t.buffer,r=0;for(n=Hr(n);r<n.length&&n[r]!=="\r"&&n[r]!==`
`;)++r;const o=n.slice(0,r);return n[r]==="\r"&&++r,n[r]===`
`&&++r,t.buffer=n.slice(r),o}function s(n){Gr(n,function(r,o){},/:/)}try{let n="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;n=i();const o=n.match(/^()?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let r=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(r?r=!1:n=i(),t.state){case"HEADER":/:/.test(n)?s(n):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new cn(0,0,""),t.state="CUE",n.indexOf("-->")===-1){t.cue.id=n;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Fl(n,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=n.indexOf("-->")!==-1;if(!n||o&&(r=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=n}continue;case"BADCUE":n||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const Bl=/\r\n|\n\r|\n|\r/g,dn=function(e,t,i=0){return e.slice(i,i+t.length)===t},Ul=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),n=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!se(t)||!se(i)||!se(s)||!se(n))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*s,t+=60*60*1e3*n,t},hn=function(e){let t=5381,i=e.length;for(;i;)t=t*33^e.charCodeAt(--i);return(t>>>0).toString()};function fn(a,e,t){return hn(a.toString())+hn(e.toString())+hn(t)}const $l=function(e,t,i){let s=e[t],n=e[s.prevCC];if(!n||!n.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(r=n)!=null&&r.new;){var r;e.ccOffset+=s.start-n.start,s.new=!1,s=n,n=e[s.prevCC]}e.presentationOffset=i};function Vl(a,e,t,i,s,n,r){const o=new Ml,l=Q(new Uint8Array(a)).trim().replace(Bl,`
`).split(`
`),c=[],h=e?Zo(e.baseTime,e.timescale):0;let f="00:00.000",g=0,y=0,v,A=!0;o.oncue=function(S){const L=t[i];let C=t.ccOffset;const R=(g-h)/9e4;if(L!=null&&L.new&&(y!==void 0?C=t.ccOffset=L.start:$l(t,i,R)),R){if(!e){v=new Error("Missing initPTS for VTT MPEGTS");return}C=R-t.presentationOffset}const M=S.endTime-S.startTime,O=Ot((S.startTime+C-y)*9e4,s*9e4)/9e4;S.startTime=Math.max(O,0),S.endTime=Math.max(O+M,0);const J=S.text.trim();S.text=decodeURIComponent(encodeURIComponent(J)),S.id||(S.id=fn(S.startTime,S.endTime,J)),S.endTime>0&&c.push(S)},o.onparsingerror=function(S){v=S},o.onflush=function(){if(v){r(v);return}n(c)},l.forEach(S=>{if(A)if(dn(S,"X-TIMESTAMP-MAP=")){A=!1,S.slice(16).split(",").forEach(L=>{dn(L,"LOCAL:")?f=L.slice(6):dn(L,"MPEGTS:")&&(g=parseInt(L.slice(7)))});try{y=Ul(f)/1e3}catch(L){v=L}return}else S===""&&(A=!1);o.parse(S+`
`)}),o.flush()}const mn="stpp.ttml.im1t",Kr=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,jr=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Gl={left:"start",center:"center",right:"end",start:"start",end:"end"};function Wr(a,e,t,i){const s=ye(new Uint8Array(a),["mdat"]);if(s.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const n=s.map(o=>Q(o)),r=Qo(e.baseTime,1,e.timescale);try{n.forEach(o=>t(Hl(o,r)))}catch(o){i(o)}}function Hl(a,e){const s=new DOMParser().parseFromString(a,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const n={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},r=Object.keys(n).reduce((f,g)=>(f[g]=s.getAttribute(`ttp:${g}`)||n[g],f),{}),o=s.getAttribute("xml:space")!=="preserve",l=Yr(gn(s,"styling","style")),c=Yr(gn(s,"layout","region")),h=gn(s,"body","[begin]");return[].map.call(h,f=>{const g=qr(f,o);if(!g||!f.hasAttribute("begin"))return null;const y=yn(f.getAttribute("begin"),r),v=yn(f.getAttribute("dur"),r);let A=yn(f.getAttribute("end"),r);if(y===null)throw zr(f);if(A===null){if(v===null)throw zr(f);A=y+v}const S=new cn(y-e,A-e,g);S.id=fn(S.startTime,S.endTime,S.text);const L=c[f.getAttribute("region")],C=l[f.getAttribute("style")],R=Kl(L,C,l),{textAlign:M}=R;if(M){const O=Gl[M];O&&(S.lineAlign=O),S.align=M}return Ke(S,R),S}).filter(f=>f!==null)}function gn(a,e,t){const i=a.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function Yr(a){return a.reduce((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function qr(a,e){return[].slice.call(a.childNodes).reduce((t,i,s)=>{var n;return i.nodeName==="br"&&s?t+`
`:(n=i.childNodes)!=null&&n.length?qr(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function Kl(a,e,t){const i="http://www.w3.org/ns/ttml#styling";let s=null;const n=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],r=a!=null&&a.hasAttribute("style")?a.getAttribute("style"):null;return r&&t.hasOwnProperty(r)&&(s=t[r]),n.reduce((o,l)=>{const c=pn(e,i,l)||pn(a,i,l)||pn(s,i,l);return c&&(o[l]=c),o},{})}function pn(a,e,t){return a&&a.hasAttributeNS(e,t)?a.getAttributeNS(e,t):null}function zr(a){return new Error(`Could not parse ttml timestamp ${a}`)}function yn(a,e){if(!a)return null;let t=Vr(a);return t===null&&(Kr.test(a)?t=jl(a,e):jr.test(a)&&(t=Wl(a,e))),t}function jl(a,e){const t=Kr.exec(a),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function Wl(a,e){const t=jr.exec(a),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}class Yl{constructor(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Xr(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){const t=new Ss(this,"textTrack1"),i=new Ss(this,"textTrack2"),s=new Ss(this,"textTrack3"),n=new Ss(this,"textTrack4");this.cea608Parser1=new Br(1,t,i),this.cea608Parser2=new Br(3,s,n)}e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(b.FRAG_LOADING,this.onFragLoading,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this),e.on(b.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(b.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(b.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(b.FRAG_LOADING,this.onFragLoading,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this),e.off(b.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(b.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(b.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(e,t,i,s,n){let r=!1;for(let o=n.length;o--;){const l=n[o],c=zl(l[0],l[1],t,i);if(c>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],i),r=!0,c/(i-t)>.5))return}if(r||n.push([t,i]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,i,s)}else{const o=this.Cues.newCue(null,t,i,s);this.hls.trigger(b.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:s,timescale:n}){const{unparsedVttFrags:r}=this;i==="main"&&(this.initPTS[t.cc]={baseTime:s,timescale:n}),r.length&&(this.unparsedVttFrags=[],r.forEach(o=>{this.onFragLoaded(b.FRAG_LOADED,o)}))}getExistingTrack(e){const{media:t}=this;if(t)for(let i=0;i<t.textTracks.length;i++){const s=t.textTracks[i];if(s[e])return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:s}=this,{label:n,languageCode:r}=t[e],o=this.getExistingTrack(e);if(o)i[e]=o,Ii(i[e]),Hn(i[e],s);else{const l=this.createTextTrack("captions",n,r);l&&(l[e]=!0,i[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i=t.label,s={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(b.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,i){const s=this.media;if(s)return s.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>{Ii(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Xr(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let i=0;i<t.length;i++)Ii(t[i])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],s=i.some(n=>n.textCodec===mn);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(Cr(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const r=this.media?this.media.textTracks:null;this.tracks.forEach((o,l)=>{let c;if(r&&l<r.length){let h=null;for(let f=0;f<r.length;f++)if(ql(r[f],o)){h=r[f];break}h&&(c=h)}if(c)Ii(c);else{const h=this._captionsOrSubtitlesFromCharacteristics(o);c=this.createTextTrack(h,o.name,o.lang),c&&(c.mode="disabled")}c&&(c.groupId=o.groupId,this.textTracks.push(c))})}else if(this.tracks.length){const r=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(b.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:r})}}}_captionsOrSubtitlesFromCharacteristics(e){if(e.attrs.CHARACTERISTICS){const t=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),i=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(t&&i)return"captions"}return"subtitles"}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{const s=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!s)return;const n=`textTrack${s[1]}`,r=this.captionsProperties[n];r&&(r.label=i.name,i.lang&&(r.languageCode=i.lang),r.media=i)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){const{cea608Parser1:i,cea608Parser2:s,lastSn:n,lastPartIndex:r}=this;if(!(!this.enabled||!(i&&s))&&t.frag.type===me.MAIN){var o,l;const c=t.frag.sn,h=(o=t==null||(l=t.part)==null?void 0:l.index)!=null?o:-1;c===n+1||c===n&&h===r+1||(i.reset(),s.reset()),this.lastSn=c,this.lastPartIndex=h}}onFragLoaded(e,t){const{frag:i,payload:s}=t;if(i.type===me.SUBTITLE)if(s.byteLength){const n=i.decryptdata,r="stats"in t;if(n==null||!n.encrypted||r){const o=this.tracks[i.level],l=this.vttCCs;l[i.cc]||(l[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),o&&o.textCodec===mn?this._parseIMSC1(i,s):this._parseVTTs(t)}}else this.hls.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;Wr(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),i.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{k.log(`Failed to parse IMSC1: ${s}`),i.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:i,payload:s}=e,{initPTS:n,unparsedVttFrags:r}=this,o=n.length-1;if(!n[i.cc]&&o===-1){r.push(e);return}const l=this.hls,c=(t=i.initSegment)!=null&&t.data?mi(i.initSegment.data,new Uint8Array(s)):s;Vl(c,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,h=>{this._appendCues(h,i.level),l.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},h=>{const f=h.message==="Missing initPTS for VTT MPEGTS";f?r.push(e):this._fallbackToIMSC1(i,s),k.log(`Failed to parse VTT cue: ${h}`),!(f&&o>i.cc)&&l.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:h})})}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||Wr(t,this.initPTS[e.cc],()=>{i.textCodec=mn,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(n=>Kn(s,n))}else{const s=this.tracks[t];if(!s)return;const n=s.default?"default":"subtitles"+t;i.trigger(b.CUES_PARSED,{type:"subtitles",cues:e,track:n})}}onFragDecrypted(e,t){const{frag:i}=t;i.type===me.SUBTITLE&&this.onFragLoaded(b.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){const{cea608Parser1:i,cea608Parser2:s}=this;if(!this.enabled||!(i&&s))return;const{frag:n,samples:r}=t;if(!(n.type===me.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let o=0;o<r.length;o++){const l=r[o].bytes;if(l){const c=this.extractCea608Data(l);i.addData(r[o].pts,c[0]),s.addData(r[o].pts,c[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:s,type:n}){const{media:r}=this;if(!(!r||r.currentTime<i)){if(!n||n==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(l=>Ns(o[l],t,i))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(l=>Ns(o[l],t,s))}}}extractCea608Data(e){const t=[[],[]],i=e[0]&31;let s=2;for(let n=0;n<i;n++){const r=e[s++],o=127&e[s++],l=127&e[s++];if(o===0&&l===0)continue;if((4&r)!==0){const h=3&r;(h===0||h===1)&&(t[h].push(o),t[h].push(l))}}return t}}function ql(a,e){return!!a&&a.label===e.name&&!(a.textTrack1||a.textTrack2)}function zl(a,e,t,i){return Math.min(e,i)-Math.max(a,t)}function Xr(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class vn{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(b.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.BUFFER_CODECS,this.onBufferCodecs,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(b.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.BUFFER_CODECS,this.onBufferCodecs,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){const e=this.hls.levels;if(e.length){const t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter((s,n)=>this.isLevelAllowed(s)&&n<=e);return this.clientRect=null,vn.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;const s=(r,o)=>o?r.width!==o.width||r.height!==o.height:!0;let n=e.length-1;for(let r=0;r<e.length;r+=1){const o=e[r];if((o.width>=t||o.height>=i)&&s(o,e[r+1])){n=r;break}}return n}}class Xl{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,i){const s=performance.now();if(t){if(this.lastTime){const n=s-this.lastTime,r=i-this.lastDroppedFrames,o=t-this.lastDecodedFrames,l=1e3*r/n,c=this.hls;if(c.trigger(b.FPS_DROP,{currentDropped:r,currentDecoded:o,totalDroppedFrames:i}),l>0&&r>c.config.fpsDroppedMonitoringThreshold*o){let h=c.currentLevel;k.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=h)&&(h=h-1,c.trigger(b.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:c.currentLevel}),c.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}const Ls="[eme]";class Pi{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=Pi.CDMCleanupPromise?[Pi.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=k.debug.bind(k,Ls),this.log=k.log.bind(k,Ls),this.warn=k.warn.bind(k,Ls),this.error=k.error.bind(k,Ls),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(b.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(b.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(b.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(b.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,s=t[e];if(s)return s.licenseUrl;if(e===Ue.WIDEVINE&&i)return i;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(r,o,l)=>!!r&&l.indexOf(r)===o,s=t.map(r=>r.audioCodec).filter(i),n=t.map(r=>r.videoCodec).filter(i);return s.length+n.length===0&&n.push("avc1.42e01e"),new Promise((r,o)=>{const l=c=>{const h=c.shift();this.getMediaKeysPromise(h,s,n).then(f=>r({keySystem:h,mediaKeys:f})).catch(f=>{c.length?l(c):f instanceof Nt?o(f):o(new Nt({type:ue.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_ACCESS,error:f,fatal:!0},f.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${i}`;return os===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return i(e,t)}getMediaKeysPromise(e,t,i){const s=ls(e,t,i,this.config.drmSystemOptions),n=this.keySystemAccessPromises[e];let r=n==null?void 0:n.keySystemAccess;if(!r){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(s)}`),r=this.requestMediaKeySystemAccess(e,s);const o=this.keySystemAccessPromises[e]={keySystemAccess:r};return r.catch(l=>{this.log(`Failed to obtain access to key-system "${e}": ${l}`)}),r.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const c=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),o.mediaKeys=l.createMediaKeys().then(h=>(this.log(`Media-keys created for "${e}"`),c.then(f=>f?this.setMediaKeysServerCertificate(h,e,f):h))),o.mediaKeys.catch(h=>{this.error(`Failed to create media-keys for "${e}"}: ${h}`)}),o.mediaKeys})}return r.then(()=>n.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${re.hexDump(e.keyId||[])}`);const s=i.createSession(),n={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(n),n}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),s=this.getKeyIdString(t),n="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(i,n,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return re.hexDump(e.keyId)}updateKeySession(e,t){var i;const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyID ${re.hexDump(((i=e.decryptdata)==null?void 0:i.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),s.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,i)=>{const s=xi(this.config),n=e.map(Si).filter(r=>!!r&&s.indexOf(r)!==-1);return this.getKeySystemSelectionPromise(n).then(({keySystem:r})=>{const o=di(r);o?t(o):i(new Error(`Unable to find format for key-system "${r}"`))}).catch(i)})}loadKey(e){const t=e.keyInfo.decryptdata,i=this.getKeyIdString(t),s=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);let n=this.keyIdToKeySessionPromise[i];return n||(n=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(t).then(({keySystem:r,mediaKeys:o})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(r,o).then(()=>{this.throwIfDestroyed();const l=this.createMediaKeySessionContext({keySystem:r,mediaKeys:o,decryptdata:t}),c="cenc";return this.generateRequestWithPreferredKeySession(l,c,t.pssh,"playlist-key")}))),n.catch(r=>this.handleError(r))),n}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof Nt?this.hls.trigger(b.ERROR,e.data):this.hls.trigger(b.ERROR,{type:ue.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){const s=Si(e.keyFormat),n=s?[s]:xi(this.config);return this.attemptKeySystemAccess(n)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=xi(this.config)),e.length===0)throw new Nt({type:ue.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){const{initDataType:t,initData:i}=e;if(this.debug(`"${e.type}" event: init data type: "${t}"`),i===null)return;let s,n;if(t==="sinf"&&this.config.drmSystems[Ue.FAIRPLAY]){const h=ae(new Uint8Array(i));try{const f=vt(JSON.parse(h).sinf),g=cs(new Uint8Array(f));if(!g)return;s=g.subarray(8,24),n=Ue.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const h=_a(i);if(h===null)return;h.version===0&&h.systemId===ni.WIDEVINE&&h.data&&(s=h.data.subarray(8,24)),n=Cs(h.systemId)}if(!n||!s)return;const r=re.hexDump(s),{keyIdToKeySessionPromise:o,mediaKeySessions:l}=this;let c=o[r];for(let h=0;h<l.length;h++){const f=l[h],g=f.decryptdata;if(g.pssh||!g.keyId)continue;const y=re.hexDump(g.keyId);if(r===y||g.uri.replace(/-/g,"").indexOf(r)!==-1){c=o[y],delete o[y],g.pssh=new Uint8Array(i),g.keyId=s,c=o[r]=c.then(()=>this.generateRequestWithPreferredKeySession(f,t,i,"encrypted-event-key-match"));break}}c||(c=o[r]=this.getKeySystemSelectionPromise([n]).then(({keySystem:h,mediaKeys:f})=>{var g;this.throwIfDestroyed();const y=new Hi("ISO-23001-7",r,(g=di(h))!=null?g:"");return y.pssh=new Uint8Array(i),y.keyId=s,this.attemptSetMediaKeys(h,f).then(()=>{this.throwIfDestroyed();const v=this.createMediaKeySessionContext({decryptdata:y,keySystem:h,mediaKeys:f});return this.generateRequestWithPreferredKeySession(v,t,i,"encrypted-event-no-match")})})),c.catch(h=>this.handleError(h))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,t){const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(i).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(n=>i.indexOf(n)===-1)})}generateRequestWithPreferredKeySession(e,t,i,s){var n,r;const o=(n=this.config.drmSystems)==null||(r=n[e.keySystem])==null?void 0:r.generateRequest;if(o)try{const g=o.call(this.hls,t,i,e);if(!g)throw new Error("Invalid response from configured generateRequest filter");t=g.initDataType,i=e.decryptdata.pssh=g.initData?new Uint8Array(g.initData):null}catch(g){var l;if(this.warn(g.message),(l=this.hls)!=null&&l.config.debug)throw g}if(i===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const c=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${s}": ${c} (init data type: ${t} length: ${i?i.byteLength:null})`);const h=new nn;e.mediaKeysSession.onmessage=g=>{const y=e.mediaKeysSession;if(!y){h.emit("error",new Error("invalid state"));return}const{messageType:v,message:A}=g;this.log(`"${v}" message event for session "${y.sessionId}" message size: ${A.byteLength}`),v==="license-request"||v==="license-renewal"?this.renewLicense(e,A).catch(S=>{this.handleError(S),h.emit("error",S)}):v==="license-release"?e.keySystem===Ue.FAIRPLAY&&(this.updateKeySession(e,as("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${v}"`)},e.mediaKeysSession.onkeystatuseschange=g=>{if(!e.mediaKeysSession){h.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const v=e.keyStatus;h.emit("keyStatus",v),v==="expired"&&(this.warn(`${e.keySystem} expired for key ${c}`),this.renewKeySession(e))};const f=new Promise((g,y)=>{h.on("error",y),h.on("keyStatus",v=>{v.startsWith("usable")?g():v==="output-restricted"?y(new Nt({type:ue.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):v==="internal-error"?y(new Nt({type:ue.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${v}"`)):v==="expired"?y(new Error("key expired while generating request")):this.warn(`unhandled key status change "${v}"`)})});return e.mediaKeysSession.generateRequest(t,i).then(()=>{var g;this.log(`Request generated for key-session "${(g=e.mediaKeysSession)==null?void 0:g.sessionId}" keyId: ${c}`)}).catch(g=>{throw new Nt({type:ue.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_SESSION,error:g,fatal:!1},`Error generating key-session request: ${g}`)}).then(()=>f).catch(g=>{throw h.removeAllListeners(),this.removeSession(e),g}).then(()=>(h.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,i)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${re.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${re.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,i=t.loader,s=new i(t),n=this.getServerCertificateUrl(e);return n?(this.log(`Fetching serverCertificate for "${e}"`),new Promise((r,o)=>{const l={responseType:"arraybuffer",url:n},c=t.certLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:(g,y,v,A)=>{r(g.data)},onError:(g,y,v,A)=>{o(new Nt({type:ue.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:ot({url:l.url,data:void 0},g)},`"${e}" certificate request failed (${n}). Status: ${g.code} (${g.text})`))},onTimeout:(g,y,v)=>{o(new Nt({type:ue.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${n})`))},onAbort:(g,y,v)=>{o(new Error("aborted"))}};s.load(l,h,f)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((s,n)=>{e.setServerCertificate(i).then(r=>{this.log(`setServerCertificate ${r?"success":"not supported by CDM"} (${i==null?void 0:i.byteLength}) on "${t}"`),s(e)}).catch(r=>{n(new Nt({type:ue.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:r,fatal:!0},r.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(i=>this.updateKeySession(e,new Uint8Array(i)).catch(s=>{throw new Nt({type:ue.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:s,fatal:!0},s.message)}))}setupLicenseXHR(e,t,i,s){const n=this.config.licenseXhrSetup;return n?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return n.call(this.hls,e,t,i,s)}).catch(r=>{if(!i.decryptdata)throw r;return e.open("POST",t,!0),n.call(this.hls,e,t,i,s)}).then(r=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:r||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise((s,n)=>{const r=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${r}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return n(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let l=o.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const c=this.config.licenseResponseCallback;if(c)try{l=c.call(this.hls,o,r,e)}catch(h){this.error(h)}s(l)}else{const l=i.errorRetry,c=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||o.status>=400&&o.status<500)n(new Nt({type:ue.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:o,response:{url:r,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${r}). Status: ${o.status} (${o.statusText})`));else{const h=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${h} attempts left`),this.requestLicense(e,t).then(s,n)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,r,e,t).then(({xhr:l,licenseChallenge:c})=>{l.send(c)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Hi.clearKeyUriToKeyIdMap();const i=t.length;Pi.CDMCleanupPromise=Promise.all(t.map(s=>this.removeSession(s)).concat(e==null?void 0:e.setMediaKeys(null).catch(s=>{this.log(`Could not clear media keys: ${s}. media.src: ${e==null?void 0:e.src}`)}))).then(()=>{i&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)}).catch(s=>{this.log(`Could not close sessions and clear media keys: ${s}. media.src: ${e==null?void 0:e.src}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=t.reduce((s,n)=>(s.indexOf(n.keyFormat)===-1&&s.push(n.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),t.onmessage=null,t.onkeystatuseschange=null,i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);return s>-1&&this.mediaKeySessions.splice(s,1),t.remove().catch(n=>{this.log(`Could not remove session: ${n}`)}).then(()=>t.close()).catch(n=>{this.log(`Could not close session: ${n}`)})}}}Pi.CDMCleanupPromise=void 0;class Nt extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}const Ql=1;var At={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"};const Zl="h";class oi{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:At.MANIFEST,su:!this.initialized})}catch(n){k.warn("Could not generate manifest CMCD data.",n)}},this.applyFragmentData=s=>{try{const n=s.frag,r=this.hls.levels[n.level],o=this.getObjectType(n),l={d:n.duration*1e3,ot:o};(o===At.VIDEO||o===At.AUDIO||o==At.MUXED)&&(l.br=r.bitrate/1e3,l.tb=this.getTopBandwidth(o)/1e3,l.bl=this.getBufferLength(o)),this.apply(s,l)}catch(n){k.warn("Could not generate segment CMCD data.",n)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||oi.uuid(),this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.registerListeners())}registerListeners(){const e=this.hls;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHED,this.onMediaDetached,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHED,this.onMediaDetached,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,s;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:Ql,sf:Zl,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Ke(t,this.createData());const i=t.ot===At.INIT||t.ot===At.VIDEO||t.ot===At.MUXED;if(this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering),this.useHeaders){const s=oi.toHeaders(t);if(!Object.keys(s).length)return;e.headers||(e.headers={}),Ke(e.headers,s)}else{const s=oi.toQuery(t);if(!s)return;e.url=oi.appendQueryToUri(e.url,s)}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return At.TIMED_TEXT;if(e.sn==="initSegment")return At.INIT;if(t==="audio")return At.AUDIO;if(t==="main")return this.hls.audioTracks.length?At.VIDEO:At.MUXED}getTopBandwidth(e){let t=0,i;const s=this.hls;if(e===At.AUDIO)i=s.audioTracks;else{const n=s.maxAutoLevel,r=n>-1?n+1:s.levels.length;i=s.levels.slice(0,r)}for(const n of i)n.bitrate>t&&(t=n.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.hls.media,i=e===At.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:Xe.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(n){this.loader=void 0,this.loader=new i(n)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(n,r,o){t(n),this.loader.load(n,r,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(n){this.loader=void 0,this.loader=new i(n)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(n,r,o){t(n),this.loader.load(n,r,o)}}}static uuid(){const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}static serialize(e){const t=[],i=c=>!Number.isNaN(c)&&c!=null&&c!==""&&c!==!1,s=c=>Math.round(c),n=c=>s(c/100)*100,o={br:s,d:s,bl:n,dl:n,mtp:n,nor:c=>encodeURIComponent(c),rtp:n,tb:s},l=Object.keys(e||{}).sort();for(const c of l){let h=e[c];if(!i(h)||c==="v"&&h===1||c=="pr"&&h===1)continue;const f=o[c];f&&(h=f(h));const g=typeof h;let y;c==="ot"||c==="sf"||c==="st"?y=`${c}=${h}`:g==="boolean"?y=c:g==="number"?y=`${c}=${h}`:y=`${c}=${JSON.stringify(h)}`,t.push(y)}return t.join(",")}static toHeaders(e){const t=Object.keys(e),i={},s=["Object","Request","Session","Status"],n=[{},{},{},{}],r={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(const o of t){const l=r[o]!=null?r[o]:1;n[l][o]=e[o]}for(let o=0;o<n.length;o++){const l=oi.serialize(n[o]);l&&(i[`CMCD-${s[o]}`]=l)}return i}static toQuery(e){return`CMCD=${encodeURIComponent(oi.serialize(e))}`}static appendQueryToUri(e,t){if(!t)return e;const i=e.includes("?")?"&":"?";return`${e}${i}${t}`}}const Jl=3e5;class ec{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=k.log.bind(k,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){const e=Math.max(this.timeToLoad*1e3-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,e)}else this.loadSteeringManifest(this.uri)}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if((i==null?void 0:i.action)===gt.SendAlternateToPenaltyBox&&i.flags===_t.MoveAllAlternatesMatchingHost){let s=this.pathwayPriority;const n=this.pathwayId;this.penalizedPathways[n]||(this.penalizedPathways[n]=performance.now()),!s&&this.levels&&(s=this.levels.reduce((r,o)=>(r.indexOf(o.pathwayId)===-1&&r.push(o.pathwayId),r),[])),s&&s.length>1&&(this.updatePathwayPriority(s),i.resolved=this.pathwayId!==n)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this.pathwayPriority=e;let t;const i=this.penalizedPathways,s=performance.now();Object.keys(i).forEach(n=>{s-i[n]>Jl&&delete i[n]});for(let n=0;n<e.length;n++){const r=e[n];if(i[r])continue;if(r===this.pathwayId)return;const o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(t=this.getLevelsForPathway(r),t.length>0){this.log(`Setting Pathway to "${r}"`),this.pathwayId=r,this.hls.trigger(b.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[o];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=o);break}}}clonePathways(e){const t=this.levels;if(!t)return;const i={},s={};e.forEach(n=>{const{ID:r,"BASE-ID":o,"URI-REPLACEMENT":l}=n;if(t.some(h=>h.pathwayId===r))return;const c=this.getLevelsForPathway(o).map(h=>{const f=Ke({},h);f.details=void 0,f.url=Zr(h.uri,h.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l);const g=new We(h.attrs);g["PATHWAY-ID"]=r;const y=g.AUDIO&&`${g.AUDIO}_clone_${r}`,v=g.SUBTITLES&&`${g.SUBTITLES}_clone_${r}`;y&&(i[g.AUDIO]=y,g.AUDIO=y),v&&(s[g.SUBTITLES]=v,g.SUBTITLES=v),f.attrs=g;const A=new ji(f);return gs(A,"audio",y),gs(A,"text",v),A});t.push(...c),Qr(this.audioTracks,i,l,r),Qr(this.subtitleTracks,s,l,r)})}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const h=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+h)}const n={responseType:"json",url:s.href},r=t.steeringManifestLoadPolicy.default,o=r.errorRetry||r.timeoutRetry||{},l={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},c={onSuccess:(h,f,g,y)=>{this.log(`Loaded steering manifest: "${s}"`);const v=h.data;if(v.VERSION!==1){this.log(`Steering VERSION ${v.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=v.TTL;const{"RELOAD-URI":A,"PATHWAY-CLONES":S,"PATHWAY-PRIORITY":L}=v;if(A)try{this.uri=new self.URL(A,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${A}`);return}this.scheduleRefresh(this.uri||g.url),S&&this.clonePathways(S),L&&this.updatePathwayPriority(L)},onError:(h,f,g,y)=>{if(this.log(`Error loading steering manifest: ${h.code} ${h.text} (${f.url})`),this.stopLoad(),h.code===410){this.enabled=!1,this.log(`Steering manifest ${f.url} no longer available`);return}let v=this.timeToLoad*1e3;if(h.code===429){const A=this.loader;if(typeof(A==null?void 0:A.getResponseHeader)=="function"){const S=A.getResponseHeader("Retry-After");S&&(v=parseFloat(S)*1e3)}this.log(`Steering manifest ${f.url} rate limited`);return}this.scheduleRefresh(this.uri||f.url,v)},onTimeout:(h,f,g)=>{this.log(`Timeout loading steering manifest (${f.url})`),this.scheduleRefresh(this.uri||f.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(n,l,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(()=>{this.loadSteeringManifest(e)},t)}}function Qr(a,e,t,i){a&&Object.keys(e).forEach(s=>{const n=a.filter(r=>r.groupId===s).map(r=>{const o=Ke({},r);return o.details=void 0,o.attrs=new We(o.attrs),o.url=o.attrs.URI=Zr(r.url,r.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[s],o.attrs["PATHWAY-ID"]=i,o});a.push(...n)})}function Zr(a,e,t,i){const{HOST:s,PARAMS:n,[t]:r}=i;let o;e&&(o=r==null?void 0:r[e],o&&(a=o));const l=new self.URL(a);return s&&!o&&(l.host=s),n&&Object.keys(n).sort().forEach(c=>{c&&l.searchParams.set(c,n[c])}),l.href}const tc=/^age:\s*[\d.]+\s*$/im;class Jr{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new ui,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e)return;const i=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const n=this.xhrSetup;n?Promise.resolve().then(()=>{if(!this.stats.aborted)return n(i,t.url)}).catch(r=>(i.open("GET",t.url,!0),n(i,t.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(r=>{this.callbacks.onError({code:i.status,text:r.message},t,i,s)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const s=this.context.headers,{maxTimeToFirstByteMs:n,maxLoadTimeMs:r}=i.loadPolicy;if(s)for(const o in s)e.setRequestHeader(o,s[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=n&&se(n)?n:r,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const s=t.readyState,n=this.config;if(!i.aborted&&s>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),n.timeout!==n.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),n.timeout=n.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const r=t.status,o=t.responseType!=="text";if(r>=200&&r<300&&(o&&t.response||t.responseText!==null)){i.loading.end=Math.max(self.performance.now(),i.loading.first);const l=o?t.response:t.responseText,c=t.responseType==="arraybuffer"?l.byteLength:l.length;if(i.loaded=i.total=c,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first),!this.callbacks)return;const h=this.callbacks.onProgress;if(h&&h(i,e,l,t),!this.callbacks)return;const f={url:t.responseURL,data:l,code:r};this.callbacks.onSuccess(f,i,e,t)}else{const l=n.loadPolicy.errorRetry,c=i.retry;ms(l,c,!1,r)?this.retry(l):(k.error(`${r} while loading ${e.url}`),this.callbacks.onError({code:r,text:t.statusText},e,t,i))}}}loadtimeout(){var e;const t=(e=this.config)==null?void 0:e.loadPolicy.timeoutRetry,i=this.stats.retry;if(ms(t,i,!0))this.retry(t);else{k.warn(`timeout while loading ${this.context.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=Vs(e,i.retry),i.retry++,k.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&tc.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}function ic(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const sc=/(\d+)-(\d+)\/(\d+)/;class ea{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||oc,this.controller=new self.AbortController,this.stats=new ui}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){const e=this.response;e!=null&&e.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const n=nc(e,this.controller.signal),r=i.onProgress,o=e.responseType==="arraybuffer",l=o?"byteLength":"length",{maxTimeToFirstByteMs:c,maxLoadTimeMs:h}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,n),self.clearTimeout(this.requestTimeout),t.timeout=c&&se(c)?c:h,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),i.onTimeout(s,e,this.response)},t.timeout),self.fetch(this.request).then(f=>{this.response=this.loader=f;const g=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=h,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),i.onTimeout(s,e,this.response)},h-(g-s.loading.start)),!f.ok){const{status:y,statusText:v}=f;throw new lc(v||"fetch, bad network response",y,f)}return s.loading.first=g,s.total=ac(f.headers)||s.total,r&&se(t.highWaterMark)?this.loadProgressively(f,s,e,t.highWaterMark,r):o?f.arrayBuffer():e.responseType==="json"?f.json():f.text()}).then(f=>{const{response:g}=this;self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const y=f[l];y&&(s.loaded=s.total=y);const v={url:g.url,data:f,code:g.status};r&&!se(t.highWaterMark)&&r(s,e,f,g),i.onSuccess(v,s,e,g)}).catch(f=>{if(self.clearTimeout(this.requestTimeout),s.aborted)return;const g=f&&f.code||0,y=f?f.message:null;i.onError({code:g,text:y},e,f?f.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,s=0,n){const r=new kr,o=e.body.getReader(),l=()=>o.read().then(c=>{if(c.done)return r.dataLength&&n(t,i,r.flush(),e),Promise.resolve(new ArrayBuffer(0));const h=c.value,f=h.length;return t.loaded+=f,f<s||r.dataLength?(r.push(h),r.dataLength>=s&&n(t,i,r.flush(),e)):n(t,i,h,e),l()}).catch(()=>Promise.reject());return l()}}function nc(a,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Ke({},a.headers))};return a.rangeEnd&&t.headers.set("Range","bytes="+a.rangeStart+"-"+String(a.rangeEnd-1)),t}function rc(a){const e=sc.exec(a);if(e)return parseInt(e[2])-parseInt(e[1])+1}function ac(a){const e=a.get("Content-Range");if(e){const i=rc(e);if(se(i))return i}const t=a.get("Content-Length");if(t)return parseInt(t)}function oc(a,e){return new self.Request(a.url,e)}class lc extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const cc=/\s/,uc={newCue(a,e,t,i){const s=[];let n,r,o,l,c;const h=self.VTTCue||self.TextTrackCue;for(let g=0;g<i.rows.length;g++)if(n=i.rows[g],o=!0,l=0,c="",!n.isEmpty()){var f;for(let A=0;A<n.chars.length;A++)cc.test(n.chars[A].uchar)&&o?l++:(c+=n.chars[A].uchar,o=!1);n.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const y=Hr(c.trim()),v=fn(e,t,y);a!=null&&(f=a.cues)!=null&&f.getCueById(v)||(r=new h(e,t,y),r.id=v,r.line=g+1,r.align="left",r.position=10+Math.min(80,Math.floor(l*8/32)*10),s.push(r))}return a&&s.length&&(s.sort((g,y)=>g.line==="auto"||y.line==="auto"?0:g.line>8&&y.line>8?y.line-g.line:g.line-y.line),s.forEach(g=>Kn(a,g))),s}},dc={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},hc=ot(ot({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Jr,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:pl,bufferController:Ll,capLevelController:vn,errorController:oo,fpsController:Xl,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:os,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:dc},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},fc()),{},{subtitleStreamController:El,subtitleTrackController:Sl,timelineController:Yl,audioStreamController:vl,audioTrackController:bl,emeController:Pi,cmcdController:oi,contentSteeringController:ec});function fc(){return{cueHandler:uc,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function mc(a,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const t=bn(a),i=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(n=>{const r=`${n==="level"?"playlist":n}LoadPolicy`,o=e[r]===void 0,l=[];s.forEach(c=>{const h=`${n}Loading${c}`,f=e[h];if(f!==void 0&&o){l.push(h);const g=t[r].default;switch(e[r]={default:g},c){case"TimeOut":g.maxLoadTimeMs=f,g.maxTimeToFirstByteMs=f;break;case"MaxRetry":g.errorRetry.maxNumRetry=f,g.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":g.errorRetry.retryDelayMs=f,g.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":g.errorRetry.maxRetryDelayMs=f,g.timeoutRetry.maxRetryDelayMs=f;break}}}),l.length&&k.warn(`hls.js config: "${l.join('", "')}" setting(s) are deprecated, use "${r}": ${JSON.stringify(e[r])}`)}),ot(ot({},t),e)}function bn(a){return a&&typeof a=="object"?Array.isArray(a)?a.map(bn):Object.keys(a).reduce((e,t)=>(e[t]=bn(a[t]),e),{}):a}function gc(a){const e=a.loader;e!==ea&&e!==Jr?(k.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1):ic()&&(a.loader=ea,a.progressive=!0,a.enableSoftwareAES=!0,k.log("[config]: Progressive streaming enabled, using FetchLoader"))}class It{static get version(){return"1.4.13"}static isSupported(){return Io()}static get Events(){return b}static get ErrorTypes(){return ue}static get ErrorDetails(){return N}static get DefaultConfig(){return It.defaultConfig?It.defaultConfig:hc}static set DefaultConfig(e){It.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new nn,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,Is(e.debug||!1,"Hls instance");const t=this.config=mc(It.DefaultConfig,e);this.userConfig=e,this._autoLevelCapping=-1,t.progressive&&gc(t);const{abrController:i,bufferController:s,capLevelController:n,errorController:r,fpsController:o}=t,l=new r(this),c=this.abrController=new i(this),h=this.bufferController=new s(this),f=this.capLevelController=new n(this),g=new o(this),y=new Ga(this),v=new Ya(this),A=t.contentSteeringController,S=A?new A(this):null,L=this.levelController=new co(this,S),C=new uo(this),R=new fo(this.config),M=this.streamController=new ml(this,C,R);f.setStreamController(M),g.setStreamController(M);const O=[y,L,M];S&&O.splice(1,0,S),this.networkControllers=O;const J=[c,h,f,g,v,C];this.audioTrackController=this.createController(t.audioTrackController,O);const G=t.audioStreamController;G&&O.push(new G(this,C,R)),this.subtitleTrackController=this.createController(t.subtitleTrackController,O);const Y=t.subtitleStreamController;Y&&O.push(new Y(this,C,R)),this.createController(t.timelineController,J),R.emeController=this.emeController=this.createController(t.emeController,J),this.cmcdController=this.createController(t.cmcdController,J),this.latencyController=this.createController(qa,J),this.coreComponents=J,O.push(l);const Z=l.onErrorOut;typeof Z=="function"&&this.on(b.ERROR,Z,l)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,s){this._emitter.off(e,t,i,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){k.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),this.trigger(b.ERROR,{type:ue.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,fatal:!1,event:e,error:i})}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){k.log("destroy"),this.trigger(b.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){k.log("attachMedia"),this._media=e,this.trigger(b.MEDIA_ATTACHING,{media:e})}detachMedia(){k.log("detachMedia"),this.trigger(b.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const t=this.media,i=this.url,s=this.url=Ti.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});k.log(`loadSource:${s}`),t&&i&&(i!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(b.MANIFEST_LOADING,{url:e})}startLoad(e=-1){k.log(`startLoad(${e})`),this.networkControllers.forEach(t=>{t.startLoad(e)})}stopLoad(){k.log("stopLoad"),this.networkControllers.forEach(e=>{e.stopLoad()})}swapAudioCodec(){k.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){k.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e,t=0){this.levelController.removeLevel(e,t)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){k.log(`set currentLevel:${e}`),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){k.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){k.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){k.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){return this.levelController.startLevel}set startLevel(e){k.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(k.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){Bs.indexOf(e)>-1&&(this._maxHdcpLevel=e)}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let s=0;s<i;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let s;if(t===-1&&e&&e.length?s=e.length-1:s=t,i)for(let n=s;n--;){const r=e[n].attrs["HDCP-LEVEL"];if(r&&r<=i)return n}return s}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}It.defaultConfig=void 0;var Tn=oe(456903),ws=oe(64745),pc=function(){function a(e,t){z()(this,a),F()(this,"errorContainerClassName","video-player__error"),F()(this,"errorMessageElementClassName","video-player__error-message"),this.player=e,this.message=t,this.errorMessageElement=this.createErrorMessageElement()}return te()(a,[{key:"destroy",value:function(){var t;(t=this.errorMessageElement)===null||t===void 0||t.remove()}},{key:"createErrorMessageElement",value:function(){var t=this.player.elements.container,i=document.createElement("div"),s=document.createElement("p");return i.classList.add(this.errorContainerClassName),s.classList.add(this.errorMessageElementClassName),s.innerText=this.message,i.appendChild(s),t==null||t.appendChild(i),i}}])}(),ta=function(){function a(e,t){var i=this;z()(this,a),F()(this,"handleError",function(s){var n=yt.fromError(s);if(i.handleVideoPlayerError(n),n.code===j.UnexpectedError)throw s;console.error(s)}),F()(this,"handleMediaError",function(s){var n=yt.fromPlayerMedia(s.media);if(i.handleVideoPlayerError(n),n.code===j.UnexpectedError)throw n;console.error(n)}),F()(this,"handleVideoPlayerError",function(s){var n=i.mapCodeToMessage(s.code);n&&i.showErrorMessageScreen(n)}),F()(this,"showErrorMessageScreen",function(s){i.errorMessageScreen=new pc(i.player,s)}),this.player=e,this.isExternalProvider=t,this.translation=e.config.i18n,t||this.player.on("error",function(s){return i.handleMediaError(s.detail.plyr)})}return te()(a,[{key:"destroy",value:function(){var t;(t=this.errorMessageScreen)===null||t===void 0||t.destroy()}},{key:"mapCodeToMessage",value:function(t){var i=new Map([[j.VideoAbortedByUser,this.translation.videoAbortedByUser],[j.VideoCouldNotBeAccessed,this.translation.videoCouldNotBeAccessed],[j.VideoCouldNotBeDecoded,this.translation.videoCouldNotBeDecoded],[j.VideoCouldNotBePlayed,this.translation.videoCouldNotBePlayed],[j.VideoPlaybackDriverUnsupported,this.translation.videoCouldNotBePlayed],[j.UnauthorizedError,this.translation.unauthorizedAccess],[j.InvalidConfiguration,this.translation.videoCouldNotBePlayed],[j.UnexpectedError,this.translation.unexpectedError]]);return i.get(t)}}])}(),ia=function(e){return(e==null?void 0:e.code)===j.UnauthorizedError};function sa(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(a,s).enumerable})),t.push.apply(t,i)}return t}function yc(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?sa(Object(t),!0).forEach(function(i){F()(a,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):sa(Object(t)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(t,i))})}return a}var En=function(){function a(){z()(this,a),F()(this,"cancelTokenSource",null)}return te()(a,[{key:"resolve",value:function(){var e=Ne()(Fe().mark(function i(s){return Fe().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,this.requestPlaylist(s);case 3:return r.abrupt("return",r.sent);case 6:if(r.prev=6,r.t0=r.catch(0),!ws.Z.isAxiosError(r.t0)){r.next=14;break}if(!a.isAuthError(r.t0)){r.next=11;break}return r.abrupt("return",this.resolveWithAuth(s));case 11:throw a.buildApiError(r.t0);case 14:throw r.t0;case 15:case"end":return r.stop()}},i,this,[[0,6]])}));function t(i){return e.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t;(t=this.cancelTokenSource)===null||t===void 0||t.cancel(),this.cancelTokenSource=null}},{key:"resolveWithAuth",value:function(){var e=Ne()(Fe().mark(function i(s){var n;return Fe().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,this.requestAuthToken();case 3:return n=o.sent,o.next=6,this.requestPlaylist(s,n);case 6:return o.abrupt("return",o.sent);case 9:if(o.prev=9,o.t0=o.catch(0),!ws.Z.isAxiosError(o.t0)){o.next=17;break}if(!a.isAuthError(o.t0)){o.next=14;break}throw new yt(j.UnauthorizedError);case 14:throw a.buildApiError(o.t0);case 17:throw o.t0;case 18:case"end":return o.stop()}},i,this,[[0,9]])}));function t(i){return e.apply(this,arguments)}return t}()},{key:"requestPlaylist",value:function(t,i){var s;return(s=this.cancelTokenSource)===null||s===void 0||s.cancel(),this.cancelTokenSource=ws.Z.CancelToken.source(),Tn.default.get(t,yc({cancelToken:this.cancelTokenSource.token},i?{withCredentials:!0,headers:{Authorization:"Bearer ".concat(i)}}:{})).then(function(n){return new Blob([n.data],{type:"text/plain"})})}},{key:"requestAuthToken",value:function(){var t;return(t=this.cancelTokenSource)===null||t===void 0||t.cancel(),this.cancelTokenSource=ws.Z.CancelToken.source(),Tn.default.get(a.AuthEndpoint,{cancelToken:this.cancelTokenSource.token}).then(function(i){return i.data.token})}}],[{key:"buildApiError",value:function(t){return new Tn.errors.ApiError("Could not load HLS playlist","PlaylistLoader",t)}},{key:"isAuthError",value:function(t){var i,s;return((i=t.response)===null||i===void 0?void 0:i.status)===401||((s=t.response)===null||s===void 0?void 0:s.status)===403}}])}();F()(En,"AuthEndpoint","/api/media/auth/v1/asset/authorization");var vc=It.isSupported,bc=function(){function a(e){z()(this,a),F()(this,"playlistLoader",new En),F()(this,"hasMediaErrorOccurred",!1);var t=e.thumbnailSrc,i=e.player,s=e.errorHandler,n=e.onUnauthorizedError;this.player=i,this.hlsJs=new It({enableWorker:!1}),this.errorHandler=s,t&&(this.player.poster=t),this.initVideo(e).catch(function(r){n&&ia(r)?n():s.handleError(r)})}return te()(a,[{key:"hlsJsInstance",get:function(){return this.hlsJs}},{key:"destroy",value:function(){this.hlsJs.destroy(),this.playlistLoader.destroy()}},{key:"onReady",value:function(){var t=this;return this.player.duration?Promise.resolve():new Promise(function(i){t.hlsJs.once(It.Events.MEDIA_ATTACHED,function(){return i()})})}},{key:"initVideo",value:function(){var e=Ne()(Fe().mark(function i(s){var n,r,o,l;return Fe().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return n=s.src,r=s.videoElement,h.next=3,this.playlistLoader.resolve(n);case 3:o=h.sent,l=URL.createObjectURL(o),this.hlsJs.loadSource(l),this.hlsJs.attachMedia(r),this.handleErrors(),this.setHighestQuality();case 9:case"end":return h.stop()}},i,this)}));function t(i){return e.apply(this,arguments)}return t}()},{key:"setHighestQuality",value:function(){var t=this;this.hlsJs.on(It.Events.MANIFEST_PARSED,function(){t.hlsJs.config.startLevel=t.hlsJs.levels.reduce(function(i,s,n,r){return s.bitrate>r[i].bitrate?n:i},0)})}},{key:"handleErrors",value:function(){var t=this;this.hlsJs.on(It.Events.ERROR,function(i,s){if(s.fatal)switch(s.type){case It.ErrorTypes.NETWORK_ERROR:t.hlsJs.startLoad();break;case It.ErrorTypes.MEDIA_ERROR:t.handleMediaError(s);break;default:t.errorHandler.handleError(s);break}})}},{key:"handleMediaError",value:function(t){this.hasMediaErrorOccurred?this.errorHandler.handleError(t):(this.hasMediaErrorOccurred=!0,this.hlsJs.recoverMediaError())}}])}(),Tc=function(){function a(e){z()(this,a),F()(this,"playlistLoader",new En);var t=e.player,i=e.thumbnailSrc,s=e.errorHandler,n=e.onUnauthorizedError;this.player=t,i&&(this.player.poster=i),this.initVideo(e).catch(function(r){n&&ia(r)?n():s.handleError(r)})}return te()(a,[{key:"destroy",value:function(){this.playlistLoader.destroy()}},{key:"onReady",value:function(){var e=Ne()(Fe().mark(function i(){var s=this;return Fe().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!this.player.duration){r.next=2;break}return r.abrupt("return",Promise.resolve());case 2:return r.next=4,new Promise(function(o){var l=function(){s.player.media.removeEventListener("loadedmetadata",l),o()};s.player.media.addEventListener("loadedmetadata",l)});case 4:case"end":return r.stop()}},i,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"initVideo",value:function(){var e=Ne()(Fe().mark(function i(s){var n,r,o,l,c;return Fe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return n=s.src,r=s.videoElement,f.next=3,this.playlistLoader.resolve(n);case 3:o=f.sent,l=URL.createObjectURL(o),c=document.createElement("source"),c.setAttribute("src",l),c.setAttribute("type","application/x-mpegURL"),r.appendChild(c),this.setHighestQuality();case 10:case"end":return f.stop()}},i,this)}));function t(i){return e.apply(this,arguments)}return t}()},{key:"setHighestQuality",value:function(){}}])}(),Ec=function(){function a(e,t){z()(this,a),this.videoProvider=e;var i=t.src,s=t.thumbnailSrc;this.videoProvider=e;var n=this.createPlyrSourceInfo(i,s);t.player.source=n}return te()(a,[{key:"destroy",value:function(){}},{key:"onReady",value:function(){return Promise.resolve()}},{key:"createPlyrSourceInfo",value:function(t,i){return{type:"video",sources:[{src:t,provider:this.videoProvider}],poster:i}}}])}(),Ac=function(e,t){switch(e){case Dt.HlsJs:return new bc(t);case Dt.NativeHls:return new Tc(t);case Dt.Vimeo:case Dt.YouTube:return new Ec(e,t)}},na=F()(F()({},bi.YouTube,["youtube.com","youtube-nocookie.com","youtu.be"]),bi.Vimeo,["vimeo.com"]),Sc=function(e){var t=!!(e.canPlayType("application/vnd.apple.mpegURL")||e.canPlayType("audio/mpegurl"));if(vc())return Dt.HlsJs;if(t)return Dt.NativeHls;throw new yt(j.VideoPlaybackDriverUnsupported,"No HLS implementation is supported on this platform")},xc=function(e,t){var i=function(o){if(na[o].some(function(l){return e.includes(l)}))return o},s=Object.keys(na),n=s.find(function(r){return i(r)});return n??Sc(t)},Lc=function(){function a(e,t){var i=this;z()(this,a),F()(this,"vimeoButtonClassName","video-player--vimeo-button"),F()(this,"maxContainerWidth",225),F()(this,"maxContainerHeight",127),this.videoPlayerElement=t,e.provider===Dt.Vimeo&&e.once("ready",function(){i.resizeObserver=new ResizeObserver(function(){return i.toggleVimeoPlayButtonClassName()}),i.resizeObserver.observe(t)})}return te()(a,[{key:"destroy",value:function(){var t;(t=this.resizeObserver)===null||t===void 0||t.disconnect(),this.removeVimeoPlayButtonClassName()}},{key:"toggleVimeoPlayButtonClassName",value:function(){var t=this.videoPlayerElement.clientWidth,i=this.videoPlayerElement.clientHeight;t<this.maxContainerWidth||i<this.maxContainerHeight?this.videoPlayerElement.classList.add(this.vimeoButtonClassName):this.removeVimeoPlayButtonClassName()}},{key:"removeVimeoPlayButtonClassName",value:function(){this.videoPlayerElement.classList.remove(this.vimeoButtonClassName)}}])}(),St={DA:"da",DE:"de",EN:"en",ES:"es",FI:"fi",FR:"fr",IT:"it",JA:"ja",NL:"nl",NO:"no",PT:"pt",SV:"sv"},wc={play:"Spil",pause:"S\xE6t p\xE5 pause",seek:"S\xF8g",seekLabel:"{currentTime} af {duration}",currentTime:"Aktuelt klokkesl\xE6t",duration:"Varighed",volume:"Lydstyrke",mute:"Sl\xE5 lyden fra",unmute:"Sl\xE5 lyden til",enterFullscreen:"\xC5bn fuldsk\xE6rm",exitFullscreen:"Luk fuldsk\xE6rm",settings:"Indstillinger",menuBack:"G\xE5 tilbage til forrige menu",speed:"Hastighed",normal:"Normal",quality:"Kvalitet",videoAbortedByUser:"Du har afbrudt medieafspilningen.",videoCouldNotBeAccessed:"Videoen kunne ikke indl\xE6ses. Tjek forbindelsen, og pr\xF8v derefter igen.",videoCouldNotBeDecoded:"Videoen er ikke tilg\xE6ngelig. Pr\xF8v at spille noget andet.",videoCouldNotBePlayed:"Video er ikke tilg\xE6ngelig, eller formatet underst\xF8ttes ikke. Pr\xF8v en anden browser.",unauthorizedAccess:"Adgang n\xE6gtet. Log ind eller kontakt ejeren for at anmode om adgang.",unexpectedError:"Videoen kunne ikke indl\xE6ses. Pr\xF8v igen senere.",paywallCtaButton:"Tilmeld dig nu",paywallDescription:"Tilmeld dig for at se denne video"},Ic={play:"Abspielen",pause:"Anhalten",seek:"Suche",seekLabel:"{currentTime} von {duration}",currentTime:"Aktuelle Uhrzeit",duration:"Dauer",volume:"Lautst\xE4rke",mute:"Stummschalten",unmute:"Stummschaltung aufheben",enterFullscreen:"Zum Vollbildmodus wechseln",exitFullscreen:"Vollbildmodus verlassen",settings:"Einstellungen",menuBack:"Zur\xFCck zum vorherigen Men\xFC",speed:"Geschwindigkeit",normal:"Normal",quality:"Qualit\xE4t",videoAbortedByUser:"Du hast die Medienwiedergabe abgebrochen.",videoCouldNotBeAccessed:"Video konnte nicht geladen werden. \xDCberpr\xFCfe deine Internetverbindung und versuche es erneut.",videoCouldNotBeDecoded:"Video nicht verf\xFCgbar. Versuche, etwas anderes abzuspielen.",videoCouldNotBePlayed:"Das Video ist nicht verf\xFCgbar oder das Format wird nicht unterst\xFCtzt. Versuche es mit einem anderen Browser.",unauthorizedAccess:"Zugriff verweigert. Logge dich ein oder bitte den Besitzer um Zugriff.",unexpectedError:"Video konnte nicht geladen werden. Versuche es sp\xE4ter erneut.",paywallCtaButton:"Jetzt beitreten",paywallDescription:"Registriere dich, um dieses Video anzusehen"},Je=function(e,t,i){return e},kc={play:Je("Play",null,{project:"video-player"}),pause:Je("Pause",null,{project:"video-player"}),seek:Je("Seek",null,{project:"video-player"}),seekLabel:Je("{currentTime} of {duration}",null,{project:"video-player",notes:"{currentTime} and {duration} are tokens replaced with time in format mm:ss"}),currentTime:Je("Current time",null,{project:"video-player"}),duration:Je("Duration",null,{project:"video-player"}),volume:Je("Volume",null,{project:"video-player"}),mute:Je("Mute",null,{project:"video-player"}),unmute:Je("Unmute",null,{project:"video-player"}),enterFullscreen:Je("Enter fullscreen",null,{project:"video-player"}),exitFullscreen:Je("Exit fullscreen",null,{project:"video-player"}),settings:Je("Settings",null,{project:"video-player"}),menuBack:Je("Go back to previous menu",null,{project:"video-player"}),speed:Je("Speed",null,{project:"video-player"}),normal:Je("Normal",null,{project:"video-player"}),quality:Je("Quality",null,{project:"video-player"}),videoAbortedByUser:Je("You aborted the media playback.",null,{project:"video-player"}),videoCouldNotBeAccessed:Je("Couldn't load video. Check connection, then try again.",null,{project:"video-player"}),videoCouldNotBeDecoded:Je("Video unavailable. Try playing something else.",null,{project:"video-player"}),videoCouldNotBePlayed:Je("Video is not available or format is not supported. Try a different browser.",null,{project:"video-player"}),unauthorizedAccess:Je("Access denied. Login or contact owner to request access.",null,{project:"video-player"}),unexpectedError:Je("Unable to load video. Try again later.",null,{project:"video-player"}),paywallCtaButton:Je("Join Now",null,{project:"video-player"}),paywallDescription:Je("Sign up to view this video",null,{project:"video-player"})},Rc={play:"Ver",pause:"Pausar",seek:"Buscar",seekLabel:"{currentTime} de {duration}",currentTime:"Hora actual",duration:"Duraci\xF3n",volume:"Volumen",mute:"Silenciar",unmute:"Activar sonido",enterFullscreen:"Ingresar a pantalla completa",exitFullscreen:"Salir de pantalla completa",settings:"Configuraci\xF3n",menuBack:"Regresar al men\xFA anterior",speed:"Velocidad",normal:"Normal",quality:"Calidad",videoAbortedByUser:"Anulaste la reproducci\xF3n de medios.",videoCouldNotBeAccessed:"No se pudo cargar el video. Comprueba la conexi\xF3n y vuelve a intentarlo.",videoCouldNotBeDecoded:"Video no disponible. Prueba ver otro video.",videoCouldNotBePlayed:"El video no est\xE1 disponible o el formato no es compatible. Prueba con otro navegador.",unauthorizedAccess:"Acceso denegado. Inicia sesi\xF3n o ponte en contacto con el propietario para solicitar acceso.",unexpectedError:"No se puede cargar el video. Intenta de nuevo m\xE1s tarde.",paywallCtaButton:"\xDAnete ahora",paywallDescription:"Reg\xEDstrate para ver este video"},Cc={play:"Toista",pause:"Pys\xE4yt\xE4",seek:"Etsi",seekLabel:"{currentTime}/{duration}",currentTime:"Nykyinen aika",duration:"Kesto",volume:"\xC4\xE4nenvoimakkuus",mute:"Mykist\xE4",unmute:"Poista mykistys",enterFullscreen:"Siirry koko n\xE4yt\xF6n tilaan",exitFullscreen:"Poistu koko n\xE4yt\xF6n tilasta",settings:"Asetukset",menuBack:"Palaa edelliseen valikkoon",speed:"Nopeus",normal:"Normaali",quality:"Laatu",videoAbortedByUser:"Keskeytit mediatoiston.",videoCouldNotBeAccessed:"Videon lataaminen ei onnistu. Tarkista yhteys ja yrit\xE4 sitten uudelleen.",videoCouldNotBeDecoded:"Video ei ole k\xE4ytett\xE4viss\xE4. Kokeile katsoa jotain muuta.",videoCouldNotBePlayed:"Video ei ole saatavilla tai muotoa ei tueta. Kokeile toista selainta.",unauthorizedAccess:"P\xE4\xE4sy kielletty. Kirjaudu sis\xE4\xE4n tai ota yhteytt\xE4 omistajaan pyyt\xE4\xE4ksesi k\xE4ytt\xF6oikeutta.",unexpectedError:"Videon lataaminen ei onnistu. Yrit\xE4 my\xF6hemmin uudelleen.",paywallCtaButton:"Liity nyt",paywallDescription:"Rekister\xF6idy n\xE4hd\xE4ksesi t\xE4m\xE4n videon"},Dc={play:"Lecture",pause:"Mettre en pause",seek:"Rechercher",seekLabel:"{currentTime} sur {duration}",currentTime:"Heure actuelle",duration:"Dur\xE9e",volume:"Volume",mute:"Couper le son",unmute:"R\xE9activer le son",enterFullscreen:"Activer le mode plein \xE9cran",exitFullscreen:"Quitter le mode plein \xE9cran",settings:"Param\xE8tres",menuBack:"Revenir au menu pr\xE9c\xE9dent",speed:"Vitesse",normal:"Normal",quality:"Qualit\xE9",videoAbortedByUser:"Vous avez interrompu la lecture du m\xE9dia.",videoCouldNotBeAccessed:"Impossible de charger la vid\xE9o. V\xE9rifiez votre connexion et r\xE9essayez.",videoCouldNotBeDecoded:"Vid\xE9o indisponible. Essayez de lancer une autre vid\xE9o.",videoCouldNotBePlayed:"La vid\xE9o n'est pas disponible ou le format n'est pas pris en charge. Essayez un autre navigateur.",unauthorizedAccess:"Acc\xE8s refus\xE9. Connectez-vous ou contactez le propri\xE9taire pour obtenir l\u2019acc\xE8s.",unexpectedError:"Impossible de charger la vid\xE9o. Veuillez r\xE9essayer ult\xE9rieurement.",paywallCtaButton:"S\u2019inscrire",paywallDescription:"Inscrivez-vous pour visionner cette vid\xE9o"},Pc={play:"Riproduci",pause:"Sospendi",seek:"Cerca",seekLabel:"{currentTime} di {duration}",currentTime:"Ora attuale",duration:"Durata",volume:"Volume",mute:"Disattiva audio",unmute:"Riattiva audio",enterFullscreen:"Attiva modalit\xE0 schermo intero",exitFullscreen:"Esci dalla modalit\xE0 schermo intero",settings:"Impostazioni",menuBack:"Torna al menu precedente",speed:"Velocit\xE0",normal:"Normale",quality:"Qualit\xE0",videoAbortedByUser:"La riproduzione dei contenuti multimediali \xE8 stata interrotta.",videoCouldNotBeAccessed:"Impossibile caricare il video. Verifica la connessione, quindi riprova.",videoCouldNotBeDecoded:"Video non disponibile. Prova a riprodurre a qualcos'altro.",videoCouldNotBePlayed:"Il video non disponibile o il formato non \xE8 supportato. Prova un browser diverso.",unauthorizedAccess:"Accesso negato. Effettua il login o contatta il proprietario per richiedere l'accesso.",unexpectedError:"Impossibile caricare il video. Riprova pi\xF9 tardi.",paywallCtaButton:"Iscriviti ora",paywallDescription:"Iscriviti per visualizzare questo video"},_c={play:"\u518D\u751F",pause:"[\u4E00\u6642\u505C\u6B62]",seek:'"\u30B7\u30FC\u30AF',seekLabel:"{currentTime} \u306E {duration}",currentTime:"\u73FE\u5728\u306E\u6642\u523B",duration:"\u6240\u8981\u6642\u9593",volume:"\u30DC\u30EA\u30E5\u30FC\u30E0",mute:'"\u30DF\u30E5\u30FC\u30C8',unmute:"\u30DF\u30E5\u30FC\u30C8\u89E3\u9664",enterFullscreen:"\u30D5\u30EB\u30B9\u30AF\u30EA\u30FC\u30F3\u306B\u5207\u308A\u66FF\u3048",exitFullscreen:"\u5168\u753B\u9762\u8868\u793A\u3092\u7D42\u4E86",settings:"[\u8A2D\u5B9A]",menuBack:'"\u524D\u306E\u30E1\u30CB\u30E5\u30FC\u306B\u623B\u308B',speed:"\u30B9\u30D4\u30FC\u30C9",normal:"\u30CE\u30FC\u30DE\u30EB",quality:"\u30AF\u30AA\u30EA\u30C6\u30A3",videoAbortedByUser:"\u30E1\u30C7\u30A3\u30A2\u306E\u518D\u751F\u3092\u4E2D\u6B62\u3057\u307E\u3057\u305F\u3002",videoCouldNotBeAccessed:"\u52D5\u753B\u3092\u8AAD\u307F\u8FBC\u3081\u307E\u305B\u3093\u3067\u3057\u305F\u3002 \u63A5\u7D9A\u3092\u78BA\u8A8D\u3057\u3066\u3001\u3082\u3046\u4E00\u5EA6\u8A66\u3057\u3066\u304F\u3060\u3055\u3044\u3002",videoCouldNotBeDecoded:"\u30D3\u30C7\u30AA\u306F\u5229\u7528\u3067\u304D\u307E\u305B\u3093\u3002 \u4ED6\u306E\u3082\u306E\u3092\u30D7\u30EC\u30A4\u3057\u3066\u307F\u3066\u304F\u3060\u3055\u3044\u3002",videoCouldNotBePlayed:"\u30D3\u30C7\u30AA\u304C\u5229\u7528\u3067\u304D\u306A\u3044\u304B\u3001\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u304C\u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u305B\u3093\u3002 \u5225\u306E\u30D6\u30E9\u30A6\u30B6\u3092\u8A66\u3057\u3066\u304F\u3060\u3055\u3044\u3002",unauthorizedAccess:"\u30A2\u30AF\u30BB\u30B9\u304C\u62D2\u5426\u3055\u308C\u307E\u3057\u305F\u3002 \u30ED\u30B0\u30A4\u30F3\u3059\u308B\u304B\u3001\u6240\u6709\u8005\u306B\u9023\u7D61\u3057\u3066\u30A2\u30AF\u30BB\u30B9\u3092\u30EA\u30AF\u30A8\u30B9\u30C8\u3057\u3066\u304F\u3060\u3055\u3044\u3002",unexpectedError:"\u30D3\u30C7\u30AA\u3092\u8AAD\u307F\u8FBC\u3081\u307E\u305B\u3093\u3002 \u5F8C\u3067\u3082\u3046\u4E00\u5EA6\u8A66\u3057\u3066\u304F\u3060\u3055\u3044\u3002",paywallCtaButton:"\u4ECA\u3059\u3050\u52A0\u5165",paywallDescription:"\u3053\u306E\u52D5\u753B\u3092\u898B\u308B\u306B\u306F\u767B\u9332\u3057\u3066\u304F\u3060\u3055\u3044"},Oc={play:"Afspelen",pause:"Pauzeren",seek:"Zoeken",seekLabel:"{currentTime} van {duration}",currentTime:"Huidige tijd",duration:"Duur",volume:"Volume",mute:"Dempen",unmute:"Dempen opheffen",enterFullscreen:"Naar volledig scherm",exitFullscreen:"Volledig scherm afsluiten",settings:"Instellingen",menuBack:"Terug naar vorig menu",speed:"Snelheid",normal:"Normaal",quality:"Kwaliteit",videoAbortedByUser:"Je hebt het afspelen van media afgebroken.",videoCouldNotBeAccessed:"Kan video niet laden. Controleer de verbinding en probeer het opnieuw.",videoCouldNotBeDecoded:"Video niet beschikbaar. Probeer om iets anders af te spelen.",videoCouldNotBePlayed:"De video is niet beschikbaar of het formaat wordt niet ondersteund. Probeer een andere browser.",unauthorizedAccess:"Toegang geweigerd. Log in of neem contact op met de eigenaar om toegang te vragen.",unexpectedError:"Kan video niet laden. Probeer het later opnieuw.",paywallCtaButton:"Word nu lid",paywallDescription:"Meld je aan om deze video te bekijken"},Nc={play:"Spill av",pause:"Pause",seek:"S\xF8k",seekLabel:"{currentTime} av {duration}",currentTime:"N\xE5v\xE6rende tidspunkt",duration:"Varighet",volume:"Volum",mute:"Demp",unmute:"Sl\xE5 p\xE5 lyden",enterFullscreen:"Start fullskjermmodus",exitFullscreen:"Avslutt fullskjermmodus",settings:"Innstillinger",menuBack:"G\xE5 tilbake til forrige meny",speed:"Hastighet",normal:"Normal",quality:"Kvalitet",videoAbortedByUser:"Du avbr\xF8t medieavspillingen.",videoCouldNotBeAccessed:"Kunne ikke laste video. Sjekk tilkoblingen og pr\xF8v igjen.",videoCouldNotBeDecoded:"Videoen er utilgjengelig. Pr\xF8v \xE5 spille av noe annet.",videoCouldNotBePlayed:"Videoen er ikke tilgjengelig eller formatet st\xF8ttes ikke. Pr\xF8v en annen nettleser.",unauthorizedAccess:"Ingen tilgang. Logg p\xE5 eller be eieren om tilgang.",unexpectedError:"Kan ikke laste video. Pr\xF8v igjen senere.",paywallCtaButton:"Bli med n\xE5",paywallDescription:"Registrer deg for \xE5 se denne videoen"},Fc={play:"Reproduzir",pause:"Pausar",seek:"Procurar",seekLabel:"{currentTime} de {duration}",currentTime:"Hor\xE1rio atual",duration:"Dura\xE7\xE3o",volume:"Volume",mute:"Silenciar",unmute:"Ativar o som",enterFullscreen:"Abrir em tela cheia",exitFullscreen:"Sair da tela cheia",settings:"Configura\xE7\xF5es",menuBack:"Voltar ao menu anterior",speed:"Velocidade",normal:"Normal",quality:"Qualidade",videoAbortedByUser:"Voc\xEA abortou a reprodu\xE7\xE3o da m\xEDdia.",videoCouldNotBeAccessed:"N\xE3o foi poss\xEDvel carregar o v\xEDdeo. Verifique a conex\xE3o e tente novamente.",videoCouldNotBeDecoded:"O v\xEDdeo est\xE1 indispon\xEDvel. Tente reproduzir outra coisa.",videoCouldNotBePlayed:"O v\xEDdeo est\xE1 indispon\xEDvel ou o formato n\xE3o \xE9 aceito. Use outro browser.",unauthorizedAccess:"Acesso negado. Fa\xE7a o login ou solicite o acesso ao propriet\xE1rio.",unexpectedError:"N\xE3o foi poss\xEDvel carregar o v\xEDdeo. Tente novamente mais tarde.",paywallCtaButton:"Participe agora",paywallDescription:"Cadastre-se para ver este v\xEDdeo"},Mc={play:"Spela",pause:"Paus",seek:"S\xF6k",seekLabel:"{currentTime} av {duration}",currentTime:"Aktuell tid",duration:"L\xE4ngd",volume:"Volym",mute:"St\xE4ng av ljudet",unmute:"S\xE4tt p\xE5 ljudet",enterFullscreen:"\xD6ppna helsk\xE4rmsl\xE4ge",exitFullscreen:"L\xE4mna helsk\xE4rmsl\xE4ge",settings:"Inst\xE4llningar",menuBack:"G\xE5 tillbaka till f\xF6reg\xE5ende meny",speed:"Hastighet",normal:"Normal",quality:"Kvalitet",videoAbortedByUser:"Du avbr\xF6t medieuppspelningen.",videoCouldNotBeAccessed:"Det gick inte att l\xE4sa in videon. Kontrollera anslutningen och f\xF6rs\xF6k igen.",videoCouldNotBeDecoded:"Videon \xE4r inte tillg\xE4nglig. F\xF6rs\xF6k spela upp n\xE5got annat.",videoCouldNotBePlayed:"Videofilen \xE4r inte tillg\xE4nglig, eller s\xE5 st\xF6ds inte videoformatet. F\xF6rs\xF6k med en annan webbl\xE4sare.",unauthorizedAccess:"\xC5tkomst nekad. Logga in eller kontakta \xE4garen f\xF6r att beg\xE4ra \xE5tkomst.",unexpectedError:"Videon kunde inte l\xE4sas in. F\xF6rs\xF6k igen senare.",paywallCtaButton:"Registrera dig nu",paywallDescription:"Registrera dig f\xF6r att se den h\xE4r videon"},An,ra=(An={},F()(F()(F()(F()(F()(F()(F()(F()(F()(F()(An,St.DA,wc),St.DE,Ic),St.EN,kc),St.ES,Rc),St.FI,Cc),St.FR,Dc),St.IT,Pc),St.JA,_c),St.NL,Oc),St.NO,Nc),F()(F()(An,St.PT,Fc),St.SV,Mc)),Sn=St.EN;function aa(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(a,s).enumerable})),t.push.apply(t,i)}return t}function oa(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?aa(Object(t),!0).forEach(function(i){F()(a,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):aa(Object(t)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(t,i))})}return a}var Bc=function(e){var t=e.split("-"),i=t[0];return Object.values(St).find(function(s){return s===i})},Uc=function(e){var t;return e&&(t=Bc(e))!==null&&t!==void 0?t:Sn},$c=function(e){var t=ra[Sn];return oa(oa({},t),e)},Vc=function(e){var t=Uc(e),i=ra[t];return $c(i)},zi=function(){function a(){z()(this,a)}return te()(a,null,[{key:"createLoadingIndicatorElement",value:function(){var t=document.createElement("div");return t.classList.add(a.LoadingIndicatorClassName),t.appendChild(a.createLoadingIndicatorIcon()),t}},{key:"createLoadingIndicatorIcon",value:function(){var t="http://www.w3.org/2000/svg",i="50",s=document.createElementNS(t,"circle");s.setAttribute("cx",i),s.setAttribute("cy",i),s.setAttribute("r","20"),s.setAttribute("stroke","#fff"),s.setAttribute("stroke-width","6"),s.setAttribute("class",this.LoadingIndicatorPathClassName);var n=document.createElementNS(t,"svg");return n.setAttribute("viewBox","25 25 50 50"),n.setAttribute("class",this.LoadingIndicatorSpinnerClassName),n.appendChild(s),n}}])}();F()(zi,"LoadingIndicatorClassName","video-player__loading-indicator"),F()(zi,"LoadingIndicatorPathClassName","loading-indicator__path"),F()(zi,"LoadingIndicatorSpinnerClassName","loading-indicator__spinner");var la=function(){function a(e,t,i){z()(this,a),this.player=e,this.isExternalProvider=t,this.controls=i;var s=!t&&i.includes(Ut.LoadingIndicator);if(s){var n=e.elements.container;this.loadingIndicatorElement=zi.createLoadingIndicatorElement(),this.loadingIndicatorElement.classList.add(a.PlyrLoadingIndicatorClassName),n==null||n.appendChild(this.loadingIndicatorElement)}else this.loadingIndicatorElement=null}return te()(a,[{key:"destroy",value:function(){var t;(t=this.loadingIndicatorElement)===null||t===void 0||t.remove()}}])}();F()(la,"PlyrLoadingIndicatorClassName","video-player__plyr-loading-indicator");var ca=function(){function a(e){z()(this,a),F()(this,"loadingScreenClassName","video-player__loading-screen"),this.loadingScreenElement=this.createLoadingScreenElement(e)}return te()(a,[{key:"destroy",value:function(){var t;(t=this.loadingScreenElement)===null||t===void 0||t.remove()}},{key:"createLoadingScreenElement",value:function(t){var i=t.elements.container,s=document.createElement("div");return s.setAttribute("data-testid",a.TestId),s.classList.add(this.loadingScreenClassName),s.appendChild(zi.createLoadingIndicatorElement()),i==null||i.appendChild(s),s}}])}();F()(ca,"TestId","loading-screen");var ua=function(){function a(e,t,i){z()(this,a),this.element=document.createElement("button"),this.onCtaClick=i,this.element.classList.add(a.ClassName),this.element.innerText=t,this.subscribeEvents(),e==null||e.appendChild(this.element)}return te()(a,[{key:"destroy",value:function(){this.unsubscribeEvents(),this.element.remove()}},{key:"subscribeEvents",value:function(){this.element.addEventListener("click",this.onCtaClick)}},{key:"unsubscribeEvents",value:function(){this.element.removeEventListener("click",this.onCtaClick)}}])}();F()(ua,"ClassName","video-player__paywall-cta-button");var da=function(){function a(e,t){z()(this,a);var i=document.createElement("p");i.innerHTML=t,this.element=document.createElement("div"),this.element.classList.add(a.ClassName),this.element.appendChild(i),e==null||e.appendChild(this.element)}return te()(a,[{key:"destroy",value:function(){this.element.remove()}}])}();F()(da,"ClassName","video-player__paywall-description");var ha=function(){function a(e){z()(this,a);var t="lock",i="http://www.w3.org/2000/svg",s="video-player__icon",n=document.createElement("div"),r=document.createElementNS(i,"svg"),o=document.createElementNS(i,"use"),l="#".concat(s,"-").concat(t);n.classList.add(a.ClassName),"href"in o&&o.setAttributeNS("http://www.w3.org/1999/xlink","href",l),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l),r.appendChild(o),n.appendChild(r),this.element=n,e==null||e.appendChild(n)}return te()(a,[{key:"destroy",value:function(){this.element.remove()}}])}();F()(ha,"ClassName","video-player__lock-icon");var fa=function(){function a(e,t,i){z()(this,a),F()(this,"ctaButton",null),F()(this,"description",null),F()(this,"lockIcon",null),this.player=e,this.screenElement=this.createScreenElement();var s=e.config.i18n,n=s.paywallCtaButton,r=s.paywallDescription;this.createLockIcon(),this.createDescription(r),this.createCtaButton(i.onCtaClick,n),this.hideVideoPlayerControls(),t==null||t.appendChild(this.screenElement)}return te()(a,[{key:"destroy",value:function(){this.removeUIElements(),this.showVideoPlayerControls()}},{key:"createScreenElement",value:function(){var t=document.createElement("div");return t.classList.add(a.ClassName),t}},{key:"createLockIcon",value:function(){this.lockIcon=new ha(this.screenElement)}},{key:"createDescription",value:function(t){this.description=new da(this.screenElement,t)}},{key:"createCtaButton",value:function(t,i){this.ctaButton=new ua(this.screenElement,i,t)}},{key:"removeUIElements",value:function(){var t,i,s,n;(t=this.lockIcon)===null||t===void 0||t.destroy(),(i=this.description)===null||i===void 0||i.destroy(),(s=this.ctaButton)===null||s===void 0||s.destroy(),(n=this.screenElement)===null||n===void 0||n.remove()}},{key:"hideVideoPlayerControls",value:function(){var t=this.player.elements.controls;t==null||t.classList.add("video-player__controls--hidden"),this.player.toggleControls(!1)}},{key:"showVideoPlayerControls",value:function(){var t=this.player.elements.controls;t==null||t.classList.remove("video-player__controls--hidden")}}])}();F()(fa,"ClassName","video-player__paywall-screen");var ma={Small:{minWidth:0,className:"video-player"},Medium:{minWidth:480,className:"video-player--medium"},Large:{minWidth:768,className:"video-player--large"}},Gc=function(){function a(e,t){var i=this,s;z()(this,a),this.videoPlayerElement=e,this.getPlayerContainer=t,this.updateContainerClassNames(),this.videoObserver=new ResizeObserver(function(){i.updateContainerClassNames()}),(s=this.videoObserver)===null||s===void 0||s.observe(e)}return te()(a,[{key:"destroy",value:function(){var t;this.removeContainerClassNames(),(t=this.videoObserver)===null||t===void 0||t.disconnect()}},{key:"updateContainerClassNames",value:function(){var t,i=this,s=Object.values(ma),n=((t=this.getPlayerContainer())===null||t===void 0?void 0:t.clientWidth)||this.videoPlayerElement.clientWidth;s.forEach(function(r){var o=r.minWidth,l=r.className;n>=o?i.videoPlayerElement.classList.add(l):n<o&&i.videoPlayerElement.classList.remove(l)})}},{key:"removeContainerClassNames",value:function(){var t=this,i=Object.values(ma);i.forEach(function(s){var n=s.className;t.videoPlayerElement.classList.remove(n)})}}])}(),ga=767,fu=["only screen and (pointer: coarse) and (orientation: portrait) and (max-device-width: ".concat(ga,"px)"),"only screen and (pointer: coarse) and (orientation: landscape) and (max-device-height: ".concat(ga,"px)")].join(","),mu=function(){return window.matchMedia(mobileBreakpoints).matches},Hc=function(){function a(e,t){var i=this;z()(this,a),F()(this,"thumbnailFocalPointClassName","video-player__thumbnail--focal-point"),F()(this,"thumbnailYouTubeFailureClassName","video-player__thumbnail--youtube-failure"),this.player=e,e.once("ready",function(){i.thumbnailElement=e==null?void 0:e.elements.poster,t&&i.setFocalPoint(t),i.hideThumbnailOnYouTubeFailure()})}return te()(a,[{key:"destroy",value:function(){var t,i;(t=this.thumbnailElement)===null||t===void 0||t.classList.remove(this.thumbnailFocalPointClassName),(i=this.thumbnailElement)===null||i===void 0||i.classList.remove(this.thumbnailYouTubeFailureClassName),this.thumbnailElement=null}},{key:"setFocalPoint",value:function(t){this.thumbnailElement&&(this.thumbnailElement.classList.add(this.thumbnailFocalPointClassName),this.thumbnailElement.style.backgroundPosition=this.mapFocalPointToBackgroundPosition(t))}},{key:"mapFocalPointToBackgroundPosition",value:function(t){var i=t.x,s=t.y;return"".concat(i*100,"% ").concat(s*100,"%")}},{key:"hideThumbnailOnYouTubeFailure",value:function(){var t,i,s=((t=this.player)===null||t===void 0?void 0:t.provider)===Dt.YouTube,n=((i=this.player)===null||i===void 0?void 0:i.duration)===0;if(s&&n){var r;(r=this.thumbnailElement)===null||r===void 0||r.classList.add(this.thumbnailYouTubeFailureClassName)}}}])}(),_i=function(e){var t=e.detail.plyr;return t.currentTime||0},Oi=function(e){return e.detail.plyr.duration},Kc=function(e){var t=function(){var S;return e==null||(S=e.onReady)===null||S===void 0?void 0:S.call(e)},i=function(S){var L;return e==null||(L=e.onPlay)===null||L===void 0?void 0:L.call(e,_i(S),Oi(S))},s=function(S){var L;return e==null||(L=e.onPlaying)===null||L===void 0?void 0:L.call(e,_i(S),Oi(S))},n=function(S){var L;return e==null||(L=e.onTimeUpdate)===null||L===void 0?void 0:L.call(e,_i(S),Oi(S))},r=function(S){var L;return e==null||(L=e.onPause)===null||L===void 0?void 0:L.call(e,_i(S),Oi(S))},o=function(S){var L;return e==null||(L=e.onEnd)===null||L===void 0?void 0:L.call(e,_i(S),Oi(S))},l=function(S){var L,C=S.detail.plyr;e==null||(L=e.onError)===null||L===void 0||L.call(e,yt.fromPlayerMedia(C.media))},c=function(S){var L;return e==null||(L=e.onSeek)===null||L===void 0?void 0:L.call(e,_i(S),Oi(S))},h=function(S){var L,C=S.detail.plyr;e==null||(L=e.onSpeedChange)===null||L===void 0||L.call(e,C.speed)},f=function(S){var L,C=S.detail.plyr;e==null||(L=e.onVolumeChange)===null||L===void 0||L.call(e,C.volume,C.muted)},g=function(S){var L,C=S.detail.plyr;e==null||(L=e.onQualityChange)===null||L===void 0||L.call(e,C.quality)},y=function(){var S;return e==null||(S=e.onFullscreenEnter)===null||S===void 0?void 0:S.call(e)},v=function(){var S;return e==null||(S=e.onFullscreenExit)===null||S===void 0?void 0:S.call(e)};return{onReady:t,onPlay:i,onPlaying:s,onTimeUpdate:n,onPause:r,onEnded:o,onError:l,onSeeked:c,onRateChange:h,onVolumeChange:f,onQualityChange:g,onEnterFullscreen:y,onExitFullscreen:v}};function pa(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(a,s).enumerable})),t.push.apply(t,i)}return t}function ya(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?pa(Object(t),!0).forEach(function(i){F()(a,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):pa(Object(t)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(t,i))})}return a}var Xi=function(){function a(){z()(this,a)}return te()(a,null,[{key:"getOptions",value:function(){if(!a.isSupported())return null;var t=window.localStorage.getItem(a.StorageKey);return t?JSON.parse(t):null}},{key:"setOption",value:function(t,i){if(a.isSupported()){var s=a.getOptions(),n=ya(ya({},s),{},F()({},t,i));window.localStorage.setItem(a.StorageKey,JSON.stringify(n))}}},{key:"isSupported",value:function(){try{if(!window.localStorage)return!1;var t="is_supported_test";return window.localStorage.setItem(t,t),window.localStorage.removeItem(t),!0}catch{return!1}}}])}();F()(Xi,"StorageKey","squarespace-video-player-options");var jc=function(){function a(e,t){var i=this;z()(this,a),F()(this,"containerClassName","video-player__container--click-to-play"),t.clickToPlay&&(this.plyrContainer=e==null?void 0:e.elements.container,e.once("ready",function(){i.setContainerClassName()}))}return te()(a,[{key:"destroy",value:function(){this.removeContainerClassName()}},{key:"setContainerClassName",value:function(){var t;(t=this.plyrContainer)===null||t===void 0||t.classList.add(this.containerClassName)}},{key:"removeContainerClassName",value:function(){var t;(t=this.plyrContainer)===null||t===void 0||t.classList.remove(this.containerClassName)}}])}(),Wc=`
  <symbol id="video-player__icon-backward" viewBox="0 0 72 72">
    <path d="M23.2519 58H31.1519V56.04H28.5919V43.64H26.4919C26.3919 44.48 26.0519 45 25.4519 45.34C24.8919 45.64 24.1319 45.84 23.0519 45.86V47.72H26.1519V56.04H23.2519V58ZM38.14 43.42C34.08 43.42 33.1 47 33.1 50.88C33.1 55.12 34.18 58.3 38.16 58.3C42.12 58.3 43.22 55.12 43.22 50.88C43.22 47 42.24 43.42 38.14 43.42ZM38.16 45.62C40.18 45.62 40.6 48 40.6 50.88C40.6 53.98 40.1 56.2 38.16 56.2C36.22 56.2 35.72 53.98 35.72 50.9C35.72 48 36.12 45.62 38.16 45.62Z" fill="white"/>
    <path d="M53 10L53 37L31 23.498L53 10Z" fill="white"/>
    <path d="M31 10L31 37L9 23.498L31 10Z" fill="white"/>
  </symbol>
`,Yc=`
  <symbol id="video-player__icon-enter-fullscreen" viewBox="0 0 24 24">
    <path fill="currentColor" d="m4,4l6,0l0,2l-4,0l0,4l-2,0l0,-6z" />
    <path fill="currentColor" d="m20,4l-6,0l0,2l4,0l0,4l2,0l0,-6z" />
    <path fill="currentColor" d="m10,20l-6,0l0,-6l2,0l0,4l4,0l0,2z" />
    <path fill="currentColor" d="m20,20l-6,0l0,-2l4,0l0,-4l2,0l0,6z" />
    <path stroke-opacity="0.15" stroke="black" d="m4,4l6,0l0,2l-4,0l0,4l-2,0l0,-6z" />
    <path stroke-opacity="0.15" stroke="black" d="m20,4l-6,0l0,2l4,0l0,4l2,0l0,-6z" />
    <path stroke-opacity="0.15" stroke="black" d="m10,20l-6,0l0,-6l2,0l0,4l4,0l0,2z" />
    <path stroke-opacity="0.15" stroke="black" d="m20,20l-6,0l0,-2l4,0l0,-4l2,0l0,6z" />
  </symbol>
`,qc=`
  <symbol id="video-player__icon-exit-fullscreen" viewBox="0 0 24 24">
    <path fill="currentColor" d="m10,10l-6,0l0,-2l4,0l0,-4l2,0l0,6z" />
    <path fill="currentColor" d="m14,10l6,0l0,-2l-4,0l0,-4l-2,0l0,6z" />
    <path fill="currentColor" d="m4,14l6,0l0,6l-2,0l0,-4l-4,0l0,-2z" />
    <path fill="currentColor" d="m14,14l6,0l0,2l-4,0l0,4l-2,0l0,-6z" />
    <path stroke-opacity="0.15" stroke="black" d="m10,10l-6,0l0,-2l4,0l0,-4l2,0l0,6z" />
    <path stroke-opacity="0.15" stroke="black" d="m14,10l6,0l0,-2l-4,0l0,-4l-2,0l0,6z" />
    <path stroke-opacity="0.15" stroke="black" d="m4,14l6,0l0,6l-2,0l0,-4l-4,0l0,-2z" />
    <path stroke-opacity="0.15" stroke="black" d="m14,14l6,0l0,2l-4,0l0,4l-2,0l0,-6z" />
  </symbol>
`,zc=`
  <symbol id="video-player__icon-forward" viewBox="0 0 72 72">
    <path d="M23.2519 58H31.1519V56.04H28.5919V43.64H26.4919C26.3919 44.48 26.0519 45 25.4519 45.34C24.8919 45.64 24.1319 45.84 23.0519 45.86V47.72H26.1519V56.04H23.2519V58ZM38.14 43.42C34.08 43.42 33.1 47 33.1 50.88C33.1 55.12 34.18 58.3 38.16 58.3C42.12 58.3 43.22 55.12 43.22 50.88C43.22 47 42.24 43.42 38.14 43.42ZM38.16 45.62C40.18 45.62 40.6 48 40.6 50.88C40.6 53.98 40.1 56.2 38.16 56.2C36.22 56.2 35.72 53.98 35.72 50.9C35.72 48 36.12 45.62 38.16 45.62Z" fill="white"/>
    <path d="M13 37V10L35 23.502L13 37Z" fill="white"/>
    <path d="M35 37V10L57 23.502L35 37Z" fill="white"/>
  </symbol>
`,Xc=`
  <symbol id="video-player__icon-muted" viewBox="0 0 24 24">
    <path fill-rule="evenodd" clip-rule="evenodd" d="M15 21L16 23H18.2417L7.25 1H5L7.90476 6.80952L6 8H1V16H6L14 21H15ZM8.73495 8.46989L13 17V18.1957L7 14.4457V9.55423L8.73495 8.46989ZM3 10V14H5V10H3Z" fill="currentColor" />
    <path d="M11.3386 4.66339L12.1683 6.32406L13 5.80423V7.98874L15 11.9917V3H14L11.3386 4.66339Z" fill="currentColor" />
    <path d="M17.9634 17.9231L17.0026 16C19.2106 15.9986 21 14.2083 21 12C21 9.79086 19.2091 8 17 8V6C20.3137 6 23 8.68629 23 12C23 14.9858 20.8191 17.4621 17.9634 17.9231Z" fill="currentColor" />
    <path d="M19 12C19 10.8954 18.1046 10 17 10V14C18.1046 14 19 13.1046 19 12Z" fill="currentColor" />
    <path fill-rule="evenodd" clip-rule="evenodd" d="M15 21L16 23H18.2417L7.25 1H5L7.90476 6.80952L6 8H1V16H6L14 21H15ZM8.73495 8.46989L13 17V18.1957L7 14.4457V9.55423L8.73495 8.46989ZM3 10V14H5V10H3Z" stroke="black" stroke-opacity="0.15" />
    <path d="M11.3386 4.66339L12.1683 6.32406L13 5.80423V7.98874L15 11.9917V3H14L11.3386 4.66339Z" stroke="black" stroke-opacity="0.15" />
    <path d="M17.9634 17.9231L17.0026 16C19.2106 15.9986 21 14.2083 21 12C21 9.79086 19.2091 8 17 8V6C20.3137 6 23 8.68629 23 12C23 14.9858 20.8191 17.4621 17.9634 17.9231Z" stroke="black" stroke-opacity="0.15" />
    <path d="M19 12C19 10.8954 18.1046 10 17 10V14C18.1046 14 19 13.1046 19 12Z" stroke="black" stroke-opacity="0.15" />
  </symbol>
`,Qc=`
  <symbol id="video-player__icon-pause" viewBox="0 0 72 72">
    <path d="M42.0469 16.042H54V57.9482H42.0469V16.042ZM18 57.9482V16.042H29.9531V57.9482H18Z" />
  </symbol>
`,Zc=`
  <symbol id="video-player__icon-play" viewBox="0 0 72 72">
    <path d="M24.2842 54.7435V17.2559L55.5238 36.0025L24.2842 54.7435Z" />
  </symbol>
`,Jc=`
  <symbol id="video-player__icon-replay" viewBox="0 0 72 72">
    <path d="M19.9587 31.6466C22.5091 25.0906 29.0569 19.8821 36.4712 19.8822C45.9757 19.8823 54.1177 27.9446 54.1178 37.5288C54.1179 47.1225 46.0033 55.1756 36.4712 55.1754C31.8366 55.1754 27.2731 53.2868 23.9932 50.0069L19.8338 54.1662C24.2174 58.5498 30.2773 61.0576 36.4712 61.0576C49.238 61.0578 60.0001 50.3851 60 37.5288C59.9999 24.6779 49.2063 14.0001 36.4712 14C27.6621 13.9999 19.9161 19.3001 15.8864 26.5302V14L9.99999 19.8822L9.99999 37.533L27.6508 37.5288L33.533 31.6466H19.9587Z" />
  </symbol>
`,eu=`
  <symbol id="video-player__icon-settings" viewBox="0 0 24 24">
    <path stroke-opacity="0.15" stroke="black" fill="currentColor" d="m16.1918,6.39334c-0.9162,-0.68607 -2.0061,-1.15284 -3.1918,-1.32245l0,-2.07089l-2,0l0,2.07089c-1.18575,0.16961 -2.27564,0.63638 -3.19181,1.32245l-1.46429,-1.46429l-1.41421,1.41421l1.4642,1.4642c-0.68637,0.91632 -1.15335,2.00648 -1.323,3.19254l-2.07089,0l0,2l2.07089,0c0.16965,1.1861 0.63661,2.2762 1.32297,3.1925l-1.46432,1.4643l1.41421,1.4142l1.46441,-1.4644c0.91618,0.6861 2.00608,1.1529 3.19184,1.3225l0,2.0709l2,0l0,-2.0709c1.1858,-0.1696 2.2758,-0.6364 3.192,-1.3226l1.4645,1.4645l1.4142,-1.4142l-1.4645,-1.4644c0.6863,-0.9163 1.1533,-2.0064 1.3229,-3.1924l2.0709,0l0,-2l-2.0709,0c-0.1696,-1.18606 -0.6366,-2.27622 -1.323,-3.19254l1.4644,-1.46443l-1.4142,-1.41421l-1.4645,1.46452zm-4.1918,10.60666c2.7614,0 5,-2.2386 5,-5c0,-2.76142 -2.2386,-5 -5,-5c-2.76142,0 -5,2.23858 -5,5c0,2.7614 2.23858,5 5,5z" clip-rule="evenodd" fill-rule="evenodd" />
  </symbol>
`,tu=`
  <symbol id="video-player__icon-volume" viewBox="0 0 24 24">
    <path fill="currentColor" d="m15,21l0,-18l-1,0l-8,5l-5,0l0,8l5,0l8,5l1,0zm-8,-6.5543l0,-4.89147l6,-3.75l0,12.39147l-6,-3.75zm-4,-4.4457l0,4l2,0l0,-4l-2,0z" clip-rule="evenodd" fill-rule="evenodd" />
    <path fill="currentColor" d="m17,8c2.2091,0 4,1.79086 4,4c0,2.2091 -1.7909,4 -4,4l0,2c3.3137,0 6,-2.6863 6,-6c0,-3.31371 -2.6863,-6 -6,-6l0,2z" />
    <path fill="currentColor" d="m19,12c0,-1.10457 -0.8954,-2 -2,-2l0,4c1.1046,0 2,-0.8954 2,-2z" />
    <path stroke-opacity="0.15" stroke="black" d="m15,21l0,-18l-1,0l-8,5l-5,0l0,8l5,0l8,5l1,0zm-8,-6.5543l0,-4.89147l6,-3.75l0,12.39147l-6,-3.75zm-4,-4.4457l0,4l2,0l0,-4l-2,0z" clip-rule="evenodd" fill-rule="evenodd" />
    <path stroke-opacity="0.15" stroke="black" d="m17,8c2.2091,0 4,1.79086 4,4c0,2.2091 -1.7909,4 -4,4l0,2c3.3137,0 6,-2.6863 6,-6c0,-3.31371 -2.6863,-6 -6,-6l0,2z" />
    <path stroke-opacity="0.15" stroke="black" d="m19,12c0,-1.10457 -0.8954,-2 -2,-2l0,4c1.1046,0 2,-0.8954 2,-2z" />
  </symbol>
`,iu=`
  <symbol id="video-player__icon-lock" viewBox="0 0 21 26">
    <path d="M9.1875 15.6V20.8H11.8125V15.6H9.1875Z" fill="white"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M3.9375 6.5V10.4H0V26H21V10.4H17.0625V6.5C17.0625 2.91015 14.1244 0 10.5 0C6.87563 0 3.9375 2.91015 3.9375 6.5ZM10.5 2.6C8.32538 2.6 6.5625 4.34609 6.5625 6.5V10.4H14.4375V6.5C14.4375 4.34609 12.6746 2.6 10.5 2.6ZM2.625 13V23.4H18.375V13H2.625Z" fill="white"/>
  </symbol>
`,su=`
  <?xml version="1.0" encoding="UTF-8"?>
  <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    `.concat(Wc,`
    `).concat(Yc,`
    `).concat(qc,`
    `).concat(zc,`
    `).concat(Xc,`
    `).concat(Qc,`
    `).concat(Jc,`
    `).concat(Zc,`
    `).concat(eu,`
    `).concat(tu,`
    `).concat(iu,`
  </svg>
`),nu=function(){function a(e,t){z()(this,a),F()(this,"iconsClassName","video-player__icons"),F()(this,"iconsElement",null);var i=t.length>0;i&&(this.iconsElement=this.createIconSpriteElement(),e.appendChild(this.iconsElement))}return te()(a,[{key:"destroy",value:function(){var t;(t=this.iconsElement)===null||t===void 0||t.remove()}},{key:"createIconSpriteElement",value:function(){var t=document.createElement("div");return t.classList.add(this.iconsClassName),t.innerHTML=su,t}}])}(),va=function(){function a(e,t){z()(this,a),F()(this,"className","video-player__navigation-indicator"),F()(this,"showClassName","".concat(this.className,"--show"));var i="http://www.w3.org/2000/svg",s="video-player__icon",n=document.createElement("div"),r=document.createElementNS(i,"svg"),o=document.createElementNS(i,"use"),l="#".concat(s,"-").concat(e),c="".concat(this.className,"--").concat(e);n.classList.add(this.className,c),"href"in o&&o.setAttributeNS("http://www.w3.org/1999/xlink","href",l),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l),r.appendChild(o),n.appendChild(r),this.element=n,t.appendChild(n)}return te()(a,[{key:"show",value:function(){this.element.classList.add(this.showClassName)}},{key:"hide",value:function(){this.element.classList.remove(this.showClassName)}}])}(),ba=function(a){return a.Backward="backward",a.Forward="forward",a}({}),ru=function(){function a(e,t,i){var s=this,n,r;z()(this,a),F()(this,"navigationIndicatorsClassName","video-player__navigation-indicators"),F()(this,"hideIndicatorTimeoutMs",1e3),F()(this,"navigationIndicatorsElement",null),F()(this,"backwardNavigationIndicator",null),F()(this,"forwardNavigationIndicator",null),F()(this,"plyrContainer",null),F()(this,"toggleNavigationIndicatorListener",function(h){var f=h.key;if(s.player.seeking)switch(f){case"ArrowLeft":s.handleBackwardNavigationIndicator();break;case"ArrowRight":s.handleForwardNavigationIndicator();break}}),this.player=e;var o=t.includes(Ut.NavigationIndicators),l=!!(!((n=i.keyboard)===null||n===void 0)&&n.focused||!((r=i.keyboard)===null||r===void 0)&&r.global);if(o&&l){var c;this.plyrContainer=e.elements.container,this.navigationIndicatorsElement=this.createNavigationIndicatorsElement(),(c=this.plyrContainer)===null||c===void 0||c.appendChild(this.navigationIndicatorsElement),this.subscribeEvents()}}return te()(a,[{key:"destroy",value:function(){var t;this.unsubscribeEvents(),(t=this.navigationIndicatorsElement)===null||t===void 0||t.remove()}},{key:"createNavigationIndicatorsElement",value:function(){var t=document.createElement("div");return t.classList.add(this.navigationIndicatorsClassName),this.createNavigationIndicators(t),t}},{key:"createNavigationIndicators",value:function(t){this.backwardNavigationIndicator=new va(ba.Backward,t),this.forwardNavigationIndicator=new va(ba.Forward,t)}},{key:"subscribeEvents",value:function(){var t;(t=this.plyrContainer)===null||t===void 0||t.addEventListener("keydown",this.toggleNavigationIndicatorListener)}},{key:"unsubscribeEvents",value:function(){var t;(t=this.plyrContainer)===null||t===void 0||t.removeEventListener("keydown",this.toggleNavigationIndicatorListener)}},{key:"handleBackwardNavigationIndicator",value:function(){var t,i,s=this;window.clearTimeout(this.hideIndicatorTimer),(t=this.forwardNavigationIndicator)===null||t===void 0||t.hide(),(i=this.backwardNavigationIndicator)===null||i===void 0||i.show(),this.hideIndicatorTimer=window.setTimeout(function(){var n;return(n=s.backwardNavigationIndicator)===null||n===void 0?void 0:n.hide()},this.hideIndicatorTimeoutMs)}},{key:"handleForwardNavigationIndicator",value:function(){var t,i,s=this;window.clearTimeout(this.hideIndicatorTimer),(t=this.backwardNavigationIndicator)===null||t===void 0||t.hide(),(i=this.forwardNavigationIndicator)===null||i===void 0||i.show(),this.hideIndicatorTimer=window.setTimeout(function(){var n;return(n=s.forwardNavigationIndicator)===null||n===void 0?void 0:n.hide()},this.hideIndicatorTimeoutMs)}}])}(),au=function(){function a(e,t){z()(this,a),this.onHeightUpdated=t;var i=e.elements.controls;i&&(this.controlsObserver=this.observeControls(i),this.updateHeight(i))}return te()(a,[{key:"destroy",value:function(){var t;(t=this.controlsObserver)===null||t===void 0||t.disconnect()}},{key:"observeControls",value:function(t){var i=this,s=new ResizeObserver(function(){return i.updateHeight(t)});return s.observe(t),s}},{key:"updateHeight",value:function(t){var i=function(o){var l=window.getComputedStyle(o);return l.display!=="none"&&l.visibility!=="hidden"},s=Array.from(t.querySelectorAll(".plyr__controls__item")).filter(i).map(function(r){return t.clientHeight-r.offsetTop}),n=Math.max.apply(Math,Be()(s));this.onHeightUpdated(n)}}])}(),ou=function(){function a(e){z()(this,a),this.player=e}return te()(a,[{key:"destroy",value:function(){this.updateStyles({transform:"",bottom:"",skipTransition:!0})}},{key:"updateHeight",value:function(t){this.updateStyles({transform:"translateY(-".concat(t,"px)"),bottom:"-".concat(t,"px"),skipTransition:!0})}},{key:"updateStyles",value:function(t){var i=this.player.elements.controls;if(i){var s=function(){return i.offsetHeight},n=i.style.transition;t.skipTransition&&(i.style.transition="none"),i.style.transform=t.transform,i.style.bottom=t.bottom,t.skipTransition&&(s(),i.style.transition=n)}}}])}(),Ta=function(){function a(e,t){z()(this,a);var i=t.length>0,s=e.elements.controls;i&&e.elements.container&&s&&(this.blockerElement=this.createBlockerElement(),e.elements.container.appendChild(this.blockerElement))}return te()(a,[{key:"destroy",value:function(){var t;(t=this.blockerElement)===null||t===void 0||t.remove()}},{key:"updateHeight",value:function(t){this.blockerElement&&(this.blockerElement.style.height="".concat(t,"px"))}},{key:"createBlockerElement",value:function(){var t=document.createElement("div");return t.classList.add(a.blockerClassName),t}}])}();F()(Ta,"blockerClassName","video-player__controls-blocker");var Ea=function(){function a(e){var t,i=this;z()(this,a),F()(this,"observers",[]);var s=e.elements.settings.popup;if(s){var n=(t=e.elements.settings.buttons.speed)===null||t===void 0?void 0:t.querySelector(".plyr__menu__value"),r=[].concat(Be()(Array.from(s.querySelectorAll(a.SpeedLabelsSelector))),Be()(n?[n]:[]));r.forEach(function(o){return i.formatElement(o)}),this.observers=r.map(function(o){return i.observeLabel(o)})}}return te()(a,[{key:"destroy",value:function(){this.observers.forEach(function(t){return t.disconnect()}),this.observers=[]}},{key:"formatElement",value:function(t){var i=this.format(t.textContent);i!==t.textContent&&(t.textContent=i)}},{key:"format",value:function(t){return t&&t.slice(-1)==="\xD7"?"".concat(parseFloat(t),"x"):t}},{key:"observeLabel",value:function(t){var i=this,s=new MutationObserver(function(){return i.formatElement(t)});return s.observe(t,{characterData:!1,attributes:!1,childList:!0,subtree:!1}),s}}])}();F()(Ea,"SpeedLabelsSelector","button[data-plyr=speed] > span");var lu=function(){function a(e,t,i){var s=this,n,r;z()(this,a),F()(this,"hideVolumeTimeoutMs",1e3),F()(this,"showVolumeSliderClassName","video-player__volume--menu-open"),F()(this,"setFocusOnContainer",function(){var h;return(h=s.player.elements.container)===null||h===void 0?void 0:h.focus()}),this.player=e;var o=i.includes(Ut.Volume),l=!!(!((n=t.keyboard)===null||n===void 0)&&n.focused||!((r=t.keyboard)===null||r===void 0)&&r.global);if(o&&l){var c;this.player.on("volumechange",function(){return s.showVolumeOnChange()}),(c=this.player.elements.inputs.volume)===null||c===void 0||c.addEventListener("click",this.setFocusOnContainer)}}return te()(a,[{key:"destroy",value:function(){var t;(t=this.player.elements.inputs.volume)===null||t===void 0||t.removeEventListener("click",this.setFocusOnContainer),this.clearHideTimeout()}},{key:"clearHideTimeout",value:function(){this.hideTimeout!==void 0&&window.clearTimeout(this.hideTimeout),this.hideTimeout=void 0}},{key:"showVolumeOnChange",value:function(){var t=this;this.isMuted()||(this.isSliderVisible()&&this.hideTimeout!==void 0||!this.isSliderVisible())&&(this.clearHideTimeout(),this.hideTimeout=window.setTimeout(function(){return t.hideVolumeSlider()},this.hideVolumeTimeoutMs),this.showVolumeSlider())}},{key:"isMuted",value:function(){return this.player.muted}},{key:"isSliderVisible",value:function(){var t,i=this.player.elements.inputs.volume;return!!(i&&window.getComputedStyle(i).visibility==="visible"||!((t=this.player.elements.container)===null||t===void 0)&&t.classList.contains(this.showVolumeSliderClassName))}},{key:"showVolumeSlider",value:function(){if(!this.isSliderVisible()){var t,i;this.player.toggleControls(!1),(t=this.player.elements.buttons.mute)===null||t===void 0||t.focus(),(i=this.player.elements.container)===null||i===void 0||i.classList.add(this.showVolumeSliderClassName)}}},{key:"hideVolumeSlider",value:function(){if(this.clearHideTimeout(),this.isSliderVisible()){var t;this.setFocusOnContainer(),(t=this.player.elements.container)===null||t===void 0||t.classList.remove(this.showVolumeSliderClassName)}}}])}(),cu=function(){function a(e,t,i,s,n){var r=this;z()(this,a),F()(this,"unsubscribeFocusOnPlyrContainer",function(){var o=r.getPlayButtons();o==null||o.forEach(function(l){return l.removeEventListener("click",r.focusOnPlyrContainerListener)})}),F()(this,"focusOnPlyrContainerListener",function(){var o;return(o=r.player.elements.container)===null||o===void 0?void 0:o.focus()}),this.player=e,this.plyrOptions=t,this.videoPlayerControls=i,this.videoPlayerElement=s,this.isExternalProvider=n,this.icons=new nu(s,i),this.plyrLoadingIndicator=new la(e,n,i),this.volumeSliderToggler=new lu(e,t,i),this.speedLabelsFormatter=new Ea(e),this.controlsInteractionBlocker=new Ta(e,i),this.controlsHideOffsetSetter=new ou(e),this.controlsHeightObserver=new au(e,function(o){var l,c;(l=r.controlsInteractionBlocker)===null||l===void 0||l.updateHeight(o),(c=r.controlsHideOffsetSetter)===null||c===void 0||c.updateHeight(o)}),this.clickToPlay=new jc(e,t),this.vimeoPlayButton=new Lc(e,s),e.once("ready",function(){r.movePlayButtonAsTheFirstUIElement(),r.togglePlayButtonIcon(),r.navigationIndicators=new ru(e,i,t)})}return te()(a,[{key:"destroy",value:function(){var t,i,s,n,r,o,l,c,h;(t=this.clickToPlay)===null||t===void 0||t.destroy(),(i=this.controlsInteractionBlocker)===null||i===void 0||i.destroy(),(s=this.controlsHideOffsetSetter)===null||s===void 0||s.destroy(),(n=this.controlsHeightObserver)===null||n===void 0||n.destroy(),(r=this.icons)===null||r===void 0||r.destroy(),(o=this.plyrLoadingIndicator)===null||o===void 0||o.destroy(),(l=this.volumeSliderToggler)===null||l===void 0||l.destroy(),(c=this.speedLabelsFormatter)===null||c===void 0||c.destroy(),(h=this.navigationIndicators)===null||h===void 0||h.destroy(),this.vimeoPlayButton.destroy(),this.unsubscribeFocusOnPlyrContainer()}},{key:"movePlayButtonAsTheFirstUIElement",value:function(){var t="plyr__control--overlaid",i=this.getPlayButtons(),s=i==null?void 0:i.find(function(o){return o.classList.contains(t)}),n=this.player.elements.container,r=this.player.elements.controls;s&&(n==null||n.insertBefore(s,r))}},{key:"togglePlayButtonIcon",value:function(){var t=this,i=this.getPlayButtons();if(this.player&&i){var s=function(o,l){var c=o.querySelector("use");c&&c.setAttribute("href","#video-player__icon-".concat(l))},n=function(o){return i.forEach(function(l){return s(l,o)})};this.player.on("play",function(){return n("pause")}),this.player.on("pause",function(){return n("play")}),this.player.on("seeking",function(){return t.player.playing?n("pause"):n("play")}),this.player.on("ended",function(){return n("replay")}),this.subscribeFocusOnPlyrContainer(i)}}},{key:"getPlayButtons",value:function(){var t,i=(t=this.player)===null||t===void 0?void 0:t.elements.buttons.play;return i?Array.isArray(i)?i:[i]:null}},{key:"subscribeFocusOnPlyrContainer",value:function(t){var i=this;t.forEach(function(s){return s.addEventListener("click",i.focusOnPlyrContainerListener)})}}])}(),uu=oe(305170),du=function(){function a(){z()(this,a)}return te()(a,null,[{key:"getSessionId",value:function(){if(!a.sessionId){var t,i=Xi.getOptions();a.sessionId=(t=i==null?void 0:i.sessionId)!==null&&t!==void 0?t:a.createSessionId()}return a.sessionId}},{key:"createSessionId",value:function(){var t=(0,uu.Z)();return Xi.setOption("sessionId",t),t}}])}();function Aa(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(a,s).enumerable})),t.push.apply(t,i)}return t}function hu(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Aa(Object(t),!0).forEach(function(i){F()(a,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):Aa(Object(t)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(t,i))})}return a}var xn=function(){function a(e,t){var i=this,s;z()(this,a),F()(this,"thumbnail",null),F()(this,"ui",null),F()(this,"playbackDriver",null),F()(this,"embedAspectRatio",null),F()(this,"videoPlayerErrorHandler",null),F()(this,"videoProvider",null),F()(this,"loadingScreen",null),F()(this,"paywall",null),this.videoPlayerElement=e;var n=Date.now(),r=du.getSessionId(),o=t.environment,l=t.src,c=t.options,h=t.thumbnailSrc,f=t.events;this.videoPlayerElement.videoPlayer=this,this.breakpointsSetter=new Gc(this.videoPlayerElement,function(){var A,S;return(A=(S=i.player)===null||S===void 0?void 0:S.elements.container)!==null&&A!==void 0?A:null});var g=this.createVideoElement(e,c),y=(s=c==null?void 0:c.controls)!==null&&s!==void 0?s:a.DefaultControls,v=this.createPlyrOptions(hu({controls:y},c));this.player=new(Ni())(g,v);try{if(!o)throw new yt(j.InvalidConfiguration,"You must provide 'environment' in the configuration.");if(!l||l.trim().length===0)throw new yt(j.InvalidConfiguration,"You must provide 'src' in the configuration.");this.videoPlayerErrorHandler=new ta(this.player,this.isExternalProvider),this.videoProvider=xc(l,g),this.playbackDriver=Ac(this.videoProvider,{videoElement:g,src:l,thumbnailSrc:h,player:this.player,errorHandler:this.videoPlayerErrorHandler,onUnauthorizedError:c!=null&&c.paywall?function(){return i.showPaywall(c==null?void 0:c.paywall,f)}:null}),this.embedAspectRatio=new Fi(e,this.player,this.isExternalProvider),this.thumbnail=new Hc(this.player,c==null?void 0:c.thumbnailFocalPoint),this.ui=new cu(this.player,v,si[y],e,this.isExternalProvider),this.isLoading=!0,this.player.once("ready",function(){i.setDefaultSpeed(v)}),this.subscribeEvents(f),this.onReady().then(function(){i.isLoading=!1})}catch(A){this.videoPlayerErrorHandler||(this.videoPlayerErrorHandler=new ta(this.player,this.isExternalProvider)),this.videoPlayerErrorHandler.handleError(A)}}return te()(a,[{key:"speed",set:function(t){this.player&&(this.player.speed=t)}},{key:"thumbnailFocalPoint",set:function(t){this.thumbnail&&this.thumbnail.setFocalPoint(t)}},{key:"isLoading",set:function(t){if(t)this.loadingScreen===null&&(this.loadingScreen=this.player?new ca(this.player):null);else{var i;(i=this.loadingScreen)===null||i===void 0||i.destroy(),this.loadingScreen=null}}},{key:"currentTime",get:function(){var t;return((t=this.player)===null||t===void 0?void 0:t.currentTime)||0},set:function(t){this.player&&(this.player.currentTime=t)}},{key:"duration",get:function(){var t;return((t=this.player)===null||t===void 0?void 0:t.duration)||0}},{key:"isMuted",get:function(){var t;return((t=this.player)===null||t===void 0?void 0:t.muted)||!1}},{key:"volume",get:function(){var t;return((t=this.player)===null||t===void 0?void 0:t.volume)||0}},{key:"isPlaying",get:function(){var t;return((t=this.player)===null||t===void 0?void 0:t.playing)||!1}},{key:"isPaused",get:function(){var t;return((t=this.player)===null||t===void 0?void 0:t.paused)||!1}},{key:"isEnded",get:function(){var t;return((t=this.player)===null||t===void 0?void 0:t.ended)||!1}},{key:"isExternalProvider",get:function(){return this.videoProvider?Object.values(bi).includes(this.videoProvider):!1}},{key:"destroy",value:function(){var t=this,i,s,n,r,o,l,c,h,f=function(){t.player=null};(i=this.ui)===null||i===void 0||i.destroy(),this.ui=null,(s=this.playbackDriver)===null||s===void 0||s.destroy(),this.playbackDriver=null,(n=this.thumbnail)===null||n===void 0||n.destroy(),(r=this.paywall)===null||r===void 0||r.destroy(),(o=this.embedAspectRatio)===null||o===void 0||o.destroy(),(l=this.videoPlayerErrorHandler)===null||l===void 0||l.destroy(),this.isLoading=!1,(c=this.player)===null||c===void 0||c.destroy(function(){var g=this;g.remove(),f()}),(h=this.breakpointsSetter)===null||h===void 0||h.destroy(),this.breakpointsSetter=null,this.videoPlayerElement.videoPlayer=null}},{key:"onReady",value:function(){var e=Ne()(Fe().mark(function i(){var s;return Fe().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.onPlayer("ready");case 2:return r.next=4,(s=this.playbackDriver)===null||s===void 0?void 0:s.onReady();case 4:case"end":return r.stop()}},i,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"onLoadedData",value:function(){var e=Ne()(Fe().mark(function i(){return Fe().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.onPlayer("loadeddata");case 2:case"end":return n.stop()}},i,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"onPlayer",value:function(){var e=Ne()(Fe().mark(function i(s){var n;return Fe().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(n=this.player,n){o.next=3;break}return o.abrupt("return",Promise.reject());case 3:return o.abrupt("return",new Promise(function(l){n.once(s,function(){return l()})}));case 4:case"end":return o.stop()}},i,this)}));function t(i){return e.apply(this,arguments)}return t}()},{key:"createVideoElement",value:function(t,i){var s=document.createElement("video");return s.setAttribute("playsinline",""),s.setAttribute("webkit-playsinline",""),i!=null&&i.loop&&s.setAttribute("loop",""),i!=null&&i.muted&&s.setAttribute("muted",""),i!=null&&i.autoPlay&&s.setAttribute("autoplay",""),t.appendChild(s),s}},{key:"createPlyrOptions",value:function(t){var i,s,n,r,o,l,c,h,f=t!=null&&t.controls?this.mapToPlyrControlNames(si[t.controls]):[],g=[Le.Speed],y={enabled:(i=t==null?void 0:t.storage)!==null&&i!==void 0?i:!0,key:Xi.StorageKey},v=this.getSelectedSpeed(y.enabled,t==null?void 0:t.speed);return{speed:{selected:v,options:Be()(vi)},volume:(s=t==null?void 0:t.volume)!==null&&s!==void 0?s:1,muted:(n=t==null?void 0:t.muted)!==null&&n!==void 0?n:!1,clickToPlay:(r=t==null?void 0:t.clickToPlay)!==null&&r!==void 0?r:!0,autoplay:(o=t==null?void 0:t.autoPlay)!==null&&o!==void 0?o:!1,loop:{active:(l=t==null?void 0:t.loop)!==null&&l!==void 0?l:!1},fullscreen:{enabled:(c=t==null?void 0:t.fullscreen)!==null&&c!==void 0?c:!0,iosNative:!0},controls:f,i18n:Vc(t==null?void 0:t.language),keyboard:{focused:(h=t==null?void 0:t.keyboard)!==null&&h!==void 0?h:!0},captions:{active:!1,update:!1},storage:y,loadSprite:!1,iconPrefix:"video-player__icon",blankVideo:Qi,settings:g,vimeo:{controls:!0}}}},{key:"showPaywall",value:function(t,i){if(this.player&&t){var s=function(){var r;i==null||(r=i.onPaywallCtaClick)===null||r===void 0||r.call(i),t==null||t.onCtaClick()};this.createPaywall({onCtaClick:s}),this.isLoading=!1}}},{key:"createPaywall",value:function(t){this.player&&(this.paywall=new fa(this.player,this.videoPlayerElement,t))}},{key:"getSelectedSpeed",value:function(t,i){if(t){var s,n=Xi.getOptions(),r=n&&Number(n.speed)&&(s=n.speed)!==null&&s!==void 0?s:null;if(r)return r}return i??a.DefaultVideoPlayerSpeed}},{key:"mapToPlyrControlNames",value:function(t){var i=new Map([[Ut.Play,[He.PlayLarge]],[Ut.Time,[He.CurrentTime,He.Duration]]]),s=Object.values(He);return t.flatMap(function(n){var r,o;return(r=(o=i.get(n))!==null&&o!==void 0?o:s.find(function(l){return l===n}))!==null&&r!==void 0?r:[]})}},{key:"setDefaultSpeed",value:function(t){var i=this;this.player&&this.player.once("canplay",function(){var s,n=(s=t.speed)===null||s===void 0?void 0:s.selected;i.player&&n&&(i.player.speed=n)})}},{key:"subscribeEvents",value:function(t){if(this.player){var i=Kc(t);this.player.on("ready",i.onReady),this.player.on("play",i.onPlay),this.player.on("playing",i.onPlaying),this.player.on("timeupdate",i.onTimeUpdate),this.player.on("pause",i.onPause),this.player.on("ended",i.onEnded),this.player.on("error",i.onError),this.player.on("seeked",i.onSeeked),this.player.on("ratechange",i.onRateChange),this.player.on("volumechange",i.onVolumeChange),this.player.on("qualitychange",i.onQualityChange),this.player.on("enterfullscreen",i.onEnterFullscreen),this.player.on("exitfullscreen",i.onExitFullscreen)}}}])}();F()(xn,"DefaultControls",pe.Full),F()(xn,"DefaultVideoPlayerSpeed",1)},927215:function(){(function(){if(!(typeof window>"u"))try{var nt=new window.CustomEvent("test",{cancelable:!0});if(nt.preventDefault(),nt.defaultPrevented!==!0)throw new Error("Could not prevent default")}catch{var kt=function(H,Ie){var Ge,De;return Ie=Ie||{},Ie.bubbles=!!Ie.bubbles,Ie.cancelable=!!Ie.cancelable,Ge=document.createEvent("CustomEvent"),Ge.initCustomEvent(H,Ie.bubbles,Ie.cancelable,Ie.detail),De=Ge.preventDefault,Ge.preventDefault=function(){De.call(this);try{Object.defineProperty(this,"defaultPrevented",{get:function(){return!0}})}catch{this.defaultPrevented=!0}},Ge};kt.prototype=window.Event.prototype,window.CustomEvent=kt}})()},91913:function(nt,kt,oe){typeof navigator=="object"&&function(H,Ie){nt.exports=Ie()}(this,function(){"use strict";function H(u,m,d){return(m=function(p){var T=function(E,w){if(typeof E!="object"||E===null)return E;var I=E[Symbol.toPrimitive];if(I!==void 0){var _=I.call(E,w||"default");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return(w==="string"?String:Number)(E)}(p,"string");return typeof T=="symbol"?T:String(T)}(m))in u?Object.defineProperty(u,m,{value:d,enumerable:!0,configurable:!0,writable:!0}):u[m]=d,u}function Ie(u,m){for(var d=0;d<m.length;d++){var p=m[d];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(u,p.key,p)}}function Ge(u,m,d){return m in u?Object.defineProperty(u,m,{value:d,enumerable:!0,configurable:!0,writable:!0}):u[m]=d,u}function De(u,m){var d=Object.keys(u);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(u);m&&(p=p.filter(function(T){return Object.getOwnPropertyDescriptor(u,T).enumerable})),d.push.apply(d,p)}return d}function Ye(u){for(var m=1;m<arguments.length;m++){var d=arguments[m]!=null?arguments[m]:{};m%2?De(Object(d),!0).forEach(function(p){Ge(u,p,d[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(d)):De(Object(d)).forEach(function(p){Object.defineProperty(u,p,Object.getOwnPropertyDescriptor(d,p))})}return u}var rt={addCSS:!0,thumbWidth:15,watch:!0},ct=function(u){return u!=null?u.constructor:null},mt=function(u,m){return!!(u&&m&&u instanceof m)},ve=function(u){return u==null},ge=function(u){return ct(u)===Object},pe=function(u){return ct(u)===String},j=function(u){return Array.isArray(u)},Te=function(u){return mt(u,NodeList)},z={nullOrUndefined:ve,object:ge,number:function(u){return ct(u)===Number&&!Number.isNaN(u)},string:pe,boolean:function(u){return ct(u)===Boolean},function:function(u){return ct(u)===Function},array:j,nodeList:Te,element:function(u){return mt(u,Element)},event:function(u){return mt(u,Event)},empty:function(u){return ve(u)||(pe(u)||j(u)||Te(u))&&!u.length||ge(u)&&!Object.keys(u).length}};function Ze(u,m){if(1>m){var d=function(p){var T="".concat(p).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return T?Math.max(0,(T[1]?T[1].length:0)-(T[2]?+T[2]:0)):0}(m);return parseFloat(u.toFixed(d))}return Math.round(u/m)*m}var te=function(){function u(m,d){(function(p,T){if(!(p instanceof T))throw new TypeError("Cannot call a class as a function")})(this,u),z.element(m)?this.element=m:z.string(m)&&(this.element=document.querySelector(m)),z.element(this.element)&&z.empty(this.element.rangeTouch)&&(this.config=Ye({},rt,{},d),this.init())}return function(m,d,p){d&&Ie(m.prototype,d),p&&Ie(m,p)}(u,[{key:"init",value:function(){u.enabled&&(this.config.addCSS&&(this.element.style.userSelect="none",this.element.style.webKitUserSelect="none",this.element.style.touchAction="manipulation"),this.listeners(!0),this.element.rangeTouch=this)}},{key:"destroy",value:function(){u.enabled&&(this.config.addCSS&&(this.element.style.userSelect="",this.element.style.webKitUserSelect="",this.element.style.touchAction=""),this.listeners(!1),this.element.rangeTouch=null)}},{key:"listeners",value:function(m){var d=this,p=m?"addEventListener":"removeEventListener";["touchstart","touchmove","touchend"].forEach(function(T){d.element[p](T,function(E){return d.set(E)},!1)})}},{key:"get",value:function(m){if(!u.enabled||!z.event(m))return null;var d,p=m.target,T=m.changedTouches[0],E=parseFloat(p.getAttribute("min"))||0,w=parseFloat(p.getAttribute("max"))||100,I=parseFloat(p.getAttribute("step"))||1,_=p.getBoundingClientRect(),$=100/_.width*(this.config.thumbWidth/2)/100;return 0>(d=100/_.width*(T.clientX-_.left))?d=0:100<d&&(d=100),50>d?d-=(100-2*d)*$:50<d&&(d+=2*(d-50)*$),E+Ze(d/100*(w-E),I)}},{key:"set",value:function(m){u.enabled&&z.event(m)&&!m.target.disabled&&(m.preventDefault(),m.target.value=this.get(m),function(d,p){if(d&&p){var T=new Event(p,{bubbles:!0});d.dispatchEvent(T)}}(m.target,m.type==="touchend"?"change":"input"))}}],[{key:"setup",value:function(m){var d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},p=null;if(z.empty(m)||z.string(m)?p=Array.from(document.querySelectorAll(z.string(m)?m:'input[type="range"]')):z.element(m)?p=[m]:z.nodeList(m)?p=Array.from(m):z.array(m)&&(p=m.filter(z.element)),z.empty(p))return null;var T=Ye({},rt,{},d);if(z.string(m)&&T.watch){var E=new MutationObserver(function(w){Array.from(w).forEach(function(I){Array.from(I.addedNodes).forEach(function(_){z.element(_)&&function($,Q){return(function(){return Array.from(document.querySelectorAll(Q)).includes(this)}).call($,Q)}(_,m)&&new u(_,T)})})});E.observe(document.body,{childList:!0,subtree:!0})}return p.map(function(w){return new u(w,d)})}},{key:"enabled",get:function(){return"ontouchstart"in document.documentElement}}]),u}();const ut=u=>u!=null?u.constructor:null,at=(u,m)=>!!(u&&m&&u instanceof m),ht=u=>u==null,Tt=u=>ut(u)===Object,Rt=u=>ut(u)===String,Xt=u=>typeof u=="function",Bt=u=>Array.isArray(u),li=u=>at(u,NodeList),Qt=u=>ht(u)||(Rt(u)||Bt(u)||li(u))&&!u.length||Tt(u)&&!Object.keys(u).length;var x={nullOrUndefined:ht,object:Tt,number:u=>ut(u)===Number&&!Number.isNaN(u),string:Rt,boolean:u=>ut(u)===Boolean,function:Xt,array:Bt,weakMap:u=>at(u,WeakMap),nodeList:li,element:u=>u!==null&&typeof u=="object"&&u.nodeType===1&&typeof u.style=="object"&&typeof u.ownerDocument=="object",textNode:u=>ut(u)===Text,event:u=>at(u,Event),keyboardEvent:u=>at(u,KeyboardEvent),cue:u=>at(u,window.TextTrackCue)||at(u,window.VTTCue),track:u=>at(u,TextTrack)||!ht(u)&&Rt(u.kind),promise:u=>at(u,Promise)&&Xt(u.then),url:u=>{if(at(u,window.URL))return!0;if(!Rt(u))return!1;let m=u;u.startsWith("http://")&&u.startsWith("https://")||(m=`http://${u}`);try{return!Qt(new URL(m).hostname)}catch{return!1}},empty:Qt};const yt=(()=>{const u=document.createElement("span"),m={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},d=Object.keys(m).find(p=>u.style[p]!==void 0);return!!x.string(d)&&m[d]})();function yi(u,m){setTimeout(()=>{try{u.hidden=!0,u.offsetHeight,u.hidden=!1}catch{}},m)}var F={isIE:!!window.document.documentMode,isEdge:/Edge/g.test(navigator.userAgent),isWebKit:"WebkitAppearance"in document.documentElement.style&&!/Edge/g.test(navigator.userAgent),isIPhone:/iPhone|iPod/gi.test(navigator.userAgent)&&navigator.maxTouchPoints>1,isIPadOS:navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,isIos:/iPad|iPhone|iPod/gi.test(navigator.userAgent)&&navigator.maxTouchPoints>1};function xt(u,m){return m.split(".").reduce((d,p)=>d&&d[p],u)}function Oe(u={},...m){if(!m.length)return u;const d=m.shift();return x.object(d)?(Object.keys(d).forEach(p=>{x.object(d[p])?(Object.keys(u).includes(p)||Object.assign(u,{[p]:{}}),Oe(u[p],d[p])):Object.assign(u,{[p]:d[p]})}),Oe(u,...m)):u}function Zt(u,m){const d=u.length?u:[u];Array.from(d).reverse().forEach((p,T)=>{const E=T>0?m.cloneNode(!0):m,w=p.parentNode,I=p.nextSibling;E.appendChild(p),I?w.insertBefore(E,I):w.appendChild(E)})}function K(u,m){x.element(u)&&!x.empty(m)&&Object.entries(m).filter(([,d])=>!x.nullOrUndefined(d)).forEach(([d,p])=>u.setAttribute(d,p))}function D(u,m,d){const p=document.createElement(u);return x.object(m)&&K(p,m),x.string(d)&&(p.innerText=d),p}function W(u,m,d,p){x.element(m)&&m.appendChild(D(u,d,p))}function ce(u){x.nodeList(u)||x.array(u)?Array.from(u).forEach(ce):x.element(u)&&x.element(u.parentNode)&&u.parentNode.removeChild(u)}function ne(u){if(!x.element(u))return;let{length:m}=u.childNodes;for(;m>0;)u.removeChild(u.lastChild),m-=1}function xe(u,m){return x.element(m)&&x.element(m.parentNode)&&x.element(u)?(m.parentNode.replaceChild(u,m),u):null}function Me(u,m){if(!x.string(u)||x.empty(u))return{};const d={},p=Oe({},m);return u.split(",").forEach(T=>{const E=T.trim(),w=E.replace(".",""),I=E.replace(/[[\]]/g,"").split("="),[_]=I,$=I.length>1?I[1].replace(/["']/g,""):"";switch(E.charAt(0)){case".":x.string(p.class)?d.class=`${p.class} ${w}`:d.class=w;break;case"#":d.id=E.replace("#","");break;case"[":d[_]=$}}),Oe(p,d)}function Be(u,m){if(!x.element(u))return;let d=m;x.boolean(d)||(d=!u.hidden),u.hidden=d}function be(u,m,d){if(x.nodeList(u))return Array.from(u).map(p=>be(p,m,d));if(x.element(u)){let p="toggle";return d!==void 0&&(p=d?"add":"remove"),u.classList[p](m),u.classList.contains(m)}return!1}function Ne(u,m){return x.element(u)&&u.classList.contains(m)}function Lt(u,m){const{prototype:d}=Element;return(d.matches||d.webkitMatchesSelector||d.mozMatchesSelector||d.msMatchesSelector||function(){return Array.from(document.querySelectorAll(m)).includes(this)}).call(u,m)}function Fe(u){return this.elements.container.querySelectorAll(u)}function Pe(u){return this.elements.container.querySelector(u)}function Ni(u=null,m=!1){x.element(u)&&u.focus({preventScroll:!0,focusVisible:m})}const Qi={"audio/ogg":"vorbis","audio/wav":"1","video/webm":"vp8, vorbis","video/mp4":"avc1.42E01E, mp4a.40.2","video/ogg":"theora"},He={audio:"canPlayType"in document.createElement("audio"),video:"canPlayType"in document.createElement("video"),check(u,m){const d=He[u]||m!=="html5";return{api:d,ui:d&&He.rangeInput}},pip:!(F.isIPhone||!x.function(D("video").webkitSetPresentationMode)&&(!document.pictureInPictureEnabled||D("video").disablePictureInPicture)),airplay:x.function(window.WebKitPlaybackTargetAvailabilityEvent),playsinline:"playsInline"in document.createElement("video"),mime(u){if(x.empty(u))return!1;const[m]=u.split("/");let d=u;if(!this.isHTML5||m!==this.type)return!1;Object.keys(Qi).includes(d)&&(d+=`; codecs="${Qi[u]}"`);try{return!!(d&&this.media.canPlayType(d).replace(/no/,""))}catch{return!1}},textTracks:"textTracks"in document.createElement("video"),rangeInput:(()=>{const u=document.createElement("input");return u.type="range",u.type==="range"})(),touch:"ontouchstart"in document.documentElement,transitions:yt!==!1,reducedMotion:"matchMedia"in window&&window.matchMedia("(prefers-reduced-motion)").matches},Ut=(()=>{let u=!1;try{const m=Object.defineProperty({},"passive",{get:()=>(u=!0,null)});window.addEventListener("test",null,m),window.removeEventListener("test",null,m)}catch{}return u})();function si(u,m,d,p=!1,T=!0,E=!1){if(!u||!("addEventListener"in u)||x.empty(m)||!x.function(d))return;const w=m.split(" ");let I=E;Ut&&(I={passive:T,capture:E}),w.forEach(_=>{this&&this.eventListeners&&p&&this.eventListeners.push({element:u,type:_,callback:d,options:I}),u[p?"addEventListener":"removeEventListener"](_,d,I)})}function Le(u,m="",d,p=!0,T=!1){si.call(this,u,m,d,!0,p,T)}function vi(u,m="",d,p=!0,T=!1){si.call(this,u,m,d,!1,p,T)}function Fi(u,m="",d,p=!0,T=!1){const E=(...w)=>{vi(u,m,E,p,T),d.apply(this,w)};si.call(this,u,m,E,!0,p,T)}function he(u,m="",d=!1,p={}){if(!x.element(u)||x.empty(m))return;const T=new CustomEvent(m,{bubbles:d,detail:{...p,plyr:this}});u.dispatchEvent(T)}function Zi(){this&&this.eventListeners&&(this.eventListeners.forEach(u=>{const{element:m,type:d,callback:p,options:T}=u;m.removeEventListener(d,p,T)}),this.eventListeners=[])}function bi(){return new Promise(u=>this.ready?setTimeout(u,0):Le.call(this,this.elements.container,"ready",u)).then(()=>{})}function Ct(u){x.promise(u)&&u.then(null,()=>{})}function Dt(u){return x.array(u)?u.filter((m,d)=>u.indexOf(m)===d):u}function Ji(u,m){return x.array(u)&&u.length?u.reduce((d,p)=>Math.abs(p-m)<Math.abs(d-m)?p:d):null}function Mi(u){return!(!window||!window.CSS)&&window.CSS.supports(u)}const Ti=[[1,1],[4,3],[3,4],[5,4],[4,5],[3,2],[2,3],[16,10],[10,16],[16,9],[9,16],[21,9],[9,21],[32,9],[9,32]].reduce((u,[m,d])=>({...u,[m/d]:[m,d]}),{});function Bi(u){return x.array(u)||x.string(u)&&u.includes(":")?(x.array(u)?u:u.split(":")).map(Number).every(x.number):!1}function ot(u){if(!x.array(u)||!u.every(x.number))return null;const[m,d]=u,p=(E,w)=>w===0?E:p(w,E%w),T=p(m,d);return[m/T,d/T]}function Ui(u){const m=p=>Bi(p)?p.split(":").map(Number):null;let d=m(u);if(d===null&&(d=m(this.config.ratio)),d===null&&!x.empty(this.embed)&&x.array(this.embed.ratio)&&({ratio:d}=this.embed),d===null&&this.isHTML5){const{videoWidth:p,videoHeight:T}=this.media;d=[p,T]}return ot(d)}function Ke(u){if(!this.isVideo)return{};const{wrapper:m}=this.elements,d=Ui.call(this,u);if(!x.array(d))return{};const[p,T]=ot(d),E=100/p*T;if(Mi(`aspect-ratio: ${p}/${T}`)?m.style.aspectRatio=`${p}/${T}`:m.style.paddingBottom=`${E}%`,this.isVimeo&&!this.config.vimeo.premium&&this.supported.ui){const w=100/this.media.offsetWidth*parseInt(window.getComputedStyle(this.media).paddingBottom,10),I=(w-E)/(w/50);this.fullscreen.active?m.style.paddingBottom=null:this.media.style.transform=`translateY(-${I}%)`}else this.isHTML5&&m.classList.add(this.config.classNames.videoFixedRatio);return{padding:E,ratio:d}}function es(u,m,d=.05){const p=u/m,T=Ji(Object.keys(Ti),p);return Math.abs(T-p)<=d?Ti[T]:[u,m]}const Wt={getSources(){return this.isHTML5?Array.from(this.media.querySelectorAll("source")).filter(u=>{const m=u.getAttribute("type");return!!x.empty(m)||He.mime.call(this,m)}):[]},getQualityOptions(){return this.config.quality.forced?this.config.quality.options:Wt.getSources.call(this).map(u=>Number(u.getAttribute("size"))).filter(Boolean)},setup(){if(!this.isHTML5)return;const u=this;u.options.speed=u.config.speed.options,x.empty(this.config.ratio)||Ke.call(u),Object.defineProperty(u.media,"quality",{get(){const m=Wt.getSources.call(u).find(d=>d.getAttribute("src")===u.source);return m&&Number(m.getAttribute("size"))},set(m){if(u.quality!==m){if(u.config.quality.forced&&x.function(u.config.quality.onChange))u.config.quality.onChange(m);else{const d=Wt.getSources.call(u).find(_=>Number(_.getAttribute("size"))===m);if(!d)return;const{currentTime:p,paused:T,preload:E,readyState:w,playbackRate:I}=u.media;u.media.src=d.getAttribute("src"),(E!=="none"||w)&&(u.once("loadedmetadata",()=>{u.speed=I,u.currentTime=p,T||Ct(u.play())}),u.media.load())}he.call(u,u.media,"qualitychange",!1,{quality:m})}}})},cancelRequests(){this.isHTML5&&(ce(Wt.getSources.call(this)),this.media.setAttribute("src",this.config.blankVideo),this.media.load(),this.debug.log("Cancelled network requests"))}};function se(u,...m){return x.empty(u)?u:u.toString().replace(/{(\d+)}/g,(d,p)=>m[p].toString())}const ci=(u="",m="",d="")=>u.replace(new RegExp(m.toString().replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),"g"),d.toString()),ts=(u="")=>u.toString().replace(/\w\S*/g,m=>m.charAt(0).toUpperCase()+m.slice(1).toLowerCase());function b(u=""){let m=u.toString();return m=function(d=""){let p=d.toString();return p=ci(p,"-"," "),p=ci(p,"_"," "),p=ts(p),ci(p," ","")}(m),m.charAt(0).toLowerCase()+m.slice(1)}function ue(u){const m=document.createElement("div");return m.appendChild(u),m.innerHTML}const N={pip:"PIP",airplay:"AirPlay",html5:"HTML5",vimeo:"Vimeo",youtube:"YouTube"},je={get(u="",m={}){if(x.empty(u)||x.empty(m))return"";let d=xt(m.i18n,u);if(x.empty(d))return Object.keys(N).includes(u)?N[u]:"";const p={"{seektime}":m.seekTime,"{title}":m.title};return Object.entries(p).forEach(([T,E])=>{d=ci(d,T,E)}),d}};class Jt{constructor(m){H(this,"get",d=>{if(!Jt.supported||!this.enabled)return null;const p=window.localStorage.getItem(this.key);if(x.empty(p))return null;const T=JSON.parse(p);return x.string(d)&&d.length?T[d]:T}),H(this,"set",d=>{if(!Jt.supported||!this.enabled||!x.object(d))return;let p=this.get();x.empty(p)&&(p={}),Oe(p,d);try{window.localStorage.setItem(this.key,JSON.stringify(p))}catch{}}),this.enabled=m.config.storage.enabled,this.key=m.config.storage.key}static get supported(){try{if(!("localStorage"in window))return!1;const m="___test";return window.localStorage.setItem(m,m),window.localStorage.removeItem(m),!0}catch{return!1}}}function $t(u,m="text"){return new Promise((d,p)=>{try{const T=new XMLHttpRequest;if(!("withCredentials"in T))return;T.addEventListener("load",()=>{if(m==="text")try{d(JSON.parse(T.responseText))}catch{d(T.responseText)}else d(T.response)}),T.addEventListener("error",()=>{throw new Error(T.status)}),T.open("GET",u,!0),T.responseType=m,T.send()}catch(T){p(T)}})}function is(u,m){if(!x.string(u))return;const d="cache",p=x.string(m);let T=!1;const E=()=>document.getElementById(m)!==null,w=(I,_)=>{I.innerHTML=_,p&&E()||document.body.insertAdjacentElement("afterbegin",I)};if(!p||!E()){const I=Jt.supported,_=document.createElement("div");if(_.setAttribute("hidden",""),p&&_.setAttribute("id",m),I){const $=window.localStorage.getItem(`${d}-${m}`);if(T=$!==null,T){const Q=JSON.parse($);w(_,Q.content)}}$t(u).then($=>{if(!x.empty($)){if(I)try{window.localStorage.setItem(`${d}-${m}`,JSON.stringify({content:$}))}catch{}w(_,$)}}).catch(()=>{})}}const ss=u=>Math.trunc(u/60/60%60,10),Is=u=>Math.trunc(u/60%60,10),k=u=>Math.trunc(u%60,10);function Ei(u=0,m=!1,d=!1){if(!x.number(u))return Ei(void 0,m,d);const p=I=>`0${I}`.slice(-2);let T=ss(u);const E=Is(u),w=k(u);return T=m||T>0?`${T}:`:"",`${d&&u>0?"-":""}${T}${p(E)}:${p(w)}`}const X={getIconUrl(){const u=new URL(this.config.iconUrl,window.location),m=window.location.host?window.location.host:window.top.location.host,d=u.host!==m||F.isIE&&!window.svg4everybody;return{url:this.config.iconUrl,cors:d}},findElements(){try{return this.elements.controls=Pe.call(this,this.config.selectors.controls.wrapper),this.elements.buttons={play:Fe.call(this,this.config.selectors.buttons.play),pause:Pe.call(this,this.config.selectors.buttons.pause),restart:Pe.call(this,this.config.selectors.buttons.restart),rewind:Pe.call(this,this.config.selectors.buttons.rewind),fastForward:Pe.call(this,this.config.selectors.buttons.fastForward),mute:Pe.call(this,this.config.selectors.buttons.mute),pip:Pe.call(this,this.config.selectors.buttons.pip),airplay:Pe.call(this,this.config.selectors.buttons.airplay),settings:Pe.call(this,this.config.selectors.buttons.settings),captions:Pe.call(this,this.config.selectors.buttons.captions),fullscreen:Pe.call(this,this.config.selectors.buttons.fullscreen)},this.elements.progress=Pe.call(this,this.config.selectors.progress),this.elements.inputs={seek:Pe.call(this,this.config.selectors.inputs.seek),volume:Pe.call(this,this.config.selectors.inputs.volume)},this.elements.display={buffer:Pe.call(this,this.config.selectors.display.buffer),currentTime:Pe.call(this,this.config.selectors.display.currentTime),duration:Pe.call(this,this.config.selectors.display.duration)},x.element(this.elements.progress)&&(this.elements.display.seekTooltip=this.elements.progress.querySelector(`.${this.config.classNames.tooltip}`)),!0}catch(u){return this.debug.warn("It looks like there is a problem with your custom controls HTML",u),this.toggleNativeControls(!0),!1}},createIcon(u,m){const d="http://www.w3.org/2000/svg",p=X.getIconUrl.call(this),T=`${p.cors?"":p.url}#${this.config.iconPrefix}`,E=document.createElementNS(d,"svg");K(E,Oe(m,{"aria-hidden":"true",focusable:"false"}));const w=document.createElementNS(d,"use"),I=`${T}-${u}`;return"href"in w&&w.setAttributeNS("http://www.w3.org/1999/xlink","href",I),w.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",I),E.appendChild(w),E},createLabel(u,m={}){const d=je.get(u,this.config);return D("span",{...m,class:[m.class,this.config.classNames.hidden].filter(Boolean).join(" ")},d)},createBadge(u){if(x.empty(u))return null;const m=D("span",{class:this.config.classNames.menu.value});return m.appendChild(D("span",{class:this.config.classNames.menu.badge},u)),m},createButton(u,m){const d=Oe({},m);let p=b(u);const T={element:"button",toggle:!1,label:null,icon:null,labelPressed:null,iconPressed:null};switch(["element","icon","label"].forEach(w=>{Object.keys(d).includes(w)&&(T[w]=d[w],delete d[w])}),T.element!=="button"||Object.keys(d).includes("type")||(d.type="button"),Object.keys(d).includes("class")?d.class.split(" ").some(w=>w===this.config.classNames.control)||Oe(d,{class:`${d.class} ${this.config.classNames.control}`}):d.class=this.config.classNames.control,u){case"play":T.toggle=!0,T.label="play",T.labelPressed="pause",T.icon="play",T.iconPressed="pause";break;case"mute":T.toggle=!0,T.label="mute",T.labelPressed="unmute",T.icon="volume",T.iconPressed="muted";break;case"captions":T.toggle=!0,T.label="enableCaptions",T.labelPressed="disableCaptions",T.icon="captions-off",T.iconPressed="captions-on";break;case"fullscreen":T.toggle=!0,T.label="enterFullscreen",T.labelPressed="exitFullscreen",T.icon="enter-fullscreen",T.iconPressed="exit-fullscreen";break;case"play-large":d.class+=` ${this.config.classNames.control}--overlaid`,p="play",T.label="play",T.icon="play";break;default:x.empty(T.label)&&(T.label=p),x.empty(T.icon)&&(T.icon=u)}const E=D(T.element);return T.toggle?(E.appendChild(X.createIcon.call(this,T.iconPressed,{class:"icon--pressed"})),E.appendChild(X.createIcon.call(this,T.icon,{class:"icon--not-pressed"})),E.appendChild(X.createLabel.call(this,T.labelPressed,{class:"label--pressed"})),E.appendChild(X.createLabel.call(this,T.label,{class:"label--not-pressed"}))):(E.appendChild(X.createIcon.call(this,T.icon)),E.appendChild(X.createLabel.call(this,T.label))),Oe(d,Me(this.config.selectors.buttons[p],d)),K(E,d),p==="play"?(x.array(this.elements.buttons[p])||(this.elements.buttons[p]=[]),this.elements.buttons[p].push(E)):this.elements.buttons[p]=E,E},createRange(u,m){const d=D("input",Oe(Me(this.config.selectors.inputs[u]),{type:"range",min:0,max:100,step:.01,value:0,autocomplete:"off",role:"slider","aria-label":je.get(u,this.config),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0},m));return this.elements.inputs[u]=d,X.updateRangeFill.call(this,d),te.setup(d),d},createProgress(u,m){const d=D("progress",Oe(Me(this.config.selectors.display[u]),{min:0,max:100,value:0,role:"progressbar","aria-hidden":!0},m));if(u!=="volume"){d.appendChild(D("span",null,"0"));const p={played:"played",buffer:"buffered"}[u],T=p?je.get(p,this.config):"";d.innerText=`% ${T.toLowerCase()}`}return this.elements.display[u]=d,d},createTime(u,m){const d=Me(this.config.selectors.display[u],m),p=D("div",Oe(d,{class:`${d.class?d.class:""} ${this.config.classNames.display.time} `.trim(),"aria-label":je.get(u,this.config),role:"timer"}),"00:00");return this.elements.display[u]=p,p},bindMenuItemShortcuts(u,m){Le.call(this,u,"keydown keyup",d=>{if(![" ","ArrowUp","ArrowDown","ArrowRight"].includes(d.key)||(d.preventDefault(),d.stopPropagation(),d.type==="keydown"))return;const p=Lt(u,'[role="menuitemradio"]');if(!p&&[" ","ArrowRight"].includes(d.key))X.showMenuPanel.call(this,m,!0);else{let T;d.key!==" "&&(d.key==="ArrowDown"||p&&d.key==="ArrowRight"?(T=u.nextElementSibling,x.element(T)||(T=u.parentNode.firstElementChild)):(T=u.previousElementSibling,x.element(T)||(T=u.parentNode.lastElementChild)),Ni.call(this,T,!0))}},!1),Le.call(this,u,"keyup",d=>{d.key==="Return"&&X.focusFirstMenuItem.call(this,null,!0)})},createMenuItem({value:u,list:m,type:d,title:p,badge:T=null,checked:E=!1}){const w=Me(this.config.selectors.inputs[d]),I=D("button",Oe(w,{type:"button",role:"menuitemradio",class:`${this.config.classNames.control} ${w.class?w.class:""}`.trim(),"aria-checked":E,value:u})),_=D("span");_.innerHTML=p,x.element(T)&&_.appendChild(T),I.appendChild(_),Object.defineProperty(I,"checked",{enumerable:!0,get:()=>I.getAttribute("aria-checked")==="true",set($){$&&Array.from(I.parentNode.children).filter(Q=>Lt(Q,'[role="menuitemradio"]')).forEach(Q=>Q.setAttribute("aria-checked","false")),I.setAttribute("aria-checked",$?"true":"false")}}),this.listeners.bind(I,"click keyup",$=>{if(!x.keyboardEvent($)||$.key===" "){switch($.preventDefault(),$.stopPropagation(),I.checked=!0,d){case"language":this.currentTrack=Number(u);break;case"quality":this.quality=u;break;case"speed":this.speed=parseFloat(u)}X.showMenuPanel.call(this,"home",x.keyboardEvent($))}},d,!1),X.bindMenuItemShortcuts.call(this,I,d),m.appendChild(I)},formatTime(u=0,m=!1){return x.number(u)?Ei(u,ss(this.duration)>0,m):u},updateTimeDisplay(u=null,m=0,d=!1){x.element(u)&&x.number(m)&&(u.innerText=X.formatTime(m,d))},updateVolume(){this.supported.ui&&(x.element(this.elements.inputs.volume)&&X.setRange.call(this,this.elements.inputs.volume,this.muted?0:this.volume),x.element(this.elements.buttons.mute)&&(this.elements.buttons.mute.pressed=this.muted||this.volume===0))},setRange(u,m=0){x.element(u)&&(u.value=m,X.updateRangeFill.call(this,u))},updateProgress(u){if(!this.supported.ui||!x.event(u))return;let m=0;const d=(E,w)=>{const I=x.number(w)?w:0,_=x.element(E)?E:this.elements.display.buffer;if(x.element(_)){_.value=I;const $=_.getElementsByTagName("span")[0];x.element($)&&($.childNodes[0].nodeValue=I)}};if(u)switch(u.type){case"timeupdate":case"seeking":case"seeked":p=this.currentTime,T=this.duration,m=p===0||T===0||Number.isNaN(p)||Number.isNaN(T)?0:(p/T*100).toFixed(2),u.type==="timeupdate"&&X.setRange.call(this,this.elements.inputs.seek,m);break;case"playing":case"progress":d(this.elements.display.buffer,100*this.buffered)}var p,T},updateRangeFill(u){const m=x.event(u)?u.target:u;if(x.element(m)&&m.getAttribute("type")==="range"){if(Lt(m,this.config.selectors.inputs.seek)){m.setAttribute("aria-valuenow",this.currentTime);const d=X.formatTime(this.currentTime),p=X.formatTime(this.duration),T=je.get("seekLabel",this.config);m.setAttribute("aria-valuetext",T.replace("{currentTime}",d).replace("{duration}",p))}else if(Lt(m,this.config.selectors.inputs.volume)){const d=100*m.value;m.setAttribute("aria-valuenow",d),m.setAttribute("aria-valuetext",`${d.toFixed(1)}%`)}else m.setAttribute("aria-valuenow",m.value);(F.isWebKit||F.isIPadOS)&&m.style.setProperty("--value",m.value/m.max*100+"%")}},updateSeekTooltip(u){var m,d;if(!this.config.tooltips.seek||!x.element(this.elements.inputs.seek)||!x.element(this.elements.display.seekTooltip)||this.duration===0)return;const p=this.elements.display.seekTooltip,T=`${this.config.classNames.tooltip}--visible`,E=Q=>be(p,T,Q);if(this.touch)return void E(!1);let w=0;const I=this.elements.progress.getBoundingClientRect();if(x.event(u))w=100/I.width*(u.pageX-I.left);else{if(!Ne(p,T))return;w=parseFloat(p.style.left,10)}w<0?w=0:w>100&&(w=100);const _=this.duration/100*w;p.innerText=X.formatTime(_);const $=(m=this.config.markers)===null||m===void 0||(d=m.points)===null||d===void 0?void 0:d.find(({time:Q})=>Q===Math.round(_));$&&p.insertAdjacentHTML("afterbegin",`${$.label}<br>`),p.style.left=`${w}%`,x.event(u)&&["mouseenter","mouseleave"].includes(u.type)&&E(u.type==="mouseenter")},timeUpdate(u){const m=!x.element(this.elements.display.duration)&&this.config.invertTime;X.updateTimeDisplay.call(this,this.elements.display.currentTime,m?this.duration-this.currentTime:this.currentTime,m),u&&u.type==="timeupdate"&&this.media.seeking||X.updateProgress.call(this,u)},durationUpdate(){if(!this.supported.ui||!this.config.invertTime&&this.currentTime)return;if(this.duration>=2**32)return Be(this.elements.display.currentTime,!0),void Be(this.elements.progress,!0);x.element(this.elements.inputs.seek)&&this.elements.inputs.seek.setAttribute("aria-valuemax",this.duration);const u=x.element(this.elements.display.duration);!u&&this.config.displayDuration&&this.paused&&X.updateTimeDisplay.call(this,this.elements.display.currentTime,this.duration),u&&X.updateTimeDisplay.call(this,this.elements.display.duration,this.duration),this.config.markers.enabled&&X.setMarkers.call(this),X.updateSeekTooltip.call(this)},toggleMenuButton(u,m){Be(this.elements.settings.buttons[u],!m)},updateSetting(u,m,d){const p=this.elements.settings.panels[u];let T=null,E=m;if(u==="captions")T=this.currentTrack;else{if(T=x.empty(d)?this[u]:d,x.empty(T)&&(T=this.config[u].default),!x.empty(this.options[u])&&!this.options[u].includes(T))return void this.debug.warn(`Unsupported value of '${T}' for ${u}`);if(!this.config[u].options.includes(T))return void this.debug.warn(`Disabled value of '${T}' for ${u}`)}if(x.element(E)||(E=p&&p.querySelector('[role="menu"]')),!x.element(E))return;this.elements.settings.buttons[u].querySelector(`.${this.config.classNames.menu.value}`).innerHTML=X.getLabel.call(this,u,T);const w=E&&E.querySelector(`[value="${T}"]`);x.element(w)&&(w.checked=!0)},getLabel(u,m){switch(u){case"speed":return m===1?je.get("normal",this.config):`${m}&times;`;case"quality":if(x.number(m)){const d=je.get(`qualityLabel.${m}`,this.config);return d.length?d:`${m}p`}return ts(m);case"captions":return we.getLabel.call(this);default:return null}},setQualityMenu(u){if(!x.element(this.elements.settings.panels.quality))return;const m="quality",d=this.elements.settings.panels.quality.querySelector('[role="menu"]');x.array(u)&&(this.options.quality=Dt(u).filter(E=>this.config.quality.options.includes(E)));const p=!x.empty(this.options.quality)&&this.options.quality.length>1;if(X.toggleMenuButton.call(this,m,p),ne(d),X.checkMenu.call(this),!p)return;const T=E=>{const w=je.get(`qualityBadge.${E}`,this.config);return w.length?X.createBadge.call(this,w):null};this.options.quality.sort((E,w)=>{const I=this.config.quality.options;return I.indexOf(E)>I.indexOf(w)?1:-1}).forEach(E=>{X.createMenuItem.call(this,{value:E,list:d,type:m,title:X.getLabel.call(this,"quality",E),badge:T(E)})}),X.updateSetting.call(this,m,d)},setCaptionsMenu(){if(!x.element(this.elements.settings.panels.captions))return;const u="captions",m=this.elements.settings.panels.captions.querySelector('[role="menu"]'),d=we.getTracks.call(this),p=!!d.length;if(X.toggleMenuButton.call(this,u,p),ne(m),X.checkMenu.call(this),!p)return;const T=d.map((E,w)=>({value:w,checked:this.captions.toggled&&this.currentTrack===w,title:we.getLabel.call(this,E),badge:E.language&&X.createBadge.call(this,E.language.toUpperCase()),list:m,type:"language"}));T.unshift({value:-1,checked:!this.captions.toggled,title:je.get("disabled",this.config),list:m,type:"language"}),T.forEach(X.createMenuItem.bind(this)),X.updateSetting.call(this,u,m)},setSpeedMenu(){if(!x.element(this.elements.settings.panels.speed))return;const u="speed",m=this.elements.settings.panels.speed.querySelector('[role="menu"]');this.options.speed=this.options.speed.filter(p=>p>=this.minimumSpeed&&p<=this.maximumSpeed);const d=!x.empty(this.options.speed)&&this.options.speed.length>1;X.toggleMenuButton.call(this,u,d),ne(m),X.checkMenu.call(this),d&&(this.options.speed.forEach(p=>{X.createMenuItem.call(this,{value:p,list:m,type:u,title:X.getLabel.call(this,"speed",p)})}),X.updateSetting.call(this,u,m))},checkMenu(){const{buttons:u}=this.elements.settings,m=!x.empty(u)&&Object.values(u).some(d=>!d.hidden);Be(this.elements.settings.menu,!m)},focusFirstMenuItem(u,m=!1){if(this.elements.settings.popup.hidden)return;let d=u;x.element(d)||(d=Object.values(this.elements.settings.panels).find(T=>!T.hidden));const p=d.querySelector('[role^="menuitem"]');Ni.call(this,p,m)},toggleMenu(u){const{popup:m}=this.elements.settings,d=this.elements.buttons.settings;if(!x.element(m)||!x.element(d))return;const{hidden:p}=m;let T=p;if(x.boolean(u))T=u;else if(x.keyboardEvent(u)&&u.key==="Escape")T=!1;else if(x.event(u)){const E=x.function(u.composedPath)?u.composedPath()[0]:u.target,w=m.contains(E);if(w||!w&&u.target!==d&&T)return}d.setAttribute("aria-expanded",T),Be(m,!T),be(this.elements.container,this.config.classNames.menu.open,T),T&&x.keyboardEvent(u)?X.focusFirstMenuItem.call(this,null,!0):T||p||Ni.call(this,d,x.keyboardEvent(u))},getMenuSize(u){const m=u.cloneNode(!0);m.style.position="absolute",m.style.opacity=0,m.removeAttribute("hidden"),u.parentNode.appendChild(m);const d=m.scrollWidth,p=m.scrollHeight;return ce(m),{width:d,height:p}},showMenuPanel(u="",m=!1){const d=this.elements.container.querySelector(`#plyr-settings-${this.id}-${u}`);if(!x.element(d))return;const p=d.parentNode,T=Array.from(p.children).find(E=>!E.hidden);if(He.transitions&&!He.reducedMotion){p.style.width=`${T.scrollWidth}px`,p.style.height=`${T.scrollHeight}px`;const E=X.getMenuSize.call(this,d),w=I=>{I.target===p&&["width","height"].includes(I.propertyName)&&(p.style.width="",p.style.height="",vi.call(this,p,yt,w))};Le.call(this,p,yt,w),p.style.width=`${E.width}px`,p.style.height=`${E.height}px`}Be(T,!0),Be(d,!1),X.focusFirstMenuItem.call(this,d,m)},setDownloadUrl(){const u=this.elements.buttons.download;x.element(u)&&u.setAttribute("href",this.download)},create(u){const{bindMenuItemShortcuts:m,createButton:d,createProgress:p,createRange:T,createTime:E,setQualityMenu:w,setSpeedMenu:I,showMenuPanel:_}=X;this.elements.controls=null,x.array(this.config.controls)&&this.config.controls.includes("play-large")&&this.elements.container.appendChild(d.call(this,"play-large"));const $=D("div",Me(this.config.selectors.controls.wrapper));this.elements.controls=$;const Q={class:"plyr__controls__item"};return Dt(x.array(this.config.controls)?this.config.controls:[]).forEach(le=>{if(le==="restart"&&$.appendChild(d.call(this,"restart",Q)),le==="rewind"&&$.appendChild(d.call(this,"rewind",Q)),le==="play"&&$.appendChild(d.call(this,"play",Q)),le==="fast-forward"&&$.appendChild(d.call(this,"fast-forward",Q)),le==="progress"){const q=D("div",{class:`${Q.class} plyr__progress__container`}),re=D("div",Me(this.config.selectors.progress));if(re.appendChild(T.call(this,"seek",{id:`plyr-seek-${u.id}`})),re.appendChild(p.call(this,"buffer")),this.config.tooltips.seek){const Ee=D("span",{class:this.config.classNames.tooltip},"00:00");re.appendChild(Ee),this.elements.display.seekTooltip=Ee}this.elements.progress=re,q.appendChild(this.elements.progress),$.appendChild(q)}if(le==="current-time"&&$.appendChild(E.call(this,"currentTime",Q)),le==="duration"&&$.appendChild(E.call(this,"duration",Q)),le==="mute"||le==="volume"){let{volume:q}=this.elements;if(x.element(q)&&$.contains(q)||(q=D("div",Oe({},Q,{class:`${Q.class} plyr__volume`.trim()})),this.elements.volume=q,$.appendChild(q)),le==="mute"&&q.appendChild(d.call(this,"mute")),le==="volume"&&!F.isIos&&!F.isIPadOS){const re={max:1,step:.05,value:this.config.volume};q.appendChild(T.call(this,"volume",Oe(re,{id:`plyr-volume-${u.id}`})))}}if(le==="captions"&&$.appendChild(d.call(this,"captions",Q)),le==="settings"&&!x.empty(this.config.settings)){const q=D("div",Oe({},Q,{class:`${Q.class} plyr__menu`.trim(),hidden:""}));q.appendChild(d.call(this,"settings",{"aria-haspopup":!0,"aria-controls":`plyr-settings-${u.id}`,"aria-expanded":!1}));const re=D("div",{class:"plyr__menu__container",id:`plyr-settings-${u.id}`,hidden:""}),Ee=D("div"),Se=D("div",{id:`plyr-settings-${u.id}-home`}),qe=D("div",{role:"menu"});Se.appendChild(qe),Ee.appendChild(Se),this.elements.settings.panels.home=Se,this.config.settings.forEach(ae=>{const ze=D("button",Oe(Me(this.config.selectors.buttons.settings),{type:"button",class:`${this.config.classNames.control} ${this.config.classNames.control}--forward`,role:"menuitem","aria-haspopup":!0,hidden:""}));m.call(this,ze,ae),Le.call(this,ze,"click",()=>{_.call(this,ae,!1)});const U=D("span",null,je.get(ae,this.config)),Ae=D("span",{class:this.config.classNames.menu.value});Ae.innerHTML=u[ae],U.appendChild(Ae),ze.appendChild(U),qe.appendChild(ze);const it=D("div",{id:`plyr-settings-${u.id}-${ae}`,hidden:""}),ye=D("button",{type:"button",class:`${this.config.classNames.control} ${this.config.classNames.control}--back`});ye.appendChild(D("span",{"aria-hidden":!0},je.get(ae,this.config))),ye.appendChild(D("span",{class:this.config.classNames.hidden},je.get("menuBack",this.config))),Le.call(this,it,"keydown",wt=>{wt.key==="ArrowLeft"&&(wt.preventDefault(),wt.stopPropagation(),_.call(this,"home",!0))},!1),Le.call(this,ye,"click",()=>{_.call(this,"home",!1)}),it.appendChild(ye),it.appendChild(D("div",{role:"menu"})),Ee.appendChild(it),this.elements.settings.buttons[ae]=ze,this.elements.settings.panels[ae]=it}),re.appendChild(Ee),q.appendChild(re),$.appendChild(q),this.elements.settings.popup=re,this.elements.settings.menu=q}if(le==="pip"&&He.pip&&$.appendChild(d.call(this,"pip",Q)),le==="airplay"&&He.airplay&&$.appendChild(d.call(this,"airplay",Q)),le==="download"){const q=Oe({},Q,{element:"a",href:this.download,target:"_blank"});this.isHTML5&&(q.download="");const{download:re}=this.config.urls;!x.url(re)&&this.isEmbed&&Oe(q,{icon:`logo-${this.provider}`,label:this.provider}),$.appendChild(d.call(this,"download",q))}le==="fullscreen"&&$.appendChild(d.call(this,"fullscreen",Q))}),this.isHTML5&&w.call(this,Wt.getQualityOptions.call(this)),I.call(this),$},inject(){if(this.config.loadSprite){const T=X.getIconUrl.call(this);T.cors&&is(T.url,"sprite-plyr")}this.id=Math.floor(1e4*Math.random());let u=null;this.elements.controls=null;const m={id:this.id,seektime:this.config.seekTime,title:this.config.title};let d=!0;x.function(this.config.controls)&&(this.config.controls=this.config.controls.call(this,m)),this.config.controls||(this.config.controls=[]),x.element(this.config.controls)||x.string(this.config.controls)?u=this.config.controls:(u=X.create.call(this,{id:this.id,seektime:this.config.seekTime,speed:this.speed,quality:this.quality,captions:we.getLabel.call(this)}),d=!1);let p;if(d&&x.string(this.config.controls)&&(u=(T=>{let E=T;return Object.entries(m).forEach(([w,I])=>{E=ci(E,`{${w}}`,I)}),E})(u)),x.string(this.config.selectors.controls.container)&&(p=document.querySelector(this.config.selectors.controls.container)),x.element(p)||(p=this.elements.container),p[x.element(u)?"insertAdjacentElement":"insertAdjacentHTML"]("afterbegin",u),x.element(this.elements.controls)||X.findElements.call(this),!x.empty(this.elements.buttons)){const T=E=>{const w=this.config.classNames.controlPressed;E.setAttribute("aria-pressed","false"),Object.defineProperty(E,"pressed",{configurable:!0,enumerable:!0,get:()=>Ne(E,w),set(I=!1){be(E,w,I),E.setAttribute("aria-pressed",I?"true":"false")}})};Object.values(this.elements.buttons).filter(Boolean).forEach(E=>{x.array(E)||x.nodeList(E)?Array.from(E).filter(Boolean).forEach(T):T(E)})}if(F.isEdge&&yi(p),this.config.tooltips.controls){const{classNames:T,selectors:E}=this.config,w=`${E.controls.wrapper} ${E.labels} .${T.hidden}`,I=Fe.call(this,w);Array.from(I).forEach(_=>{be(_,this.config.classNames.hidden,!1),be(_,this.config.classNames.tooltip,!0)})}},setMediaMetadata(){try{"mediaSession"in navigator&&(navigator.mediaSession.metadata=new window.MediaMetadata({title:this.config.mediaMetadata.title,artist:this.config.mediaMetadata.artist,album:this.config.mediaMetadata.album,artwork:this.config.mediaMetadata.artwork}))}catch{}},setMarkers(){var u,m;if(!this.duration||this.elements.markers)return;const d=(u=this.config.markers)===null||u===void 0||(m=u.points)===null||m===void 0?void 0:m.filter(({time:_})=>_>0&&_<this.duration);if(d==null||!d.length)return;const p=document.createDocumentFragment(),T=document.createDocumentFragment();let E=null;const w=`${this.config.classNames.tooltip}--visible`,I=_=>be(E,w,_);d.forEach(_=>{const $=D("span",{class:this.config.classNames.marker},""),Q=_.time/this.duration*100+"%";E&&($.addEventListener("mouseenter",()=>{_.label||(E.style.left=Q,E.innerHTML=_.label,I(!0))}),$.addEventListener("mouseleave",()=>{I(!1)})),$.addEventListener("click",()=>{this.currentTime=_.time}),$.style.left=Q,T.appendChild($)}),p.appendChild(T),this.config.tooltips.seek||(E=D("span",{class:this.config.classNames.tooltip},""),p.appendChild(E)),this.elements.markers={points:T,tip:E},this.elements.progress.appendChild(p)}};function We(u,m=!0){let d=u;if(m){const p=document.createElement("a");p.href=d,d=p.href}try{return new URL(d)}catch{return null}}function ns(u){const m=new URLSearchParams;return x.object(u)&&Object.entries(u).forEach(([d,p])=>{m.set(d,p)}),m}const we={setup(){if(!this.supported.ui)return;if(!this.isVideo||this.isYouTube||this.isHTML5&&!He.textTracks)return void(x.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&X.setCaptionsMenu.call(this));var u,m;if(x.element(this.elements.captions)||(this.elements.captions=D("div",Me(this.config.selectors.captions)),this.elements.captions.setAttribute("dir","auto"),u=this.elements.captions,m=this.elements.wrapper,x.element(u)&&x.element(m)&&m.parentNode.insertBefore(u,m.nextSibling)),F.isIE&&window.URL){const E=this.media.querySelectorAll("track");Array.from(E).forEach(w=>{const I=w.getAttribute("src"),_=We(I);_!==null&&_.hostname!==window.location.href.hostname&&["http:","https:"].includes(_.protocol)&&$t(I,"blob").then($=>{w.setAttribute("src",window.URL.createObjectURL($))}).catch(()=>{ce(w)})})}const d=Dt((navigator.languages||[navigator.language||navigator.userLanguage||"en"]).map(E=>E.split("-")[0]));let p=(this.storage.get("language")||this.config.captions.language||"auto").toLowerCase();p==="auto"&&([p]=d);let T=this.storage.get("captions");if(x.boolean(T)||({active:T}=this.config.captions),Object.assign(this.captions,{toggled:!1,active:T,language:p,languages:d}),this.isHTML5){const E=this.config.captions.update?"addtrack removetrack":"removetrack";Le.call(this,this.media.textTracks,E,we.update.bind(this))}setTimeout(we.update.bind(this),0)},update(){const u=we.getTracks.call(this,!0),{active:m,language:d,meta:p,currentTrackNode:T}=this.captions,E=!!u.find(w=>w.language===d);this.isHTML5&&this.isVideo&&u.filter(w=>!p.get(w)).forEach(w=>{this.debug.log("Track added",w),p.set(w,{default:w.mode==="showing"}),w.mode==="showing"&&(w.mode="hidden"),Le.call(this,w,"cuechange",()=>we.updateCues.call(this))}),(E&&this.language!==d||!u.includes(T))&&(we.setLanguage.call(this,d),we.toggle.call(this,m&&E)),this.elements&&be(this.elements.container,this.config.classNames.captions.enabled,!x.empty(u)),x.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&X.setCaptionsMenu.call(this)},toggle(u,m=!0){if(!this.supported.ui)return;const{toggled:d}=this.captions,p=this.config.classNames.captions.active,T=x.nullOrUndefined(u)?!d:u;if(T!==d){if(m||(this.captions.active=T,this.storage.set({captions:T})),!this.language&&T&&!m){const E=we.getTracks.call(this),w=we.findTrack.call(this,[this.captions.language,...this.captions.languages],!0);return this.captions.language=w.language,void we.set.call(this,E.indexOf(w))}this.elements.buttons.captions&&(this.elements.buttons.captions.pressed=T),be(this.elements.container,p,T),this.captions.toggled=T,X.updateSetting.call(this,"captions"),he.call(this,this.media,T?"captionsenabled":"captionsdisabled")}setTimeout(()=>{T&&this.captions.toggled&&(this.captions.currentTrackNode.mode="hidden")})},set(u,m=!0){const d=we.getTracks.call(this);if(u!==-1)if(x.number(u))if(u in d){if(this.captions.currentTrack!==u){this.captions.currentTrack=u;const p=d[u],{language:T}=p||{};this.captions.currentTrackNode=p,X.updateSetting.call(this,"captions"),m||(this.captions.language=T,this.storage.set({language:T})),this.isVimeo&&this.embed.enableTextTrack(T),he.call(this,this.media,"languagechange")}we.toggle.call(this,!0,m),this.isHTML5&&this.isVideo&&we.updateCues.call(this)}else this.debug.warn("Track not found",u);else this.debug.warn("Invalid caption argument",u);else we.toggle.call(this,!1,m)},setLanguage(u,m=!0){if(!x.string(u))return void this.debug.warn("Invalid language argument",u);const d=u.toLowerCase();this.captions.language=d;const p=we.getTracks.call(this),T=we.findTrack.call(this,[d]);we.set.call(this,p.indexOf(T),m)},getTracks(u=!1){return Array.from((this.media||{}).textTracks||[]).filter(m=>!this.isHTML5||u||this.captions.meta.has(m)).filter(m=>["captions","subtitles"].includes(m.kind))},findTrack(u,m=!1){const d=we.getTracks.call(this),p=w=>Number((this.captions.meta.get(w)||{}).default),T=Array.from(d).sort((w,I)=>p(I)-p(w));let E;return u.every(w=>(E=T.find(I=>I.language===w),!E)),E||(m?T[0]:void 0)},getCurrentTrack(){return we.getTracks.call(this)[this.currentTrack]},getLabel(u){let m=u;return!x.track(m)&&He.textTracks&&this.captions.toggled&&(m=we.getCurrentTrack.call(this)),x.track(m)?x.empty(m.label)?x.empty(m.language)?je.get("enabled",this.config):u.language.toUpperCase():m.label:je.get("disabled",this.config)},updateCues(u){if(!this.supported.ui)return;if(!x.element(this.elements.captions))return void this.debug.warn("No captions element to render to");if(!x.nullOrUndefined(u)&&!Array.isArray(u))return void this.debug.warn("updateCues: Invalid input",u);let m=u;if(!m){const p=we.getCurrentTrack.call(this);m=Array.from((p||{}).activeCues||[]).map(T=>T.getCueAsHTML()).map(ue)}const d=m.map(p=>p.trim()).join(`
`);if(d!==this.elements.captions.innerHTML){ne(this.elements.captions);const p=D("span",Me(this.config.selectors.caption));p.innerHTML=d,this.elements.captions.appendChild(p),he.call(this,this.media,"cuechange")}}},$i={enabled:!0,title:"",debug:!1,autoplay:!1,autopause:!0,playsinline:!0,seekTime:10,volume:1,muted:!1,duration:null,displayDuration:!0,invertTime:!0,toggleInvert:!0,ratio:null,clickToPlay:!0,hideControls:!0,resetOnEnd:!1,disableContextMenu:!0,loadSprite:!0,iconPrefix:"plyr",iconUrl:"https://cdn.plyr.io/3.7.8/plyr.svg",blankVideo:"https://cdn.plyr.io/static/blank.mp4",quality:{default:576,options:[4320,2880,2160,1440,1080,720,576,480,360,240],forced:!1,onChange:null},loop:{active:!1},speed:{selected:1,options:[.5,.75,1,1.25,1.5,1.75,2,4]},keyboard:{focused:!0,global:!1},tooltips:{controls:!1,seek:!0},captions:{active:!1,language:"auto",update:!1},fullscreen:{enabled:!0,fallback:!0,iosNative:!1},storage:{enabled:!0,key:"plyr"},controls:["play-large","play","progress","current-time","mute","volume","captions","settings","pip","airplay","fullscreen"],settings:["captions","quality","speed"],i18n:{restart:"Restart",rewind:"Rewind {seektime}s",play:"Play",pause:"Pause",fastForward:"Forward {seektime}s",seek:"Seek",seekLabel:"{currentTime} of {duration}",played:"Played",buffered:"Buffered",currentTime:"Current time",duration:"Duration",volume:"Volume",mute:"Mute",unmute:"Unmute",enableCaptions:"Enable captions",disableCaptions:"Disable captions",download:"Download",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",frameTitle:"Player for {title}",captions:"Captions",settings:"Settings",pip:"PIP",menuBack:"Go back to previous menu",speed:"Speed",normal:"Normal",quality:"Quality",loop:"Loop",start:"Start",end:"End",all:"All",reset:"Reset",disabled:"Disabled",enabled:"Enabled",advertisement:"Ad",qualityBadge:{2160:"4K",1440:"HD",1080:"HD",720:"HD",576:"SD",480:"SD"}},urls:{download:null,vimeo:{sdk:"https://player.vimeo.com/api/player.js",iframe:"https://player.vimeo.com/video/{0}?{1}",api:"https://vimeo.com/api/oembed.json?url={0}"},youtube:{sdk:"https://www.youtube.com/iframe_api",api:"https://noembed.com/embed?url=https://www.youtube.com/watch?v={0}"},googleIMA:{sdk:"https://imasdk.googleapis.com/js/sdkloader/ima3.js"}},listeners:{seek:null,play:null,pause:null,restart:null,rewind:null,fastForward:null,mute:null,volume:null,captions:null,download:null,fullscreen:null,pip:null,airplay:null,speed:null,quality:null,loop:null,language:null},events:["ended","progress","stalled","playing","waiting","canplay","canplaythrough","loadstart","loadeddata","loadedmetadata","timeupdate","volumechange","play","pause","error","seeking","seeked","emptied","ratechange","cuechange","download","enterfullscreen","exitfullscreen","captionsenabled","captionsdisabled","languagechange","controlshidden","controlsshown","ready","statechange","qualitychange","adsloaded","adscontentpause","adscontentresume","adstarted","adsmidpoint","adscomplete","adsallcomplete","adsimpression","adsclick"],selectors:{editable:"input, textarea, select, [contenteditable]",container:".plyr",controls:{container:null,wrapper:".plyr__controls"},labels:"[data-plyr]",buttons:{play:'[data-plyr="play"]',pause:'[data-plyr="pause"]',restart:'[data-plyr="restart"]',rewind:'[data-plyr="rewind"]',fastForward:'[data-plyr="fast-forward"]',mute:'[data-plyr="mute"]',captions:'[data-plyr="captions"]',download:'[data-plyr="download"]',fullscreen:'[data-plyr="fullscreen"]',pip:'[data-plyr="pip"]',airplay:'[data-plyr="airplay"]',settings:'[data-plyr="settings"]',loop:'[data-plyr="loop"]'},inputs:{seek:'[data-plyr="seek"]',volume:'[data-plyr="volume"]',speed:'[data-plyr="speed"]',language:'[data-plyr="language"]',quality:'[data-plyr="quality"]'},display:{currentTime:".plyr__time--current",duration:".plyr__time--duration",buffer:".plyr__progress__buffer",loop:".plyr__progress__loop",volume:".plyr__volume--display"},progress:".plyr__progress",captions:".plyr__captions",caption:".plyr__caption"},classNames:{type:"plyr--{0}",provider:"plyr--{0}",video:"plyr__video-wrapper",embed:"plyr__video-embed",videoFixedRatio:"plyr__video-wrapper--fixed-ratio",embedContainer:"plyr__video-embed__container",poster:"plyr__poster",posterEnabled:"plyr__poster-enabled",ads:"plyr__ads",control:"plyr__control",controlPressed:"plyr__control--pressed",playing:"plyr--playing",paused:"plyr--paused",stopped:"plyr--stopped",loading:"plyr--loading",hover:"plyr--hover",tooltip:"plyr__tooltip",cues:"plyr__cues",marker:"plyr__progress__marker",hidden:"plyr__sr-only",hideControls:"plyr--hide-controls",isTouch:"plyr--is-touch",uiSupported:"plyr--full-ui",noTransition:"plyr--no-transition",display:{time:"plyr__time"},menu:{value:"plyr__menu__value",badge:"plyr__badge",open:"plyr--menu-open"},captions:{enabled:"plyr--captions-enabled",active:"plyr--captions-active"},fullscreen:{enabled:"plyr--fullscreen-enabled",fallback:"plyr--fullscreen-fallback"},pip:{supported:"plyr--pip-supported",active:"plyr--pip-active"},airplay:{supported:"plyr--airplay-supported",active:"plyr--airplay-active"},previewThumbnails:{thumbContainer:"plyr__preview-thumb",thumbContainerShown:"plyr__preview-thumb--is-shown",imageContainer:"plyr__preview-thumb__image-container",timeContainer:"plyr__preview-thumb__time-container",scrubbingContainer:"plyr__preview-scrubbing",scrubbingContainerShown:"plyr__preview-scrubbing--is-shown"}},attributes:{embed:{provider:"data-plyr-provider",id:"data-plyr-embed-id",hash:"data-plyr-embed-hash"}},ads:{enabled:!1,publisherId:"",tagUrl:""},previewThumbnails:{enabled:!1,src:""},vimeo:{byline:!1,portrait:!1,title:!1,speed:!0,transparent:!1,customControls:!0,referrerPolicy:null,premium:!1},youtube:{rel:0,showinfo:0,iv_load_policy:3,modestbranding:1,customControls:!0,noCookie:!1},mediaMetadata:{title:"",artist:"",album:"",artwork:[]},markers:{enabled:!1,points:[]}},ui="picture-in-picture",Re="inline",Vt={html5:"html5",youtube:"youtube",vimeo:"vimeo"},Vi="audio",rs="video",Gi=()=>{};class ks{constructor(m=!1){this.enabled=window.console&&m,this.enabled&&this.log("Debugging enabled")}get log(){return this.enabled?Function.prototype.bind.call(console.log,console):Gi}get warn(){return this.enabled?Function.prototype.bind.call(console.warn,console):Gi}get error(){return this.enabled?Function.prototype.bind.call(console.error,console):Gi}}class vt{constructor(m){H(this,"onChange",()=>{if(!this.supported)return;const d=this.player.elements.buttons.fullscreen;x.element(d)&&(d.pressed=this.active);const p=this.target===this.player.media?this.target:this.player.elements.container;he.call(this.player,p,this.active?"enterfullscreen":"exitfullscreen",!0)}),H(this,"toggleFallback",(d=!1)=>{if(d?this.scrollPosition={x:window.scrollX??0,y:window.scrollY??0}:window.scrollTo(this.scrollPosition.x,this.scrollPosition.y),document.body.style.overflow=d?"hidden":"",be(this.target,this.player.config.classNames.fullscreen.fallback,d),F.isIos){let p=document.head.querySelector('meta[name="viewport"]');const T="viewport-fit=cover";p||(p=document.createElement("meta"),p.setAttribute("name","viewport"));const E=x.string(p.content)&&p.content.includes(T);d?(this.cleanupViewport=!E,E||(p.content+=`,${T}`)):this.cleanupViewport&&(p.content=p.content.split(",").filter(w=>w.trim()!==T).join(","))}this.onChange()}),H(this,"trapFocus",d=>{if(F.isIos||F.isIPadOS||!this.active||d.key!=="Tab")return;const p=document.activeElement,T=Fe.call(this.player,"a[href], button:not(:disabled), input:not(:disabled), [tabindex]"),[E]=T,w=T[T.length-1];p!==w||d.shiftKey?p===E&&d.shiftKey&&(w.focus(),d.preventDefault()):(E.focus(),d.preventDefault())}),H(this,"update",()=>{if(this.supported){let d;d=this.forceFallback?"Fallback (forced)":vt.nativeSupported?"Native":"Fallback",this.player.debug.log(`${d} fullscreen enabled`)}else this.player.debug.log("Fullscreen not supported and fallback disabled");be(this.player.elements.container,this.player.config.classNames.fullscreen.enabled,this.supported)}),H(this,"enter",()=>{this.supported&&(F.isIos&&this.player.config.fullscreen.iosNative?this.player.isVimeo?this.player.embed.requestFullscreen():this.target.webkitEnterFullscreen():!vt.nativeSupported||this.forceFallback?this.toggleFallback(!0):this.prefix?x.empty(this.prefix)||this.target[`${this.prefix}Request${this.property}`]():this.target.requestFullscreen({navigationUI:"hide"}))}),H(this,"exit",()=>{if(this.supported)if(F.isIos&&this.player.config.fullscreen.iosNative)this.player.isVimeo?this.player.embed.exitFullscreen():this.target.webkitEnterFullscreen(),Ct(this.player.play());else if(!vt.nativeSupported||this.forceFallback)this.toggleFallback(!1);else if(this.prefix){if(!x.empty(this.prefix)){const d=this.prefix==="moz"?"Cancel":"Exit";document[`${this.prefix}${d}${this.property}`]()}}else(document.cancelFullScreen||document.exitFullscreen).call(document)}),H(this,"toggle",()=>{this.active?this.exit():this.enter()}),this.player=m,this.prefix=vt.prefix,this.property=vt.property,this.scrollPosition={x:0,y:0},this.forceFallback=m.config.fullscreen.fallback==="force",this.player.elements.fullscreen=m.config.fullscreen.container&&function(d,p){const{prototype:T}=Element;return(T.closest||function(){let E=this;do{if(Lt.matches(E,p))return E;E=E.parentElement||E.parentNode}while(E!==null&&E.nodeType===1);return null}).call(d,p)}(this.player.elements.container,m.config.fullscreen.container),Le.call(this.player,document,this.prefix==="ms"?"MSFullscreenChange":`${this.prefix}fullscreenchange`,()=>{this.onChange()}),Le.call(this.player,this.player.elements.container,"dblclick",d=>{x.element(this.player.elements.controls)&&this.player.elements.controls.contains(d.target)||this.player.listeners.proxy(d,this.toggle,"fullscreen")}),Le.call(this,this.player.elements.container,"keydown",d=>this.trapFocus(d)),this.update()}static get nativeSupported(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}get useNative(){return vt.nativeSupported&&!this.forceFallback}static get prefix(){if(x.function(document.exitFullscreen))return"";let m="";return["webkit","moz","ms"].some(d=>!(!x.function(document[`${d}ExitFullscreen`])&&!x.function(document[`${d}CancelFullScreen`]))&&(m=d,!0)),m}static get property(){return this.prefix==="moz"?"FullScreen":"Fullscreen"}get supported(){return[this.player.config.fullscreen.enabled,this.player.isVideo,vt.nativeSupported||this.player.config.fullscreen.fallback,!this.player.isYouTube||vt.nativeSupported||!F.isIos||this.player.config.playsinline&&!this.player.config.fullscreen.iosNative].every(Boolean)}get active(){if(!this.supported)return!1;if(!vt.nativeSupported||this.forceFallback)return Ne(this.target,this.player.config.classNames.fullscreen.fallback);const m=this.prefix?this.target.getRootNode()[`${this.prefix}${this.property}Element`]:this.target.getRootNode().fullscreenElement;return m&&m.shadowRoot?m===this.target.getRootNode().host:m===this.target}get target(){return F.isIos&&this.player.config.fullscreen.iosNative?this.player.media:this.player.elements.fullscreen??this.player.elements.container}}function Ai(u,m=1){return new Promise((d,p)=>{const T=new Image,E=()=>{delete T.onload,delete T.onerror,(T.naturalWidth>=m?d:p)(T)};Object.assign(T,{onload:E,onerror:E,src:u})})}const Ce={addStyleHook(){be(this.elements.container,this.config.selectors.container.replace(".",""),!0),be(this.elements.container,this.config.classNames.uiSupported,this.supported.ui)},toggleNativeControls(u=!1){u&&this.isHTML5?this.media.setAttribute("controls",""):this.media.removeAttribute("controls")},build(){if(this.listeners.media(),!this.supported.ui)return this.debug.warn(`Basic support only for ${this.provider} ${this.type}`),void Ce.toggleNativeControls.call(this,!0);x.element(this.elements.controls)||(X.inject.call(this),this.listeners.controls()),Ce.toggleNativeControls.call(this),this.isHTML5&&we.setup.call(this),this.volume=null,this.muted=null,this.loop=null,this.quality=null,this.speed=null,X.updateVolume.call(this),X.timeUpdate.call(this),X.durationUpdate.call(this),Ce.checkPlaying.call(this),be(this.elements.container,this.config.classNames.pip.supported,He.pip&&this.isHTML5&&this.isVideo),be(this.elements.container,this.config.classNames.airplay.supported,He.airplay&&this.isHTML5),be(this.elements.container,this.config.classNames.isTouch,this.touch),this.ready=!0,setTimeout(()=>{he.call(this,this.media,"ready")},0),Ce.setTitle.call(this),this.poster&&Ce.setPoster.call(this,this.poster,!1).catch(()=>{}),this.config.duration&&X.durationUpdate.call(this),this.config.mediaMetadata&&X.setMediaMetadata.call(this)},setTitle(){let u=je.get("play",this.config);if(x.string(this.config.title)&&!x.empty(this.config.title)&&(u+=`, ${this.config.title}`),Array.from(this.elements.buttons.play||[]).forEach(m=>{m.setAttribute("aria-label",u)}),this.isEmbed){const m=Pe.call(this,"iframe");if(!x.element(m))return;const d=x.empty(this.config.title)?"video":this.config.title,p=je.get("frameTitle",this.config);m.setAttribute("title",p.replace("{title}",d))}},togglePoster(u){be(this.elements.container,this.config.classNames.posterEnabled,u)},setPoster(u,m=!0){return m&&this.poster?Promise.reject(new Error("Poster already set")):(this.media.setAttribute("data-poster",u),this.elements.poster.removeAttribute("hidden"),bi.call(this).then(()=>Ai(u)).catch(d=>{throw u===this.poster&&Ce.togglePoster.call(this,!1),d}).then(()=>{if(u!==this.poster)throw new Error("setPoster cancelled by later call to setPoster")}).then(()=>(Object.assign(this.elements.poster.style,{backgroundImage:`url('${u}')`,backgroundSize:""}),Ce.togglePoster.call(this,!0),u)))},checkPlaying(u){be(this.elements.container,this.config.classNames.playing,this.playing),be(this.elements.container,this.config.classNames.paused,this.paused),be(this.elements.container,this.config.classNames.stopped,this.stopped),Array.from(this.elements.buttons.play||[]).forEach(m=>{Object.assign(m,{pressed:this.playing}),m.setAttribute("aria-label",je.get(this.playing?"pause":"play",this.config))}),x.event(u)&&u.type==="timeupdate"||Ce.toggleControls.call(this)},checkLoading(u){this.loading=["stalled","waiting"].includes(u.type),clearTimeout(this.timers.loading),this.timers.loading=setTimeout(()=>{be(this.elements.container,this.config.classNames.loading,this.loading),Ce.toggleControls.call(this)},this.loading?250:0)},toggleControls(u){const{controls:m}=this.elements;if(m&&this.config.hideControls){const d=this.touch&&this.lastSeekTime+2e3>Date.now();this.toggleControls(!!(u||this.loading||this.paused||m.pressed||m.hover||d))}},migrateStyles(){Object.values({...this.media.style}).filter(u=>!x.empty(u)&&x.string(u)&&u.startsWith("--plyr")).forEach(u=>{this.elements.container.style.setProperty(u,this.media.style.getPropertyValue(u)),this.media.style.removeProperty(u)}),x.empty(this.media.style)&&this.media.removeAttribute("style")}};class Rs{constructor(m){H(this,"firstTouch",()=>{const{player:d}=this,{elements:p}=d;d.touch=!0,be(p.container,d.config.classNames.isTouch,!0)}),H(this,"global",(d=!0)=>{const{player:p}=this;p.config.keyboard.global&&si.call(p,window,"keydown keyup",this.handleKey,d,!1),si.call(p,document.body,"click",this.toggleMenu,d),Fi.call(p,document.body,"touchstart",this.firstTouch)}),H(this,"container",()=>{const{player:d}=this,{config:p,elements:T,timers:E}=d;!p.keyboard.global&&p.keyboard.focused&&Le.call(d,T.container,"keydown keyup",this.handleKey,!1),Le.call(d,T.container,"mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen",_=>{const{controls:$}=T;$&&_.type==="enterfullscreen"&&($.pressed=!1,$.hover=!1);let Q=0;["touchstart","touchmove","mousemove"].includes(_.type)&&(Ce.toggleControls.call(d,!0),Q=d.touch?3e3:2e3),clearTimeout(E.controls),E.controls=setTimeout(()=>Ce.toggleControls.call(d,!1),Q)});const w=()=>{if(!d.isVimeo||d.config.vimeo.premium)return;const _=T.wrapper,{active:$}=d.fullscreen,[Q,le]=Ui.call(d),q=Mi(`aspect-ratio: ${Q} / ${le}`);if(!$)return void(q?(_.style.width=null,_.style.height=null):(_.style.maxWidth=null,_.style.margin=null));const[re,Ee]=[Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)],Se=re/Ee>Q/le;q?(_.style.width=Se?"auto":"100%",_.style.height=Se?"100%":"auto"):(_.style.maxWidth=Se?Ee/le*Q+"px":null,_.style.margin=Se?"0 auto":null)},I=()=>{clearTimeout(E.resized),E.resized=setTimeout(w,50)};Le.call(d,T.container,"enterfullscreen exitfullscreen",_=>{const{target:$}=d.fullscreen;$===T.container&&(!d.isEmbed&&x.empty(d.config.ratio)||(w(),(_.type==="enterfullscreen"?Le:vi).call(d,window,"resize",I)))})}),H(this,"media",()=>{const{player:d}=this,{elements:p}=d;if(Le.call(d,d.media,"timeupdate seeking seeked",E=>X.timeUpdate.call(d,E)),Le.call(d,d.media,"durationchange loadeddata loadedmetadata",E=>X.durationUpdate.call(d,E)),Le.call(d,d.media,"ended",()=>{d.isHTML5&&d.isVideo&&d.config.resetOnEnd&&(d.restart(),d.pause())}),Le.call(d,d.media,"progress playing seeking seeked",E=>X.updateProgress.call(d,E)),Le.call(d,d.media,"volumechange",E=>X.updateVolume.call(d,E)),Le.call(d,d.media,"playing play pause ended emptied timeupdate",E=>Ce.checkPlaying.call(d,E)),Le.call(d,d.media,"waiting canplay seeked playing",E=>Ce.checkLoading.call(d,E)),d.supported.ui&&d.config.clickToPlay&&!d.isAudio){const E=Pe.call(d,`.${d.config.classNames.video}`);if(!x.element(E))return;Le.call(d,p.container,"click",w=>{([p.container,E].includes(w.target)||E.contains(w.target))&&(d.touch&&d.config.hideControls||(d.ended?(this.proxy(w,d.restart,"restart"),this.proxy(w,()=>{Ct(d.play())},"play")):this.proxy(w,()=>{Ct(d.togglePlay())},"play")))})}d.supported.ui&&d.config.disableContextMenu&&Le.call(d,p.wrapper,"contextmenu",E=>{E.preventDefault()},!1),Le.call(d,d.media,"volumechange",()=>{d.storage.set({volume:d.volume,muted:d.muted})}),Le.call(d,d.media,"ratechange",()=>{X.updateSetting.call(d,"speed"),d.storage.set({speed:d.speed})}),Le.call(d,d.media,"qualitychange",E=>{X.updateSetting.call(d,"quality",null,E.detail.quality)}),Le.call(d,d.media,"ready qualitychange",()=>{X.setDownloadUrl.call(d)});const T=d.config.events.concat(["keyup","keydown"]).join(" ");Le.call(d,d.media,T,E=>{let{detail:w={}}=E;E.type==="error"&&(w=d.media.error),he.call(d,p.container,E.type,!0,w)})}),H(this,"proxy",(d,p,T)=>{const{player:E}=this,w=E.config.listeners[T];let I=!0;x.function(w)&&(I=w.call(E,d)),I!==!1&&x.function(p)&&p.call(E,d)}),H(this,"bind",(d,p,T,E,w=!0)=>{const{player:I}=this,_=I.config.listeners[E],$=x.function(_);Le.call(I,d,p,Q=>this.proxy(Q,T,E),w&&!$)}),H(this,"controls",()=>{const{player:d}=this,{elements:p}=d,T=F.isIE?"change":"input";if(p.buttons.play&&Array.from(p.buttons.play).forEach(E=>{this.bind(E,"click",()=>{Ct(d.togglePlay())},"play")}),this.bind(p.buttons.restart,"click",d.restart,"restart"),this.bind(p.buttons.rewind,"click",()=>{d.lastSeekTime=Date.now(),d.rewind()},"rewind"),this.bind(p.buttons.fastForward,"click",()=>{d.lastSeekTime=Date.now(),d.forward()},"fastForward"),this.bind(p.buttons.mute,"click",()=>{d.muted=!d.muted},"mute"),this.bind(p.buttons.captions,"click",()=>d.toggleCaptions()),this.bind(p.buttons.download,"click",()=>{he.call(d,d.media,"download")},"download"),this.bind(p.buttons.fullscreen,"click",()=>{d.fullscreen.toggle()},"fullscreen"),this.bind(p.buttons.pip,"click",()=>{d.pip="toggle"},"pip"),this.bind(p.buttons.airplay,"click",d.airplay,"airplay"),this.bind(p.buttons.settings,"click",E=>{E.stopPropagation(),E.preventDefault(),X.toggleMenu.call(d,E)},null,!1),this.bind(p.buttons.settings,"keyup",E=>{[" ","Enter"].includes(E.key)&&(E.key!=="Enter"?(E.preventDefault(),E.stopPropagation(),X.toggleMenu.call(d,E)):X.focusFirstMenuItem.call(d,null,!0))},null,!1),this.bind(p.settings.menu,"keydown",E=>{E.key==="Escape"&&X.toggleMenu.call(d,E)}),this.bind(p.inputs.seek,"mousedown mousemove",E=>{const w=p.progress.getBoundingClientRect(),I=100/w.width*(E.pageX-w.left);E.currentTarget.setAttribute("seek-value",I)}),this.bind(p.inputs.seek,"mousedown mouseup keydown keyup touchstart touchend",E=>{const w=E.currentTarget,I="play-on-seeked";if(x.keyboardEvent(E)&&!["ArrowLeft","ArrowRight"].includes(E.key))return;d.lastSeekTime=Date.now();const _=w.hasAttribute(I),$=["mouseup","touchend","keyup"].includes(E.type);_&&$?(w.removeAttribute(I),Ct(d.play())):!$&&d.playing&&(w.setAttribute(I,""),d.pause())}),F.isIos){const E=Fe.call(d,'input[type="range"]');Array.from(E).forEach(w=>this.bind(w,T,I=>yi(I.target)))}this.bind(p.inputs.seek,T,E=>{const w=E.currentTarget;let I=w.getAttribute("seek-value");x.empty(I)&&(I=w.value),w.removeAttribute("seek-value"),d.currentTime=I/w.max*d.duration},"seek"),this.bind(p.progress,"mouseenter mouseleave mousemove",E=>X.updateSeekTooltip.call(d,E)),this.bind(p.progress,"mousemove touchmove",E=>{const{previewThumbnails:w}=d;w&&w.loaded&&w.startMove(E)}),this.bind(p.progress,"mouseleave touchend click",()=>{const{previewThumbnails:E}=d;E&&E.loaded&&E.endMove(!1,!0)}),this.bind(p.progress,"mousedown touchstart",E=>{const{previewThumbnails:w}=d;w&&w.loaded&&w.startScrubbing(E)}),this.bind(p.progress,"mouseup touchend",E=>{const{previewThumbnails:w}=d;w&&w.loaded&&w.endScrubbing(E)}),F.isWebKit&&Array.from(Fe.call(d,'input[type="range"]')).forEach(E=>{this.bind(E,"input",w=>X.updateRangeFill.call(d,w.target))}),d.config.toggleInvert&&!x.element(p.display.duration)&&this.bind(p.display.currentTime,"click",()=>{d.currentTime!==0&&(d.config.invertTime=!d.config.invertTime,X.timeUpdate.call(d))}),this.bind(p.inputs.volume,T,E=>{d.volume=E.target.value},"volume"),this.bind(p.controls,"mouseenter mouseleave",E=>{p.controls.hover=!d.touch&&E.type==="mouseenter"}),p.fullscreen&&Array.from(p.fullscreen.children).filter(E=>!E.contains(p.container)).forEach(E=>{this.bind(E,"mouseenter mouseleave",w=>{p.controls&&(p.controls.hover=!d.touch&&w.type==="mouseenter")})}),this.bind(p.controls,"mousedown mouseup touchstart touchend touchcancel",E=>{p.controls.pressed=["mousedown","touchstart"].includes(E.type)}),this.bind(p.controls,"focusin",()=>{const{config:E,timers:w}=d;be(p.controls,E.classNames.noTransition,!0),Ce.toggleControls.call(d,!0),setTimeout(()=>{be(p.controls,E.classNames.noTransition,!1)},0);const I=this.touch?3e3:4e3;clearTimeout(w.controls),w.controls=setTimeout(()=>Ce.toggleControls.call(d,!1),I)}),this.bind(p.inputs.volume,"wheel",E=>{const w=E.webkitDirectionInvertedFromDevice,[I,_]=[E.deltaX,-E.deltaY].map(le=>w?-le:le),$=Math.sign(Math.abs(I)>Math.abs(_)?I:_);d.increaseVolume($/50);const{volume:Q}=d.media;($===1&&Q<1||$===-1&&Q>0)&&E.preventDefault()},"volume",!1)}),this.player=m,this.lastKey=null,this.focusTimer=null,this.lastKeyDown=null,this.handleKey=this.handleKey.bind(this),this.toggleMenu=this.toggleMenu.bind(this),this.firstTouch=this.firstTouch.bind(this)}handleKey(m){const{player:d}=this,{elements:p}=d,{key:T,type:E,altKey:w,ctrlKey:I,metaKey:_,shiftKey:$}=m,Q=E==="keydown",le=Q&&T===this.lastKey;if(!(w||I||_||$)&&T){if(Q){const re=document.activeElement;if(x.element(re)){const{editable:Ee}=d.config.selectors,{seek:Se}=p.inputs;if(re!==Se&&Lt(re,Ee)||m.key===" "&&Lt(re,'button, [role^="menuitem"]'))return}switch([" ","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","0","1","2","3","4","5","6","7","8","9","c","f","k","l","m"].includes(T)&&(m.preventDefault(),m.stopPropagation()),T){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":le||(q=parseInt(T,10),d.currentTime=d.duration/10*q);break;case" ":case"k":le||Ct(d.togglePlay());break;case"ArrowUp":d.increaseVolume(.1);break;case"ArrowDown":d.decreaseVolume(.1);break;case"m":le||(d.muted=!d.muted);break;case"ArrowRight":d.forward();break;case"ArrowLeft":d.rewind();break;case"f":d.fullscreen.toggle();break;case"c":le||d.toggleCaptions();break;case"l":d.loop=!d.loop}T==="Escape"&&!d.fullscreen.usingNative&&d.fullscreen.active&&d.fullscreen.toggle(),this.lastKey=T}else this.lastKey=null;var q}}toggleMenu(m){X.toggleMenu.call(this.player,m)}}typeof globalThis<"u"||typeof window<"u"||(typeof oe.g<"u"?oe.g:typeof self<"u");var as=function(u,m){return u(m={exports:{}},m.exports),m.exports}(function(u,m){u.exports=function(){var d=function(){},p={},T={},E={};function w(q,re){q=q.push?q:[q];var Ee,Se,qe,ae=[],ze=q.length,U=ze;for(Ee=function(Ae,it){it.length&&ae.push(Ae),--U||re(ae)};ze--;)Se=q[ze],(qe=T[Se])?Ee(Se,qe):(E[Se]=E[Se]||[]).push(Ee)}function I(q,re){if(q){var Ee=E[q];if(T[q]=re,Ee)for(;Ee.length;)Ee[0](q,re),Ee.splice(0,1)}}function _(q,re){q.call&&(q={success:q}),re.length?(q.error||d)(re):(q.success||d)(q)}function $(q,re,Ee,Se){var qe,ae,ze=document,U=Ee.async,Ae=(Ee.numRetries||0)+1,it=Ee.before||d,ye=q.replace(/[\?|#].*$/,""),wt=q.replace(/^(css|img)!/,"");Se=Se||0,/(^css!|\.css$)/.test(ye)?((ae=ze.createElement("link")).rel="stylesheet",ae.href=wt,(qe="hideFocus"in ae)&&ae.relList&&(qe=0,ae.rel="preload",ae.as="style")):/(^img!|\.(png|gif|jpg|svg|webp)$)/.test(ye)?(ae=ze.createElement("img")).src=wt:((ae=ze.createElement("script")).src=q,ae.async=U===void 0||U),ae.onload=ae.onerror=ae.onbeforeload=function(Pt){var wi=Pt.type[0];if(qe)try{ae.sheet.cssText.length||(wi="e")}catch(cs){cs.code!=18&&(wi="e")}if(wi=="e"){if((Se+=1)<Ae)return $(q,re,Ee,Se)}else if(ae.rel=="preload"&&ae.as=="style")return ae.rel="stylesheet";re(q,wi,Pt.defaultPrevented)},it(q,ae)!==!1&&ze.head.appendChild(ae)}function Q(q,re,Ee){var Se,qe,ae=(q=q.push?q:[q]).length,ze=ae,U=[];for(Se=function(Ae,it,ye){if(it=="e"&&U.push(Ae),it=="b"){if(!ye)return;U.push(Ae)}--ae||re(U)},qe=0;qe<ze;qe++)$(q[qe],Se,Ee)}function le(q,re,Ee){var Se,qe;if(re&&re.trim&&(Se=re),qe=(Se?Ee:re)||{},Se){if(Se in p)throw"LoadJS";p[Se]=!0}function ae(ze,U){Q(q,function(Ae){_(qe,Ae),ze&&_({success:ze,error:U},Ae),I(Se,Ae)},qe)}if(qe.returnPromise)return new Promise(ae);ae()}return le.ready=function(q,re){return w(q,function(Ee){_(re,Ee)}),le},le.done=function(q){I(q,[])},le.reset=function(){p={},T={},E={}},le.isDefined=function(q){return q in p},le}()});function Ue(u){return new Promise((m,d)=>{as(u,{success:m,error:d})})}function lt(u){u&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===u&&(this.media.paused=!u,he.call(this,this.media,u?"play":"pause"))}const Si={setup(){const u=this;be(u.elements.wrapper,u.config.classNames.embed,!0),u.options.speed=u.config.speed.options,Ke.call(u),x.object(window.Vimeo)?Si.ready.call(u):Ue(u.config.urls.vimeo.sdk).then(()=>{Si.ready.call(u)}).catch(m=>{u.debug.warn("Vimeo SDK (player.js) failed to load",m)})},ready(){const u=this,m=u.config.vimeo,{premium:d,referrerPolicy:p,...T}=m;let E=u.media.getAttribute("src"),w="";x.empty(E)?(E=u.media.getAttribute(u.config.attributes.embed.id),w=u.media.getAttribute(u.config.attributes.embed.hash)):w=function(U){const Ae=U.match(/^.*(vimeo.com\/|video\/)(\d+)(\?.*&*h=|\/)+([\d,a-f]+)/);return Ae&&Ae.length===5?Ae[4]:null}(E);const I=w?{h:w}:{};d&&Object.assign(T,{controls:!1,sidedock:!1});const _=ns({loop:u.config.loop.active,autoplay:u.autoplay,muted:u.muted,gesture:"media",playsinline:u.config.playsinline,...I,...T}),$=(Q=E,x.empty(Q)?null:x.number(Number(Q))?Q:Q.match(/^.*(vimeo.com\/|video\/)(\d+).*/)?RegExp.$2:Q);var Q;const le=D("iframe"),q=se(u.config.urls.vimeo.iframe,$,_);if(le.setAttribute("src",q),le.setAttribute("allowfullscreen",""),le.setAttribute("allow",["autoplay","fullscreen","picture-in-picture","encrypted-media","accelerometer","gyroscope"].join("; ")),x.empty(p)||le.setAttribute("referrerPolicy",p),d||!m.customControls)le.setAttribute("data-poster",u.poster),u.media=xe(le,u.media);else{const U=D("div",{class:u.config.classNames.embedContainer,"data-poster":u.poster});U.appendChild(le),u.media=xe(U,u.media)}m.customControls||$t(se(u.config.urls.vimeo.api,q)).then(U=>{!x.empty(U)&&U.thumbnail_url&&Ce.setPoster.call(u,U.thumbnail_url).catch(()=>{})}),u.embed=new window.Vimeo.Player(le,{autopause:u.config.autopause,muted:u.muted}),u.media.paused=!0,u.media.currentTime=0,u.supported.ui&&u.embed.disableTextTrack(),u.media.play=()=>(lt.call(u,!0),u.embed.play()),u.media.pause=()=>(lt.call(u,!1),u.embed.pause()),u.media.stop=()=>{u.pause(),u.currentTime=0};let{currentTime:re}=u.media;Object.defineProperty(u.media,"currentTime",{get:()=>re,set(U){const{embed:Ae,media:it,paused:ye,volume:wt}=u,Pt=ye&&!Ae.hasPlayed;it.seeking=!0,he.call(u,it,"seeking"),Promise.resolve(Pt&&Ae.setVolume(0)).then(()=>Ae.setCurrentTime(U)).then(()=>Pt&&Ae.pause()).then(()=>Pt&&Ae.setVolume(wt)).catch(()=>{})}});let Ee=u.config.speed.selected;Object.defineProperty(u.media,"playbackRate",{get:()=>Ee,set(U){u.embed.setPlaybackRate(U).then(()=>{Ee=U,he.call(u,u.media,"ratechange")}).catch(()=>{u.options.speed=[1]})}});let{volume:Se}=u.config;Object.defineProperty(u.media,"volume",{get:()=>Se,set(U){u.embed.setVolume(U).then(()=>{Se=U,he.call(u,u.media,"volumechange")})}});let{muted:qe}=u.config;Object.defineProperty(u.media,"muted",{get:()=>qe,set(U){const Ae=!!x.boolean(U)&&U;u.embed.setMuted(!!Ae||u.config.muted).then(()=>{qe=Ae,he.call(u,u.media,"volumechange")})}});let ae,{loop:ze}=u.config;Object.defineProperty(u.media,"loop",{get:()=>ze,set(U){const Ae=x.boolean(U)?U:u.config.loop.active;u.embed.setLoop(Ae).then(()=>{ze=Ae})}}),u.embed.getVideoUrl().then(U=>{ae=U,X.setDownloadUrl.call(u)}).catch(U=>{this.debug.warn(U)}),Object.defineProperty(u.media,"currentSrc",{get:()=>ae}),Object.defineProperty(u.media,"ended",{get:()=>u.currentTime===u.duration}),Promise.all([u.embed.getVideoWidth(),u.embed.getVideoHeight()]).then(U=>{const[Ae,it]=U;u.embed.ratio=es(Ae,it),Ke.call(this)}),u.embed.setAutopause(u.config.autopause).then(U=>{u.config.autopause=U}),u.embed.getVideoTitle().then(U=>{u.config.title=U,Ce.setTitle.call(this)}),u.embed.getCurrentTime().then(U=>{re=U,he.call(u,u.media,"timeupdate")}),u.embed.getDuration().then(U=>{u.media.duration=U,he.call(u,u.media,"durationchange")}),u.embed.getTextTracks().then(U=>{u.media.textTracks=U,we.setup.call(u)}),u.embed.on("cuechange",({cues:U=[]})=>{const Ae=U.map(it=>function(ye){const wt=document.createDocumentFragment(),Pt=document.createElement("div");return wt.appendChild(Pt),Pt.innerHTML=ye,wt.firstChild.innerText}(it.text));we.updateCues.call(u,Ae)}),u.embed.on("loaded",()=>{u.embed.getPaused().then(U=>{lt.call(u,!U),U||he.call(u,u.media,"playing")}),x.element(u.embed.element)&&u.supported.ui&&u.embed.element.setAttribute("tabindex",-1)}),u.embed.on("bufferstart",()=>{he.call(u,u.media,"waiting")}),u.embed.on("bufferend",()=>{he.call(u,u.media,"playing")}),u.embed.on("play",()=>{lt.call(u,!0),he.call(u,u.media,"playing")}),u.embed.on("pause",()=>{lt.call(u,!1)}),u.embed.on("timeupdate",U=>{u.media.seeking=!1,re=U.seconds,he.call(u,u.media,"timeupdate")}),u.embed.on("progress",U=>{u.media.buffered=U.percent,he.call(u,u.media,"progress"),parseInt(U.percent,10)===1&&he.call(u,u.media,"canplaythrough"),u.embed.getDuration().then(Ae=>{Ae!==u.media.duration&&(u.media.duration=Ae,he.call(u,u.media,"durationchange"))})}),u.embed.on("seeked",()=>{u.media.seeking=!1,he.call(u,u.media,"seeked")}),u.embed.on("ended",()=>{u.media.paused=!0,he.call(u,u.media,"ended")}),u.embed.on("error",U=>{u.media.error=U,he.call(u,u.media,"error")}),m.customControls&&setTimeout(()=>Ce.build.call(u),0)}};function ni(u){u&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===u&&(this.media.paused=!u,he.call(this,this.media,u?"play":"pause"))}function Cs(u){return u.noCookie?"https://www.youtube-nocookie.com":window.location.protocol==="http:"?"http://www.youtube.com":void 0}const di={setup(){if(be(this.elements.wrapper,this.config.classNames.embed,!0),x.object(window.YT)&&x.function(window.YT.Player))di.ready.call(this);else{const u=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{x.function(u)&&u(),di.ready.call(this)},Ue(this.config.urls.youtube.sdk).catch(m=>{this.debug.warn("YouTube API failed to load",m)})}},getTitle(u){$t(se(this.config.urls.youtube.api,u)).then(m=>{if(x.object(m)){const{title:d,height:p,width:T}=m;this.config.title=d,Ce.setTitle.call(this),this.embed.ratio=es(T,p)}Ke.call(this)}).catch(()=>{Ke.call(this)})},ready(){const u=this,m=u.config.youtube,d=u.media&&u.media.getAttribute("id");if(!x.empty(d)&&d.startsWith("youtube-"))return;let p=u.media.getAttribute("src");x.empty(p)&&(p=u.media.getAttribute(this.config.attributes.embed.id));const T=(E=p,x.empty(E)?null:E.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/)?RegExp.$2:E);var E;const w=D("div",{id:`${u.provider}-${Math.floor(1e4*Math.random())}`,"data-poster":m.customControls?u.poster:void 0});if(u.media=xe(w,u.media),m.customControls){const I=_=>`https://i.ytimg.com/vi/${T}/${_}default.jpg`;Ai(I("maxres"),121).catch(()=>Ai(I("sd"),121)).catch(()=>Ai(I("hq"))).then(_=>Ce.setPoster.call(u,_.src)).then(_=>{_.includes("maxres")||(u.elements.poster.style.backgroundSize="cover")}).catch(()=>{})}u.embed=new window.YT.Player(u.media,{videoId:T,host:Cs(m),playerVars:Oe({},{autoplay:u.config.autoplay?1:0,hl:u.config.hl,controls:u.supported.ui&&m.customControls?0:1,disablekb:1,playsinline:u.config.playsinline&&!u.config.fullscreen.iosNative?1:0,cc_load_policy:u.captions.active?1:0,cc_lang_pref:u.config.captions.language,widget_referrer:window?window.location.href:null},m),events:{onError(I){if(!u.media.error){const _=I.data,$={2:"The request contains an invalid parameter value. For example, this error occurs if you specify a video ID that does not have 11 characters, or if the video ID contains invalid characters, such as exclamation points or asterisks.",5:"The requested content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred.",100:"The video requested was not found. This error occurs when a video has been removed (for any reason) or has been marked as private.",101:"The owner of the requested video does not allow it to be played in embedded players.",150:"The owner of the requested video does not allow it to be played in embedded players."}[_]||"An unknown error occurred";u.media.error={code:_,message:$},he.call(u,u.media,"error")}},onPlaybackRateChange(I){const _=I.target;u.media.playbackRate=_.getPlaybackRate(),he.call(u,u.media,"ratechange")},onReady(I){if(x.function(u.media.play))return;const _=I.target;di.getTitle.call(u,T),u.media.play=()=>{ni.call(u,!0),_.playVideo()},u.media.pause=()=>{ni.call(u,!1),_.pauseVideo()},u.media.stop=()=>{_.stopVideo()},u.media.duration=_.getDuration(),u.media.paused=!0,u.media.currentTime=0,Object.defineProperty(u.media,"currentTime",{get:()=>Number(_.getCurrentTime()),set(q){u.paused&&!u.embed.hasPlayed&&u.embed.mute(),u.media.seeking=!0,he.call(u,u.media,"seeking"),_.seekTo(q)}}),Object.defineProperty(u.media,"playbackRate",{get:()=>_.getPlaybackRate(),set(q){_.setPlaybackRate(q)}});let{volume:$}=u.config;Object.defineProperty(u.media,"volume",{get:()=>$,set(q){$=q,_.setVolume(100*$),he.call(u,u.media,"volumechange")}});let{muted:Q}=u.config;Object.defineProperty(u.media,"muted",{get:()=>Q,set(q){const re=x.boolean(q)?q:Q;Q=re,_[re?"mute":"unMute"](),_.setVolume(100*$),he.call(u,u.media,"volumechange")}}),Object.defineProperty(u.media,"currentSrc",{get:()=>_.getVideoUrl()}),Object.defineProperty(u.media,"ended",{get:()=>u.currentTime===u.duration});const le=_.getAvailablePlaybackRates();u.options.speed=le.filter(q=>u.config.speed.options.includes(q)),u.supported.ui&&m.customControls&&u.media.setAttribute("tabindex",-1),he.call(u,u.media,"timeupdate"),he.call(u,u.media,"durationchange"),clearInterval(u.timers.buffering),u.timers.buffering=setInterval(()=>{u.media.buffered=_.getVideoLoadedFraction(),(u.media.lastBuffered===null||u.media.lastBuffered<u.media.buffered)&&he.call(u,u.media,"progress"),u.media.lastBuffered=u.media.buffered,u.media.buffered===1&&(clearInterval(u.timers.buffering),he.call(u,u.media,"canplaythrough"))},200),m.customControls&&setTimeout(()=>Ce.build.call(u),50)},onStateChange(I){const _=I.target;switch(clearInterval(u.timers.playing),u.media.seeking&&[1,2].includes(I.data)&&(u.media.seeking=!1,he.call(u,u.media,"seeked")),I.data){case-1:he.call(u,u.media,"timeupdate"),u.media.buffered=_.getVideoLoadedFraction(),he.call(u,u.media,"progress");break;case 0:ni.call(u,!1),u.media.loop?(_.stopVideo(),_.playVideo()):he.call(u,u.media,"ended");break;case 1:m.customControls&&!u.config.autoplay&&u.media.paused&&!u.embed.hasPlayed?u.media.pause():(ni.call(u,!0),he.call(u,u.media,"playing"),u.timers.playing=setInterval(()=>{he.call(u,u.media,"timeupdate")},50),u.media.duration!==_.getDuration()&&(u.media.duration=_.getDuration(),he.call(u,u.media,"durationchange")));break;case 2:u.muted||u.embed.unMute(),ni.call(u,!1);break;case 3:he.call(u,u.media,"waiting")}he.call(u,u.elements.container,"statechange",!1,{code:I.data})}}})}},xi={setup(){this.media?(be(this.elements.container,this.config.classNames.type.replace("{0}",this.type),!0),be(this.elements.container,this.config.classNames.provider.replace("{0}",this.provider),!0),this.isEmbed&&be(this.elements.container,this.config.classNames.type.replace("{0}","video"),!0),this.isVideo&&(this.elements.wrapper=D("div",{class:this.config.classNames.video}),Zt(this.media,this.elements.wrapper),this.elements.poster=D("div",{class:this.config.classNames.poster}),this.elements.wrapper.appendChild(this.elements.poster)),this.isHTML5?Wt.setup.call(this):this.isYouTube?di.setup.call(this):this.isVimeo&&Si.setup.call(this)):this.debug.warn("No media element found!")}};class os{constructor(m){H(this,"load",()=>{this.enabled&&(x.object(window.google)&&x.object(window.google.ima)?this.ready():Ue(this.player.config.urls.googleIMA.sdk).then(()=>{this.ready()}).catch(()=>{this.trigger("error",new Error("Google IMA SDK failed to load"))}))}),H(this,"ready",()=>{var d;this.enabled||((d=this).manager&&d.manager.destroy(),d.elements.displayContainer&&d.elements.displayContainer.destroy(),d.elements.container.remove()),this.startSafetyTimer(12e3,"ready()"),this.managerPromise.then(()=>{this.clearSafetyTimer("onAdsManagerLoaded()")}),this.listeners(),this.setupIMA()}),H(this,"setupIMA",()=>{this.elements.container=D("div",{class:this.player.config.classNames.ads}),this.player.elements.container.appendChild(this.elements.container),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale(this.player.config.ads.language),google.ima.settings.setDisableCustomPlaybackForIOS10Plus(this.player.config.playsinline),this.elements.displayContainer=new google.ima.AdDisplayContainer(this.elements.container,this.player.media),this.loader=new google.ima.AdsLoader(this.elements.displayContainer),this.loader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,d=>this.onAdsManagerLoaded(d),!1),this.loader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,d=>this.onAdError(d),!1),this.requestAds()}),H(this,"requestAds",()=>{const{container:d}=this.player.elements;try{const p=new google.ima.AdsRequest;p.adTagUrl=this.tagUrl,p.linearAdSlotWidth=d.offsetWidth,p.linearAdSlotHeight=d.offsetHeight,p.nonLinearAdSlotWidth=d.offsetWidth,p.nonLinearAdSlotHeight=d.offsetHeight,p.forceNonLinearFullSlot=!1,p.setAdWillPlayMuted(!this.player.muted),this.loader.requestAds(p)}catch(p){this.onAdError(p)}}),H(this,"pollCountdown",(d=!1)=>{if(!d)return clearInterval(this.countdownTimer),void this.elements.container.removeAttribute("data-badge-text");this.countdownTimer=setInterval(()=>{const p=Ei(Math.max(this.manager.getRemainingTime(),0)),T=`${je.get("advertisement",this.player.config)} - ${p}`;this.elements.container.setAttribute("data-badge-text",T)},100)}),H(this,"onAdsManagerLoaded",d=>{if(!this.enabled)return;const p=new google.ima.AdsRenderingSettings;p.restoreCustomPlaybackStateOnAdBreakComplete=!0,p.enablePreloading=!0,this.manager=d.getAdsManager(this.player,p),this.cuePoints=this.manager.getCuePoints(),this.manager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,T=>this.onAdError(T)),Object.keys(google.ima.AdEvent.Type).forEach(T=>{this.manager.addEventListener(google.ima.AdEvent.Type[T],E=>this.onAdEvent(E))}),this.trigger("loaded")}),H(this,"addCuePoints",()=>{x.empty(this.cuePoints)||this.cuePoints.forEach(d=>{if(d!==0&&d!==-1&&d<this.player.duration){const p=this.player.elements.progress;if(x.element(p)){const T=100/this.player.duration*d,E=D("span",{class:this.player.config.classNames.cues});E.style.left=`${T.toString()}%`,p.appendChild(E)}}})}),H(this,"onAdEvent",d=>{const{container:p}=this.player.elements,T=d.getAd(),E=d.getAdData();switch((w=>{he.call(this.player,this.player.media,`ads${w.replace(/_/g,"").toLowerCase()}`)})(d.type),d.type){case google.ima.AdEvent.Type.LOADED:this.trigger("loaded"),this.pollCountdown(!0),T.isLinear()||(T.width=p.offsetWidth,T.height=p.offsetHeight);break;case google.ima.AdEvent.Type.STARTED:this.manager.setVolume(this.player.volume);break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:this.player.ended?this.loadAds():this.loader.contentComplete();break;case google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED:this.pauseContent();break;case google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED:this.pollCountdown(),this.resumeContent();break;case google.ima.AdEvent.Type.LOG:E.adError&&this.player.debug.warn(`Non-fatal ad error: ${E.adError.getMessage()}`)}}),H(this,"onAdError",d=>{this.cancel(),this.player.debug.warn("Ads error",d)}),H(this,"listeners",()=>{const{container:d}=this.player.elements;let p;this.player.on("canplay",()=>{this.addCuePoints()}),this.player.on("ended",()=>{this.loader.contentComplete()}),this.player.on("timeupdate",()=>{p=this.player.currentTime}),this.player.on("seeked",()=>{const T=this.player.currentTime;x.empty(this.cuePoints)||this.cuePoints.forEach((E,w)=>{p<E&&E<T&&(this.manager.discardAdBreak(),this.cuePoints.splice(w,1))})}),window.addEventListener("resize",()=>{this.manager&&this.manager.resize(d.offsetWidth,d.offsetHeight,google.ima.ViewMode.NORMAL)})}),H(this,"play",()=>{const{container:d}=this.player.elements;this.managerPromise||this.resumeContent(),this.managerPromise.then(()=>{this.manager.setVolume(this.player.volume),this.elements.displayContainer.initialize();try{this.initialized||(this.manager.init(d.offsetWidth,d.offsetHeight,google.ima.ViewMode.NORMAL),this.manager.start()),this.initialized=!0}catch(p){this.onAdError(p)}}).catch(()=>{})}),H(this,"resumeContent",()=>{this.elements.container.style.zIndex="",this.playing=!1,Ct(this.player.media.play())}),H(this,"pauseContent",()=>{this.elements.container.style.zIndex=3,this.playing=!0,this.player.media.pause()}),H(this,"cancel",()=>{this.initialized&&this.resumeContent(),this.trigger("error"),this.loadAds()}),H(this,"loadAds",()=>{this.managerPromise.then(()=>{this.manager&&this.manager.destroy(),this.managerPromise=new Promise(d=>{this.on("loaded",d),this.player.debug.log(this.manager)}),this.initialized=!1,this.requestAds()}).catch(()=>{})}),H(this,"trigger",(d,...p)=>{const T=this.events[d];x.array(T)&&T.forEach(E=>{x.function(E)&&E.apply(this,p)})}),H(this,"on",(d,p)=>(x.array(this.events[d])||(this.events[d]=[]),this.events[d].push(p),this)),H(this,"startSafetyTimer",(d,p)=>{this.player.debug.log(`Safety timer invoked from: ${p}`),this.safetyTimer=setTimeout(()=>{this.cancel(),this.clearSafetyTimer("startSafetyTimer()")},d)}),H(this,"clearSafetyTimer",d=>{x.nullOrUndefined(this.safetyTimer)||(this.player.debug.log(`Safety timer cleared from: ${d}`),clearTimeout(this.safetyTimer),this.safetyTimer=null)}),this.player=m,this.config=m.config.ads,this.playing=!1,this.initialized=!1,this.elements={container:null,displayContainer:null},this.manager=null,this.loader=null,this.cuePoints=null,this.events={},this.safetyTimer=null,this.countdownTimer=null,this.managerPromise=new Promise((d,p)=>{this.on("loaded",d),this.on("error",p)}),this.load()}get enabled(){const{config:m}=this;return this.player.isHTML5&&this.player.isVideo&&m.enabled&&(!x.empty(m.publisherId)||x.url(m.tagUrl))}get tagUrl(){const{config:m}=this;return x.url(m.tagUrl)?m.tagUrl:`https://go.aniview.com/api/adserver6/vast/?${ns({AV_PUBLISHERID:"58c25bb0073ef448b1087ad6",AV_CHANNELID:"5a0458dc28a06145e4519d21",AV_URL:window.location.hostname,cb:Date.now(),AV_WIDTH:640,AV_HEIGHT:480,AV_CDIM2:m.publisherId})}`}}function ls(u=0,m=0,d=255){return Math.min(Math.max(u,m),d)}const Ds=u=>{const m=[];return u.split(/\r\n\r\n|\n\n|\r\r/).forEach(d=>{const p={};d.split(/\r\n|\n|\r/).forEach(T=>{if(x.number(p.startTime)){if(!x.empty(T.trim())&&x.empty(p.text)){const E=T.trim().split("#xywh=");[p.text]=E,E[1]&&([p.x,p.y,p.w,p.h]=E[1].split(","))}}else{const E=T.match(/([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})( ?--> ?)([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})/);E&&(p.startTime=60*Number(E[1]||0)*60+60*Number(E[2])+Number(E[3])+ +`0.${E[4]}`,p.endTime=60*Number(E[6]||0)*60+60*Number(E[7])+Number(E[8])+ +`0.${E[9]}`)}}),p.text&&m.push(p)}),m},Yt=(u,m)=>{const d={};return u>m.width/m.height?(d.width=m.width,d.height=1/u*m.width):(d.height=m.height,d.width=u*m.height),d};class hi{constructor(m){H(this,"load",()=>{this.player.elements.display.seekTooltip&&(this.player.elements.display.seekTooltip.hidden=this.enabled),this.enabled&&this.getThumbnails().then(()=>{this.enabled&&(this.render(),this.determineContainerAutoSizing(),this.listeners(),this.loaded=!0)})}),H(this,"getThumbnails",()=>new Promise(d=>{const{src:p}=this.player.config.previewThumbnails;if(x.empty(p))throw new Error("Missing previewThumbnails.src config attribute");const T=()=>{this.thumbnails.sort((E,w)=>E.height-w.height),this.player.debug.log("Preview thumbnails",this.thumbnails),d()};if(x.function(p))p(E=>{this.thumbnails=E,T()});else{const E=(x.string(p)?[p]:p).map(w=>this.getThumbnail(w));Promise.all(E).then(T)}})),H(this,"getThumbnail",d=>new Promise(p=>{$t(d).then(T=>{const E={frames:Ds(T),height:null,urlPrefix:""};E.frames[0].text.startsWith("/")||E.frames[0].text.startsWith("http://")||E.frames[0].text.startsWith("https://")||(E.urlPrefix=d.substring(0,d.lastIndexOf("/")+1));const w=new Image;w.onload=()=>{E.height=w.naturalHeight,E.width=w.naturalWidth,this.thumbnails.push(E),p()},w.src=E.urlPrefix+E.frames[0].text})})),H(this,"startMove",d=>{if(this.loaded&&x.event(d)&&["touchmove","mousemove"].includes(d.type)&&this.player.media.duration){if(d.type==="touchmove")this.seekTime=this.player.media.duration*(this.player.elements.inputs.seek.value/100);else{var p,T;const E=this.player.elements.progress.getBoundingClientRect(),w=100/E.width*(d.pageX-E.left);this.seekTime=this.player.media.duration*(w/100),this.seekTime<0&&(this.seekTime=0),this.seekTime>this.player.media.duration-1&&(this.seekTime=this.player.media.duration-1),this.mousePosX=d.pageX,this.elements.thumb.time.innerText=Ei(this.seekTime);const I=(p=this.player.config.markers)===null||p===void 0||(T=p.points)===null||T===void 0?void 0:T.find(({time:_})=>_===Math.round(this.seekTime));I&&this.elements.thumb.time.insertAdjacentHTML("afterbegin",`${I.label}<br>`)}this.showImageAtCurrentTime()}}),H(this,"endMove",()=>{this.toggleThumbContainer(!1,!0)}),H(this,"startScrubbing",d=>{(x.nullOrUndefined(d.button)||d.button===!1||d.button===0)&&(this.mouseDown=!0,this.player.media.duration&&(this.toggleScrubbingContainer(!0),this.toggleThumbContainer(!1,!0),this.showImageAtCurrentTime()))}),H(this,"endScrubbing",()=>{this.mouseDown=!1,Math.ceil(this.lastTime)===Math.ceil(this.player.media.currentTime)?this.toggleScrubbingContainer(!1):Fi.call(this.player,this.player.media,"timeupdate",()=>{this.mouseDown||this.toggleScrubbingContainer(!1)})}),H(this,"listeners",()=>{this.player.on("play",()=>{this.toggleThumbContainer(!1,!0)}),this.player.on("seeked",()=>{this.toggleThumbContainer(!1)}),this.player.on("timeupdate",()=>{this.lastTime=this.player.media.currentTime})}),H(this,"render",()=>{this.elements.thumb.container=D("div",{class:this.player.config.classNames.previewThumbnails.thumbContainer}),this.elements.thumb.imageContainer=D("div",{class:this.player.config.classNames.previewThumbnails.imageContainer}),this.elements.thumb.container.appendChild(this.elements.thumb.imageContainer);const d=D("div",{class:this.player.config.classNames.previewThumbnails.timeContainer});this.elements.thumb.time=D("span",{},"00:00"),d.appendChild(this.elements.thumb.time),this.elements.thumb.imageContainer.appendChild(d),x.element(this.player.elements.progress)&&this.player.elements.progress.appendChild(this.elements.thumb.container),this.elements.scrubbing.container=D("div",{class:this.player.config.classNames.previewThumbnails.scrubbingContainer}),this.player.elements.wrapper.appendChild(this.elements.scrubbing.container)}),H(this,"destroy",()=>{this.elements.thumb.container&&this.elements.thumb.container.remove(),this.elements.scrubbing.container&&this.elements.scrubbing.container.remove()}),H(this,"showImageAtCurrentTime",()=>{this.mouseDown?this.setScrubbingContainerSize():this.setThumbContainerSizeAndPos();const d=this.thumbnails[0].frames.findIndex(E=>this.seekTime>=E.startTime&&this.seekTime<=E.endTime),p=d>=0;let T=0;this.mouseDown||this.toggleThumbContainer(p),p&&(this.thumbnails.forEach((E,w)=>{this.loadedImages.includes(E.frames[d].text)&&(T=w)}),d!==this.showingThumb&&(this.showingThumb=d,this.loadImage(T)))}),H(this,"loadImage",(d=0)=>{const p=this.showingThumb,T=this.thumbnails[d],{urlPrefix:E}=T,w=T.frames[p],I=T.frames[p].text,_=E+I;if(this.currentImageElement&&this.currentImageElement.dataset.filename===I)this.showImage(this.currentImageElement,w,d,p,I,!1),this.currentImageElement.dataset.index=p,this.removeOldImages(this.currentImageElement);else{this.loadingImage&&this.usingSprites&&(this.loadingImage.onload=null);const $=new Image;$.src=_,$.dataset.index=p,$.dataset.filename=I,this.showingThumbFilename=I,this.player.debug.log(`Loading image: ${_}`),$.onload=()=>this.showImage($,w,d,p,I,!0),this.loadingImage=$,this.removeOldImages($)}}),H(this,"showImage",(d,p,T,E,w,I=!0)=>{this.player.debug.log(`Showing thumb: ${w}. num: ${E}. qual: ${T}. newimg: ${I}`),this.setImageSizeAndOffset(d,p),I&&(this.currentImageContainer.appendChild(d),this.currentImageElement=d,this.loadedImages.includes(w)||this.loadedImages.push(w)),this.preloadNearby(E,!0).then(this.preloadNearby(E,!1)).then(this.getHigherQuality(T,d,p,w))}),H(this,"removeOldImages",d=>{Array.from(this.currentImageContainer.children).forEach(p=>{if(p.tagName.toLowerCase()!=="img")return;const T=this.usingSprites?500:1e3;if(p.dataset.index!==d.dataset.index&&!p.dataset.deleting){p.dataset.deleting=!0;const{currentImageContainer:E}=this;setTimeout(()=>{E.removeChild(p),this.player.debug.log(`Removing thumb: ${p.dataset.filename}`)},T)}})}),H(this,"preloadNearby",(d,p=!0)=>new Promise(T=>{setTimeout(()=>{const E=this.thumbnails[0].frames[d].text;if(this.showingThumbFilename===E){let w;w=p?this.thumbnails[0].frames.slice(d):this.thumbnails[0].frames.slice(0,d).reverse();let I=!1;w.forEach(_=>{const $=_.text;if($!==E&&!this.loadedImages.includes($)){I=!0,this.player.debug.log(`Preloading thumb filename: ${$}`);const{urlPrefix:Q}=this.thumbnails[0],le=Q+$,q=new Image;q.src=le,q.onload=()=>{this.player.debug.log(`Preloaded thumb filename: ${$}`),this.loadedImages.includes($)||this.loadedImages.push($),T()}}}),I||T()}},300)})),H(this,"getHigherQuality",(d,p,T,E)=>{if(d<this.thumbnails.length-1){let w=p.naturalHeight;this.usingSprites&&(w=T.h),w<this.thumbContainerHeight&&setTimeout(()=>{this.showingThumbFilename===E&&(this.player.debug.log(`Showing higher quality thumb for: ${E}`),this.loadImage(d+1))},300)}}),H(this,"toggleThumbContainer",(d=!1,p=!1)=>{const T=this.player.config.classNames.previewThumbnails.thumbContainerShown;this.elements.thumb.container.classList.toggle(T,d),!d&&p&&(this.showingThumb=null,this.showingThumbFilename=null)}),H(this,"toggleScrubbingContainer",(d=!1)=>{const p=this.player.config.classNames.previewThumbnails.scrubbingContainerShown;this.elements.scrubbing.container.classList.toggle(p,d),d||(this.showingThumb=null,this.showingThumbFilename=null)}),H(this,"determineContainerAutoSizing",()=>{(this.elements.thumb.imageContainer.clientHeight>20||this.elements.thumb.imageContainer.clientWidth>20)&&(this.sizeSpecifiedInCSS=!0)}),H(this,"setThumbContainerSizeAndPos",()=>{const{imageContainer:d}=this.elements.thumb;if(this.sizeSpecifiedInCSS){if(d.clientHeight>20&&d.clientWidth<20){const p=Math.floor(d.clientHeight*this.thumbAspectRatio);d.style.width=`${p}px`}else if(d.clientHeight<20&&d.clientWidth>20){const p=Math.floor(d.clientWidth/this.thumbAspectRatio);d.style.height=`${p}px`}}else{const p=Math.floor(this.thumbContainerHeight*this.thumbAspectRatio);d.style.height=`${this.thumbContainerHeight}px`,d.style.width=`${p}px`}this.setThumbContainerPos()}),H(this,"setThumbContainerPos",()=>{const d=this.player.elements.progress.getBoundingClientRect(),p=this.player.elements.container.getBoundingClientRect(),{container:T}=this.elements.thumb,E=p.left-d.left+10,w=p.right-d.left-T.clientWidth-10,I=this.mousePosX-d.left-T.clientWidth/2,_=ls(I,E,w);T.style.left=`${_}px`,T.style.setProperty("--preview-arrow-offset",I-_+"px")}),H(this,"setScrubbingContainerSize",()=>{const{width:d,height:p}=Yt(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});this.elements.scrubbing.container.style.width=`${d}px`,this.elements.scrubbing.container.style.height=`${p}px`}),H(this,"setImageSizeAndOffset",(d,p)=>{if(!this.usingSprites)return;const T=this.thumbContainerHeight/p.h;d.style.height=d.naturalHeight*T+"px",d.style.width=d.naturalWidth*T+"px",d.style.left=`-${p.x*T}px`,d.style.top=`-${p.y*T}px`}),this.player=m,this.thumbnails=[],this.loaded=!1,this.lastMouseMoveTime=Date.now(),this.mouseDown=!1,this.loadedImages=[],this.elements={thumb:{},scrubbing:{}},this.load()}get enabled(){return this.player.isHTML5&&this.player.isVideo&&this.player.config.previewThumbnails.enabled}get currentImageContainer(){return this.mouseDown?this.elements.scrubbing.container:this.elements.thumb.imageContainer}get usingSprites(){return Object.keys(this.thumbnails[0].frames[0]).includes("w")}get thumbAspectRatio(){return this.usingSprites?this.thumbnails[0].frames[0].w/this.thumbnails[0].frames[0].h:this.thumbnails[0].width/this.thumbnails[0].height}get thumbContainerHeight(){if(this.mouseDown){const{height:m}=Yt(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});return m}return this.sizeSpecifiedInCSS?this.elements.thumb.imageContainer.clientHeight:Math.floor(this.player.media.clientWidth/this.thumbAspectRatio/4)}get currentImageElement(){return this.mouseDown?this.currentScrubbingImageElement:this.currentThumbnailImageElement}set currentImageElement(m){this.mouseDown?this.currentScrubbingImageElement=m:this.currentThumbnailImageElement=m}}const Li={insertElements(u,m){x.string(m)?W(u,this.media,{src:m}):x.array(m)&&m.forEach(d=>{W(u,this.media,d)})},change(u){xt(u,"sources.length")?(Wt.cancelRequests.call(this),this.destroy.call(this,()=>{this.options.quality=[],ce(this.media),this.media=null,x.element(this.elements.container)&&this.elements.container.removeAttribute("class");const{sources:m,type:d}=u,[{provider:p=Vt.html5,src:T}]=m,E=p==="html5"?d:"div",w=p==="html5"?{}:{src:T};Object.assign(this,{provider:p,type:d,supported:He.check(d,p,this.config.playsinline),media:D(E,w)}),this.elements.container.appendChild(this.media),x.boolean(u.autoplay)&&(this.config.autoplay=u.autoplay),this.isHTML5&&(this.config.crossorigin&&this.media.setAttribute("crossorigin",""),this.config.autoplay&&this.media.setAttribute("autoplay",""),x.empty(u.poster)||(this.poster=u.poster),this.config.loop.active&&this.media.setAttribute("loop",""),this.config.muted&&this.media.setAttribute("muted",""),this.config.playsinline&&this.media.setAttribute("playsinline","")),Ce.addStyleHook.call(this),this.isHTML5&&Li.insertElements.call(this,"source",m),this.config.title=u.title,xi.setup.call(this),this.isHTML5&&Object.keys(u).includes("tracks")&&Li.insertElements.call(this,"track",u.tracks),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&Ce.build.call(this),this.isHTML5&&this.media.load(),x.empty(u.previewThumbnails)||(Object.assign(this.config.previewThumbnails,u.previewThumbnails),this.previewThumbnails&&this.previewThumbnails.loaded&&(this.previewThumbnails.destroy(),this.previewThumbnails=null),this.config.previewThumbnails.enabled&&(this.previewThumbnails=new hi(this))),this.fullscreen.update()},!0)):this.debug.warn("Invalid source format")}};class qt{constructor(m,d){if(H(this,"play",()=>x.function(this.media.play)?(this.ads&&this.ads.enabled&&this.ads.managerPromise.then(()=>this.ads.play()).catch(()=>Ct(this.media.play())),this.media.play()):null),H(this,"pause",()=>this.playing&&x.function(this.media.pause)?this.media.pause():null),H(this,"togglePlay",I=>(x.boolean(I)?I:!this.playing)?this.play():this.pause()),H(this,"stop",()=>{this.isHTML5?(this.pause(),this.restart()):x.function(this.media.stop)&&this.media.stop()}),H(this,"restart",()=>{this.currentTime=0}),H(this,"rewind",I=>{this.currentTime-=x.number(I)?I:this.config.seekTime}),H(this,"forward",I=>{this.currentTime+=x.number(I)?I:this.config.seekTime}),H(this,"increaseVolume",I=>{const _=this.media.muted?0:this.volume;this.volume=_+(x.number(I)?I:0)}),H(this,"decreaseVolume",I=>{this.increaseVolume(-I)}),H(this,"airplay",()=>{He.airplay&&this.media.webkitShowPlaybackTargetPicker()}),H(this,"toggleControls",I=>{if(this.supported.ui&&!this.isAudio){const _=Ne(this.elements.container,this.config.classNames.hideControls),$=I===void 0?void 0:!I,Q=be(this.elements.container,this.config.classNames.hideControls,$);if(Q&&x.array(this.config.controls)&&this.config.controls.includes("settings")&&!x.empty(this.config.settings)&&X.toggleMenu.call(this,!1),Q!==_){const le=Q?"controlshidden":"controlsshown";he.call(this,this.media,le)}return!Q}return!1}),H(this,"on",(I,_)=>{Le.call(this,this.elements.container,I,_)}),H(this,"once",(I,_)=>{Fi.call(this,this.elements.container,I,_)}),H(this,"off",(I,_)=>{vi(this.elements.container,I,_)}),H(this,"destroy",(I,_=!1)=>{if(!this.ready)return;const $=()=>{document.body.style.overflow="",this.embed=null,_?(Object.keys(this.elements).length&&(ce(this.elements.buttons.play),ce(this.elements.captions),ce(this.elements.controls),ce(this.elements.wrapper),this.elements.buttons.play=null,this.elements.captions=null,this.elements.controls=null,this.elements.wrapper=null),x.function(I)&&I()):(Zi.call(this),Wt.cancelRequests.call(this),xe(this.elements.original,this.elements.container),he.call(this,this.elements.original,"destroyed",!0),x.function(I)&&I.call(this.elements.original),this.ready=!1,setTimeout(()=>{this.elements=null,this.media=null},200))};this.stop(),clearTimeout(this.timers.loading),clearTimeout(this.timers.controls),clearTimeout(this.timers.resized),this.isHTML5?(Ce.toggleNativeControls.call(this,!0),$()):this.isYouTube?(clearInterval(this.timers.buffering),clearInterval(this.timers.playing),this.embed!==null&&x.function(this.embed.destroy)&&this.embed.destroy(),$()):this.isVimeo&&(this.embed!==null&&this.embed.unload().then($),setTimeout($,200))}),H(this,"supports",I=>He.mime.call(this,I)),this.timers={},this.ready=!1,this.loading=!1,this.failed=!1,this.touch=He.touch,this.media=m,x.string(this.media)&&(this.media=document.querySelectorAll(this.media)),(window.jQuery&&this.media instanceof jQuery||x.nodeList(this.media)||x.array(this.media))&&(this.media=this.media[0]),this.config=Oe({},$i,qt.defaults,d||{},(()=>{try{return JSON.parse(this.media.getAttribute("data-plyr-config"))}catch{return{}}})()),this.elements={container:null,fullscreen:null,captions:null,buttons:{},display:{},progress:{},inputs:{},settings:{popup:null,menu:null,panels:{},buttons:{}}},this.captions={active:null,currentTrack:-1,meta:new WeakMap},this.fullscreen={active:!1},this.options={speed:[],quality:[]},this.debug=new ks(this.config.debug),this.debug.log("Config",this.config),this.debug.log("Support",He),x.nullOrUndefined(this.media)||!x.element(this.media))return void this.debug.error("Setup failed: no suitable element passed");if(this.media.plyr)return void this.debug.warn("Target already setup");if(!this.config.enabled)return void this.debug.error("Setup failed: disabled by config");if(!He.check().api)return void this.debug.error("Setup failed: no support");const p=this.media.cloneNode(!0);p.autoplay=!1,this.elements.original=p;const T=this.media.tagName.toLowerCase();let E=null,w=null;switch(T){case"div":if(E=this.media.querySelector("iframe"),x.element(E)){if(w=We(E.getAttribute("src")),this.provider=function(I){return/^(https?:\/\/)?(www\.)?(youtube\.com|youtube-nocookie\.com|youtu\.?be)\/.+$/.test(I)?Vt.youtube:/^https?:\/\/player.vimeo.com\/video\/\d{0,9}(?=\b|\/)/.test(I)?Vt.vimeo:null}(w.toString()),this.elements.container=this.media,this.media=E,this.elements.container.className="",w.search.length){const I=["1","true"];I.includes(w.searchParams.get("autoplay"))&&(this.config.autoplay=!0),I.includes(w.searchParams.get("loop"))&&(this.config.loop.active=!0),this.isYouTube?(this.config.playsinline=I.includes(w.searchParams.get("playsinline")),this.config.youtube.hl=w.searchParams.get("hl")):this.config.playsinline=!0}}else this.provider=this.media.getAttribute(this.config.attributes.embed.provider),this.media.removeAttribute(this.config.attributes.embed.provider);if(x.empty(this.provider)||!Object.values(Vt).includes(this.provider))return void this.debug.error("Setup failed: Invalid provider");this.type=rs;break;case"video":case"audio":this.type=T,this.provider=Vt.html5,this.media.hasAttribute("crossorigin")&&(this.config.crossorigin=!0),this.media.hasAttribute("autoplay")&&(this.config.autoplay=!0),(this.media.hasAttribute("playsinline")||this.media.hasAttribute("webkit-playsinline"))&&(this.config.playsinline=!0),this.media.hasAttribute("muted")&&(this.config.muted=!0),this.media.hasAttribute("loop")&&(this.config.loop.active=!0);break;default:return void this.debug.error("Setup failed: unsupported type")}this.supported=He.check(this.type,this.provider),this.supported.api?(this.eventListeners=[],this.listeners=new Rs(this),this.storage=new Jt(this),this.media.plyr=this,x.element(this.elements.container)||(this.elements.container=D("div"),Zt(this.media,this.elements.container)),Ce.migrateStyles.call(this),Ce.addStyleHook.call(this),xi.setup.call(this),this.config.debug&&Le.call(this,this.elements.container,this.config.events.join(" "),I=>{this.debug.log(`event: ${I.type}`)}),this.fullscreen=new vt(this),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&Ce.build.call(this),this.listeners.container(),this.listeners.global(),this.config.ads.enabled&&(this.ads=new os(this)),this.isHTML5&&this.config.autoplay&&this.once("canplay",()=>Ct(this.play())),this.lastSeekTime=0,this.config.previewThumbnails.enabled&&(this.previewThumbnails=new hi(this))):this.debug.error("Setup failed: no support")}get isHTML5(){return this.provider===Vt.html5}get isEmbed(){return this.isYouTube||this.isVimeo}get isYouTube(){return this.provider===Vt.youtube}get isVimeo(){return this.provider===Vt.vimeo}get isVideo(){return this.type===rs}get isAudio(){return this.type===Vi}get playing(){return!!(this.ready&&!this.paused&&!this.ended)}get paused(){return!!this.media.paused}get stopped(){return!!(this.paused&&this.currentTime===0)}get ended(){return!!this.media.ended}set currentTime(m){if(!this.duration)return;const d=x.number(m)&&m>0;this.media.currentTime=d?Math.min(m,this.duration):0,this.debug.log(`Seeking to ${this.currentTime} seconds`)}get currentTime(){return Number(this.media.currentTime)}get buffered(){const{buffered:m}=this.media;return x.number(m)?m:m&&m.length&&this.duration>0?m.end(0)/this.duration:0}get seeking(){return!!this.media.seeking}get duration(){const m=parseFloat(this.config.duration),d=(this.media||{}).duration,p=x.number(d)&&d!==1/0?d:0;return m||p}set volume(m){let d=m;x.string(d)&&(d=Number(d)),x.number(d)||(d=this.storage.get("volume")),x.number(d)||({volume:d}=this.config),d>1&&(d=1),d<0&&(d=0),this.config.volume=d,this.media.volume=d,!x.empty(m)&&this.muted&&d>0&&(this.muted=!1)}get volume(){return Number(this.media.volume)}set muted(m){let d=m;x.boolean(d)||(d=this.storage.get("muted")),x.boolean(d)||(d=this.config.muted),this.config.muted=d,this.media.muted=d}get muted(){return!!this.media.muted}get hasAudio(){return!this.isHTML5||!!this.isAudio||!!this.media.mozHasAudio||!!this.media.webkitAudioDecodedByteCount||!!(this.media.audioTracks&&this.media.audioTracks.length)}set speed(m){let d=null;x.number(m)&&(d=m),x.number(d)||(d=this.storage.get("speed")),x.number(d)||(d=this.config.speed.selected);const{minimumSpeed:p,maximumSpeed:T}=this;d=ls(d,p,T),this.config.speed.selected=d,setTimeout(()=>{this.media&&(this.media.playbackRate=d)},0)}get speed(){return Number(this.media.playbackRate)}get minimumSpeed(){return this.isYouTube?Math.min(...this.options.speed):this.isVimeo?.5:.0625}get maximumSpeed(){return this.isYouTube?Math.max(...this.options.speed):this.isVimeo?2:16}set quality(m){const d=this.config.quality,p=this.options.quality;if(!p.length)return;let T=[!x.empty(m)&&Number(m),this.storage.get("quality"),d.selected,d.default].find(x.number),E=!0;if(!p.includes(T)){const w=Ji(p,T);this.debug.warn(`Unsupported quality option: ${T}, using ${w} instead`),T=w,E=!1}d.selected=T,this.media.quality=T,E&&this.storage.set({quality:T})}get quality(){return this.media.quality}set loop(m){const d=x.boolean(m)?m:this.config.loop.active;this.config.loop.active=d,this.media.loop=d}get loop(){return!!this.media.loop}set source(m){Li.change.call(this,m)}get source(){return this.media.currentSrc}get download(){const{download:m}=this.config.urls;return x.url(m)?m:this.source}set download(m){x.url(m)&&(this.config.urls.download=m,X.setDownloadUrl.call(this))}set poster(m){this.isVideo?Ce.setPoster.call(this,m,!1).catch(()=>{}):this.debug.warn("Poster can only be set for video")}get poster(){return this.isVideo?this.media.getAttribute("poster")||this.media.getAttribute("data-poster"):null}get ratio(){if(!this.isVideo)return null;const m=ot(Ui.call(this));return x.array(m)?m.join(":"):m}set ratio(m){this.isVideo?x.string(m)&&Bi(m)?(this.config.ratio=ot(m),Ke.call(this)):this.debug.error(`Invalid aspect ratio specified (${m})`):this.debug.warn("Aspect ratio can only be set for video")}set autoplay(m){this.config.autoplay=x.boolean(m)?m:this.config.autoplay}get autoplay(){return!!this.config.autoplay}toggleCaptions(m){we.toggle.call(this,m,!1)}set currentTrack(m){we.set.call(this,m,!1),we.setup.call(this)}get currentTrack(){const{toggled:m,currentTrack:d}=this.captions;return m?d:-1}set language(m){we.setLanguage.call(this,m,!1)}get language(){return(we.getCurrentTrack.call(this)||{}).language}set pip(m){if(!He.pip)return;const d=x.boolean(m)?m:!this.pip;x.function(this.media.webkitSetPresentationMode)&&this.media.webkitSetPresentationMode(d?ui:Re),x.function(this.media.requestPictureInPicture)&&(!this.pip&&d?this.media.requestPictureInPicture():this.pip&&!d&&document.exitPictureInPicture())}get pip(){return He.pip?x.empty(this.media.webkitPresentationMode)?this.media===document.pictureInPictureElement:this.media.webkitPresentationMode===ui:null}setPreviewThumbnails(m){this.previewThumbnails&&this.previewThumbnails.loaded&&(this.previewThumbnails.destroy(),this.previewThumbnails=null),Object.assign(this.config.previewThumbnails,m),this.config.previewThumbnails.enabled&&(this.previewThumbnails=new hi(this))}static supported(m,d){return He.check(m,d)}static loadSprite(m,d){return is(m,d)}static setup(m,d={}){let p=null;return x.string(m)?p=Array.from(document.querySelectorAll(m)):x.nodeList(m)?p=Array.from(m):x.array(m)&&(p=m.filter(x.element)),x.empty(p)?null:p.map(T=>new qt(T,d))}}var fi;return qt.defaults=(fi=$i,JSON.parse(JSON.stringify(fi))),qt})},221107:function(nt){var kt=function(oe){"use strict";var H=Object.prototype,Ie=H.hasOwnProperty,Ge=Object.defineProperty||function(K,D,W){K[D]=W.value},De,Ye=typeof Symbol=="function"?Symbol:{},rt=Ye.iterator||"@@iterator",ct=Ye.asyncIterator||"@@asyncIterator",mt=Ye.toStringTag||"@@toStringTag";function ve(K,D,W){return Object.defineProperty(K,D,{value:W,enumerable:!0,configurable:!0,writable:!0}),K[D]}try{ve({},"")}catch{ve=function(D,W,ce){return D[W]=ce}}function ge(K,D,W,ce){var ne=D&&D.prototype instanceof ut?D:ut,xe=Object.create(ne.prototype),Me=new xt(ce||[]);return Ge(xe,"_invoke",{value:x(K,W,Me)}),xe}oe.wrap=ge;function pe(K,D,W){try{return{type:"normal",arg:K.call(D,W)}}catch(ce){return{type:"throw",arg:ce}}}var j="suspendedStart",Te="suspendedYield",z="executing",Ze="completed",te={};function ut(){}function at(){}function ht(){}var Tt={};ve(Tt,rt,function(){return this});var Rt=Object.getPrototypeOf,Xt=Rt&&Rt(Rt(Oe([])));Xt&&Xt!==H&&Ie.call(Xt,rt)&&(Tt=Xt);var Bt=ht.prototype=ut.prototype=Object.create(Tt);at.prototype=ht,Ge(Bt,"constructor",{value:ht,configurable:!0}),Ge(ht,"constructor",{value:at,configurable:!0}),at.displayName=ve(ht,mt,"GeneratorFunction");function li(K){["next","throw","return"].forEach(function(D){ve(K,D,function(W){return this._invoke(D,W)})})}oe.isGeneratorFunction=function(K){var D=typeof K=="function"&&K.constructor;return D?D===at||(D.displayName||D.name)==="GeneratorFunction":!1},oe.mark=function(K){return Object.setPrototypeOf?Object.setPrototypeOf(K,ht):(K.__proto__=ht,ve(K,mt,"GeneratorFunction")),K.prototype=Object.create(Bt),K},oe.awrap=function(K){return{__await:K}};function Qt(K,D){function W(xe,Me,Be,be){var Ne=pe(K[xe],K,Me);if(Ne.type==="throw")be(Ne.arg);else{var Lt=Ne.arg,Fe=Lt.value;return Fe&&typeof Fe=="object"&&Ie.call(Fe,"__await")?D.resolve(Fe.__await).then(function(Pe){W("next",Pe,Be,be)},function(Pe){W("throw",Pe,Be,be)}):D.resolve(Fe).then(function(Pe){Lt.value=Pe,Be(Lt)},function(Pe){return W("throw",Pe,Be,be)})}}var ce;function ne(xe,Me){function Be(){return new D(function(be,Ne){W(xe,Me,be,Ne)})}return ce=ce?ce.then(Be,Be):Be()}Ge(this,"_invoke",{value:ne})}li(Qt.prototype),ve(Qt.prototype,ct,function(){return this}),oe.AsyncIterator=Qt,oe.async=function(K,D,W,ce,ne){ne===void 0&&(ne=Promise);var xe=new Qt(ge(K,D,W,ce),ne);return oe.isGeneratorFunction(D)?xe:xe.next().then(function(Me){return Me.done?Me.value:xe.next()})};function x(K,D,W){var ce=j;return function(xe,Me){if(ce===z)throw new Error("Generator is already running");if(ce===Ze){if(xe==="throw")throw Me;return Zt()}for(W.method=xe,W.arg=Me;;){var Be=W.delegate;if(Be){var be=yt(Be,W);if(be){if(be===te)continue;return be}}if(W.method==="next")W.sent=W._sent=W.arg;else if(W.method==="throw"){if(ce===j)throw ce=Ze,W.arg;W.dispatchException(W.arg)}else W.method==="return"&&W.abrupt("return",W.arg);ce=z;var Ne=pe(K,D,W);if(Ne.type==="normal"){if(ce=W.done?Ze:Te,Ne.arg===te)continue;return{value:Ne.arg,done:W.done}}else Ne.type==="throw"&&(ce=Ze,W.method="throw",W.arg=Ne.arg)}}}function yt(K,D){var W=D.method,ce=K.iterator[W];if(ce===De)return D.delegate=null,W==="throw"&&K.iterator.return&&(D.method="return",D.arg=De,yt(K,D),D.method==="throw")||W!=="return"&&(D.method="throw",D.arg=new TypeError("The iterator does not provide a '"+W+"' method")),te;var ne=pe(ce,K.iterator,D.arg);if(ne.type==="throw")return D.method="throw",D.arg=ne.arg,D.delegate=null,te;var xe=ne.arg;if(!xe)return D.method="throw",D.arg=new TypeError("iterator result is not an object"),D.delegate=null,te;if(xe.done)D[K.resultName]=xe.value,D.next=K.nextLoc,D.method!=="return"&&(D.method="next",D.arg=De);else return xe;return D.delegate=null,te}li(Bt),ve(Bt,mt,"Generator"),ve(Bt,rt,function(){return this}),ve(Bt,"toString",function(){return"[object Generator]"});function yi(K){var D={tryLoc:K[0]};1 in K&&(D.catchLoc=K[1]),2 in K&&(D.finallyLoc=K[2],D.afterLoc=K[3]),this.tryEntries.push(D)}function F(K){var D=K.completion||{};D.type="normal",delete D.arg,K.completion=D}function xt(K){this.tryEntries=[{tryLoc:"root"}],K.forEach(yi,this),this.reset(!0)}oe.keys=function(K){var D=Object(K),W=[];for(var ce in D)W.push(ce);return W.reverse(),function ne(){for(;W.length;){var xe=W.pop();if(xe in D)return ne.value=xe,ne.done=!1,ne}return ne.done=!0,ne}};function Oe(K){if(K!=null){var D=K[rt];if(D)return D.call(K);if(typeof K.next=="function")return K;if(!isNaN(K.length)){var W=-1,ce=function ne(){for(;++W<K.length;)if(Ie.call(K,W))return ne.value=K[W],ne.done=!1,ne;return ne.value=De,ne.done=!0,ne};return ce.next=ce}}throw new TypeError(typeof K+" is not iterable")}oe.values=Oe;function Zt(){return{value:De,done:!0}}return xt.prototype={constructor:xt,reset:function(K){if(this.prev=0,this.next=0,this.sent=this._sent=De,this.done=!1,this.delegate=null,this.method="next",this.arg=De,this.tryEntries.forEach(F),!K)for(var D in this)D.charAt(0)==="t"&&Ie.call(this,D)&&!isNaN(+D.slice(1))&&(this[D]=De)},stop:function(){this.done=!0;var K=this.tryEntries[0],D=K.completion;if(D.type==="throw")throw D.arg;return this.rval},dispatchException:function(K){if(this.done)throw K;var D=this;function W(be,Ne){return xe.type="throw",xe.arg=K,D.next=be,Ne&&(D.method="next",D.arg=De),!!Ne}for(var ce=this.tryEntries.length-1;ce>=0;--ce){var ne=this.tryEntries[ce],xe=ne.completion;if(ne.tryLoc==="root")return W("end");if(ne.tryLoc<=this.prev){var Me=Ie.call(ne,"catchLoc"),Be=Ie.call(ne,"finallyLoc");if(Me&&Be){if(this.prev<ne.catchLoc)return W(ne.catchLoc,!0);if(this.prev<ne.finallyLoc)return W(ne.finallyLoc)}else if(Me){if(this.prev<ne.catchLoc)return W(ne.catchLoc,!0)}else if(Be){if(this.prev<ne.finallyLoc)return W(ne.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(K,D){for(var W=this.tryEntries.length-1;W>=0;--W){var ce=this.tryEntries[W];if(ce.tryLoc<=this.prev&&Ie.call(ce,"finallyLoc")&&this.prev<ce.finallyLoc){var ne=ce;break}}ne&&(K==="break"||K==="continue")&&ne.tryLoc<=D&&D<=ne.finallyLoc&&(ne=null);var xe=ne?ne.completion:{};return xe.type=K,xe.arg=D,ne?(this.method="next",this.next=ne.finallyLoc,te):this.complete(xe)},complete:function(K,D){if(K.type==="throw")throw K.arg;return K.type==="break"||K.type==="continue"?this.next=K.arg:K.type==="return"?(this.rval=this.arg=K.arg,this.method="return",this.next="end"):K.type==="normal"&&D&&(this.next=D),te},finish:function(K){for(var D=this.tryEntries.length-1;D>=0;--D){var W=this.tryEntries[D];if(W.finallyLoc===K)return this.complete(W.completion,W.afterLoc),F(W),te}},catch:function(K){for(var D=this.tryEntries.length-1;D>=0;--D){var W=this.tryEntries[D];if(W.tryLoc===K){var ce=W.completion;if(ce.type==="throw"){var ne=ce.arg;F(W)}return ne}}throw new Error("illegal catch attempt")},delegateYield:function(K,D,W){return this.delegate={iterator:Oe(K),resultName:D,nextLoc:W},this.method==="next"&&(this.arg=De),te}},oe}(nt.exports);try{regeneratorRuntime=kt}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=kt:Function("r","regeneratorRuntime = r")(kt)}},410633:function(nt,kt,oe){(function(H){var Ie=function(){try{return!!Symbol.iterator}catch{return!1}},Ge=Ie(),De=function(ge){var pe={next:function(){var j=ge.shift();return{done:j===void 0,value:j}}};return Ge&&(pe[Symbol.iterator]=function(){return pe}),pe},Ye=function(ge){return encodeURIComponent(ge).replace(/%20/g,"+")},rt=function(ge){return decodeURIComponent(String(ge).replace(/\+/g," "))},ct=function(){var ge=function(j){Object.defineProperty(this,"_entries",{writable:!0,value:{}});var Te=typeof j;if(Te!=="undefined")if(Te==="string")j!==""&&this._fromString(j);else if(j instanceof ge){var z=this;j.forEach(function(at,ht){z.append(ht,at)})}else if(j!==null&&Te==="object")if(Object.prototype.toString.call(j)==="[object Array]")for(var Ze=0;Ze<j.length;Ze++){var te=j[Ze];if(Object.prototype.toString.call(te)==="[object Array]"||te.length!==2)this.append(te[0],te[1]);else throw new TypeError("Expected [string, any] as entry at index "+Ze+" of URLSearchParams's input")}else for(var ut in j)j.hasOwnProperty(ut)&&this.append(ut,j[ut]);else throw new TypeError("Unsupported input's type for URLSearchParams")},pe=ge.prototype;pe.append=function(j,Te){j in this._entries?this._entries[j].push(String(Te)):this._entries[j]=[String(Te)]},pe.delete=function(j){delete this._entries[j]},pe.get=function(j){return j in this._entries?this._entries[j][0]:null},pe.getAll=function(j){return j in this._entries?this._entries[j].slice(0):[]},pe.has=function(j){return j in this._entries},pe.set=function(j,Te){this._entries[j]=[String(Te)]},pe.forEach=function(j,Te){var z;for(var Ze in this._entries)if(this._entries.hasOwnProperty(Ze)){z=this._entries[Ze];for(var te=0;te<z.length;te++)j.call(Te,z[te],Ze,this)}},pe.keys=function(){var j=[];return this.forEach(function(Te,z){j.push(z)}),De(j)},pe.values=function(){var j=[];return this.forEach(function(Te){j.push(Te)}),De(j)},pe.entries=function(){var j=[];return this.forEach(function(Te,z){j.push([z,Te])}),De(j)},Ge&&(pe[Symbol.iterator]=pe.entries),pe.toString=function(){var j=[];return this.forEach(function(Te,z){j.push(Ye(z)+"="+Ye(Te))}),j.join("&")},H.URLSearchParams=ge},mt=function(){try{var ge=H.URLSearchParams;return new ge("?a=1").toString()==="a=1"&&typeof ge.prototype.set=="function"&&typeof ge.prototype.entries=="function"}catch{return!1}};mt()||ct();var ve=H.URLSearchParams.prototype;typeof ve.sort!="function"&&(ve.sort=function(){var ge=this,pe=[];this.forEach(function(Te,z){pe.push([z,Te]),ge._entries||ge.delete(z)}),pe.sort(function(Te,z){return Te[0]<z[0]?-1:Te[0]>z[0]?1:0}),ge._entries&&(ge._entries={});for(var j=0;j<pe.length;j++)this.append(pe[j][0],pe[j][1])}),typeof ve._fromString!="function"&&Object.defineProperty(ve,"_fromString",{enumerable:!1,configurable:!1,writable:!1,value:function(ge){if(this._entries)this._entries={};else{var pe=[];this.forEach(function(Ze,te){pe.push(te)});for(var j=0;j<pe.length;j++)this.delete(pe[j])}ge=ge.replace(/^\?/,"");for(var Te=ge.split("&"),z,j=0;j<Te.length;j++)z=Te[j].split("="),this.append(rt(z[0]),z.length>1?rt(z[1]):"")}})})(typeof oe.g<"u"?oe.g:typeof window<"u"?window:typeof self<"u"?self:this),function(H){var Ie=function(){try{var Ye=new H.URL("b","http://a");return Ye.pathname="c d",Ye.href==="http://a/c%20d"&&Ye.searchParams}catch{return!1}},Ge=function(){var Ye=H.URL,rt=function(ve,ge){typeof ve!="string"&&(ve=String(ve)),ge&&typeof ge!="string"&&(ge=String(ge));var pe=document,j;if(ge&&(H.location===void 0||ge!==H.location.href)){ge=ge.toLowerCase(),pe=document.implementation.createHTMLDocument(""),j=pe.createElement("base"),j.href=ge,pe.head.appendChild(j);try{if(j.href.indexOf(ge)!==0)throw new Error(j.href)}catch(Tt){throw new Error("URL unable to set base "+ge+" due to "+Tt)}}var Te=pe.createElement("a");Te.href=ve,j&&(pe.body.appendChild(Te),Te.href=Te.href);var z=pe.createElement("input");if(z.type="url",z.value=ve,Te.protocol===":"||!/:/.test(Te.href)||!z.checkValidity()&&!ge)throw new TypeError("Invalid URL");Object.defineProperty(this,"_anchorElement",{value:Te});var Ze=new H.URLSearchParams(this.search),te=!0,ut=!0,at=this;["append","delete","set"].forEach(function(Tt){var Rt=Ze[Tt];Ze[Tt]=function(){Rt.apply(Ze,arguments),te&&(ut=!1,at.search=Ze.toString(),ut=!0)}}),Object.defineProperty(this,"searchParams",{value:Ze,enumerable:!0});var ht=void 0;Object.defineProperty(this,"_updateSearchParams",{enumerable:!1,configurable:!1,writable:!1,value:function(){this.search!==ht&&(ht=this.search,ut&&(te=!1,this.searchParams._fromString(this.search),te=!0))}})},ct=rt.prototype,mt=function(ve){Object.defineProperty(ct,ve,{get:function(){return this._anchorElement[ve]},set:function(ge){this._anchorElement[ve]=ge},enumerable:!0})};["hash","host","hostname","port","protocol"].forEach(function(ve){mt(ve)}),Object.defineProperty(ct,"search",{get:function(){return this._anchorElement.search},set:function(ve){this._anchorElement.search=ve,this._updateSearchParams()},enumerable:!0}),Object.defineProperties(ct,{toString:{get:function(){var ve=this;return function(){return ve.href}}},href:{get:function(){return this._anchorElement.href.replace(/\?$/,"")},set:function(ve){this._anchorElement.href=ve,this._updateSearchParams()},enumerable:!0},pathname:{get:function(){return this._anchorElement.pathname.replace(/(^\/?)/,"/")},set:function(ve){this._anchorElement.pathname=ve},enumerable:!0},origin:{get:function(){var ve={"http:":80,"https:":443,"ftp:":21}[this._anchorElement.protocol],ge=this._anchorElement.port!=ve&&this._anchorElement.port!=="";return this._anchorElement.protocol+"//"+this._anchorElement.hostname+(ge?":"+this._anchorElement.port:"")},enumerable:!0},password:{get:function(){return""},set:function(ve){},enumerable:!0},username:{get:function(){return""},set:function(ve){},enumerable:!0}}),rt.createObjectURL=function(ve){return Ye.createObjectURL.apply(Ye,arguments)},rt.revokeObjectURL=function(ve){return Ye.revokeObjectURL.apply(Ye,arguments)},H.URL=rt};if(Ie()||Ge(),H.location!==void 0&&!("origin"in H.location)){var De=function(){return H.location.protocol+"//"+H.location.hostname+(H.location.port?":"+H.location.port:"")};try{Object.defineProperty(H.location,"origin",{get:De,enumerable:!0})}catch{setInterval(function(){H.location.origin=De()},100)}}}(typeof oe.g<"u"?oe.g:typeof window<"u"?window:typeof self<"u"?self:this)},892232:function(nt,kt,oe){var H=oe(953327);function Ie(){return nt.exports=Ie=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(Ge,De,Ye){var rt=H(Ge,De);if(rt){var ct=Object.getOwnPropertyDescriptor(rt,De);return ct.get?ct.get.call(arguments.length<3?Ge:Ye):ct.value}},nt.exports.__esModule=!0,nt.exports.default=nt.exports,Ie.apply(null,arguments)}nt.exports=Ie,nt.exports.__esModule=!0,nt.exports.default=nt.exports},953327:function(nt,kt,oe){var H=oe(848664);function Ie(Ge,De){for(;!{}.hasOwnProperty.call(Ge,De)&&(Ge=H(Ge))!==null;);return Ge}nt.exports=Ie,nt.exports.__esModule=!0,nt.exports.default=nt.exports}}]);

//# sourceMappingURL=https://sourcemaps.squarespace.net/universal/scripts-compressed/sourcemaps/e1b40b531b679846/90215-532c7dd67b6e1759-min.en-US.js.map